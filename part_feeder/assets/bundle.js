/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={977:function(t,e){var i;!function(n){"use strict";var r=function(t){return.5*(Math.exp(t)+Math.exp(-t))},o=function(t){return.5*(Math.exp(t)-Math.exp(-t))},s=function(){throw SyntaxError("Invalid Param")};function a(t,e){var i=Math.abs(t),n=Math.abs(e);return 0===t?Math.log(n):0===e?Math.log(i):i<3e3&&n<3e3?.5*Math.log(t*t+e*e):Math.log(t/Math.cos(Math.atan2(e,t)))}function h(t,e){if(!(this instanceof h))return new h(t,e);var i=function(t,e){var i={re:0,im:0};if(null==t)i.re=i.im=0;else if(void 0!==e)i.re=t,i.im=e;else switch(typeof t){case"object":if("im"in t&&"re"in t)i.re=t.re,i.im=t.im;else if("abs"in t&&"arg"in t){if(!Number.isFinite(t.abs)&&Number.isFinite(t.arg))return h.INFINITY;i.re=t.abs*Math.cos(t.arg),i.im=t.abs*Math.sin(t.arg)}else if("r"in t&&"phi"in t){if(!Number.isFinite(t.r)&&Number.isFinite(t.phi))return h.INFINITY;i.re=t.r*Math.cos(t.phi),i.im=t.r*Math.sin(t.phi)}else 2===t.length?(i.re=t[0],i.im=t[1]):s();break;case"string":i.im=i.re=0;var n=t.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),r=1,o=0;null===n&&s();for(var a=0;a<n.length;a++){var u=n[a];" "===u||"\t"===u||"\n"===u||("+"===u?r++:"-"===u?o++:"i"===u||"I"===u?(r+o===0&&s()," "===n[a+1]||isNaN(n[a+1])?i.im+=parseFloat((o%2?"-":"")+"1"):(i.im+=parseFloat((o%2?"-":"")+n[a+1]),a++),r=o=0):((r+o===0||isNaN(u))&&s(),"i"===n[a+1]||"I"===n[a+1]?(i.im+=parseFloat((o%2?"-":"")+u),a++):i.re+=parseFloat((o%2?"-":"")+u),r=o=0))}r+o>0&&s();break;case"number":i.im=0,i.re=t;break;default:s()}return isNaN(i.re)||isNaN(i.im),i}(t,e);this.re=i.re,this.im=i.im}h.prototype={re:0,im:0,sign:function(){var t=this.abs();return new h(this.re/t,this.im/t)},add:function(t,e){var i=new h(t,e);return this.isInfinite()&&i.isInfinite()?h.NAN:this.isInfinite()||i.isInfinite()?h.INFINITY:new h(this.re+i.re,this.im+i.im)},sub:function(t,e){var i=new h(t,e);return this.isInfinite()&&i.isInfinite()?h.NAN:this.isInfinite()||i.isInfinite()?h.INFINITY:new h(this.re-i.re,this.im-i.im)},mul:function(t,e){var i=new h(t,e);return this.isInfinite()&&i.isZero()||this.isZero()&&i.isInfinite()?h.NAN:this.isInfinite()||i.isInfinite()?h.INFINITY:0===i.im&&0===this.im?new h(this.re*i.re,0):new h(this.re*i.re-this.im*i.im,this.re*i.im+this.im*i.re)},div:function(t,e){var i=new h(t,e);if(this.isZero()&&i.isZero()||this.isInfinite()&&i.isInfinite())return h.NAN;if(this.isInfinite()||i.isZero())return h.INFINITY;if(this.isZero()||i.isInfinite())return h.ZERO;t=this.re,e=this.im;var n,r,o=i.re,s=i.im;return 0===s?new h(t/o,e/o):Math.abs(o)<Math.abs(s)?new h((t*(r=o/s)+e)/(n=o*r+s),(e*r-t)/n):new h((t+e*(r=s/o))/(n=s*r+o),(e-t*r)/n)},pow:function(t,e){var i=new h(t,e);if(t=this.re,e=this.im,i.isZero())return h.ONE;if(0===i.im){if(0===e)return new h(Math.pow(t,i.re),0);if(0===t)switch((i.re%4+4)%4){case 0:return new h(Math.pow(e,i.re),0);case 1:return new h(0,Math.pow(e,i.re));case 2:return new h(-Math.pow(e,i.re),0);case 3:return new h(0,-Math.pow(e,i.re))}}if(0===t&&0===e&&i.re>0&&i.im>=0)return h.ZERO;var n=Math.atan2(e,t),r=a(t,e);return t=Math.exp(i.re*r-i.im*n),e=i.im*r+i.re*n,new h(t*Math.cos(e),t*Math.sin(e))},sqrt:function(){var t,e,i=this.re,n=this.im,r=this.abs();if(i>=0){if(0===n)return new h(Math.sqrt(i),0);t=.5*Math.sqrt(2*(r+i))}else t=Math.abs(n)/Math.sqrt(2*(r-i));return e=i<=0?.5*Math.sqrt(2*(r-i)):Math.abs(n)/Math.sqrt(2*(r+i)),new h(t,n<0?-e:e)},exp:function(){var t=Math.exp(this.re);return this.im,new h(t*Math.cos(this.im),t*Math.sin(this.im))},expm1:function(){var t=this.re,e=this.im;return new h(Math.expm1(t)*Math.cos(e)+function(t){var e=Math.PI/4;if(t<-e||t>e)return Math.cos(t)-1;var i=t*t;return i*(i*(1/24+i*(-1/720+i*(1/40320+i*(-1/3628800+i*(1/4790014600+i*(-1/87178291200+i*(1/20922789888e3)))))))-.5)}(e),Math.exp(t)*Math.sin(e))},log:function(){var t=this.re,e=this.im;return new h(a(t,e),Math.atan2(e,t))},abs:function(){return t=this.re,e=this.im,i=Math.abs(t),n=Math.abs(e),i<3e3&&n<3e3?Math.sqrt(i*i+n*n):(i<n?(i=n,n=t/e):n=e/t,i*Math.sqrt(1+n*n));var t,e,i,n},arg:function(){return Math.atan2(this.im,this.re)},sin:function(){var t=this.re,e=this.im;return new h(Math.sin(t)*r(e),Math.cos(t)*o(e))},cos:function(){var t=this.re,e=this.im;return new h(Math.cos(t)*r(e),-Math.sin(t)*o(e))},tan:function(){var t=2*this.re,e=2*this.im,i=Math.cos(t)+r(e);return new h(Math.sin(t)/i,o(e)/i)},cot:function(){var t=2*this.re,e=2*this.im,i=Math.cos(t)-r(e);return new h(-Math.sin(t)/i,o(e)/i)},sec:function(){var t=this.re,e=this.im,i=.5*r(2*e)+.5*Math.cos(2*t);return new h(Math.cos(t)*r(e)/i,Math.sin(t)*o(e)/i)},csc:function(){var t=this.re,e=this.im,i=.5*r(2*e)-.5*Math.cos(2*t);return new h(Math.sin(t)*r(e)/i,-Math.cos(t)*o(e)/i)},asin:function(){var t=this.re,e=this.im,i=new h(e*e-t*t+1,-2*t*e).sqrt(),n=new h(i.re-e,i.im+t).log();return new h(n.im,-n.re)},acos:function(){var t=this.re,e=this.im,i=new h(e*e-t*t+1,-2*t*e).sqrt(),n=new h(i.re-e,i.im+t).log();return new h(Math.PI/2-n.im,n.re)},atan:function(){var t=this.re,e=this.im;if(0===t){if(1===e)return new h(0,1/0);if(-1===e)return new h(0,-1/0)}var i=t*t+(1-e)*(1-e),n=new h((1-e*e-t*t)/i,-2*t/i).log();return new h(-.5*n.im,.5*n.re)},acot:function(){var t=this.re,e=this.im;if(0===e)return new h(Math.atan2(1,t),0);var i=t*t+e*e;return 0!==i?new h(t/i,-e/i).atan():new h(0!==t?t/0:0,0!==e?-e/0:0).atan()},asec:function(){var t=this.re,e=this.im;if(0===t&&0===e)return new h(0,1/0);var i=t*t+e*e;return 0!==i?new h(t/i,-e/i).acos():new h(0!==t?t/0:0,0!==e?-e/0:0).acos()},acsc:function(){var t=this.re,e=this.im;if(0===t&&0===e)return new h(Math.PI/2,1/0);var i=t*t+e*e;return 0!==i?new h(t/i,-e/i).asin():new h(0!==t?t/0:0,0!==e?-e/0:0).asin()},sinh:function(){var t=this.re,e=this.im;return new h(o(t)*Math.cos(e),r(t)*Math.sin(e))},cosh:function(){var t=this.re,e=this.im;return new h(r(t)*Math.cos(e),o(t)*Math.sin(e))},tanh:function(){var t=2*this.re,e=2*this.im,i=r(t)+Math.cos(e);return new h(o(t)/i,Math.sin(e)/i)},coth:function(){var t=2*this.re,e=2*this.im,i=r(t)-Math.cos(e);return new h(o(t)/i,-Math.sin(e)/i)},csch:function(){var t=this.re,e=this.im,i=Math.cos(2*e)-r(2*t);return new h(-2*o(t)*Math.cos(e)/i,2*r(t)*Math.sin(e)/i)},sech:function(){var t=this.re,e=this.im,i=Math.cos(2*e)+r(2*t);return new h(2*r(t)*Math.cos(e)/i,-2*o(t)*Math.sin(e)/i)},asinh:function(){var t=this.im;this.im=-this.re,this.re=t;var e=this.asin();return this.re=-this.im,this.im=t,t=e.re,e.re=-e.im,e.im=t,e},acosh:function(){var t=this.acos();if(t.im<=0){var e=t.re;t.re=-t.im,t.im=e}else e=t.im,t.im=-t.re,t.re=e;return t},atanh:function(){var t=this.re,e=this.im,i=t>1&&0===e,n=1-t,r=1+t,o=n*n+e*e,s=0!==o?new h((r*n-e*e)/o,(e*n+r*e)/o):new h(-1!==t?t/0:0,0!==e?e/0:0),u=s.re;return s.re=a(s.re,s.im)/2,s.im=Math.atan2(s.im,u)/2,i&&(s.im=-s.im),s},acoth:function(){var t=this.re,e=this.im;if(0===t&&0===e)return new h(0,Math.PI/2);var i=t*t+e*e;return 0!==i?new h(t/i,-e/i).atanh():new h(0!==t?t/0:0,0!==e?-e/0:0).atanh()},acsch:function(){var t=this.re,e=this.im;if(0===e)return new h(0!==t?Math.log(t+Math.sqrt(t*t+1)):1/0,0);var i=t*t+e*e;return 0!==i?new h(t/i,-e/i).asinh():new h(0!==t?t/0:0,0!==e?-e/0:0).asinh()},asech:function(){var t=this.re,e=this.im;if(this.isZero())return h.INFINITY;var i=t*t+e*e;return 0!==i?new h(t/i,-e/i).acosh():new h(0!==t?t/0:0,0!==e?-e/0:0).acosh()},inverse:function(){if(this.isZero())return h.INFINITY;if(this.isInfinite())return h.ZERO;var t=this.re,e=this.im,i=t*t+e*e;return new h(t/i,-e/i)},conjugate:function(){return new h(this.re,-this.im)},neg:function(){return new h(-this.re,-this.im)},ceil:function(t){return t=Math.pow(10,t||0),new h(Math.ceil(this.re*t)/t,Math.ceil(this.im*t)/t)},floor:function(t){return t=Math.pow(10,t||0),new h(Math.floor(this.re*t)/t,Math.floor(this.im*t)/t)},round:function(t){return t=Math.pow(10,t||0),new h(Math.round(this.re*t)/t,Math.round(this.im*t)/t)},equals:function(t,e){var i=new h(t,e);return Math.abs(i.re-this.re)<=h.EPSILON&&Math.abs(i.im-this.im)<=h.EPSILON},clone:function(){return new h(this.re,this.im)},toString:function(){var t=this.re,e=this.im,i="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":0===e?i+t:(0!==t?(i+=t,i+=" ",e<0?(e=-e,i+="-"):i+="+",i+=" "):e<0&&(e=-e,i+="-"),1!==e&&(i+=e),i+"i")},toVector:function(){return[this.re,this.im]},valueOf:function(){return 0===this.im?this.re:null},isNaN:function(){return isNaN(this.re)||isNaN(this.im)},isZero:function(){return 0===this.im&&0===this.re},isFinite:function(){return isFinite(this.re)&&isFinite(this.im)},isInfinite:function(){return!(this.isNaN()||this.isFinite())}},h.ZERO=new h(0,0),h.ONE=new h(1,0),h.I=new h(0,1),h.PI=new h(Math.PI,0),h.E=new h(Math.E,0),h.INFINITY=new h(1/0,1/0),h.NAN=new h(NaN,NaN),h.EPSILON=1e-16,void 0===(i=function(){return h}.apply(e,[]))||(t.exports=i)}()},776:function(t,e,i){var n;!function(r){"use strict";var o,s,a,h=9e15,u=1e9,c="0123456789abcdef",m="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",l="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",p={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-h,maxE:h,crypto:!1},_=!0,f="[DecimalError] ",d=f+"Invalid argument: ",y=f+"Precision limit exceeded",v=f+"crypto unavailable",g=Math.floor,x=Math.pow,b=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,A=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,w=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,B=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,M=1e7,C=m.length-1,S=l.length-1,z={name:"[object Decimal]"};function I(t){var e,i,n,r=t.length-1,o="",s=t[0];if(r>0){for(o+=s,e=1;e<r;e++)(i=7-(n=t[e]+"").length)&&(o+=k(i)),o+=n;(i=7-(n=(s=t[e])+"").length)&&(o+=k(i))}else if(0===s)return"0";for(;s%10==0;)s/=10;return o+s}function P(t,e,i){if(t!==~~t||t<e||t>i)throw Error(d+t)}function E(t,e,i,n){var r,o,s,a;for(o=t[0];o>=10;o/=10)--e;return--e<0?(e+=7,r=0):(r=Math.ceil((e+1)/7),e%=7),o=x(10,7-e),a=t[r]%o|0,null==n?e<3?(0==e?a=a/100|0:1==e&&(a=a/10|0),s=i<4&&99999==a||i>3&&49999==a||5e4==a||0==a):s=(i<4&&a+1==o||i>3&&a+1==o/2)&&(t[r+1]/o/100|0)==x(10,e-2)-1||(a==o/2||0==a)&&0==(t[r+1]/o/100|0):e<4?(0==e?a=a/1e3|0:1==e?a=a/100|0:2==e&&(a=a/10|0),s=(n||i<4)&&9999==a||!n&&i>3&&4999==a):s=((n||i<4)&&a+1==o||!n&&i>3&&a+1==o/2)&&(t[r+1]/o/1e3|0)==x(10,e-3)-1,s}function N(t,e,i){for(var n,r,o=[0],s=0,a=t.length;s<a;){for(r=o.length;r--;)o[r]*=e;for(o[0]+=c.indexOf(t.charAt(s++)),n=0;n<o.length;n++)o[n]>i-1&&(void 0===o[n+1]&&(o[n+1]=0),o[n+1]+=o[n]/i|0,o[n]%=i)}return o.reverse()}z.absoluteValue=z.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),T(t)},z.ceil=function(){return T(new this.constructor(this),this.e+1,2)},z.comparedTo=z.cmp=function(t){var e,i,n,r,o=this,s=o.d,a=(t=new o.constructor(t)).d,h=o.s,u=t.s;if(!s||!a)return h&&u?h!==u?h:s===a?0:!s^h<0?1:-1:NaN;if(!s[0]||!a[0])return s[0]?h:a[0]?-u:0;if(h!==u)return h;if(o.e!==t.e)return o.e>t.e^h<0?1:-1;for(e=0,i=(n=s.length)<(r=a.length)?n:r;e<i;++e)if(s[e]!==a[e])return s[e]>a[e]^h<0?1:-1;return n===r?0:n>r^h<0?1:-1},z.cosine=z.cos=function(){var t,e,i=this,n=i.constructor;return i.d?i.d[0]?(t=n.precision,e=n.rounding,n.precision=t+Math.max(i.e,i.sd())+7,n.rounding=1,i=function(t,e){var i,n,r=e.d.length;r<32?n=(1/X(4,i=Math.ceil(r/3))).toString():(i=16,n="2.3283064365386962890625e-10"),t.precision+=i,e=G(t,1,e.times(n),new t(1));for(var o=i;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return t.precision-=i,e}(n,K(n,i)),n.precision=t,n.rounding=e,T(2==a||3==a?i.neg():i,t,e,!0)):new n(1):new n(NaN)},z.cubeRoot=z.cbrt=function(){var t,e,i,n,r,o,s,a,h,u,c=this,m=c.constructor;if(!c.isFinite()||c.isZero())return new m(c);for(_=!1,(o=c.s*x(c.s*c,1/3))&&Math.abs(o)!=1/0?n=new m(o.toString()):(i=I(c.d),(o=((t=c.e)-i.length+1)%3)&&(i+=1==o||-2==o?"0":"00"),o=x(i,1/3),t=g((t+1)/3)-(t%3==(t<0?-1:2)),(n=new m(i=o==1/0?"5e"+t:(i=o.toExponential()).slice(0,i.indexOf("e")+1)+t)).s=c.s),s=(t=m.precision)+3;;)if(u=(h=(a=n).times(a).times(a)).plus(c),n=V(u.plus(c).times(a),u.plus(h),s+2,1),I(a.d).slice(0,s)===(i=I(n.d)).slice(0,s)){if("9999"!=(i=i.slice(s-3,s+1))&&(r||"4999"!=i)){+i&&(+i.slice(1)||"5"!=i.charAt(0))||(T(n,t+1,1),e=!n.times(n).times(n).eq(c));break}if(!r&&(T(a,t+1,0),a.times(a).times(a).eq(c))){n=a;break}s+=4,r=1}return _=!0,T(n,t,m.rounding,e)},z.decimalPlaces=z.dp=function(){var t,e=this.d,i=NaN;if(e){if(i=7*((t=e.length-1)-g(this.e/7)),t=e[t])for(;t%10==0;t/=10)i--;i<0&&(i=0)}return i},z.dividedBy=z.div=function(t){return V(this,new this.constructor(t))},z.dividedToIntegerBy=z.divToInt=function(t){var e=this.constructor;return T(V(this,new e(t),0,1,1),e.precision,e.rounding)},z.equals=z.eq=function(t){return 0===this.cmp(t)},z.floor=function(){return T(new this.constructor(this),this.e+1,3)},z.greaterThan=z.gt=function(t){return this.cmp(t)>0},z.greaterThanOrEqualTo=z.gte=function(t){var e=this.cmp(t);return 1==e||0===e},z.hyperbolicCosine=z.cosh=function(){var t,e,i,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;i=s.precision,n=s.rounding,s.precision=i+Math.max(o.e,o.sd())+4,s.rounding=1,(r=o.d.length)<32?e=(1/X(4,t=Math.ceil(r/3))).toString():(t=16,e="2.3283064365386962890625e-10"),o=G(s,1,o.times(e),new s(1),!0);for(var h,u=t,c=new s(8);u--;)h=o.times(o),o=a.minus(h.times(c.minus(h.times(c))));return T(o,s.precision=i,s.rounding=n,!0)},z.hyperbolicSine=z.sinh=function(){var t,e,i,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,i=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,(n=r.d.length)<3)r=G(o,2,r,r,!0);else{t=(t=1.4*Math.sqrt(n))>16?16:0|t,r=G(o,2,r=r.times(1/X(5,t)),r,!0);for(var s,a=new o(5),h=new o(16),u=new o(20);t--;)s=r.times(r),r=r.times(a.plus(s.times(h.times(s).plus(u))))}return o.precision=e,o.rounding=i,T(r,e,i,!0)},z.hyperbolicTangent=z.tanh=function(){var t,e,i=this,n=i.constructor;return i.isFinite()?i.isZero()?new n(i):(t=n.precision,e=n.rounding,n.precision=t+7,n.rounding=1,V(i.sinh(),i.cosh(),n.precision=t,n.rounding=e)):new n(i.s)},z.inverseCosine=z.acos=function(){var t,e=this,i=e.constructor,n=e.abs().cmp(1),r=i.precision,o=i.rounding;return-1!==n?0===n?e.isNeg()?L(i,r,o):new i(0):new i(NaN):e.isZero()?L(i,r+4,o).times(.5):(i.precision=r+6,i.rounding=1,e=e.asin(),t=L(i,r+4,o).times(.5),i.precision=r,i.rounding=o,t.minus(e))},z.inverseHyperbolicCosine=z.acosh=function(){var t,e,i=this,n=i.constructor;return i.lte(1)?new n(i.eq(1)?0:NaN):i.isFinite()?(t=n.precision,e=n.rounding,n.precision=t+Math.max(Math.abs(i.e),i.sd())+4,n.rounding=1,_=!1,i=i.times(i).minus(1).sqrt().plus(i),_=!0,n.precision=t,n.rounding=e,i.ln()):new n(i)},z.inverseHyperbolicSine=z.asinh=function(){var t,e,i=this,n=i.constructor;return!i.isFinite()||i.isZero()?new n(i):(t=n.precision,e=n.rounding,n.precision=t+2*Math.max(Math.abs(i.e),i.sd())+6,n.rounding=1,_=!1,i=i.times(i).plus(1).sqrt().plus(i),_=!0,n.precision=t,n.rounding=e,i.ln())},z.inverseHyperbolicTangent=z.atanh=function(){var t,e,i,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(t=o.precision,e=o.rounding,n=r.sd(),Math.max(n,t)<2*-r.e-1?T(new o(r),t,e,!0):(o.precision=i=n-r.e,r=V(r.plus(1),new o(1).minus(r),i+t,1),o.precision=t+4,o.rounding=1,r=r.ln(),o.precision=t,o.rounding=e,r.times(.5))):new o(NaN)},z.inverseSine=z.asin=function(){var t,e,i,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),i=o.precision,n=o.rounding,-1!==e?0===e?((t=L(o,i+4,n).times(.5)).s=r.s,t):new o(NaN):(o.precision=i+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=i,o.rounding=n,r.times(2)))},z.inverseTangent=z.atan=function(){var t,e,i,n,r,o,s,a,h,u=this,c=u.constructor,m=c.precision,l=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&m+4<=S)return(s=L(c,m+4,l).times(.25)).s=u.s,s}else{if(!u.s)return new c(NaN);if(m+4<=S)return(s=L(c,m+4,l).times(.5)).s=u.s,s}for(c.precision=a=m+10,c.rounding=1,t=i=Math.min(28,a/7+2|0);t;--t)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(_=!1,e=Math.ceil(a/7),n=1,h=u.times(u),s=new c(u),r=u;-1!==t;)if(r=r.times(h),o=s.minus(r.div(n+=2)),r=r.times(h),void 0!==(s=o.plus(r.div(n+=2))).d[e])for(t=e;s.d[t]===o.d[t]&&t--;);return i&&(s=s.times(2<<i-1)),_=!0,T(s,c.precision=m,c.rounding=l,!0)},z.isFinite=function(){return!!this.d},z.isInteger=z.isInt=function(){return!!this.d&&g(this.e/7)>this.d.length-2},z.isNaN=function(){return!this.s},z.isNegative=z.isNeg=function(){return this.s<0},z.isPositive=z.isPos=function(){return this.s>0},z.isZero=function(){return!!this.d&&0===this.d[0]},z.lessThan=z.lt=function(t){return this.cmp(t)<0},z.lessThanOrEqualTo=z.lte=function(t){return this.cmp(t)<1},z.logarithm=z.log=function(t){var e,i,n,r,o,s,a,h,u=this,c=u.constructor,m=c.precision,l=c.rounding;if(null==t)t=new c(10),e=!0;else{if(i=(t=new c(t)).d,t.s<0||!i||!i[0]||t.eq(1))return new c(NaN);e=t.eq(10)}if(i=u.d,u.s<0||!i||!i[0]||u.eq(1))return new c(i&&!i[0]?-1/0:1!=u.s?NaN:i?0:1/0);if(e)if(i.length>1)o=!0;else{for(r=i[0];r%10==0;)r/=10;o=1!==r}if(_=!1,s=U(u,a=m+5),n=e?q(c,a+10):U(t,a),E((h=V(s,n,a,1)).d,r=m,l))do{if(s=U(u,a+=10),n=e?q(c,a+10):U(t,a),h=V(s,n,a,1),!o){+I(h.d).slice(r+1,r+15)+1==1e14&&(h=T(h,m+1,0));break}}while(E(h.d,r+=10,l));return _=!0,T(h,m,l)},z.minus=z.sub=function(t){var e,i,n,r,o,s,a,h,u,c,m,l,p=this,f=p.constructor;if(t=new f(t),!p.d||!t.d)return p.s&&t.s?p.d?t.s=-t.s:t=new f(t.d||p.s!==t.s?p:NaN):t=new f(NaN),t;if(p.s!=t.s)return t.s=-t.s,p.plus(t);if(u=p.d,l=t.d,a=f.precision,h=f.rounding,!u[0]||!l[0]){if(l[0])t.s=-t.s;else{if(!u[0])return new f(3===h?-0:0);t=new f(p)}return _?T(t,a,h):t}if(i=g(t.e/7),c=g(p.e/7),u=u.slice(),o=c-i){for((m=o<0)?(e=u,o=-o,s=l.length):(e=l,i=c,s=u.length),o>(n=Math.max(Math.ceil(a/7),s)+2)&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for((m=(n=u.length)<(s=l.length))&&(s=n),n=0;n<s;n++)if(u[n]!=l[n]){m=u[n]<l[n];break}o=0}for(m&&(e=u,u=l,l=e,t.s=-t.s),s=u.length,n=l.length-s;n>0;--n)u[s++]=0;for(n=l.length;n>o;){if(u[--n]<l[n]){for(r=n;r&&0===u[--r];)u[r]=M-1;--u[r],u[n]+=M}u[n]-=l[n]}for(;0===u[--s];)u.pop();for(;0===u[0];u.shift())--i;return u[0]?(t.d=u,t.e=D(u,i),_?T(t,a,h):t):new f(3===h?-0:0)},z.modulo=z.mod=function(t){var e,i=this,n=i.constructor;return t=new n(t),!i.d||!t.s||t.d&&!t.d[0]?new n(NaN):!t.d||i.d&&!i.d[0]?T(new n(i),n.precision,n.rounding):(_=!1,9==n.modulo?(e=V(i,t.abs(),0,3,1)).s*=t.s:e=V(i,t,0,n.modulo,1),e=e.times(t),_=!0,i.minus(e))},z.naturalExponential=z.exp=function(){return Y(this)},z.naturalLogarithm=z.ln=function(){return U(this)},z.negated=z.neg=function(){var t=new this.constructor(this);return t.s=-t.s,T(t)},z.plus=z.add=function(t){var e,i,n,r,o,s,a,h,u,c,m=this,l=m.constructor;if(t=new l(t),!m.d||!t.d)return m.s&&t.s?m.d||(t=new l(t.d||m.s===t.s?m:NaN)):t=new l(NaN),t;if(m.s!=t.s)return t.s=-t.s,m.minus(t);if(u=m.d,c=t.d,a=l.precision,h=l.rounding,!u[0]||!c[0])return c[0]||(t=new l(m)),_?T(t,a,h):t;if(o=g(m.e/7),n=g(t.e/7),u=u.slice(),r=o-n){for(r<0?(i=u,r=-r,s=c.length):(i=c,n=o,s=u.length),r>(s=(o=Math.ceil(a/7))>s?o+1:s+1)&&(r=s,i.length=1),i.reverse();r--;)i.push(0);i.reverse()}for((s=u.length)-(r=c.length)<0&&(r=s,i=c,c=u,u=i),e=0;r;)e=(u[--r]=u[r]+c[r]+e)/M|0,u[r]%=M;for(e&&(u.unshift(e),++n),s=u.length;0==u[--s];)u.pop();return t.d=u,t.e=D(u,n),_?T(t,a,h):t},z.precision=z.sd=function(t){var e,i=this;if(void 0!==t&&t!==!!t&&1!==t&&0!==t)throw Error(d+t);return i.d?(e=O(i.d),t&&i.e+1>e&&(e=i.e+1)):e=NaN,e},z.round=function(){var t=this,e=t.constructor;return T(new e(t),t.e+1,e.rounding)},z.sine=z.sin=function(){var t,e,i=this,n=i.constructor;return i.isFinite()?i.isZero()?new n(i):(t=n.precision,e=n.rounding,n.precision=t+Math.max(i.e,i.sd())+7,n.rounding=1,i=function(t,e){var i,n=e.d.length;if(n<3)return G(t,2,e,e);i=(i=1.4*Math.sqrt(n))>16?16:0|i,e=G(t,2,e=e.times(1/X(5,i)),e);for(var r,o=new t(5),s=new t(16),a=new t(20);i--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}(n,K(n,i)),n.precision=t,n.rounding=e,T(a>2?i.neg():i,t,e,!0)):new n(NaN)},z.squareRoot=z.sqrt=function(){var t,e,i,n,r,o,s=this,a=s.d,h=s.e,u=s.s,c=s.constructor;if(1!==u||!a||!a[0])return new c(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(_=!1,0==(u=Math.sqrt(+s))||u==1/0?(((e=I(a)).length+h)%2==0&&(e+="0"),u=Math.sqrt(e),h=g((h+1)/2)-(h<0||h%2),n=new c(e=u==1/0?"5e"+h:(e=u.toExponential()).slice(0,e.indexOf("e")+1)+h)):n=new c(u.toString()),i=(h=c.precision)+3;;)if(n=(o=n).plus(V(s,o,i+2,1)).times(.5),I(o.d).slice(0,i)===(e=I(n.d)).slice(0,i)){if("9999"!=(e=e.slice(i-3,i+1))&&(r||"4999"!=e)){+e&&(+e.slice(1)||"5"!=e.charAt(0))||(T(n,h+1,1),t=!n.times(n).eq(s));break}if(!r&&(T(o,h+1,0),o.times(o).eq(s))){n=o;break}i+=4,r=1}return _=!0,T(n,h,c.rounding,t)},z.tangent=z.tan=function(){var t,e,i=this,n=i.constructor;return i.isFinite()?i.isZero()?new n(i):(t=n.precision,e=n.rounding,n.precision=t+10,n.rounding=1,(i=i.sin()).s=1,i=V(i,new n(1).minus(i.times(i)).sqrt(),t+10,0),n.precision=t,n.rounding=e,T(2==a||4==a?i.neg():i,t,e,!0)):new n(NaN)},z.times=z.mul=function(t){var e,i,n,r,o,s,a,h,u,c=this,m=c.constructor,l=c.d,p=(t=new m(t)).d;if(t.s*=c.s,!(l&&l[0]&&p&&p[0]))return new m(!t.s||l&&!l[0]&&!p||p&&!p[0]&&!l?NaN:l&&p?0*t.s:t.s/0);for(i=g(c.e/7)+g(t.e/7),(h=l.length)<(u=p.length)&&(o=l,l=p,p=o,s=h,h=u,u=s),o=[],n=s=h+u;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=h+n;r>n;)a=o[r]+p[n]*l[r-n-1]+e,o[r--]=a%M|0,e=a/M|0;o[r]=(o[r]+e)%M|0}for(;!o[--s];)o.pop();return e?++i:o.shift(),t.d=o,t.e=D(o,i),_?T(t,m.precision,m.rounding):t},z.toBinary=function(t,e){return $(this,2,t,e)},z.toDecimalPlaces=z.toDP=function(t,e){var i=this,n=i.constructor;return i=new n(i),void 0===t?i:(P(t,0,u),void 0===e?e=n.rounding:P(e,0,8),T(i,t+i.e+1,e))},z.toExponential=function(t,e){var i,n=this,r=n.constructor;return void 0===t?i=F(n,!0):(P(t,0,u),void 0===e?e=r.rounding:P(e,0,8),i=F(n=T(new r(n),t+1,e),!0,t+1)),n.isNeg()&&!n.isZero()?"-"+i:i},z.toFixed=function(t,e){var i,n,r=this,o=r.constructor;return void 0===t?i=F(r):(P(t,0,u),void 0===e?e=o.rounding:P(e,0,8),i=F(n=T(new o(r),t+r.e+1,e),!1,t+n.e+1)),r.isNeg()&&!r.isZero()?"-"+i:i},z.toFraction=function(t){var e,i,n,r,o,s,a,h,u,c,m,l,p=this,f=p.d,y=p.constructor;if(!f)return new y(p);if(u=i=new y(1),n=h=new y(0),s=(o=(e=new y(n)).e=O(f)-p.e-1)%7,e.d[0]=x(10,s<0?7+s:s),null==t)t=o>0?e:u;else{if(!(a=new y(t)).isInt()||a.lt(u))throw Error(d+a);t=a.gt(e)?o>0?e:u:a}for(_=!1,a=new y(I(f)),c=y.precision,y.precision=o=7*f.length*2;m=V(a,e,0,1,1),1!=(r=i.plus(m.times(n))).cmp(t);)i=n,n=r,r=u,u=h.plus(m.times(r)),h=r,r=e,e=a.minus(m.times(r)),a=r;return r=V(t.minus(i),n,0,1,1),h=h.plus(r.times(u)),i=i.plus(r.times(n)),h.s=u.s=p.s,l=V(u,n,o,1).minus(p).abs().cmp(V(h,i,o,1).minus(p).abs())<1?[u,n]:[h,i],y.precision=c,_=!0,l},z.toHexadecimal=z.toHex=function(t,e){return $(this,16,t,e)},z.toNearest=function(t,e){var i=this,n=i.constructor;if(i=new n(i),null==t){if(!i.d)return i;t=new n(1),e=n.rounding}else{if(t=new n(t),void 0===e?e=n.rounding:P(e,0,8),!i.d)return t.s?i:t;if(!t.d)return t.s&&(t.s=i.s),t}return t.d[0]?(_=!1,i=V(i,t,0,e,1).times(t),_=!0,T(i)):(t.s=i.s,i=t),i},z.toNumber=function(){return+this},z.toOctal=function(t,e){return $(this,8,t,e)},z.toPower=z.pow=function(t){var e,i,n,r,o,s,a=this,h=a.constructor,u=+(t=new h(t));if(!(a.d&&t.d&&a.d[0]&&t.d[0]))return new h(x(+a,u));if((a=new h(a)).eq(1))return a;if(n=h.precision,o=h.rounding,t.eq(1))return T(a,n,o);if((e=g(t.e/7))>=t.d.length-1&&(i=u<0?-u:u)<=9007199254740991)return r=j(h,a,i,n),t.s<0?new h(1).div(r):T(r,n,o);if((s=a.s)<0){if(e<t.d.length-1)return new h(NaN);if(0==(1&t.d[e])&&(s=1),0==a.e&&1==a.d[0]&&1==a.d.length)return a.s=s,a}return(e=0!=(i=x(+a,u))&&isFinite(i)?new h(i+"").e:g(u*(Math.log("0."+I(a.d))/Math.LN10+a.e+1)))>h.maxE+1||e<h.minE-1?new h(e>0?s/0:0):(_=!1,h.rounding=a.s=1,i=Math.min(12,(e+"").length),(r=Y(t.times(U(a,n+i)),n)).d&&E((r=T(r,n+5,1)).d,n,o)&&(e=n+10,+I((r=T(Y(t.times(U(a,e+i)),e),e+5,1)).d).slice(n+1,n+15)+1==1e14&&(r=T(r,n+1,0))),r.s=s,_=!0,h.rounding=o,T(r,n,o))},z.toPrecision=function(t,e){var i,n=this,r=n.constructor;return void 0===t?i=F(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(P(t,1,u),void 0===e?e=r.rounding:P(e,0,8),i=F(n=T(new r(n),t,e),t<=n.e||n.e<=r.toExpNeg,t)),n.isNeg()&&!n.isZero()?"-"+i:i},z.toSignificantDigits=z.toSD=function(t,e){var i=this.constructor;return void 0===t?(t=i.precision,e=i.rounding):(P(t,1,u),void 0===e?e=i.rounding:P(e,0,8)),T(new i(this),t,e)},z.toString=function(){var t=this,e=t.constructor,i=F(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+i:i},z.truncated=z.trunc=function(){return T(new this.constructor(this),this.e+1,1)},z.valueOf=z.toJSON=function(){var t=this,e=t.constructor,i=F(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+i:i};var V=function(){function t(t,e,i){var n,r=0,o=t.length;for(t=t.slice();o--;)n=t[o]*e+r,t[o]=n%i|0,r=n/i|0;return r&&t.unshift(r),t}function e(t,e,i,n){var r,o;if(i!=n)o=i>n?1:-1;else for(r=o=0;r<i;r++)if(t[r]!=e[r]){o=t[r]>e[r]?1:-1;break}return o}function i(t,e,i,n){for(var r=0;i--;)t[i]-=r,r=t[i]<e[i]?1:0,t[i]=r*n+t[i]-e[i];for(;!t[0]&&t.length>1;)t.shift()}return function(n,r,o,a,h,u){var c,m,l,p,_,f,d,y,v,x,b,A,w,B,C,S,z,I,P,E,N=n.constructor,V=n.s==r.s?1:-1,F=n.d,D=r.d;if(!(F&&F[0]&&D&&D[0]))return new N(n.s&&r.s&&(F?!D||F[0]!=D[0]:D)?F&&0==F[0]||!D?0*V:V/0:NaN);for(u?(_=1,m=n.e-r.e):(u=M,_=7,m=g(n.e/_)-g(r.e/_)),P=D.length,z=F.length,x=(v=new N(V)).d=[],l=0;D[l]==(F[l]||0);l++);if(D[l]>(F[l]||0)&&m--,null==o?(B=o=N.precision,a=N.rounding):B=h?o+(n.e-r.e)+1:o,B<0)x.push(1),f=!0;else{if(B=B/_+2|0,l=0,1==P){for(p=0,D=D[0],B++;(l<z||p)&&B--;l++)C=p*u+(F[l]||0),x[l]=C/D|0,p=C%D|0;f=p||l<z}else{for((p=u/(D[0]+1)|0)>1&&(D=t(D,p,u),F=t(F,p,u),P=D.length,z=F.length),S=P,A=(b=F.slice(0,P)).length;A<P;)b[A++]=0;(E=D.slice()).unshift(0),I=D[0],D[1]>=u/2&&++I;do{p=0,(c=e(D,b,P,A))<0?(w=b[0],P!=A&&(w=w*u+(b[1]||0)),(p=w/I|0)>1?(p>=u&&(p=u-1),1==(c=e(d=t(D,p,u),b,y=d.length,A=b.length))&&(p--,i(d,P<y?E:D,y,u))):(0==p&&(c=p=1),d=D.slice()),(y=d.length)<A&&d.unshift(0),i(b,d,A,u),-1==c&&(c=e(D,b,P,A=b.length))<1&&(p++,i(b,P<A?E:D,A,u)),A=b.length):0===c&&(p++,b=[0]),x[l++]=p,c&&b[0]?b[A++]=F[S]||0:(b=[F[S]],A=1)}while((S++<z||void 0!==b[0])&&B--);f=void 0!==b[0]}x[0]||x.shift()}if(1==_)v.e=m,s=f;else{for(l=1,p=x[0];p>=10;p/=10)l++;v.e=l+m*_-1,T(v,h?o+v.e+1:o,a,f)}return v}}();function T(t,e,i,n){var r,o,s,a,h,u,c,m,l,p=t.constructor;t:if(null!=e){if(!(m=t.d))return t;for(r=1,a=m[0];a>=10;a/=10)r++;if((o=e-r)<0)o+=7,s=e,h=(c=m[l=0])/x(10,r-s-1)%10|0;else if((l=Math.ceil((o+1)/7))>=(a=m.length)){if(!n)break t;for(;a++<=l;)m.push(0);c=h=0,r=1,s=(o%=7)-7+1}else{for(c=a=m[l],r=1;a>=10;a/=10)r++;h=(s=(o%=7)-7+r)<0?0:c/x(10,r-s-1)%10|0}if(n=n||e<0||void 0!==m[l+1]||(s<0?c:c%x(10,r-s-1)),u=i<4?(h||n)&&(0==i||i==(t.s<0?3:2)):h>5||5==h&&(4==i||n||6==i&&(o>0?s>0?c/x(10,r-s):0:m[l-1])%10&1||i==(t.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=t.e+1,m[0]=x(10,(7-e%7)%7),t.e=-e||0):m[0]=t.e=0,t;if(0==o?(m.length=l,a=1,l--):(m.length=l+1,a=x(10,7-o),m[l]=s>0?(c/x(10,r-s)%x(10,s)|0)*a:0),u)for(;;){if(0==l){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(t.e++,m[0]==M&&(m[0]=1));break}if(m[l]+=a,m[l]!=M)break;m[l--]=0,a=1}for(o=m.length;0===m[--o];)m.pop()}return _&&(t.e>p.maxE?(t.d=null,t.e=NaN):t.e<p.minE&&(t.e=0,t.d=[0])),t}function F(t,e,i){if(!t.isFinite())return W(t);var n,r=t.e,o=I(t.d),s=o.length;return e?(i&&(n=i-s)>0?o=o.charAt(0)+"."+o.slice(1)+k(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(t.e<0?"e":"e+")+t.e):r<0?(o="0."+k(-r-1)+o,i&&(n=i-s)>0&&(o+=k(n))):r>=s?(o+=k(r+1-s),i&&(n=i-r-1)>0&&(o=o+"."+k(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),i&&(n=i-s)>0&&(r+1===s&&(o+="."),o+=k(n))),o}function D(t,e){var i=t[0];for(e*=7;i>=10;i/=10)e++;return e}function q(t,e,i){if(e>C)throw _=!0,i&&(t.precision=i),Error(y);return T(new t(m),e,1,!0)}function L(t,e,i){if(e>S)throw Error(y);return T(new t(l),e,i,!0)}function O(t){var e=t.length-1,i=7*e+1;if(e=t[e]){for(;e%10==0;e/=10)i--;for(e=t[0];e>=10;e/=10)i++}return i}function k(t){for(var e="";t--;)e+="0";return e}function j(t,e,i,n){var r,o=new t(1),s=Math.ceil(n/7+4);for(_=!1;;){if(i%2&&Q((o=o.times(e)).d,s)&&(r=!0),0===(i=g(i/2))){i=o.d.length-1,r&&0===o.d[i]&&++o.d[i];break}Q((e=e.times(e)).d,s)}return _=!0,o}function R(t){return 1&t.d[t.d.length-1]}function J(t,e,i){for(var n,r=new t(e[0]),o=0;++o<e.length;){if(!(n=new t(e[o])).s){r=n;break}r[i](n)&&(r=n)}return r}function Y(t,e){var i,n,r,o,s,a,h,u=0,c=0,m=0,l=t.constructor,p=l.rounding,f=l.precision;if(!t.d||!t.d[0]||t.e>17)return new l(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:NaN);for(null==e?(_=!1,h=f):h=e,a=new l(.03125);t.e>-2;)t=t.times(a),m+=5;for(h+=n=Math.log(x(2,m))/Math.LN10*2+5|0,i=o=s=new l(1),l.precision=h;;){if(o=T(o.times(t),h,1),i=i.times(++c),I((a=s.plus(V(o,i,h,1))).d).slice(0,h)===I(s.d).slice(0,h)){for(r=m;r--;)s=T(s.times(s),h,1);if(null!=e)return l.precision=f,s;if(!(u<3&&E(s.d,h-n,p,u)))return T(s,l.precision=f,p,_=!0);l.precision=h+=10,i=o=a=new l(1),c=0,u++}s=a}}function U(t,e){var i,n,r,o,s,a,h,u,c,m,l,p=1,f=t,d=f.d,y=f.constructor,v=y.rounding,g=y.precision;if(f.s<0||!d||!d[0]||!f.e&&1==d[0]&&1==d.length)return new y(d&&!d[0]?-1/0:1!=f.s?NaN:d?0:f);if(null==e?(_=!1,c=g):c=e,y.precision=c+=10,n=(i=I(d)).charAt(0),!(Math.abs(o=f.e)<15e14))return u=q(y,c+2,g).times(o+""),f=U(new y(n+"."+i.slice(1)),c-10).plus(u),y.precision=g,null==e?T(f,g,v,_=!0):f;for(;n<7&&1!=n||1==n&&i.charAt(1)>3;)n=(i=I((f=f.times(t)).d)).charAt(0),p++;for(o=f.e,n>1?(f=new y("0."+i),o++):f=new y(n+"."+i.slice(1)),m=f,h=s=f=V(f.minus(1),f.plus(1),c,1),l=T(f.times(f),c,1),r=3;;){if(s=T(s.times(l),c,1),I((u=h.plus(V(s,new y(r),c,1))).d).slice(0,c)===I(h.d).slice(0,c)){if(h=h.times(2),0!==o&&(h=h.plus(q(y,c+2,g).times(o+""))),h=V(h,new y(p),c,1),null!=e)return y.precision=g,h;if(!E(h.d,c-10,v,a))return T(h,y.precision=g,v,_=!0);y.precision=c+=10,u=s=f=V(m.minus(1),m.plus(1),c,1),l=T(f.times(f),c,1),r=a=1}h=u,r+=2}}function W(t){return String(t.s*t.s/0)}function Z(t,e){var i,n,r;for((i=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(i<0&&(i=n),i+=+e.slice(n+1),e=e.substring(0,n)):i<0&&(i=e.length),n=0;48===e.charCodeAt(n);n++);for(r=e.length;48===e.charCodeAt(r-1);--r);if(e=e.slice(n,r)){if(r-=n,t.e=i=i-n-1,t.d=[],n=(i+1)%7,i<0&&(n+=7),n<r){for(n&&t.d.push(+e.slice(0,n)),r-=7;n<r;)t.d.push(+e.slice(n,n+=7));n=7-(e=e.slice(n)).length}else n-=r;for(;n--;)e+="0";t.d.push(+e),_&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function H(t,e){var i,n,r,s,a,h,u,c,m;if("Infinity"===e||"NaN"===e)return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(A.test(e))i=16,e=e.toLowerCase();else if(b.test(e))i=2;else{if(!w.test(e))throw Error(d+e);i=8}for((s=e.search(/p/i))>0?(u=+e.slice(s+1),e=e.substring(2,s)):e=e.slice(2),a=(s=e.indexOf("."))>=0,n=t.constructor,a&&(s=(h=(e=e.replace(".","")).length)-s,r=j(n,new n(i),s,2*s)),s=m=(c=N(e,i,M)).length-1;0===c[s];--s)c.pop();return s<0?new n(0*t.s):(t.e=D(c,m),t.d=c,_=!1,a&&(t=V(t,r,4*h)),u&&(t=t.times(Math.abs(u)<54?x(2,u):o.pow(2,u))),_=!0,t)}function G(t,e,i,n,r){var o,s,a,h,u=t.precision,c=Math.ceil(u/7);for(_=!1,h=i.times(i),a=new t(n);;){if(s=V(a.times(h),new t(e++*e++),u,1),a=r?n.plus(s):n.minus(s),n=V(s.times(h),new t(e++*e++),u,1),void 0!==(s=a.plus(n)).d[c]){for(o=c;s.d[o]===a.d[o]&&o--;);if(-1==o)break}o=a,a=n,n=s,s=o}return _=!0,s.d.length=c+1,s}function X(t,e){for(var i=t;--e;)i*=t;return i}function K(t,e){var i,n=e.s<0,r=L(t,t.precision,1),o=r.times(.5);if((e=e.abs()).lte(o))return a=n?4:1,e;if((i=e.divToInt(r)).isZero())a=n?3:2;else{if((e=e.minus(i.times(r))).lte(o))return a=R(i)?n?2:3:n?4:1,e;a=R(i)?n?1:4:n?3:2}return e.minus(r).abs()}function $(t,e,i,n){var r,o,a,h,m,l,p,_,f,d=t.constructor,y=void 0!==i;if(y?(P(i,1,u),void 0===n?n=d.rounding:P(n,0,8)):(i=d.precision,n=d.rounding),t.isFinite()){for(y?(r=2,16==e?i=4*i-3:8==e&&(i=3*i-2)):r=e,(a=(p=F(t)).indexOf("."))>=0&&(p=p.replace(".",""),(f=new d(1)).e=p.length-a,f.d=N(F(f),10,r),f.e=f.d.length),o=m=(_=N(p,10,r)).length;0==_[--m];)_.pop();if(_[0]){if(a<0?o--:((t=new d(t)).d=_,t.e=o,_=(t=V(t,f,i,n,0,r)).d,o=t.e,l=s),a=_[i],h=r/2,l=l||void 0!==_[i+1],l=n<4?(void 0!==a||l)&&(0===n||n===(t.s<0?3:2)):a>h||a===h&&(4===n||l||6===n&&1&_[i-1]||n===(t.s<0?8:7)),_.length=i,l)for(;++_[--i]>r-1;)_[i]=0,i||(++o,_.unshift(1));for(m=_.length;!_[m-1];--m);for(a=0,p="";a<m;a++)p+=c.charAt(_[a]);if(y){if(m>1)if(16==e||8==e){for(a=16==e?4:3,--m;m%a;m++)p+="0";for(m=(_=N(p,r,e)).length;!_[m-1];--m);for(a=1,p="1.";a<m;a++)p+=c.charAt(_[a])}else p=p.charAt(0)+"."+p.slice(1);p=p+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)p="0"+p;p="0."+p}else if(++o>m)for(o-=m;o--;)p+="0";else o<m&&(p=p.slice(0,o)+"."+p.slice(o))}else p=y?"0p+0":"0";p=(16==e?"0x":2==e?"0b":8==e?"0o":"")+p}else p=W(t);return t.s<0?"-"+p:p}function Q(t,e){if(t.length>e)return t.length=e,!0}function tt(t){return new this(t).abs()}function et(t){return new this(t).acos()}function it(t){return new this(t).acosh()}function nt(t,e){return new this(t).plus(e)}function rt(t){return new this(t).asin()}function ot(t){return new this(t).asinh()}function st(t){return new this(t).atan()}function at(t){return new this(t).atanh()}function ht(t,e){t=new this(t),e=new this(e);var i,n=this.precision,r=this.rounding,o=n+4;return t.s&&e.s?t.d||e.d?!e.d||t.isZero()?(i=e.s<0?L(this,n,r):new this(0)).s=t.s:!t.d||e.isZero()?(i=L(this,o,1).times(.5)).s=t.s:e.s<0?(this.precision=o,this.rounding=1,i=this.atan(V(t,e,o,1)),e=L(this,o,1),this.precision=n,this.rounding=r,i=t.s<0?i.minus(e):i.plus(e)):i=this.atan(V(t,e,o,1)):(i=L(this,o,1).times(e.s>0?.25:.75)).s=t.s:i=new this(NaN),i}function ut(t){return new this(t).cbrt()}function ct(t){return T(t=new this(t),t.e+1,2)}function mt(t){if(!t||"object"!=typeof t)throw Error(f+"Object expected");var e,i,n,r=!0===t.defaults,o=["precision",1,u,"rounding",0,8,"toExpNeg",-h,0,"toExpPos",0,h,"maxE",0,h,"minE",-h,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(i=o[e],r&&(this[i]=p[i]),void 0!==(n=t[i])){if(!(g(n)===n&&n>=o[e+1]&&n<=o[e+2]))throw Error(d+i+": "+n);this[i]=n}if(i="crypto",r&&(this[i]=p[i]),void 0!==(n=t[i])){if(!0!==n&&!1!==n&&0!==n&&1!==n)throw Error(d+i+": "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(v);this[i]=!0}else this[i]=!1}return this}function lt(t){return new this(t).cos()}function pt(t){return new this(t).cosh()}function _t(t,e){return new this(t).div(e)}function ft(t){return new this(t).exp()}function dt(t){return T(t=new this(t),t.e+1,3)}function yt(){var t,e,i=new this(0);for(_=!1,t=0;t<arguments.length;)if((e=new this(arguments[t++])).d)i.d&&(i=i.plus(e.times(e)));else{if(e.s)return _=!0,new this(1/0);i=e}return _=!0,i.sqrt()}function vt(t){return t instanceof o||t&&"[object Decimal]"===t.name||!1}function gt(t){return new this(t).ln()}function xt(t,e){return new this(t).log(e)}function bt(t){return new this(t).log(2)}function At(t){return new this(t).log(10)}function wt(){return J(this,arguments,"lt")}function Bt(){return J(this,arguments,"gt")}function Mt(t,e){return new this(t).mod(e)}function Ct(t,e){return new this(t).mul(e)}function St(t,e){return new this(t).pow(e)}function zt(t){var e,i,n,r,o=0,s=new this(1),a=[];if(void 0===t?t=this.precision:P(t,1,u),n=Math.ceil(t/7),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)(r=e[o])>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else{if(!crypto.randomBytes)throw Error(v);for(e=crypto.randomBytes(n*=4);o<n;)(r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((127&e[o+3])<<24))>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else for(;o<n;)a[o++]=1e7*Math.random()|0;for(t%=7,(n=a[--o])&&t&&(r=x(10,7-t),a[o]=(n/r|0)*r);0===a[o];o--)a.pop();if(o<0)i=0,a=[0];else{for(i=-1;0===a[0];i-=7)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<7&&(i-=7-n)}return s.e=i,s.d=a,s}function It(t){return T(t=new this(t),t.e+1,this.rounding)}function Pt(t){return(t=new this(t)).d?t.d[0]?t.s:0*t.s:t.s||NaN}function Et(t){return new this(t).sin()}function Nt(t){return new this(t).sinh()}function Vt(t){return new this(t).sqrt()}function Tt(t,e){return new this(t).sub(e)}function Ft(t){return new this(t).tan()}function Dt(t){return new this(t).tanh()}function qt(t){return T(t=new this(t),t.e+1,1)}(o=function t(e){var i,n,r;function o(t){var e,i,n,r=this;if(!(r instanceof o))return new o(t);if(r.constructor=o,t instanceof o)return r.s=t.s,void(_?!t.d||t.e>o.maxE?(r.e=NaN,r.d=null):t.e<o.minE?(r.e=0,r.d=[0]):(r.e=t.e,r.d=t.d.slice()):(r.e=t.e,r.d=t.d?t.d.slice():t.d));if("number"==(n=typeof t)){if(0===t)return r.s=1/t<0?-1:1,r.e=0,void(r.d=[0]);if(t<0?(t=-t,r.s=-1):r.s=1,t===~~t&&t<1e7){for(e=0,i=t;i>=10;i/=10)e++;return void(_?e>o.maxE?(r.e=NaN,r.d=null):e<o.minE?(r.e=0,r.d=[0]):(r.e=e,r.d=[t]):(r.e=e,r.d=[t]))}return 0*t!=0?(t||(r.s=NaN),r.e=NaN,void(r.d=null)):Z(r,t.toString())}if("string"!==n)throw Error(d+t);return 45===(i=t.charCodeAt(0))?(t=t.slice(1),r.s=-1):(43===i&&(t=t.slice(1)),r.s=1),B.test(t)?Z(r,t):H(r,t)}if(o.prototype=z,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=mt,o.clone=t,o.isDecimal=vt,o.abs=tt,o.acos=et,o.acosh=it,o.add=nt,o.asin=rt,o.asinh=ot,o.atan=st,o.atanh=at,o.atan2=ht,o.cbrt=ut,o.ceil=ct,o.cos=lt,o.cosh=pt,o.div=_t,o.exp=ft,o.floor=dt,o.hypot=yt,o.ln=gt,o.log=xt,o.log10=At,o.log2=bt,o.max=wt,o.min=Bt,o.mod=Mt,o.mul=Ct,o.pow=St,o.random=zt,o.round=It,o.sign=Pt,o.sin=Et,o.sinh=Nt,o.sqrt=Vt,o.sub=Tt,o.tan=Ft,o.tanh=Dt,o.trunc=qt,void 0===e&&(e={}),e&&!0!==e.defaults)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],i=0;i<r.length;)e.hasOwnProperty(n=r[i++])||(e[n]=this[n]);return o.config(e),o}(p)).default=o.Decimal=o,m=new o(m),l=new o(l),void 0===(n=function(){return o}.call(e,i,e,t))||(t.exports=n)}()},628:function(t,e){var i;!function(n){"use strict";var r={s:1,n:0,d:1};function o(t){function e(){var e=Error.apply(this,arguments);e.name=this.name=t,this.stack=e.stack,this.message=e.message}function i(){}return i.prototype=Error.prototype,e.prototype=new i,e}var s=l.DivisionByZero=o("DivisionByZero"),a=l.InvalidParameter=o("InvalidParameter");function h(t,e){return isNaN(t=parseInt(t,10))&&u(),t*e}function u(){throw new a}var c=function(t,e){var i,n=0,o=1,a=1,c=0,m=0,l=0,p=1,_=1,f=0,d=1,y=1,v=1,g=1e7;if(null==t);else if(void 0!==e)a=(n=t)*(o=e);else switch(typeof t){case"object":"d"in t&&"n"in t?(n=t.n,o=t.d,"s"in t&&(n*=t.s)):0 in t?(n=t[0],1 in t&&(o=t[1])):u(),a=n*o;break;case"number":if(t<0&&(a=t,t=-t),t%1==0)n=t;else if(t>0){for(t>=1&&(t/=_=Math.pow(10,Math.floor(1+Math.log(t)/Math.LN10)));d<=g&&v<=g;){if(t===(i=(f+y)/(d+v))){d+v<=g?(n=f+y,o=d+v):v>d?(n=y,o=v):(n=f,o=d);break}t>i?(f+=y,d+=v):(y+=f,v+=d),d>g?(n=y,o=v):(n=f,o=d)}n*=_}else(isNaN(t)||isNaN(e))&&(o=n=NaN);break;case"string":if(null===(d=t.match(/\d+|./g))&&u(),"-"===d[f]?(a=-1,f++):"+"===d[f]&&f++,d.length===f+1?m=h(d[f++],a):"."===d[f+1]||"."===d[f]?("."!==d[f]&&(c=h(d[f++],a)),(1+ ++f===d.length||"("===d[f+1]&&")"===d[f+3]||"'"===d[f+1]&&"'"===d[f+3])&&(m=h(d[f],a),p=Math.pow(10,d[f].length),f++),("("===d[f]&&")"===d[f+2]||"'"===d[f]&&"'"===d[f+2])&&(l=h(d[f+1],a),_=Math.pow(10,d[f+1].length)-1,f+=3)):"/"===d[f+1]||":"===d[f+1]?(m=h(d[f],a),p=h(d[f+2],1),f+=3):"/"===d[f+3]&&" "===d[f+1]&&(c=h(d[f],a),m=h(d[f+2],a),p=h(d[f+4],1),f+=5),d.length<=f){a=n=l+(o=p*_)*c+_*m;break}default:u()}if(0===o)throw new s;r.s=a<0?-1:1,r.n=Math.abs(n),r.d=Math.abs(o)};function m(t,e){if(!t)return e;if(!e)return t;for(;;){if(!(t%=e))return e;if(!(e%=t))return t}}function l(t,e){if(!(this instanceof l))return new l(t,e);c(t,e),t=l.REDUCE?m(r.d,r.n):1,this.s=r.s,this.n=r.n/t,this.d=r.d/t}l.REDUCE=1,l.prototype={s:1,n:0,d:1,abs:function(){return new l(this.n,this.d)},neg:function(){return new l(-this.s*this.n,this.d)},add:function(t,e){return c(t,e),new l(this.s*this.n*r.d+r.s*this.d*r.n,this.d*r.d)},sub:function(t,e){return c(t,e),new l(this.s*this.n*r.d-r.s*this.d*r.n,this.d*r.d)},mul:function(t,e){return c(t,e),new l(this.s*r.s*this.n*r.n,this.d*r.d)},div:function(t,e){return c(t,e),new l(this.s*r.s*this.n*r.d,this.d*r.n)},clone:function(){return new l(this)},mod:function(t,e){return isNaN(this.n)||isNaN(this.d)?new l(NaN):void 0===t?new l(this.s*this.n%this.d,1):(c(t,e),0===r.n&&0===this.d&&l(0,0),new l(this.s*(r.d*this.n)%(r.n*this.d),r.d*this.d))},gcd:function(t,e){return c(t,e),new l(m(r.n,this.n)*m(r.d,this.d),r.d*this.d)},lcm:function(t,e){return c(t,e),0===r.n&&0===this.n?new l:new l(r.n*this.n,m(r.n,this.n)*m(r.d,this.d))},ceil:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new l(NaN):new l(Math.ceil(t*this.s*this.n/this.d),t)},floor:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new l(NaN):new l(Math.floor(t*this.s*this.n/this.d),t)},round:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new l(NaN):new l(Math.round(t*this.s*this.n/this.d),t)},inverse:function(){return new l(this.s*this.d,this.n)},pow:function(t){return t<0?new l(Math.pow(this.s*this.d,-t),Math.pow(this.n,-t)):new l(Math.pow(this.s*this.n,t),Math.pow(this.d,t))},equals:function(t,e){return c(t,e),this.s*this.n*r.d==r.s*r.n*this.d},compare:function(t,e){c(t,e);var i=this.s*this.n*r.d-r.s*r.n*this.d;return(0<i)-(i<0)},simplify:function(t){if(isNaN(this.n)||isNaN(this.d))return this;var e=this.abs().toContinued();function i(t){return 1===t.length?new l(t[0]):i(t.slice(1)).inverse().add(t[0])}t=t||.001;for(var n=0;n<e.length;n++){var r=i(e.slice(0,n+1));if(r.sub(this.abs()).abs().valueOf()<t)return r.mul(this.s)}return this},divisible:function(t,e){return c(t,e),!(!(r.n*this.d)||this.n*r.d%(r.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(t){var e,i="",n=this.n,r=this.d;return this.s<0&&(i+="-"),1===r?i+=n:(t&&(e=Math.floor(n/r))>0&&(i+=e,i+=" ",n%=r),i+=n,i+="/",i+=r),i},toLatex:function(t){var e,i="",n=this.n,r=this.d;return this.s<0&&(i+="-"),1===r?i+=n:(t&&(e=Math.floor(n/r))>0&&(i+=e,n%=r),i+="\\frac{",i+=n,i+="}{",i+=r,i+="}"),i},toContinued:function(){var t,e=this.n,i=this.d,n=[];if(isNaN(e)||isNaN(i))return n;do{n.push(Math.floor(e/i)),t=e%i,e=i,i=t}while(1!==e);return n},toString:function(t){var e,i=this.n,n=this.d;if(isNaN(i)||isNaN(n))return"NaN";l.REDUCE||(i/=e=m(i,n),n/=e),t=t||15;var r=function(t,e){for(;e%2==0;e/=2);for(;e%5==0;e/=5);if(1===e)return 0;for(var i=10%e,n=1;1!==i;n++)if(i=10*i%e,n>2e3)return 0;return n}(0,n),o=function(t,e,i){for(var n=1,r=function(t,e,i){for(var n=1;e>0;t=t*t%i,e>>=1)1&e&&(n=n*t%i);return n}(10,i,e),o=0;o<300;o++){if(n===r)return o;n=10*n%e,r=10*r%e}return 0}(0,n,r),s=-1===this.s?"-":"";if(s+=i/n|0,i%=n,(i*=10)&&(s+="."),r){for(var a=o;a--;)s+=i/n|0,i%=n,i*=10;for(s+="(",a=r;a--;)s+=i/n|0,i%=n,i*=10;s+=")"}else for(a=t;i&&a--;)s+=i/n|0,i%=n,i*=10;return s}},void 0===(i=function(){return l}.apply(e,[]))||(t.exports=i)}()},228:t=>{t.exports=function t(e,i){"use strict";var n,r,o=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,s=/(^[ ]*|[ ]*$)/g,a=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,h=/^0x[0-9a-f]+$/i,u=/^0/,c=function(e){return t.insensitive&&(""+e).toLowerCase()||""+e},m=c(e).replace(s,"")||"",l=c(i).replace(s,"")||"",p=m.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),_=l.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),f=parseInt(m.match(h),16)||1!==p.length&&m.match(a)&&Date.parse(m),d=parseInt(l.match(h),16)||f&&l.match(a)&&Date.parse(l)||null;if(d){if(f<d)return-1;if(f>d)return 1}for(var y=0,v=Math.max(p.length,_.length);y<v;y++){if(n=!(p[y]||"").match(u)&&parseFloat(p[y])||p[y]||0,r=!(_[y]||"").match(u)&&parseFloat(_[y])||_[y]||0,isNaN(n)!==isNaN(r))return isNaN(n)?1:-1;if(typeof n!=typeof r&&(n+="",r+=""),n<r)return-1;if(n>r)return 1}return 0}},495:function(t,e){!function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){null==t&&(t={});var i=Object.assign({},t);for(var n in e)e.hasOwnProperty(n)&&void 0===t[n]&&(i[n]=e[n]);if("function"==typeof Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(e),o=0;o<r.length;o++){var s=r[o];e.propertyIsEnumerable(s)&&void 0===t[n]&&(i[s]=e[s])}return i}var n=function(){},r=Math,o=Object.create(r);function s(t,i){if(!(this instanceof s))return new s(t,i);void 0===t?(this.x=0,this.y=0):"object"===e(t)?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i)}o.EPSILON=1e-9,o.isFinite=function(t){return"number"==typeof t&&isFinite(t)&&!isNaN(t)},o.assert=function(t){},o.invSqrt=function(t){return 1/r.sqrt(t)},o.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,1+((t|=t>>8)|t>>16)},o.isPowerOfTwo=function(t){return t>0&&0==(t&t-1)},o.mod=function(t,e,i){return void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)},o.clamp=function(t,e,i){return t<e?e:t>i?i:t},o.random=function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t==e?t:r.random()*(e-t)+t},s.prototype._serialize=function(){return{x:this.x,y:this.y}},s._deserialize=function(t){var e=Object.create(s.prototype);return e.x=t.x,e.y=t.y,e},s.zero=function(){var t=Object.create(s.prototype);return t.x=0,t.y=0,t},s.neo=function(t,e){var i=Object.create(s.prototype);return i.x=t,i.y=e,i},s.clone=function(t){return s.neo(t.x,t.y)},s.prototype.toString=function(){return JSON.stringify(this)},s.isValid=function(t){return t&&o.isFinite(t.x)&&o.isFinite(t.y)},s.assert=function(t){},s.prototype.clone=function(){return s.clone(this)},s.prototype.setZero=function(){return this.x=0,this.y=0,this},s.prototype.set=function(t,i){return"object"===e(t)?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),this},s.prototype.wSet=function(t,e,i,n){return void 0!==i||void 0!==n?this.setCombine(t,e,i,n):this.setMul(t,e)},s.prototype.setCombine=function(t,e,i,n){var r=t*e.x+i*n.x,o=t*e.y+i*n.y;return this.x=r,this.y=o,this},s.prototype.setMul=function(t,e){var i=t*e.x,n=t*e.y;return this.x=i,this.y=n,this},s.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},s.prototype.wAdd=function(t,e,i,n){return void 0!==i||void 0!==n?this.addCombine(t,e,i,n):this.addMul(t,e)},s.prototype.addCombine=function(t,e,i,n){var r=t*e.x+i*n.x,o=t*e.y+i*n.y;return this.x+=r,this.y+=o,this},s.prototype.addMul=function(t,e){var i=t*e.x,n=t*e.y;return this.x+=i,this.y+=n,this},s.prototype.wSub=function(t,e,i,n){return void 0!==i||void 0!==n?this.subCombine(t,e,i,n):this.subMul(t,e)},s.prototype.subCombine=function(t,e,i,n){var r=t*e.x+i*n.x,o=t*e.y+i*n.y;return this.x-=r,this.y-=o,this},s.prototype.subMul=function(t,e){var i=t*e.x,n=t*e.y;return this.x-=i,this.y-=n,this},s.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},s.prototype.mul=function(t){return this.x*=t,this.y*=t,this},s.prototype.length=function(){return s.lengthOf(this)},s.prototype.lengthSquared=function(){return s.lengthSquared(this)},s.prototype.normalize=function(){var t=this.length();if(t<o.EPSILON)return 0;var e=1/t;return this.x*=e,this.y*=e,t},s.lengthOf=function(t){return o.sqrt(t.x*t.x+t.y*t.y)},s.lengthSquared=function(t){return t.x*t.x+t.y*t.y},s.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y;return o.sqrt(i*i+n*n)},s.distanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},s.areEqual=function(t,i){return t==i||"object"===e(i)&&null!==i&&t.x===i.x&&t.y===i.y},s.skew=function(t){return s.neo(-t.y,t.x)},s.dot=function(t,e){return t.x*e.x+t.y*e.y},s.cross=function(t,e){return"number"==typeof e?s.neo(e*t.y,-e*t.x):"number"==typeof t?s.neo(-t*e.y,t*e.x):t.x*e.y-t.y*e.x},s.addCross=function(t,e,i){return"number"==typeof i?s.neo(i*e.y+t.x,-i*e.x+t.y):"number"==typeof e?s.neo(-e*i.y+t.x,e*i.x+t.y):void 0},s.add=function(t,e){return s.neo(t.x+e.x,t.y+e.y)},s.wAdd=function(t,e,i,n){return void 0!==i||void 0!==n?s.combine(t,e,i,n):s.mul(t,e)},s.combine=function(t,e,i,n){return s.zero().setCombine(t,e,i,n)},s.sub=function(t,e){return s.neo(t.x-e.x,t.y-e.y)},s.mul=function(t,i){return"object"===e(t)?s.neo(t.x*i,t.y*i):"object"===e(i)?s.neo(t*i.x,t*i.y):void 0},s.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},s.neg=function(t){return s.neo(-t.x,-t.y)},s.abs=function(t){return s.neo(o.abs(t.x),o.abs(t.y))},s.mid=function(t,e){return s.neo(.5*(t.x+e.x),.5*(t.y+e.y))},s.upper=function(t,e){return s.neo(o.max(t.x,e.x),o.max(t.y,e.y))},s.lower=function(t,e){return s.neo(o.min(t.x,e.x),o.min(t.y,e.y))},s.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var i=o.invSqrt(e);this.x*=i*t,this.y*=i*t}return this},s.clamp=function(t,e){return(t=s.neo(t.x,t.y)).clamp(e),t},s.scaleFn=function(t,e){return function(i){return s.neo(i.x*t,i.y*e)}},s.translateFn=function(t,e){return function(i){return s.neo(i.x+t,i.y+e)}};var a={};function h(t,i){if(!(this instanceof h))return new h(t,i);this.lowerBound=s.zero(),this.upperBound=s.zero(),"object"===e(t)&&this.lowerBound.set(t),"object"===e(i)?this.upperBound.set(i):"object"===e(t)&&this.upperBound.set(t)}function u(t){var e=[],i=t.max||1/0,n=t.create,r=t.allocate,o=t.release,s=t.discard,a=0,h=0,u=0,c=0;this.max=function(t){return"number"==typeof t?(i=t,this):i},this.size=function(){return e.length},this.allocate=function(){var t;return e.length>0?t=e.shift():(a++,t="function"==typeof n?n():{}),h++,"function"==typeof r&&r(t),t},this.release=function(t){e.length<i?(u++,"function"==typeof o&&o(t),e.push(t)):(c++,"function"==typeof s&&(t=s(t)))},this.toString=function(){return" +"+a+" >"+h+" <"+u+" -"+c+" ="+e.length+"/"+i}}function c(t){this.id=t,this.aabb=new h,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.toString=function(){return this.id+": "+this.userData}}function m(){this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new u({create:function(){return new c}})}a.maxManifoldPoints=2,a.maxPolygonVertices=12,a.aabbExtension=.1,a.aabbMultiplier=2,a.linearSlop=.005,a.linearSlopSquared=a.linearSlop*a.linearSlop,a.angularSlop=2/180*Math.PI,a.polygonRadius=2*a.linearSlop,a.maxSubSteps=8,a.maxTOIContacts=32,a.maxTOIIterations=20,a.maxDistnceIterations=20,a.velocityThreshold=1,a.maxLinearCorrection=.2,a.maxAngularCorrection=8/180*Math.PI,a.maxTranslation=2,a.maxTranslationSquared=a.maxTranslation*a.maxTranslation,a.maxRotation=.5*Math.PI,a.maxRotationSquared=a.maxRotation*a.maxRotation,a.baumgarte=.2,a.toiBaugarte=.75,a.timeToSleep=.5,a.linearSleepTolerance=.01,a.linearSleepToleranceSqr=Math.pow(a.linearSleepTolerance,2),a.angularSleepTolerance=2/180*Math.PI,a.angularSleepToleranceSqr=Math.pow(a.angularSleepTolerance,2),h.prototype.isValid=function(){return h.isValid(this)},h.isValid=function(t){var e=s.sub(t.upperBound,t.lowerBound);return e.x>=0&&e.y>=0&&s.isValid(t.lowerBound)&&s.isValid(t.upperBound)},h.assert=function(t){},h.prototype.getCenter=function(){return s.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},h.prototype.getExtents=function(){return s.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},h.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},h.prototype.combine=function(t,e){e=e||this;var i=t.lowerBound,n=t.upperBound,r=e.lowerBound,s=e.upperBound,a=o.min(i.x,r.x),h=o.min(i.y,r.y),u=o.max(s.x,n.x),c=o.max(s.y,n.y);this.lowerBound.set(a,h),this.upperBound.set(u,c)},h.prototype.combinePoints=function(t,e){this.lowerBound.set(o.min(t.x,e.x),o.min(t.y,e.y)),this.upperBound.set(o.max(t.x,e.x),o.max(t.y,e.y))},h.prototype.set=function(t){this.lowerBound.set(t.lowerBound.x,t.lowerBound.y),this.upperBound.set(t.upperBound.x,t.upperBound.y)},h.prototype.contains=function(t){var e=!0;return(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},h.prototype.extend=function(t){return h.extend(this,t),this},h.extend=function(t,e){t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e},h.testOverlap=function(t,e){var i=e.lowerBound.x-t.upperBound.x,n=t.lowerBound.x-e.upperBound.x,r=e.lowerBound.y-t.upperBound.y,o=t.lowerBound.y-e.upperBound.y;return!(i>0||r>0||n>0||o>0)},h.areEqual=function(t,e){return s.areEqual(t.lowerBound,e.lowerBound)&&s.areEqual(t.upperBound,e.upperBound)},h.diff=function(t,e){var i=o.max(0,o.min(t.upperBound.x,e.upperBound.x)-o.max(e.lowerBound.x,t.lowerBound.x)),n=o.max(0,o.min(t.upperBound.y,e.upperBound.y)-o.max(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-i*n},h.prototype.rayCast=function(t,e){for(var i=-1/0,n=1/0,r=e.p1,a=s.sub(e.p2,e.p1),h=s.abs(a),u=s.zero(),c="x";null!==c;c="x"===c?"y":null)if(h.x<o.EPSILON){if(r[c]<this.lowerBound[c]||this.upperBound[c]<r[c])return!1}else{var m=1/a[c],l=(this.lowerBound[c]-r[c])*m,p=(this.upperBound[c]-r[c])*m,_=-1;if(l>p){var f=l;l=p,p=f,_=1}if(l>i&&(u.setZero(),u[c]=_,i=l),i>(n=o.min(n,p)))return!1}return!(i<0||e.maxFraction<i||(t.fraction=i,t.normal=u,0))},h.prototype.toString=function(){return JSON.stringify(this)},c.prototype.isLeaf=function(){return null==this.child1},m.prototype.getUserData=function(t){return this.m_nodes[t].userData},m.prototype.getFatAABB=function(t){return this.m_nodes[t].aabb},m.prototype.allocateNode=function(){var t=this.m_pool.allocate();return t.id=++this.m_lastProxyId,t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,this.m_nodes[t.id]=t,t},m.prototype.freeNode=function(t){this.m_pool.release(t),t.height=-1,delete this.m_nodes[t.id]},m.prototype.createProxy=function(t,e){var i=this.allocateNode();return i.aabb.set(t),h.extend(i.aabb,a.aabbExtension),i.userData=e,i.height=0,this.insertLeaf(i),i.id},m.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},m.prototype.moveProxy=function(t,e,i){var n=this.m_nodes[t];return!n.aabb.contains(e)&&(this.removeLeaf(n),n.aabb.set(e),e=n.aabb,h.extend(e,a.aabbExtension),i.x<0?e.lowerBound.x+=i.x*a.aabbMultiplier:e.upperBound.x+=i.x*a.aabbMultiplier,i.y<0?e.lowerBound.y+=i.y*a.aabbMultiplier:e.upperBound.y+=i.y*a.aabbMultiplier,this.insertLeaf(n),!0)},m.prototype.insertLeaf=function(t){if(null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var e=t.aabb,i=this.m_root;0==i.isLeaf();){var n=i.child1,r=i.child2,s=i.aabb.getPerimeter(),a=new h;a.combine(i.aabb,e);var u,c,m,l=a.getPerimeter(),p=2*l,_=2*(l-s);if(n.isLeaf())(m=new h).combine(e,n.aabb),u=m.getPerimeter()+_;else{(m=new h).combine(e,n.aabb);var f=n.aabb.getPerimeter();u=m.getPerimeter()-f+_}if(r.isLeaf()?((m=new h).combine(e,r.aabb),c=m.getPerimeter()+_):((m=new h).combine(e,r.aabb),f=r.aabb.getPerimeter(),c=m.getPerimeter()-f+_),p<u&&p<c)break;i=u<c?n:r}var d=i,y=d.parent,v=this.allocateNode();for(v.parent=y,v.userData=null,v.aabb.combine(e,d.aabb),v.height=d.height+1,null!=y?(y.child1==d?y.child1=v:y.child2=v,v.child1=d,v.child2=t,d.parent=v,t.parent=v):(v.child1=d,v.child2=t,d.parent=v,t.parent=v,this.m_root=v),i=t.parent;null!=i;)n=(i=this.balance(i)).child1,r=i.child2,i.height=1+o.max(n.height,r.height),i.aabb.combine(n.aabb,r.aabb),i=i.parent},m.prototype.removeLeaf=function(t){if(t!=this.m_root){var e,i=t.parent,n=i.parent;if(e=i.child1==t?i.child2:i.child1,null!=n){n.child1==i?n.child1=e:n.child2=e,e.parent=n,this.freeNode(i);for(var r=n;null!=r;){var s=(r=this.balance(r)).child1,a=r.child2;r.aabb.combine(s.aabb,a.aabb),r.height=1+o.max(s.height,a.height),r=r.parent}}else this.m_root=e,e.parent=null,this.freeNode(i)}else this.m_root=null},m.prototype.balance=function(t){var e=t;if(e.isLeaf()||e.height<2)return t;var i=e.child1,n=e.child2,r=n.height-i.height;if(r>1){var s=n.child1,a=n.child2;return n.child1=e,n.parent=e.parent,e.parent=n,null!=n.parent?n.parent.child1==t?n.parent.child1=n:n.parent.child2=n:this.m_root=n,s.height>a.height?(n.child2=s,e.child2=a,a.parent=e,e.aabb.combine(i.aabb,a.aabb),n.aabb.combine(e.aabb,s.aabb),e.height=1+o.max(i.height,a.height),n.height=1+o.max(e.height,s.height)):(n.child2=a,e.child2=s,s.parent=e,e.aabb.combine(i.aabb,s.aabb),n.aabb.combine(e.aabb,a.aabb),e.height=1+o.max(i.height,s.height),n.height=1+o.max(e.height,a.height)),n}if(r<-1){var h=i.child1,u=i.child2;return i.child1=e,i.parent=e.parent,e.parent=i,null!=i.parent?i.parent.child1==e?i.parent.child1=i:i.parent.child2=i:this.m_root=i,h.height>u.height?(i.child2=h,e.child1=u,u.parent=e,e.aabb.combine(n.aabb,u.aabb),i.aabb.combine(e.aabb,h.aabb),e.height=1+o.max(n.height,u.height),i.height=1+o.max(e.height,h.height)):(i.child2=u,e.child1=h,h.parent=e,e.aabb.combine(n.aabb,h.aabb),i.aabb.combine(e.aabb,u.aabb),e.height=1+o.max(n.height,h.height),i.height=1+o.max(e.height,u.height)),i}return e},m.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},m.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,e=this.m_root.aabb.getPerimeter(),i=0,n=_.allocate().preorder(this.m_root);t=n.next();)t.height<0||(i+=t.aabb.getPerimeter());return _.release(n),i/e},m.prototype.computeHeight=function(t){var e;if((e=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf())return 0;var i=this.computeHeight(e.child1.id),n=this.computeHeight(e.child2.id);return 1+o.max(i,n)},m.prototype.validateStructure=function(t){if(null!=t){this.m_root;var e=t.child1,i=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(i))}},m.prototype.validateMetrics=function(t){if(null!=t){var e=t.child1,i=t.child2;if(!t.isLeaf()){var n=e.height,r=i.height;o.max(n,r),(new h).combine(e.aabb,i.aabb),this.validateMetrics(e),this.validateMetrics(i)}}},m.prototype.validate=function(){this.validateStructure(this.m_root),this.validateMetrics(this.m_root)},m.prototype.getMaxBalance=function(){for(var t,e=0,i=_.allocate().preorder(this.m_root);t=i.next();)if(!(t.height<=1)){var n=o.abs(t.child2.height-t.child1.height);e=o.max(e,n)}return _.release(i),e},m.prototype.rebuildBottomUp=function(){for(var t,e=[],i=0,n=_.allocate().preorder(this.m_root);t=n.next();)t.height<0||(t.isLeaf()?(t.parent=null,e[i]=t,++i):this.freeNode(t));for(_.release(n);i>1;){for(var r=1/0,s=-1,a=-1,u=0;u<i;++u)for(var c=e[u].aabb,m=u+1;m<i;++m){var l=e[m].aabb,p=new h;p.combine(c,l);var f=p.getPerimeter();f<r&&(s=u,a=m,r=f)}var d=e[s],y=e[a],v=this.allocateNode();v.child1=d,v.child2=y,v.height=1+o.max(d.height,y.height),v.aabb.combine(d.aabb,y.aabb),v.parent=null,d.parent=v,y.parent=v,e[a]=e[i-1],e[s]=v,--i}this.m_root=e[0],this.validate()},m.prototype.shiftOrigin=function(t){for(var e,i=_.allocate().preorder(this.m_root);e=i.next();){var n=e.aabb;n.lowerBound.x-=t.x,n.lowerBound.y-=t.y,n.upperBound.x-=t.x,n.upperBound.y-=t.y}_.release(i)},m.prototype.query=function(t,e){var i=p.allocate();for(i.push(this.m_root);i.length>0;){var n=i.pop();if(null!=n&&h.testOverlap(n.aabb,t))if(n.isLeaf()){if(0==e(n.id))return}else i.push(n.child1),i.push(n.child2)}p.release(i)},m.prototype.rayCast=function(t,e){var i=t.p1,n=t.p2,r=s.sub(n,i);r.normalize();var a=s.cross(1,r),u=s.abs(a),c=t.maxFraction,m=new h,_=s.combine(1-c,i,c,n);m.combinePoints(i,_);var f=p.allocate(),d=l.allocate();for(f.push(this.m_root);f.length>0;){var y=f.pop();if(null!=y&&0!=h.testOverlap(y.aabb,m)){var v=y.aabb.getCenter(),g=y.aabb.getExtents();if(!(o.abs(s.dot(a,s.sub(i,v)))-s.dot(u,g)>0))if(y.isLeaf()){d.p1=s.clone(t.p1),d.p2=s.clone(t.p2),d.maxFraction=c;var x=e(d,y.id);if(0==x)return;x>0&&(c=x,_=s.combine(1-c,i,c,n),m.combinePoints(i,_))}else f.push(y.child1),f.push(y.child2)}}p.release(f),l.release(d)};var l=new u({create:function(){return{}},release:function(t){}}),p=new u({create:function(){return[]},release:function(t){t.length=0}}),_=new u({create:function(){return new f},release:function(t){t.close()}});function f(){var t=[],e=[];return{preorder:function(i){return t.length=0,t.push(i),e.length=0,e.push(0),this},next:function(){for(;t.length>0;){var i=t.length-1,n=t[i];if(0===e[i])return e[i]=1,n;if(1===e[i]&&(e[i]=2,n.child1))return t.push(n.child1),e.push(1),n.child1;if(2===e[i]&&(e[i]=3,n.child2))return t.push(n.child2),e.push(1),n.child2;t.pop(),e.pop()}},close:function(){t.length=0}}}function d(){this.m_tree=new m,this.m_proxyCount=0,this.m_moveBuffer=[],this.queryCallback=this.queryCallback.bind(this)}function y(t){if(!(this instanceof y))return new y(t);"number"==typeof t?this.setAngle(t):"object"===e(t)?this.set(t):this.setIdentity()}function v(t,e){if(!(this instanceof v))return new v(t,e);this.p=s.zero(),this.q=y.identity(),void 0!==t&&this.p.set(t),void 0!==e&&this.q.set(e)}function g(t,e){this.localCenter=s.zero(),this.c=s.zero(),this.a=0,this.alpha0=0,this.c0=s.zero(),this.a0=0}function x(){this.v=s.zero(),this.w=0}function b(){this.c=s.zero(),this.a=0}function A(){this.m_type,this.m_radius}d.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},d.prototype.testOverlap=function(t,e){var i=this.m_tree.getFatAABB(t),n=this.m_tree.getFatAABB(e);return h.testOverlap(i,n)},d.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},d.prototype.getProxyCount=function(){return this.m_proxyCount},d.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},d.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},d.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},d.prototype.query=function(t,e){this.m_tree.query(t,e)},d.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},d.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},d.prototype.createProxy=function(t,e){var i=this.m_tree.createProxy(t,e);return this.m_proxyCount++,this.bufferMove(i),i},d.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_proxyCount--,this.m_tree.destroyProxy(t)},d.prototype.moveProxy=function(t,e,i){this.m_tree.moveProxy(t,e,i)&&this.bufferMove(t)},d.prototype.touchProxy=function(t){this.bufferMove(t)},d.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},d.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]==t&&(this.m_moveBuffer[e]=null)},d.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},d.prototype.queryCallback=function(t){if(t==this.m_queryProxyId)return!0;var e=o.min(t,this.m_queryProxyId),i=o.max(t,this.m_queryProxyId),n=this.m_tree.getUserData(e),r=this.m_tree.getUserData(i);return this.m_callback(n,r),!0},y.neo=function(t){var e=Object.create(y.prototype);return e.setAngle(t),e},y.clone=function(t){var e=Object.create(y.prototype);return e.s=t.s,e.c=t.c,e},y.identity=function(){var t=Object.create(y.prototype);return t.s=0,t.c=1,t},y.isValid=function(t){return t&&o.isFinite(t.s)&&o.isFinite(t.c)},y.assert=function(t){},y.prototype.setIdentity=function(){this.s=0,this.c=1},y.prototype.set=function(t){"object"===e(t)?(this.s=t.s,this.c=t.c):(this.s=o.sin(t),this.c=o.cos(t))},y.prototype.setAngle=function(t){this.s=o.sin(t),this.c=o.cos(t)},y.prototype.getAngle=function(){return o.atan2(this.s,this.c)},y.prototype.getXAxis=function(){return s.neo(this.c,this.s)},y.prototype.getYAxis=function(){return s.neo(-this.s,this.c)},y.mul=function(t,e){if("c"in e&&"s"in e){var i=y.identity();return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i}if("x"in e&&"y"in e)return s.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},y.mulRot=function(t,e){var i=y.identity();return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i},y.mulVec2=function(t,e){return s.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},y.mulSub=function(t,e,i){var n=t.c*(e.x-i.x)-t.s*(e.y-i.y),r=t.s*(e.x-i.x)+t.c*(e.y-i.y);return s.neo(n,r)},y.mulT=function(t,e){if("c"in e&&"s"in e){var i=y.identity();return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i}if("x"in e&&"y"in e)return s.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},y.mulTRot=function(t,e){var i=y.identity();return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i},y.mulTVec2=function(t,e){return s.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},v.clone=function(t){var e=Object.create(v.prototype);return e.p=s.clone(t.p),e.q=y.clone(t.q),e},v.neo=function(t,e){var i=Object.create(v.prototype);return i.p=s.clone(t),i.q=y.clone(e),i},v.identity=function(){var t=Object.create(v.prototype);return t.p=s.zero(),t.q=y.identity(),t},v.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},v.prototype.set=function(t,e){void 0===e?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},v.isValid=function(t){return t&&s.isValid(t.p)&&y.isValid(t.q)},v.assert=function(t){},v.mul=function(t,e){if(Array.isArray(e)){for(var i=[],n=0;n<e.length;n++)i[n]=v.mul(t,e[n]);return i}if("x"in e&&"y"in e){var r=t.q.c*e.x-t.q.s*e.y+t.p.x,o=t.q.s*e.x+t.q.c*e.y+t.p.y;return s.neo(r,o)}if("p"in e&&"q"in e){var a=v.identity();return a.q=y.mulRot(t.q,e.q),a.p=s.add(y.mulVec2(t.q,e.p),t.p),a}},v.mulAll=function(t,e){for(var i=[],n=0;n<e.length;n++)i[n]=v.mul(t,e[n]);return i},v.mulFn=function(t){return function(e){return v.mul(t,e)}},v.mulVec2=function(t,e){var i=t.q.c*e.x-t.q.s*e.y+t.p.x,n=t.q.s*e.x+t.q.c*e.y+t.p.y;return s.neo(i,n)},v.mulXf=function(t,e){var i=v.identity();return i.q=y.mulRot(t.q,e.q),i.p=s.add(y.mulVec2(t.q,e.p),t.p),i},v.mulT=function(t,e){if("x"in e&&"y"in e){var i=e.x-t.p.x,n=e.y-t.p.y,r=t.q.c*i+t.q.s*n,o=-t.q.s*i+t.q.c*n;return s.neo(r,o)}if("p"in e&&"q"in e){var a=v.identity();return a.q.set(y.mulTRot(t.q,e.q)),a.p.set(y.mulTVec2(t.q,s.sub(e.p,t.p))),a}},v.mulTVec2=function(t,e){var i=e.x-t.p.x,n=e.y-t.p.y,r=t.q.c*i+t.q.s*n,o=-t.q.s*i+t.q.c*n;return s.neo(r,o)},v.mulTXf=function(t,e){var i=v.identity();return i.q.set(y.mulTRot(t.q,e.q)),i.p.set(y.mulTVec2(t.q,s.sub(e.p,t.p))),i},g.prototype.setTransform=function(t){var e=v.mulVec2(t,this.localCenter);this.c.set(e),this.c0.set(e),this.a=t.q.getAngle(),this.a0=t.q.getAngle()},g.prototype.setLocalCenter=function(t,e){this.localCenter.set(t);var i=v.mulVec2(e,this.localCenter);this.c.set(i),this.c0.set(i)},g.prototype.getTransform=function(t,e){e=void 0===e?0:e,t.q.setAngle((1-e)*this.a0+e*this.a),t.p.setCombine(1-e,this.c0,e,this.c),t.p.sub(y.mulVec2(t.q,this.localCenter))},g.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);this.c0.setCombine(e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},g.prototype.forward=function(){this.a0=this.a,this.c0.set(this.c)},g.prototype.normalize=function(){var t=o.mod(this.a0,-o.PI,+o.PI);this.a-=this.a0-t,this.a0=t},g.prototype.clone=function(){var t=new g;return t.localCenter.set(this.localCenter),t.alpha0=this.alpha0,t.a0=this.a0,t.a=this.a,t.c0.set(this.c0),t.c.set(this.c),t},g.prototype.set=function(t){this.localCenter.set(t.localCenter),this.alpha0=t.alpha0,this.a0=t.a0,this.a=t.a,this.c0.set(t.c0),this.c.set(t.c)},b.prototype.getTransform=function(t,e){return t.q.set(this.a),t.p.set(s.sub(this.c,y.mulVec2(t.q,e))),t},A.prototype._reset=function(){},A.prototype._serialize=function(){return{}},A.TYPES={},A._deserialize=function(t,e,i){var n=A.TYPES[t.type];return n&&i(n,t)},A.isValid=function(t){return!!t},A.prototype.getRadius=function(){return this.m_radius},A.prototype.getType=function(){return this.m_type},A.prototype._clone=function(){},A.prototype.getChildCount=function(){},A.prototype.testPoint=function(t,e){},A.prototype.rayCast=function(t,e,i,n){},A.prototype.computeAABB=function(t,e,i){},A.prototype.computeMass=function(t,e){},A.prototype.computeDistanceProxy=function(t){};var w={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535};function B(t,e){this.aabb=new h,this.fixture=t,this.childIndex=e,this.proxyId}function M(t,e,n){e.shape?(n=e,e=e.shape):"number"==typeof n&&(n={density:n}),n=i(n,w),this.m_body=t,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_density=n.density,this.m_isSensor=n.isSensor,this.m_filterGroupIndex=n.filterGroupIndex,this.m_filterCategoryBits=n.filterCategoryBits,this.m_filterMaskBits=n.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var r=this.m_shape.getChildCount(),o=0;o<r;++o)this.m_proxies[o]=new B(this,o);this.m_userData=n.userData}M.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var i=this.m_shape.getChildCount(),n=0;n<i;++n)this.m_proxies[n]=new B(this,n);this.createProxies(e,t.m_xf),t.resetMassData()},M.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},M._deserialize=function(t,e,i){var n=i(A,t.shape);return n&&new M(e,n,t)},M.prototype.getType=function(){return this.m_shape.getType()},M.prototype.getShape=function(){return this.m_shape},M.prototype.isSensor=function(){return this.m_isSensor},M.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},M.prototype.getUserData=function(){return this.m_userData},M.prototype.setUserData=function(t){this.m_userData=t},M.prototype.getBody=function(){return this.m_body},M.prototype.getNext=function(){return this.m_next},M.prototype.getDensity=function(){return this.m_density},M.prototype.setDensity=function(t){this.m_density=t},M.prototype.getFriction=function(){return this.m_friction},M.prototype.setFriction=function(t){this.m_friction=t},M.prototype.getRestitution=function(){return this.m_restitution},M.prototype.setRestitution=function(t){this.m_restitution=t},M.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},M.prototype.rayCast=function(t,e,i){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),i)},M.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},M.prototype.getAABB=function(t){return this.m_proxies[t].aabb},M.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i];this.m_shape.computeAABB(n.aabb,e,i),n.proxyId=t.createProxy(n.aabb,n)}},M.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.destroyProxy(i.proxyId),i.proxyId=null}this.m_proxyCount=0},M.prototype.synchronize=function(t,e,i){for(var n=0;n<this.m_proxyCount;++n){var r=this.m_proxies[n],o=new h,a=new h;this.m_shape.computeAABB(o,e,r.childIndex),this.m_shape.computeAABB(a,i,r.childIndex),r.aabb.combine(o,a);var u=s.sub(i.p,e.p);t.moveProxy(r.proxyId,r.aabb,u)}},M.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},M.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},M.prototype.setFilterGroupIndex=function(t){return this.m_filterGroupIndex=t},M.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},M.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t},M.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},M.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t},M.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var e=t.contact,i=e.getFixtureA(),n=e.getFixtureB();i!=this&&n!=this||e.flagForFiltering(),t=t.next}var r=this.m_body.getWorld();if(null!=r)for(var o=r.m_broadPhase,s=0;s<this.m_proxyCount;++s)o.touchProxy(this.m_proxies[s].proxyId)}},M.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&0!==t.m_filterGroupIndex)return t.m_filterGroupIndex>0;var e=0!=(t.m_filterMaskBits&this.m_filterCategoryBits),i=0!=(t.m_filterCategoryBits&this.m_filterMaskBits);return e&&i};var C=P.STATIC="static",S=P.KINEMATIC="kinematic",z=P.DYNAMIC="dynamic",I={type:C,position:s.zero(),angle:0,linearVelocity:s.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null};function P(t,e){e=i(e,I),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==z?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=v.identity(),this.m_xf.p=s.clone(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new g,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new x,this.c_position=new b,this.m_force=s.zero(),this.m_torque=0,this.m_linearVelocity=s.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}function E(){this.mass=0,this.center=s.zero(),this.I=0}function N(t,i,n,r){"object"===e(t)&&null!==t?(this.ex=s.clone(t),this.ey=s.clone(i)):"number"==typeof t?(this.ex=s.neo(t,n),this.ey=s.neo(i,r)):(this.ex=s.zero(),this.ey=s.zero())}function V(){this.type,this.localNormal=s.zero(),this.localPoint=s.zero(),this.points=[new T,new T],this.pointCount=0}function T(){this.localPoint=s.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new F}function F(){this.cf=new D}function D(){this.indexA,this.indexB,this.typeA,this.typeB}function q(){this.normal,this.points=[],this.separations=[]}P.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},P._deserialize=function(t,e,i){var n=new P(e,t);if(t.fixtures)for(var r=t.fixtures.length-1;r>=0;r--){var o=i(M,t.fixtures[r],n);n._addFixture(o)}return n},P.prototype.isWorldLocked=function(){return!(!this.m_world||!this.m_world.isLocked())},P.prototype.getWorld=function(){return this.m_world},P.prototype.getNext=function(){return this.m_next},P.prototype.setUserData=function(t){this.m_userData=t},P.prototype.getUserData=function(){return this.m_userData},P.prototype.getFixtureList=function(){return this.m_fixtureList},P.prototype.getJointList=function(){return this.m_jointList},P.prototype.getContactList=function(){return this.m_contactList},P.prototype.isStatic=function(){return this.m_type==C},P.prototype.isDynamic=function(){return this.m_type==z},P.prototype.isKinematic=function(){return this.m_type==S},P.prototype.setStatic=function(){return this.setType(C),this},P.prototype.setDynamic=function(){return this.setType(z),this},P.prototype.setKinematic=function(){return this.setType(S),this},P.prototype.getType=function(){return this.m_type},P.prototype.setType=function(t){if(1!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==C&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.destroyContact(i.contact)}this.m_contactList=null;for(var n=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)for(var o=r.m_proxyCount,s=0;s<o;++s)n.touchProxy(r.m_proxies[s].proxyId)}},P.prototype.isBullet=function(){return this.m_bulletFlag},P.prototype.setBullet=function(t){this.m_bulletFlag=!!t},P.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},P.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,0==this.m_autoSleepFlag&&this.setAwake(!0)},P.prototype.isAwake=function(){return this.m_awakeFlag},P.prototype.setAwake=function(t){t?0==this.m_awakeFlag&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},P.prototype.isActive=function(){return this.m_activeFlag},P.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag)for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.createProxies(e,this.m_xf);else{for(e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.destroyProxies(e);for(var n=this.m_contactList;n;){var r=n;n=n.next,this.m_world.destroyContact(r.contact)}this.m_contactList=null}},P.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},P.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},P.prototype.getTransform=function(){return this.m_xf},P.prototype.setTransform=function(t,e){if(1!=this.isWorldLocked()){this.m_xf.set(t,e),this.m_sweep.setTransform(this.m_xf);for(var i=this.m_world.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.synchronize(i,this.m_xf,this.m_xf)}},P.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},P.prototype.synchronizeFixtures=function(){var t=v.identity();this.m_sweep.getTransform(t,0);for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.synchronize(e,t,this.m_xf)},P.prototype.advance=function(t){this.m_sweep.advance(t),this.m_sweep.c.set(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},P.prototype.getPosition=function(){return this.m_xf.p},P.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},P.prototype.getAngle=function(){return this.m_sweep.a},P.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},P.prototype.getWorldCenter=function(){return this.m_sweep.c},P.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},P.prototype.getLinearVelocity=function(){return this.m_linearVelocity},P.prototype.getLinearVelocityFromWorldPoint=function(t){var e=s.sub(t,this.m_sweep.c);return s.add(this.m_linearVelocity,s.cross(this.m_angularVelocity,e))},P.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},P.prototype.setLinearVelocity=function(t){this.m_type!=C&&(s.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.set(t))},P.prototype.getAngularVelocity=function(){return this.m_angularVelocity},P.prototype.setAngularVelocity=function(t){this.m_type!=C&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},P.prototype.getLinearDamping=function(){return this.m_linearDamping},P.prototype.setLinearDamping=function(t){this.m_linearDamping=t},P.prototype.getAngularDamping=function(){return this.m_angularDamping},P.prototype.setAngularDamping=function(t){this.m_angularDamping=t},P.prototype.getGravityScale=function(){return this.m_gravityScale},P.prototype.setGravityScale=function(t){this.m_gravityScale=t},P.prototype.getMass=function(){return this.m_mass},P.prototype.getInertia=function(){return this.m_I+this.m_mass*s.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},P.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),t.center.set(this.m_sweep.localCenter)},P.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic())return this.m_sweep.c0.set(this.m_xf.p),this.m_sweep.c.set(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var t=s.zero(),e=this.m_fixtureList;e;e=e.m_next)if(0!=e.m_density){var i=new E;e.getMassData(i),this.m_mass+=i.mass,t.addMul(i.mass,i.center),this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*s.dot(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=s.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t,this.m_xf),this.m_linearVelocity.add(s.cross(this.m_angularVelocity,s.sub(this.m_sweep.c,n)))},P.prototype.setMassData=function(t){if(1!=this.isWorldLocked()&&this.m_type==z){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&0==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*s.dot(t.center,t.center),this.m_invI=1/this.m_I);var e=s.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t.center,this.m_xf),this.m_linearVelocity.add(s.cross(this.m_angularVelocity,s.sub(this.m_sweep.c,e)))}},P.prototype.applyForce=function(t,e,i){this.m_type==z&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=s.cross(s.sub(e,this.m_sweep.c),t)))},P.prototype.applyForceToCenter=function(t,e){this.m_type==z&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},P.prototype.applyTorque=function(t,e){this.m_type==z&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},P.prototype.applyLinearImpulse=function(t,e,i){this.m_type==z&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*s.cross(s.sub(e,this.m_sweep.c),t)))},P.prototype.applyAngularImpulse=function(t,e){this.m_type==z&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},P.prototype.shouldCollide=function(t){if(this.m_type!=z&&t.m_type!=z)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},P.prototype._addFixture=function(t){if(1==this.isWorldLocked())return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},P.prototype.createFixture=function(t,e){if(1==this.isWorldLocked())return null;var i=new M(this,t,e);return this._addFixture(i),i},P.prototype.destroyFixture=function(t){if(1!=this.isWorldLocked()){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;null!=e;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var i=this.m_contactList;i;){var n=i.contact;i=i.next;var r=n.getFixtureA(),o=n.getFixtureB();t!=r&&t!=o||this.m_world.destroyContact(n)}if(this.m_activeFlag){var s=this.m_world.m_broadPhase;t.destroyProxies(s)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},P.prototype.getWorldPoint=function(t){return v.mulVec2(this.m_xf,t)},P.prototype.getWorldVector=function(t){return y.mulVec2(this.m_xf.q,t)},P.prototype.getLocalPoint=function(t){return v.mulTVec2(this.m_xf,t)},P.prototype.getLocalVector=function(t){return y.mulTVec2(this.m_xf.q,t)},N.prototype.toString=function(){return JSON.stringify(this)},N.isValid=function(t){return t&&s.isValid(t.ex)&&s.isValid(t.ey)},N.assert=function(t){},N.prototype.set=function(t,i,n,r){"number"==typeof t&&"number"==typeof i&&"number"==typeof n&&"number"==typeof r?(this.ex.set(t,n),this.ey.set(i,r)):"object"===e(t)&&"object"===e(i)?(this.ex.set(t),this.ey.set(i)):"object"===e(t)&&(this.ex.set(t.ex),this.ey.set(t.ey))},N.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},N.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},N.prototype.getInverse=function(){var t=this.ex.x,e=this.ey.x,i=this.ex.y,n=this.ey.y,r=t*n-e*i;0!=r&&(r=1/r);var o=new N;return o.ex.x=r*n,o.ey.x=-r*e,o.ex.y=-r*i,o.ey.y=r*t,o},N.prototype.solve=function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y,o=e*r-i*n;0!=o&&(o=1/o);var a=s.zero();return a.x=o*(r*t.x-i*t.y),a.y=o*(e*t.y-n*t.x),a},N.mul=function(t,e){if(e&&"x"in e&&"y"in e){var i=t.ex.x*e.x+t.ey.x*e.y,n=t.ex.y*e.x+t.ey.y*e.y;return s.neo(i,n)}if(e&&"ex"in e&&"ey"in e)return new N(t.ex.x*e.ex.x+t.ey.x*e.ex.y,t.ex.x*e.ey.x+t.ey.x*e.ey.y,t.ex.y*e.ex.x+t.ey.y*e.ex.y,t.ex.y*e.ey.x+t.ey.y*e.ey.y)},N.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,n=t.ex.y*e.x+t.ey.y*e.y;return s.neo(i,n)},N.mulMat22=function(t,e){return new N(t.ex.x*e.ex.x+t.ey.x*e.ex.y,t.ex.x*e.ey.x+t.ey.x*e.ey.y,t.ex.y*e.ex.x+t.ey.y*e.ex.y,t.ex.y*e.ey.x+t.ey.y*e.ey.y)},N.mulT=function(t,e){return e&&"x"in e&&"y"in e?s.neo(s.dot(e,t.ex),s.dot(e,t.ey)):e&&"ex"in e&&"ey"in e?new N(s.neo(s.dot(t.ex,e.ex),s.dot(t.ey,e.ex)),s.neo(s.dot(t.ex,e.ey),s.dot(t.ey,e.ey))):void 0},N.mulTVec2=function(t,e){return s.neo(s.dot(e,t.ex),s.dot(e,t.ey))},N.mulTMat22=function(t,e){return new N(s.neo(s.dot(t.ex,e.ex),s.dot(t.ey,e.ex)),s.neo(s.dot(t.ex,e.ey),s.dot(t.ey,e.ey)))},N.abs=function(t){return new N(s.abs(t.ex),s.abs(t.ey))},N.add=function(t,e){return new N(s.add(t.ex,e.ex),s.add(t.ey,e.ey))},V.clipSegmentToLine=function(t,e,i,n,r){var o=0,a=s.dot(i,e[0].v)-n,h=s.dot(i,e[1].v)-n;if(a<=0&&t[o++].set(e[0]),h<=0&&t[o++].set(e[1]),a*h<0){var u=a/(a-h);t[o].v.setCombine(1-u,e[0].v,u,e[1].v),t[o].id.cf.indexA=r,t[o].id.cf.indexB=e[0].id.cf.indexB,t[o].id.cf.typeA=V.e_vertex,t[o].id.cf.typeB=V.e_face,++o}return o},V.ClipVertex=O,V.getPointStates=function(t,e,i,n){for(var r=0;r<i.pointCount;++r){var o=i.points[r].id;t[r]=L.removeState;for(var s=0;s<n.pointCount;++s)if(n.points[s].id.key==o.key){t[r]=L.persistState;break}}for(r=0;r<n.pointCount;++r)for(o=n.points[r].id,e[r]=L.addState,s=0;s<i.pointCount;++s)if(i.points[s].id.key==o.key){e[r]=L.persistState;break}},V.PointState=L,V.e_circles=0,V.e_faceA=1,V.e_faceB=2,V.e_vertex=0,V.e_face=1,Object.defineProperty(F.prototype,"key",{get:function(){return this.cf.indexA+4*this.cf.indexB+16*this.cf.typeA+64*this.cf.typeB},enumerable:!0,configurable:!0}),F.prototype.set=function(t){this.cf.set(t.cf)},D.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB},V.prototype.getWorldManifold=function(t,e,i,n,r){if(0!=this.pointCount){var a=(t=t||new q).normal,h=t.points,u=t.separations;switch(this.type){case V.e_circles:a=s.neo(1,0);var c=v.mulVec2(e,this.localPoint),m=v.mulVec2(n,this.points[0].localPoint),l=s.sub(m,c);s.lengthSquared(l)>o.EPSILON*o.EPSILON&&(a.set(l),a.normalize());var p=c.clone().addMul(i,a),_=m.clone().addMul(-r,a);h[0]=s.mid(p,_),u[0]=s.dot(s.sub(_,p),a),h.length=1,u.length=1;break;case V.e_faceA:a=y.mulVec2(e.q,this.localNormal);for(var f=v.mulVec2(e,this.localPoint),d=0;d<this.pointCount;++d){var g=v.mulVec2(n,this.points[d].localPoint);p=s.clone(g).addMul(i-s.dot(s.sub(g,f),a),a),_=s.clone(g).subMul(r,a),h[d]=s.mid(p,_),u[d]=s.dot(s.sub(_,p),a)}h.length=this.pointCount,u.length=this.pointCount;break;case V.e_faceB:for(a=y.mulVec2(n.q,this.localNormal),f=v.mulVec2(n,this.localPoint),d=0;d<this.pointCount;++d)g=v.mulVec2(e,this.points[d].localPoint),_=s.combine(1,g,r-s.dot(s.sub(g,f),a),a),p=s.combine(1,g,-i,a),h[d]=s.mid(p,_),u[d]=s.dot(s.sub(p,_),a);h.length=this.pointCount,u.length=this.pointCount,a.mul(-1)}return t.normal=a,t.points=h,t.separations=u,t}};var L={nullState:0,addState:1,persistState:2,removeState:3};function O(){this.v=s.zero(),this.id=new F}O.prototype.set=function(t){this.v.set(t.v),this.id.set(t.id)};var k={toString:function(t){t="string"==typeof t?t:"\n";var i="";for(var n in this)"function"!=typeof this[n]&&"object"!==e(this[n])&&(i+=n+": "+this[n]+t);return i}};function j(t,i,n){if(!(this instanceof j))return new j(t,i,n);void 0===t?(this.x=0,this.y=0,this.z=0):"object"===e(t)?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=i,this.z=n)}function R(t,i,n){"object"===e(t)&&null!==t?(this.ex=j.clone(t),this.ey=j.clone(i),this.ez=j.clone(n)):(this.ex=j(),this.ey=j(),this.ez=j())}function J(){this.proxyA=new Z,this.proxyB=new Z,this.transformA=null,this.transformB=null,this.useRadii=!1}function Y(){this.pointA=s.zero(),this.pointB=s.zero(),this.distance,this.iterations}function U(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}function W(t,e,i){++k.gjkCalls;var n=i.proxyA,r=i.proxyB,h=i.transformA,u=i.transformB,c=new G;c.readCache(e,n,h,r,u);for(var m=c.m_v,l=a.maxDistnceIterations,p=[],_=[],f=0,d=0;d<l;){f=c.m_count;for(var g=0;g<f;++g)p[g]=m[g].indexA,_[g]=m[g].indexB;if(c.solve(),3==c.m_count)break;(C=c.getClosestPoint()).lengthSquared();var x=c.getSearchDirection();if(x.lengthSquared()<o.EPSILON*o.EPSILON)break;var b=m[c.m_count];b.indexA=n.getSupport(y.mulTVec2(h.q,s.neg(x))),b.wA=v.mulVec2(h,n.getVertex(b.indexA)),b.indexB=r.getSupport(y.mulTVec2(u.q,x)),b.wB=v.mulVec2(u,r.getVertex(b.indexB)),b.w=s.sub(b.wB,b.wA),++d,++k.gjkIters;var A=!1;for(g=0;g<f;++g)if(b.indexA==p[g]&&b.indexB==_[g]){A=!0;break}if(A)break;++c.m_count}if(k.gjkMaxIters=o.max(k.gjkMaxIters,d),c.getWitnessPoints(t.pointA,t.pointB),t.distance=s.distance(t.pointA,t.pointB),t.iterations=d,c.writeCache(e),i.useRadii){var w=n.m_radius,B=r.m_radius;if(t.distance>w+B&&t.distance>o.EPSILON){t.distance-=w+B;var M=s.sub(t.pointB,t.pointA);M.normalize(),t.pointA.addMul(w,M),t.pointB.subMul(B,M)}else{var C=s.mid(t.pointA,t.pointB);t.pointA.set(C),t.pointB.set(C),t.distance=0}}}function Z(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}function H(){this.indexA,this.indexB,this.wA=s.zero(),this.wB=s.zero(),this.w=s.zero(),this.a}function G(){this.m_v1=new H,this.m_v2=new H,this.m_v3=new H,this.m_v=[this.m_v1,this.m_v2,this.m_v3],this.m_count}function X(t){this.contact=t,this.prev,this.next,this.other}function K(t,e,i,n,r){this.m_nodeA=new X(this),this.m_nodeB=new X(this),this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=n,this.m_evaluateFcn=r,this.m_manifold=new V,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=Q(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=tt(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.v_points=[],this.v_normal=s.zero(),this.v_normalMass=new N,this.v_K=new N,this.v_pointCount,this.v_tangentSpeed,this.v_friction,this.v_restitution,this.v_invMassA,this.v_invMassB,this.v_invIA,this.v_invIB,this.p_localPoints=[],this.p_localNormal=s.zero(),this.p_localPoint=s.zero(),this.p_localCenterA=s.zero(),this.p_localCenterB=s.zero(),this.p_type,this.p_radiusA,this.p_radiusB,this.p_pointCount,this.p_invMassA,this.p_invMassB,this.p_invIA,this.p_invIB}function $(){this.rA=s.zero(),this.rB=s.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}function Q(t,e){return o.sqrt(t*e)}function tt(t,e){return t>e?t:e}j.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},j._deserialize=function(t){var e=Object.create(j.prototype);return e.x=t.x,e.y=t.y,e.z=t.z,e},j.neo=function(t,e,i){var n=Object.create(j.prototype);return n.x=t,n.y=e,n.z=i,n},j.clone=function(t){return j.neo(t.x,t.y,t.z)},j.prototype.toString=function(){return JSON.stringify(this)},j.isValid=function(t){return t&&o.isFinite(t.x)&&o.isFinite(t.y)&&o.isFinite(t.z)},j.assert=function(t){},j.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},j.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},j.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},j.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},j.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},j.areEqual=function(t,i){return t==i||"object"===e(t)&&null!==t&&"object"===e(i)&&null!==i&&t.x===i.x&&t.y===i.y&&t.z===i.z},j.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},j.cross=function(t,e){return new j(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},j.add=function(t,e){return new j(t.x+e.x,t.y+e.y,t.z+e.z)},j.sub=function(t,e){return new j(t.x-e.x,t.y-e.y,t.z-e.z)},j.mul=function(t,e){return new j(e*t.x,e*t.y,e*t.z)},j.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},j.neg=function(t){return new j(-t.x,-t.y,-t.z)},R.prototype.toString=function(){return JSON.stringify(this)},R.isValid=function(t){return t&&j.isValid(t.ex)&&j.isValid(t.ey)&&j.isValid(t.ez)},R.assert=function(t){},R.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},R.prototype.solve33=function(t){var e=j.dot(this.ex,j.cross(this.ey,this.ez));0!=e&&(e=1/e);var i=new j;return i.x=e*j.dot(t,j.cross(this.ey,this.ez)),i.y=e*j.dot(this.ex,j.cross(t,this.ez)),i.z=e*j.dot(this.ex,j.cross(this.ey,t)),i},R.prototype.solve22=function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y,o=e*r-i*n;0!=o&&(o=1/o);var a=s.zero();return a.x=o*(r*t.x-i*t.y),a.y=o*(e*t.y-n*t.x),a},R.prototype.getInverse22=function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y,o=e*r-i*n;0!=o&&(o=1/o),t.ex.x=o*r,t.ey.x=-o*i,t.ex.z=0,t.ex.y=-o*n,t.ey.y=o*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},R.prototype.getSymInverse33=function(t){var e=j.dot(this.ex,j.cross(this.ey,this.ez));0!=e&&(e=1/e);var i=this.ex.x,n=this.ey.x,r=this.ez.x,o=this.ey.y,s=this.ez.y,a=this.ez.z;t.ex.x=e*(o*a-s*s),t.ex.y=e*(r*s-n*a),t.ex.z=e*(n*s-r*o),t.ey.x=t.ex.y,t.ey.y=e*(i*a-r*r),t.ey.z=e*(r*n-i*s),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*o-n*n)},R.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e)return new j(i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,n=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z);if(e&&"y"in e&&"x"in e){var i=t.ex.x*e.x+t.ey.x*e.y,n=t.ex.y*e.x+t.ey.y*e.y;return s.neo(i,n)}},R.mulVec3=function(t,e){return new j(t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z)},R.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,n=t.ex.y*e.x+t.ey.y*e.y;return s.neo(i,n)},R.add=function(t,e){return new R(j.add(t.ex,e.ex),j.add(t.ey,e.ey),j.add(t.ez,e.ez))},W.Input=J,W.Output=Y,W.Proxy=Z,W.Cache=U,k.gjkCalls=0,k.gjkIters=0,k.gjkMaxIters=0,Z.prototype.getVertexCount=function(){return this.m_count},Z.prototype.getVertex=function(t){return this.m_vertices[t]},Z.prototype.getSupport=function(t){for(var e=0,i=s.dot(this.m_vertices[0],t),n=0;n<this.m_count;++n){var r=s.dot(this.m_vertices[n],t);r>i&&(e=n,i=r)}return e},Z.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},Z.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},H.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.wA=s.clone(t.wA),this.wB=s.clone(t.wB),this.w=s.clone(t.w),this.a=t.a},G.prototype.print=function(){return 3==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},G.prototype.readCache=function(t,e,i,n,r){this.m_count=t.count;for(var a=0;a<this.m_count;++a){(l=this.m_v[a]).indexA=t.indexA[a],l.indexB=t.indexB[a];var h=e.getVertex(l.indexA),u=n.getVertex(l.indexB);l.wA=v.mulVec2(i,h),l.wB=v.mulVec2(r,u),l.w=s.sub(l.wB,l.wA),l.a=0}if(this.m_count>1){var c=t.metric,m=this.getMetric();(m<.5*c||2*c<m||m<o.EPSILON)&&(this.m_count=0)}var l;0==this.m_count&&((l=this.m_v[0]).indexA=0,l.indexB=0,h=e.getVertex(0),u=n.getVertex(0),l.wA=v.mulVec2(i,h),l.wB=v.mulVec2(r,u),l.w=s.sub(l.wB,l.wA),l.a=1,this.m_count=1)},G.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},G.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return s.neg(this.m_v1.w);case 2:var t=s.sub(this.m_v2.w,this.m_v1.w);return s.cross(t,s.neg(this.m_v1.w))>0?s.cross(1,t):s.cross(t,1);default:return s.zero()}},G.prototype.getClosestPoint=function(){switch(this.m_count){case 0:return s.zero();case 1:return s.clone(this.m_v1.w);case 2:return s.combine(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w);case 3:default:return s.zero()}},G.prototype.getWitnessPoints=function(t,e){switch(this.m_count){case 0:break;case 1:t.set(this.m_v1.wA),e.set(this.m_v1.wB);break;case 2:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),e.setCombine(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),t.addMul(this.m_v3.a,this.m_v3.wA),e.set(t)}},G.prototype.getMetric=function(){switch(this.m_count){case 0:case 1:return 0;case 2:return s.distance(this.m_v1.w,this.m_v2.w);case 3:return s.cross(s.sub(this.m_v2.w,this.m_v1.w),s.sub(this.m_v3.w,this.m_v1.w));default:return 0}},G.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3()}},G.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=s.sub(e,t),n=-s.dot(t,i);if(n<=0)return this.m_v1.a=1,void(this.m_count=1);var r=s.dot(e,i);if(r<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var o=1/(r+n);this.m_v1.a=r*o,this.m_v2.a=n*o,this.m_count=2},G.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,n=s.sub(e,t),r=s.dot(t,n),o=s.dot(e,n),a=-r,h=s.sub(i,t),u=s.dot(t,h),c=s.dot(i,h),m=-u,l=s.sub(i,e),p=s.dot(e,l),_=s.dot(i,l),f=-p,d=s.cross(n,h),y=d*s.cross(e,i),v=d*s.cross(i,t),g=d*s.cross(t,e);if(a<=0&&m<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&a>0&&g<=0){var x=1/(o+a);return this.m_v1.a=o*x,this.m_v2.a=a*x,void(this.m_count=2)}if(c>0&&m>0&&v<=0){var b=1/(c+m);return this.m_v1.a=c*b,this.m_v3.a=m*b,this.m_count=2,void this.m_v2.set(this.m_v3)}if(o<=0&&f<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(c<=0&&_<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(_>0&&f>0&&y<=0){var A=1/(_+f);return this.m_v2.a=_*A,this.m_v3.a=f*A,this.m_count=2,void this.m_v1.set(this.m_v3)}var w=1/(y+v+g);this.m_v1.a=y*w,this.m_v2.a=v*w,this.m_v3.a=g*w,this.m_count=3},W.testOverlap=function(t,e,i,n,r,s){var a=new J;a.proxyA.set(t,e),a.proxyB.set(i,n),a.transformA=r,a.transformB=s,a.useRadii=!0;var h=new U,u=new Y;return W(u,h,a),u.distance<10*o.EPSILON},K.prototype.initConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,n=e.getShape(),r=i.getShape(),o=e.getBody(),a=i.getBody(),h=this.getManifold(),u=h.pointCount;this.v_invMassA=o.m_invMass,this.v_invMassB=a.m_invMass,this.v_invIA=o.m_invI,this.v_invIB=a.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=u,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=o.m_invMass,this.p_invMassB=a.m_invMass,this.p_invIA=o.m_invI,this.p_invIB=a.m_invI,this.p_localCenterA=s.clone(o.m_sweep.localCenter),this.p_localCenterB=s.clone(a.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=r.m_radius,this.p_type=h.type,this.p_localNormal=s.clone(h.localNormal),this.p_localPoint=s.clone(h.localPoint),this.p_pointCount=u;for(var c=0;c<u;++c){var m=h.points[c],l=this.v_points[c]=new $;t.warmStarting?(l.normalImpulse=t.dtRatio*m.normalImpulse,l.tangentImpulse=t.dtRatio*m.tangentImpulse):(l.normalImpulse=0,l.tangentImpulse=0),l.rA.setZero(),l.rB.setZero(),l.normalMass=0,l.tangentMass=0,l.velocityBias=0,this.p_localPoints[c]=s.clone(m.localPoint)}},K.prototype.getManifold=function(){return this.m_manifold},K.prototype.getWorldManifold=function(t){var e=this.m_fixtureA.getBody(),i=this.m_fixtureB.getBody(),n=this.m_fixtureA.getShape(),r=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(t,e.getTransform(),n.m_radius,i.getTransform(),r.m_radius)},K.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},K.prototype.isEnabled=function(){return this.m_enabledFlag},K.prototype.isTouching=function(){return this.m_touchingFlag},K.prototype.getNext=function(){return this.m_next},K.prototype.getFixtureA=function(){return this.m_fixtureA},K.prototype.getFixtureB=function(){return this.m_fixtureB},K.prototype.getChildIndexA=function(){return this.m_indexA},K.prototype.getChildIndexB=function(){return this.m_indexB},K.prototype.flagForFiltering=function(){this.m_filterFlag=!0},K.prototype.setFriction=function(t){this.m_friction=t},K.prototype.getFriction=function(){return this.m_friction},K.prototype.resetFriction=function(){this.m_friction=Q(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},K.prototype.setRestitution=function(t){this.m_restitution=t},K.prototype.getRestitution=function(){return this.m_restitution},K.prototype.resetRestitution=function(){this.m_restitution=tt(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},K.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},K.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},K.prototype.evaluate=function(t,e,i){this.m_evaluateFcn(t,e,this.m_fixtureA,this.m_indexA,i,this.m_fixtureB,this.m_indexB)},K.prototype.update=function(t){this.m_enabledFlag=!0;var e=!1,i=this.m_touchingFlag,n=this.m_fixtureA.isSensor(),r=this.m_fixtureB.isSensor(),o=n||r,s=this.m_fixtureA.getBody(),a=this.m_fixtureB.getBody(),h=s.getTransform(),u=a.getTransform();if(o){var c=this.m_fixtureA.getShape(),m=this.m_fixtureB.getShape();e=W.testOverlap(c,this.m_indexA,m,this.m_indexB,h,u),this.m_manifold.pointCount=0}else{var l=this.m_manifold;this.m_manifold=new V,this.evaluate(this.m_manifold,h,u),e=this.m_manifold.pointCount>0;for(var p=0;p<this.m_manifold.pointCount;++p){var _=this.m_manifold.points[p];_.normalImpulse=0,_.tangentImpulse=0;for(var f=0;f<l.pointCount;++f){var d=l.points[f];if(d.id.key==_.id.key){_.normalImpulse=d.normalImpulse,_.tangentImpulse=d.tangentImpulse;break}}}e!=i&&(s.setAwake(!0),a.setAwake(!0))}this.m_touchingFlag=e,0==i&&1==e&&t&&t.beginContact(this),1==i&&0==e&&t&&t.endContact(this),0==o&&e&&t&&t.preSolve(this,l)},K.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,!1)},K.prototype.solvePositionConstraintTOI=function(t,e,i){return this._solvePositionConstraint(t,!0,e,i)},K.prototype._solvePositionConstraint=function(t,e,i,n){var r=this.m_fixtureA,h=this.m_fixtureB,u=r.getBody(),c=h.getBody();u.c_velocity,c.c_velocity;var m=u.c_position,l=c.c_position,p=s.clone(this.p_localCenterA),_=s.clone(this.p_localCenterB),f=0,d=0;e&&u!=i&&u!=n||(f=this.p_invMassA,d=this.p_invIA);var g=0,x=0;e&&c!=i&&c!=n||(g=this.p_invMassB,x=this.p_invIB);for(var b=s.clone(m.c),A=m.a,w=s.clone(l.c),B=l.a,M=0,C=0;C<this.p_pointCount;++C){var S,z,I,P=v.identity(),E=v.identity();switch(P.q.set(A),E.q.set(B),P.p=s.sub(b,y.mulVec2(P.q,p)),E.p=s.sub(w,y.mulVec2(E.q,_)),this.p_type){case V.e_circles:var N=v.mulVec2(P,this.p_localPoint),T=v.mulVec2(E,this.p_localPoints[0]);(S=s.sub(T,N)).normalize(),z=s.combine(.5,N,.5,T),I=s.dot(s.sub(T,N),S)-this.p_radiusA-this.p_radiusB;break;case V.e_faceA:S=y.mulVec2(P.q,this.p_localNormal);var F=v.mulVec2(P,this.p_localPoint),D=v.mulVec2(E,this.p_localPoints[C]);I=s.dot(s.sub(D,F),S)-this.p_radiusA-this.p_radiusB,z=D;break;case V.e_faceB:S=y.mulVec2(E.q,this.p_localNormal),F=v.mulVec2(E,this.p_localPoint),D=v.mulVec2(P,this.p_localPoints[C]),I=s.dot(s.sub(D,F),S)-this.p_radiusA-this.p_radiusB,z=D,S.mul(-1)}var q=s.sub(z,b),L=s.sub(z,w);M=o.min(M,I);var O=e?a.toiBaugarte:a.baumgarte,k=a.linearSlop,j=a.maxLinearCorrection,R=o.clamp(O*(I+k),-j,0),J=s.cross(q,S),Y=s.cross(L,S),U=f+g+d*J*J+x*Y*Y,W=U>0?-R/U:0,Z=s.mul(W,S);b.subMul(f,Z),A-=d*s.cross(q,Z),w.addMul(g,Z),B+=x*s.cross(L,Z)}return m.c.set(b),m.a=A,l.c.set(w),l.a=B,M},K.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,n=e.getBody(),r=i.getBody(),o=n.c_velocity,h=r.c_velocity,u=n.c_position,c=r.c_position,m=this.p_radiusA,l=this.p_radiusB,p=this.getManifold(),_=this.v_invMassA,f=this.v_invMassB,d=this.v_invIA,g=this.v_invIB,x=s.clone(this.p_localCenterA),b=s.clone(this.p_localCenterB),A=s.clone(u.c),w=u.a,B=s.clone(o.v),M=o.w,C=s.clone(c.c),S=c.a,z=s.clone(h.v),I=h.w,P=v.identity(),E=v.identity();P.q.set(w),E.q.set(S),P.p.setCombine(1,A,-1,y.mulVec2(P.q,x)),E.p.setCombine(1,C,-1,y.mulVec2(E.q,b));var N=p.getWorldManifold(null,P,m,E,l);this.v_normal.set(N.normal);for(var V=0;V<this.v_pointCount;++V){var T=this.v_points[V];T.rA.set(s.sub(N.points[V],A)),T.rB.set(s.sub(N.points[V],C));var F=s.cross(T.rA,this.v_normal),D=s.cross(T.rB,this.v_normal),q=_+f+d*F*F+g*D*D;T.normalMass=q>0?1/q:0;var L=s.cross(this.v_normal,1),O=s.cross(T.rA,L),k=s.cross(T.rB,L),j=_+f+d*O*O+g*k*k;T.tangentMass=j>0?1/j:0,T.velocityBias=0;var R=s.dot(this.v_normal,z)+s.dot(this.v_normal,s.cross(I,T.rB))-s.dot(this.v_normal,B)-s.dot(this.v_normal,s.cross(M,T.rA));R<-a.velocityThreshold&&(T.velocityBias=-this.v_restitution*R)}if(2==this.v_pointCount&&t.blockSolve){var J=this.v_points[0],Y=this.v_points[1],U=s.cross(J.rA,this.v_normal),W=s.cross(J.rB,this.v_normal),Z=s.cross(Y.rA,this.v_normal),H=s.cross(Y.rB,this.v_normal),G=_+f+d*U*U+g*W*W,X=_+f+d*Z*Z+g*H*H,K=_+f+d*U*Z+g*W*H;G*G<1e3*(G*X-K*K)?(this.v_K.ex.set(G,K),this.v_K.ey.set(K,X),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}u.c.set(A),u.a=w,o.v.set(B),o.w=M,c.c.set(C),c.a=S,h.v.set(z),h.w=I},K.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,n=e.getBody(),r=i.getBody(),o=n.c_velocity,a=r.c_velocity;n.c_position,r.c_position;for(var h=this.v_invMassA,u=this.v_invIA,c=this.v_invMassB,m=this.v_invIB,l=s.clone(o.v),p=o.w,_=s.clone(a.v),f=a.w,d=this.v_normal,y=s.cross(d,1),v=0;v<this.v_pointCount;++v){var g=this.v_points[v],x=s.combine(g.normalImpulse,d,g.tangentImpulse,y);p-=u*s.cross(g.rA,x),l.subMul(h,x),f+=m*s.cross(g.rB,x),_.addMul(c,x)}o.v.set(l),o.w=p,a.v.set(_),a.w=f},K.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,i=0;i<this.v_pointCount;++i)e.points[i].normalImpulse=this.v_points[i].normalImpulse,e.points[i].tangentImpulse=this.v_points[i].tangentImpulse},K.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA.m_body,i=this.m_fixtureB.m_body,n=e.c_velocity;e.c_position;var r=i.c_velocity;i.c_position;for(var a=this.v_invMassA,h=this.v_invIA,u=this.v_invMassB,c=this.v_invIB,m=s.clone(n.v),l=n.w,p=s.clone(r.v),_=r.w,f=this.v_normal,d=s.cross(f,1),y=this.v_friction,v=0;v<this.v_pointCount;++v){var g=this.v_points[v];(M=s.zero()).addCombine(1,p,1,s.cross(_,g.rB)),M.subCombine(1,m,1,s.cross(l,g.rA));var x=s.dot(M,d)-this.v_tangentSpeed,b=g.tangentMass*-x,A=y*g.normalImpulse;b=(C=o.clamp(g.tangentImpulse+b,-A,A))-g.tangentImpulse,g.tangentImpulse=C;var w=s.mul(b,d);m.subMul(a,w),l-=h*s.cross(g.rA,w),p.addMul(u,w),_+=c*s.cross(g.rB,w)}if(1==this.v_pointCount||0==t.blockSolve)for(var B=0;B<this.v_pointCount;++B){var M;g=this.v_points[B],(M=s.zero()).addCombine(1,p,1,s.cross(_,g.rB)),M.subCombine(1,m,1,s.cross(l,g.rA));var C,S=s.dot(M,f);b=-g.normalMass*(S-g.velocityBias),b=(C=o.max(g.normalImpulse+b,0))-g.normalImpulse,g.normalImpulse=C,w=s.mul(b,f),m.subMul(a,w),l-=h*s.cross(g.rA,w),p.addMul(u,w),_+=c*s.cross(g.rB,w)}else{var z=this.v_points[0],I=this.v_points[1],P=s.neo(z.normalImpulse,I.normalImpulse),E=s.zero().add(p).add(s.cross(_,z.rB)).sub(m).sub(s.cross(l,z.rA)),V=s.zero().add(p).add(s.cross(_,I.rB)).sub(m).sub(s.cross(l,I.rA)),T=s.dot(E,f),F=s.dot(V,f),D=s.neo(T-z.velocityBias,F-I.velocityBias);for(D.sub(N.mulVec2(this.v_K,P));;){var q=N.mulVec2(this.v_normalMass,D).neg();if(q.x>=0&&q.y>=0){var L=s.sub(q,P),O=s.mul(L.x,f),k=s.mul(L.y,f);m.subCombine(a,O,a,k),l-=h*(s.cross(z.rA,O)+s.cross(I.rA,k)),p.addCombine(u,O,u,k),_+=c*(s.cross(z.rB,O)+s.cross(I.rB,k)),z.normalImpulse=q.x,I.normalImpulse=q.y;break}if(q.x=-z.normalMass*D.x,q.y=0,T=0,F=this.v_K.ex.y*q.x+D.y,q.x>=0&&F>=0){L=s.sub(q,P),O=s.mul(L.x,f),k=s.mul(L.y,f),m.subCombine(a,O,a,k),l-=h*(s.cross(z.rA,O)+s.cross(I.rA,k)),p.addCombine(u,O,u,k),_+=c*(s.cross(z.rB,O)+s.cross(I.rB,k)),z.normalImpulse=q.x,I.normalImpulse=q.y;break}if(q.x=0,q.y=-I.normalMass*D.y,T=this.v_K.ey.x*q.y+D.x,F=0,q.y>=0&&T>=0){L=s.sub(q,P),O=s.mul(L.x,f),k=s.mul(L.y,f),m.subCombine(a,O,a,k),l-=h*(s.cross(z.rA,O)+s.cross(I.rA,k)),p.addCombine(u,O,u,k),_+=c*(s.cross(z.rB,O)+s.cross(I.rB,k)),z.normalImpulse=q.x,I.normalImpulse=q.y;break}if(q.x=0,q.y=0,T=D.x,F=D.y,T>=0&&F>=0){L=s.sub(q,P),O=s.mul(L.x,f),k=s.mul(L.y,f),m.subCombine(a,O,a,k),l-=h*(s.cross(z.rA,O)+s.cross(I.rA,k)),p.addCombine(u,O,u,k),_+=c*(s.cross(z.rB,O)+s.cross(I.rB,k)),z.normalImpulse=q.x,I.normalImpulse=q.y;break}break}}n.v.set(m),n.w=l,r.v.set(p),r.w=_};var et=[];function it(){this.other=null,this.joint=null,this.prev=null,this.next=null}function nt(t,e,i){e=t.bodyA||e,i=t.bodyB||i,this.m_type="unknown-joint",this.m_bodyA=e,this.m_bodyB=i,this.m_index=0,this.m_collideConnected=!!t.collideConnected,this.m_prev=null,this.m_next=null,this.m_edgeA=new it,this.m_edgeB=new it,this.m_islandFlag=!1,this.m_userData=t.userData}K.addType=function(t,e,i){et[t]=et[t]||{},et[t][e]=i},K.create=function(t,e,i,n){var r,o,s=t.getType(),a=i.getType();if(o=et[s]&&et[s][a])r=new K(t,e,i,n,o);else{if(!(o=et[a]&&et[a][s]))return null;r=new K(i,n,t,e,o)}t=r.getFixtureA(),i=r.getFixtureB(),e=r.getChildIndexA(),n=r.getChildIndexB();var h=t.getBody(),u=i.getBody();return r.m_nodeA.contact=r,r.m_nodeA.other=u,r.m_nodeA.prev=null,r.m_nodeA.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=r.m_nodeA),h.m_contactList=r.m_nodeA,r.m_nodeB.contact=r,r.m_nodeB.other=h,r.m_nodeB.prev=null,r.m_nodeB.next=u.m_contactList,null!=u.m_contactList&&(u.m_contactList.prev=r.m_nodeB),u.m_contactList=r.m_nodeB,0==t.isSensor()&&0==i.isSensor()&&(h.setAwake(!0),u.setAwake(!0)),r},K.destroy=function(t,e){var i=t.m_fixtureA,n=t.m_fixtureB,r=i.getBody(),o=n.getBody();t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==r.m_contactList&&(r.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==o.m_contactList&&(o.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&0==i.isSensor()&&0==n.isSensor()&&(r.setAwake(!0),o.setAwake(!0));var s=i.getType(),a=n.getType(),h=et[s][a].destroyFcn;"function"==typeof h&&h(t)},nt.TYPES={},nt._deserialize=function(t,e,i){var n=nt.TYPES[t.type];return n&&i(n,t)},nt.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},nt.prototype.getType=function(){return this.m_type},nt.prototype.getBodyA=function(){return this.m_bodyA},nt.prototype.getBodyB=function(){return this.m_bodyB},nt.prototype.getNext=function(){return this.m_next},nt.prototype.getUserData=function(){return this.m_userData},nt.prototype.setUserData=function(t){this.m_userData=t},nt.prototype.getCollideConnected=function(){return this.m_collideConnected},nt.prototype.getAnchorA=function(){},nt.prototype.getAnchorB=function(){},nt.prototype.getReactionForce=function(t){},nt.prototype.getReactionTorque=function(t){},nt.prototype.shiftOrigin=function(t){},nt.prototype.initVelocityConstraints=function(t){},nt.prototype.solveVelocityConstraints=function(t){},nt.prototype.solvePositionConstraints=function(t){};var rt=function(){return Date.now()},ot=function(t){return Date.now()-t};mt.Input=function(){this.proxyA=new ht,this.proxyB=new ht,this.sweepA=new g,this.sweepB=new g,this.tMax},mt.Output=ct;var st=W.Input,at=W.Output,ht=W.Proxy,ut=W.Cache;function ct(){this.state,this.t}function mt(t,e){var i=rt();++k.toiCalls,t.state=ct.e_unknown,t.t=e.tMax;var n=e.proxyA,r=e.proxyB,s=e.sweepA,h=e.sweepB;s.normalize(),h.normalize();var u=e.tMax,c=n.m_radius+r.m_radius,m=o.max(a.linearSlop,c-3*a.linearSlop),l=.25*a.linearSlop,p=0,_=a.maxTOIIterations,f=0,d=new ut,y=new st;for(y.proxyA=e.proxyA,y.proxyB=e.proxyB,y.useRadii=!1;;){var g=v.identity(),x=v.identity();s.getTransform(g,p),h.getTransform(x,p),y.transformA=g,y.transformB=x;var b=new at;if(W(b,d,y),b.distance<=0){t.state=ct.e_overlapped,t.t=0;break}if(b.distance<m+l){t.state=ct.e_touching,t.t=p;break}var A=new lt;A.initialize(d,n,s,r,h,p);for(var w=!1,B=u,M=0;;){var C=A.findMinSeparation(B);if(A.indexA,A.indexB,C>m+l){t.state=ct.e_separated,t.t=u,w=!0;break}if(C>m-l){p=B;break}var S=A.evaluate(p);if(A.indexA,A.indexB,S<m-l){t.state=ct.e_failed,t.t=p,w=!0;break}if(S<=m+l){t.state=ct.e_touching,t.t=p,w=!0;break}for(var z=0,I=p,P=B;;){var E;E=1&z?I+(m-S)*(P-I)/(C-S):.5*(I+P),++z,++k.toiRootIters;var N=A.evaluate(E);if(A.indexA,A.indexB,o.abs(N-m)<l){B=E;break}if(N>m?(I=E,S=N):(P=E,C=N),50==z)break}if(k.toiMaxRootIters=o.max(k.toiMaxRootIters,z),++M==a.maxPolygonVertices)break}if(++f,++k.toiIters,w)break;if(f==_){t.state=ct.e_failed,t.t=p;break}}k.toiMaxIters=o.max(k.toiMaxIters,f);var V=ot(i);k.toiMaxTime=o.max(k.toiMaxTime,V),k.toiTime+=V}ct.e_unknown=0,ct.e_failed=1,ct.e_overlapped=2,ct.e_touching=3,ct.e_separated=4,k.toiTime=0,k.toiMaxTime=0,k.toiCalls=0,k.toiIters=0,k.toiMaxIters=0,k.toiRootIters=0,k.toiMaxRootIters=0;function lt(){this.m_proxyA=new ht,this.m_proxyB=new ht,this.m_sweepA,this.m_sweepB,this.indexA,this.indexB,this.m_type,this.m_localPoint=s.zero(),this.m_axis=s.zero()}lt.prototype.initialize=function(t,e,i,n,r,o){this.m_proxyA=e,this.m_proxyB=n;var a=t.count;this.m_sweepA=i,this.m_sweepB=r;var h=v.identity(),u=v.identity();if(this.m_sweepA.getTransform(h,o),this.m_sweepB.getTransform(u,o),1==a){this.m_type=1;var c=this.m_proxyA.getVertex(t.indexA[0]),m=this.m_proxyB.getVertex(t.indexB[0]),l=v.mulVec2(h,c),p=v.mulVec2(u,m);return this.m_axis.setCombine(1,p,-1,l),this.m_axis.normalize()}if(t.indexA[0]==t.indexA[1]){this.m_type=3;var _=n.getVertex(t.indexB[0]),f=n.getVertex(t.indexB[1]);this.m_axis=s.cross(s.sub(f,_),1),this.m_axis.normalize();var d=y.mulVec2(u.q,this.m_axis);return this.m_localPoint=s.mid(_,f),p=v.mulVec2(u,this.m_localPoint),c=e.getVertex(t.indexA[0]),l=v.mulVec2(h,c),(g=s.dot(l,d)-s.dot(p,d))<0&&(this.m_axis=s.neg(this.m_axis),g=-g),g}this.m_type=2;var g,x=this.m_proxyA.getVertex(t.indexA[0]),b=this.m_proxyA.getVertex(t.indexA[1]);return this.m_axis=s.cross(s.sub(b,x),1),this.m_axis.normalize(),d=y.mulVec2(h.q,this.m_axis),this.m_localPoint=s.mid(x,b),l=v.mulVec2(h,this.m_localPoint),m=this.m_proxyB.getVertex(t.indexB[0]),p=v.mulVec2(u,m),(g=s.dot(p,d)-s.dot(l,d))<0&&(this.m_axis=s.neg(this.m_axis),g=-g),g},lt.prototype.compute=function(t,e){var i=v.identity(),n=v.identity();switch(this.m_sweepA.getTransform(i,e),this.m_sweepB.getTransform(n,e),this.m_type){case 1:if(t){var r=y.mulTVec2(i.q,this.m_axis),o=y.mulTVec2(n.q,s.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(r),this.indexB=this.m_proxyB.getSupport(o)}var a=this.m_proxyA.getVertex(this.indexA),h=this.m_proxyB.getVertex(this.indexB),u=v.mulVec2(i,a),c=v.mulVec2(n,h);return s.dot(c,this.m_axis)-s.dot(u,this.m_axis);case 2:var m=y.mulVec2(i.q,this.m_axis);return u=v.mulVec2(i,this.m_localPoint),t&&(o=y.mulTVec2(n.q,s.neg(m)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(o)),h=this.m_proxyB.getVertex(this.indexB),c=v.mulVec2(n,h),s.dot(c,m)-s.dot(u,m);case 3:return m=y.mulVec2(n.q,this.m_axis),c=v.mulVec2(n,this.m_localPoint),t&&(r=y.mulTVec2(i.q,s.neg(m)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(r)),a=this.m_proxyA.getVertex(this.indexA),u=v.mulVec2(i,a),s.dot(u,m)-s.dot(c,m);default:return t&&(this.indexA=-1,this.indexB=-1),0}},lt.prototype.findMinSeparation=function(t){return this.compute(!0,t)},lt.prototype.evaluate=function(t){return this.compute(!1,t)},dt.TimeStep=ft;var pt=mt.Input,_t=mt.Output;function ft(t){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}function dt(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}ft.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},dt.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},dt.prototype.addBody=function(t){this.m_bodies.push(t)},dt.prototype.addContact=function(t){this.m_contacts.push(t)},dt.prototype.addJoint=function(t){this.m_joints.push(t)},dt.prototype.solveWorld=function(t){for(var e=this.m_world,i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(var n=e.m_contactList;n;n=n.m_next)n.m_islandFlag=!1;for(var r=e.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(var o=this.m_stack,s=e.m_bodyList;s;s=s.m_next)if(!s.m_islandFlag&&0!=s.isAwake()&&0!=s.isActive()&&!s.isStatic()){for(this.clear(),o.push(s),s.m_islandFlag=!0;o.length>0;)if(i=o.pop(),this.addBody(i),i.setAwake(!0),!i.isStatic()){for(var a=i.m_contactList;a;a=a.next){var h=a.contact;if(!h.m_islandFlag&&0!=h.isEnabled()&&0!=h.isTouching()){var u=h.m_fixtureA.m_isSensor,c=h.m_fixtureB.m_isSensor;u||c||(this.addContact(h),h.m_islandFlag=!0,(l=a.other).m_islandFlag||(o.push(l),l.m_islandFlag=!0))}}for(var m=i.m_jointList;m;m=m.next){var l;1!=m.joint.m_islandFlag&&0!=(l=m.other).isActive()&&(this.addJoint(m.joint),m.joint.m_islandFlag=!0,l.m_islandFlag||(o.push(l),l.m_islandFlag=!0))}}this.solveIsland(t);for(var p=0;p<this.m_bodies.length;++p)(i=this.m_bodies[p]).isStatic()&&(i.m_islandFlag=!1)}},dt.prototype.solveIsland=function(t){for(var e=this.m_world,i=e.m_gravity,n=e.m_allowSleep,r=t.dt,h=0;h<this.m_bodies.length;++h){var u=this.m_bodies[h],c=s.clone(u.m_sweep.c),m=u.m_sweep.a,l=s.clone(u.m_linearVelocity),p=u.m_angularVelocity;u.m_sweep.c0.set(u.m_sweep.c),u.m_sweep.a0=u.m_sweep.a,u.isDynamic()&&(l.addMul(r*u.m_gravityScale,i),l.addMul(r*u.m_invMass,u.m_force),p+=r*u.m_invI*u.m_torque,l.mul(1/(1+r*u.m_linearDamping)),p*=1/(1+r*u.m_angularDamping)),u.c_position.c=c,u.c_position.a=m,u.c_velocity.v=l,u.c_velocity.w=p}for(h=0;h<this.m_contacts.length;++h)this.m_contacts[h].initConstraint(t);for(h=0;h<this.m_contacts.length;++h)this.m_contacts[h].initVelocityConstraint(t);if(t.warmStarting)for(h=0;h<this.m_contacts.length;++h)this.m_contacts[h].warmStartConstraint(t);for(h=0;h<this.m_joints.length;++h)this.m_joints[h].initVelocityConstraints(t);for(h=0;h<t.velocityIterations;++h){for(var _=0;_<this.m_joints.length;++_)this.m_joints[_].solveVelocityConstraints(t);for(_=0;_<this.m_contacts.length;++_)this.m_contacts[_].solveVelocityConstraint(t)}for(h=0;h<this.m_contacts.length;++h)this.m_contacts[h].storeConstraintImpulses(t);for(h=0;h<this.m_bodies.length;++h){u=this.m_bodies[h],c=s.clone(u.c_position.c),m=u.c_position.a,l=s.clone(u.c_velocity.v),p=u.c_velocity.w;var f=s.mul(r,l);if(s.lengthSquared(f)>a.maxTranslationSquared){var d=a.maxTranslation/f.length();l.mul(d)}var y=r*p;y*y>a.maxRotationSquared&&(p*=d=a.maxRotation/o.abs(y)),c.addMul(r,l),m+=r*p,u.c_position.c.set(c),u.c_position.a=m,u.c_velocity.v.set(l),u.c_velocity.w=p}var v=!1;for(h=0;h<t.positionIterations;++h){var g=0;for(_=0;_<this.m_contacts.length;++_){var x=this.m_contacts[_].solvePositionConstraint(t);g=o.min(g,x)}var b=g>=-3*a.linearSlop,A=!0;for(_=0;_<this.m_joints.length;++_){var w=this.m_joints[_].solvePositionConstraints(t);A=A&&w}if(b&&A){v=!0;break}}for(h=0;h<this.m_bodies.length;++h)(u=this.m_bodies[h]).m_sweep.c.set(u.c_position.c),u.m_sweep.a=u.c_position.a,u.m_linearVelocity.set(u.c_velocity.v),u.m_angularVelocity=u.c_velocity.w,u.synchronizeTransform();if(this.postSolveIsland(),n){var B=1/0,M=a.linearSleepToleranceSqr,C=a.angularSleepToleranceSqr;for(h=0;h<this.m_bodies.length;++h)(u=this.m_bodies[h]).isStatic()||(0==u.m_autoSleepFlag||u.m_angularVelocity*u.m_angularVelocity>C||s.lengthSquared(u.m_linearVelocity)>M?(u.m_sleepTime=0,B=0):(u.m_sleepTime+=r,B=o.min(B,u.m_sleepTime)));if(B>=a.timeToSleep&&v)for(h=0;h<this.m_bodies.length;++h)(u=this.m_bodies[h]).setAwake(!1)}},dt.prototype.printBodies=function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[e];n(t,i.c_position.a,i.c_position.c.x,i.c_position.c.y,i.c_velocity.w,i.c_velocity.v.x,i.c_velocity.v.y)}};var yt=new ft;function vt(){this.normalImpulses=[],this.tangentImpulses=[]}dt.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var n=e.m_contactList;n;n=n.m_next)n.m_toiFlag=!1,n.m_islandFlag=!1,n.m_toiCount=0,n.m_toi=1}for(;;){var r=null,s=1;for(n=e.m_contactList;n;n=n.m_next)if(0!=n.isEnabled()&&!(n.m_toiCount>a.maxSubSteps)){var h=1;if(n.m_toiFlag)h=n.m_toi;else{var u=n.getFixtureA(),c=n.getFixtureB();if(u.isSensor()||c.isSensor())continue;var m=u.getBody(),l=c.getBody(),p=m.isAwake()&&!m.isStatic(),_=l.isAwake()&&!l.isStatic();if(0==p&&0==_)continue;var f=m.isBullet()||!m.isDynamic(),d=l.isBullet()||!l.isDynamic();if(0==f&&0==d)continue;var y=m.m_sweep.alpha0;m.m_sweep.alpha0<l.m_sweep.alpha0?(y=l.m_sweep.alpha0,m.m_sweep.advance(y)):l.m_sweep.alpha0<m.m_sweep.alpha0&&(y=m.m_sweep.alpha0,l.m_sweep.advance(y));var v=n.getChildIndexA(),g=n.getChildIndexB();m.m_sweep,l.m_sweep;var x=new pt;x.proxyA.set(u.getShape(),v),x.proxyB.set(c.getShape(),g),x.sweepA.set(m.m_sweep),x.sweepB.set(l.m_sweep),x.tMax=1;var b=new _t;mt(b,x);var A=b.t;h=b.state==_t.e_touching?o.min(y+(1-y)*A,1):1,n.m_toi=h,n.m_toiFlag=!0}h<s&&(r=n,s=h)}if(null==r||1-10*o.EPSILON<s){e.m_stepComplete=!0;break}u=r.getFixtureA(),c=r.getFixtureB(),m=u.getBody(),l=c.getBody();var w=m.m_sweep.clone(),B=l.m_sweep.clone();if(m.advance(s),l.advance(s),r.update(e),r.m_toiFlag=!1,++r.m_toiCount,0!=r.isEnabled()&&0!=r.isTouching()){m.setAwake(!0),l.setAwake(!0),this.clear(),this.addBody(m),this.addBody(l),this.addContact(r),m.m_islandFlag=!0,l.m_islandFlag=!0,r.m_islandFlag=!0;for(var M=[m,l],C=0;C<M.length;++C)if((V=M[C]).isDynamic())for(var S=V.m_contactList;S;S=S.next){var z=S.contact;if(!z.m_islandFlag){var I=S.other;if(!I.isDynamic()||V.isBullet()||I.isBullet()){var P=z.m_fixtureA.m_isSensor,E=z.m_fixtureB.m_isSensor;if(!P&&!E){var N=I.m_sweep.clone();0==I.m_islandFlag&&I.advance(s),z.update(e),0!=z.isEnabled()&&0!=z.isTouching()?(z.m_islandFlag=!0,this.addContact(z),I.m_islandFlag||(I.m_islandFlag=!0,I.isStatic()||I.setAwake(!0),this.addBody(I))):(I.m_sweep.set(N),I.synchronizeTransform())}}}}for(yt.reset((1-s)*t.dt),yt.dtRatio=1,yt.positionIterations=20,yt.velocityIterations=t.velocityIterations,yt.warmStarting=!1,this.solveIslandTOI(yt,m,l),C=0;C<this.m_bodies.length;++C){var V;if((V=this.m_bodies[C]).m_islandFlag=!1,V.isDynamic())for(V.synchronizeFixtures(),S=V.m_contactList;S;S=S.next)S.contact.m_toiFlag=!1,S.contact.m_islandFlag=!1}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}else r.setEnabled(!1),m.m_sweep.set(w),l.m_sweep.set(B),m.synchronizeTransform(),l.synchronizeTransform()}},dt.prototype.solveIslandTOI=function(t,e,i){this.m_world;for(var n=0;n<this.m_bodies.length;++n)(m=this.m_bodies[n]).c_position.c.set(m.m_sweep.c),m.c_position.a=m.m_sweep.a,m.c_velocity.v.set(m.m_linearVelocity),m.c_velocity.w=m.m_angularVelocity;for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].initConstraint(t);for(n=0;n<t.positionIterations;++n){for(var r=0,h=0;h<this.m_contacts.length;++h){var u=this.m_contacts[h].solvePositionConstraintTOI(t,e,i);r=o.min(r,u)}if(r>=-1.5*a.linearSlop)break}for(e.m_sweep.c0.set(e.c_position.c),e.m_sweep.a0=e.c_position.a,i.m_sweep.c0.set(i.c_position.c),i.m_sweep.a0=i.c_position.a,n=0;n<this.m_contacts.length;++n)this.m_contacts[n].initVelocityConstraint(t);for(n=0;n<t.velocityIterations;++n)for(h=0;h<this.m_contacts.length;++h)this.m_contacts[h].solveVelocityConstraint(t);var c=t.dt;for(n=0;n<this.m_bodies.length;++n){var m=this.m_bodies[n],l=s.clone(m.c_position.c),p=m.c_position.a,_=s.clone(m.c_velocity.v),f=m.c_velocity.w,d=s.mul(c,_);if(s.dot(d,d)>a.maxTranslationSquared){var y=a.maxTranslation/d.length();_.mul(y)}var v=c*f;v*v>a.maxRotationSquared&&(f*=y=a.maxRotation/o.abs(v)),l.addMul(c,_),p+=c*f,m.c_position.c=l,m.c_position.a=p,m.c_velocity.v=_,m.c_velocity.w=f,m.m_sweep.c=l,m.m_sweep.a=p,m.m_linearVelocity=_,m.m_angularVelocity=f,m.synchronizeTransform()}this.postSolveIsland()},dt.prototype.postSolveIsland=function(){for(var t=new vt,e=0;e<this.m_contacts.length;++e){for(var i=this.m_contacts[e],n=0;n<i.v_points.length;++n)t.normalImpulses.push(i.v_points[n].normalImpulse),t.tangentImpulses.push(i.v_points[n].tangentImpulse);this.m_world.postSolve(i,t)}};var gt={gravity:s.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3};function xt(t){if(!(this instanceof xt))return new xt(t);t&&s.isValid(t)&&(t={gravity:t}),t=i(t,gt),this.m_solver=new dt(this),this.m_broadPhase=new d,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=s.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0,this.addPair=this.createContact.bind(this)}xt.prototype._serialize=function(){for(var t=[],e=[],i=this.getBodyList();i;i=i.getNext())t.push(i);for(var n=this.getJointList();n;n=n.getNext())"function"==typeof n._serialize&&e.push(n);return{gravity:this.m_gravity,bodies:t,joints:e}},xt._deserialize=function(t,e,i){if(!t)return new xt;var n=new xt(t.gravity);if(t.bodies)for(var r=t.bodies.length-1;r>=0;r-=1)n._addBody(i(P,t.bodies[r],n));if(t.joints)for(r=t.joints.length-1;r>=0;r--)n.createJoint(i(nt,t.joints[r],n));return n},xt.prototype.getBodyList=function(){return this.m_bodyList},xt.prototype.getJointList=function(){return this.m_jointList},xt.prototype.getContactList=function(){return this.m_contactList},xt.prototype.getBodyCount=function(){return this.m_bodyCount},xt.prototype.getJointCount=function(){return this.m_jointCount},xt.prototype.getContactCount=function(){return this.m_contactCount},xt.prototype.setGravity=function(t){this.m_gravity=t},xt.prototype.getGravity=function(){return this.m_gravity},xt.prototype.isLocked=function(){return this.m_locked},xt.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},xt.prototype.getAllowSleeping=function(){return this.m_allowSleep},xt.prototype.setWarmStarting=function(t){this.m_warmStarting=t},xt.prototype.getWarmStarting=function(){return this.m_warmStarting},xt.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},xt.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},xt.prototype.setSubStepping=function(t){this.m_subStepping=t},xt.prototype.getSubStepping=function(){return this.m_subStepping},xt.prototype.setAutoClearForces=function(t){this.m_clearForces=t},xt.prototype.getAutoClearForces=function(){return this.m_clearForces},xt.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},xt.prototype.queryAABB=function(t,e){var i=this.m_broadPhase;this.m_broadPhase.query(t,(function(t){var n=i.getUserData(t);return e(n.fixture)}))},xt.prototype.rayCast=function(t,e,i){var n=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},(function(t,e){var r=n.getUserData(e),o=r.fixture,a=r.childIndex,h={};if(o.rayCast(h,t,a)){var u=h.fraction,c=s.add(s.mul(1-u,t.p1),s.mul(u,t.p2));return i(o,c,h.normal,u)}return t.maxFraction}))},xt.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},xt.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},xt.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},xt.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},xt.prototype.shiftOrigin=function(t){if(!this.m_locked){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var i=this.m_jointList;i;i=i.m_next)i.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},xt.prototype._addBody=function(t){this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},xt.prototype.createBody=function(t,e){if(this.isLocked())return null;t&&s.isValid(t)&&(t={position:t,angle:e});var i=new P(this,t);return this._addBody(i),i},xt.prototype.createDynamicBody=function(t,e){return t?s.isValid(t)&&(t={position:t,angle:e}):t={},t.type="dynamic",this.createBody(t)},xt.prototype.createKinematicBody=function(t,e){return t?s.isValid(t)&&(t={position:t,angle:e}):t={},t.type="kinematic",this.createBody(t)},xt.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.publish("remove-joint",i.joint),this.destroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var n=t.m_contactList;n;){var r=n;n=n.next,this.destroyContact(r.contact),t.m_contactList=n}t.m_contactList=null;for(var o=t.m_fixtureList;o;){var s=o;o=o.m_next,this.publish("remove-fixture",s),s.destroyProxies(this.m_broadPhase),t.m_fixtureList=o}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},xt.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,0==t.m_collideConnected)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},xt.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,i=t.m_bodyB;if(e.setAwake(!0),i.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,0==t.m_collideConnected)for(var n=i.getContactList();n;)n.other==e&&n.contact.flagForFiltering(),n=n.next;this.publish("remove-joint",t)}};var bt=new dt.TimeStep;xt.prototype.step=function(t,e,i){if(this.publish("pre-step",t),(0|e)!==e&&(e=0),e=e||this.m_velocityIterations,i=i||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,bt.reset(t),bt.velocityIterations=e,bt.positionIterations=i,bt.warmStarting=this.m_warmStarting,bt.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(bt);for(var n=this.m_bodyList;n;n=n.getNext())0!=n.m_islandFlag&&(n.isStatic()||n.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(bt),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",t)},xt.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.addPair)},xt.prototype.createContact=function(t,e){var i=t.fixture,n=e.fixture,r=t.childIndex,o=e.childIndex,s=i.getBody(),a=n.getBody();if(s!=a){for(var h=a.getContactList();h;){if(h.other==s){var u=h.contact.getFixtureA(),c=h.contact.getFixtureB(),m=h.contact.getChildIndexA(),l=h.contact.getChildIndexB();if(u==i&&c==n&&m==r&&l==o)return;if(u==n&&c==i&&m==o&&l==r)return}h=h.next}if(0!=a.shouldCollide(s)&&0!=n.shouldCollide(i)){var p=K.create(i,r,n,o);null!=p&&(p.m_prev=null,null!=this.m_contactList&&(p.m_next=this.m_contactList,this.m_contactList.m_prev=p),this.m_contactList=p,++this.m_contactCount)}}},xt.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var i=t.getFixtureA(),n=t.getFixtureB(),r=t.getChildIndexA(),o=t.getChildIndexB(),s=i.getBody(),a=n.getBody();if(t.m_filterFlag){if(0==a.shouldCollide(s)){this.destroyContact(t);continue}if(0==n.shouldCollide(i)){this.destroyContact(t);continue}t.m_filterFlag=!1}var h=s.isAwake()&&!s.isStatic(),u=a.isAwake()&&!a.isStatic();if(0!=h||0!=u){var c=i.m_proxies[r].proxyId,m=n.m_proxies[o].proxyId;0!=this.m_broadPhase.testOverlap(c,m)?t.update(this):this.destroyContact(t)}}},xt.prototype.destroyContact=function(t){K.destroy(t,this),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),--this.m_contactCount},xt.prototype._listeners=null,xt.prototype.on=function(t,e){return"string"!=typeof t||"function"!=typeof e||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this},xt.prototype.off=function(t,e){if("string"!=typeof t||"function"!=typeof e)return this;var i=this._listeners&&this._listeners[t];if(!i||!i.length)return this;var n=i.indexOf(e);return n>=0&&i.splice(n,1),this},xt.prototype.publish=function(t,e,i,n){var r=this._listeners&&this._listeners[t];if(!r||!r.length)return 0;for(var o=0;o<r.length;o++)r[o].call(this,e,i,n);return r.length},xt.prototype.beginContact=function(t){this.publish("begin-contact",t)},xt.prototype.endContact=function(t){this.publish("end-contact",t)},xt.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},xt.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)};var At=0;function wt(t){var i=(t=t||{}).rootClass||xt,n=t.preSerialize||function(t){return t},r=t.postSerialize||function(t,e){return t},o=t.preDeserialize||function(t){return t},a=t.postDeserialize||function(t,e){return t},h={World:xt,Body:P,Joint:nt,Fixture:M,Shape:A},u=Object.assign({Vec2:s,Vec3:j},h);this.toJson=function(t){var i=[],o=[t],s={};function a(t,e){if(t.__sid=t.__sid||++At,!s[t.__sid]){o.push(t);var n={refIndex:i.length+o.length,refType:e};s[t.__sid]=n}return s[t.__sid]}function u(t,i){if("object"!==e(t)||null===t)return t;if("function"==typeof t._serialize){if(t!==i)for(var o in h)if(t instanceof h[o])return a(t,o);t=function(t){var e=(t=n(t))._serialize();return r(e,t)}(t)}if(Array.isArray(t)){for(var s=[],c=0;c<t.length;c++)s[c]=u(t[c]);t=s}else{for(var c in s={},t)t.hasOwnProperty(c)&&(s[c]=u(t[c]));t=s}return t}for(;o.length;){var c=o.shift(),m=u(c,c);i.push(m)}return i},this.fromJson=function(t){var e={};function n(t,e,i){e=o(e);var n=t._deserialize(e,i,r);return a(n,e)}function r(i,r,o){if(!r.refIndex)return i&&i._deserialize&&n(i,r,o);i=u[r.refType]||i;var s=r.refIndex;if(!e[s]){var a=n(i,t[s],o);e[s]=a}return e[s]}return i._deserialize(t[0],null,r)}}var Bt=new wt;function Mt(t,i){if(!(this instanceof Mt))return new Mt(t,i);Mt._super.call(this),this.m_type=Mt.TYPE,this.m_p=s.zero(),this.m_radius=1,"object"===e(t)&&s.isValid(t)?(this.m_p.set(t),"number"==typeof i&&(this.m_radius=i)):"number"==typeof t&&(this.m_radius=t)}function Ct(t,e){if(!(this instanceof Ct))return new Ct(t,e);Ct._super.call(this),this.m_type=Ct.TYPE,this.m_radius=a.polygonRadius,this.m_vertex1=t?s.clone(t):s.zero(),this.m_vertex2=e?s.clone(e):s.zero(),this.m_vertex0=s.zero(),this.m_vertex3=s.zero(),this.m_hasVertex0=!1,this.m_hasVertex3=!1}function St(t){if(!(this instanceof St))return new St(t);St._super.call(this),this.m_type=St.TYPE,this.m_radius=a.polygonRadius,this.m_centroid=s.zero(),this.m_vertices=[],this.m_normals=[],this.m_count=0,t&&t.length&&this._set(t)}function zt(t,e){if(!(this instanceof zt))return new zt(t,e);zt._super.call(this),this.m_type=zt.TYPE,this.m_radius=a.polygonRadius,this.m_vertices=[],this.m_count=0,this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_isLoop=e,t&&t.length&&(e?this._createLoop(t):this._createChain(t))}function It(t,e,i,n){if(!(this instanceof It))return new It(t,e,i,n);It._super.call(this),this._setAsBox(t,e,i,n)}function Pt(t,e,i,n,r){t.pointCount=0;var o=v.mulVec2(i,e.m_p),a=v.mulVec2(r,n.m_p),h=s.distanceSquared(a,o),u=e.m_radius+n.m_radius;h>u*u||(t.type=V.e_circles,t.localPoint.set(e.m_p),t.localNormal.setZero(),t.pointCount=1,t.points[0].localPoint.set(n.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=V.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=V.e_vertex)}function Et(t,e,i,n,r){t.pointCount=0;var o=v.mulTVec2(i,v.mulVec2(r,n.m_p)),a=e.m_vertex1,h=e.m_vertex2,u=s.sub(h,a),c=s.dot(u,s.sub(h,o)),m=s.dot(u,s.sub(o,a)),l=e.m_radius+n.m_radius;if(m<=0){var p=s.clone(a),_=s.sub(o,p);if(s.dot(_,_)>l*l)return;if(e.m_hasVertex0){var f=e.m_vertex0,d=a,y=s.sub(d,f);if(s.dot(y,s.sub(d,o))>0)return}return t.type=V.e_circles,t.localNormal.setZero(),t.localPoint.set(p),t.pointCount=1,t.points[0].localPoint.set(n.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=V.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=V.e_vertex)}if(c<=0){if(p=s.clone(h),_=s.sub(o,p),s.dot(_,_)>l*l)return;if(e.m_hasVertex3){var g=e.m_vertex3,x=h,b=s.sub(g,x);if(s.dot(b,s.sub(o,x))>0)return}return t.type=V.e_circles,t.localNormal.setZero(),t.localPoint.set(p),t.pointCount=1,t.points[0].localPoint.set(n.m_p),t.points[0].id.cf.indexA=1,t.points[0].id.cf.typeA=V.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=V.e_vertex)}var A=s.dot(u,u);if(p=s.combine(c/A,a,m/A,h),_=s.sub(o,p),!(s.dot(_,_)>l*l)){var w=s.neo(-u.y,u.x);s.dot(w,s.sub(o,a))<0&&w.set(-w.x,-w.y),w.normalize(),t.type=V.e_faceA,t.localNormal=w,t.localPoint.set(a),t.pointCount=1,t.points[0].localPoint.set(n.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=V.e_face,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=V.e_vertex}}function Nt(t,e,i,n){for(var r=t.m_count,o=i.m_count,a=t.m_normals,h=t.m_vertices,u=i.m_vertices,c=v.mulTXf(n,e),m=0,l=-1/0,p=0;p<r;++p){for(var _=y.mulVec2(c.q,a[p]),f=v.mulVec2(c,h[p]),d=1/0,g=0;g<o;++g){var x=s.dot(_,u[g])-s.dot(_,f);x<d&&(d=x)}d>l&&(l=d,m=p)}Nt._maxSeparation=l,Nt._bestIndex=m}function Vt(t,e,i,n,r){t.pointCount=0;var o=e.m_radius+n.m_radius;Nt(e,i,n,r);var h=Nt._bestIndex,u=Nt._maxSeparation;if(!(u>o)){Nt(n,r,e,i);var c=Nt._bestIndex,m=Nt._maxSeparation;if(!(m>o)){var l,p,_,f,d,g;m>u+.1*a.linearSlop?(l=n,p=e,_=r,f=i,d=c,t.type=V.e_faceB,g=1):(l=e,p=n,_=i,f=r,d=h,t.type=V.e_faceA,g=0);var x=[new V.ClipVertex,new V.ClipVertex];!function(t,e,i,n,r,o){for(var a=e.m_normals,h=r.m_count,u=r.m_vertices,c=r.m_normals,m=y.mulT(o.q,y.mulVec2(i.q,a[n])),l=0,p=1/0,_=0;_<h;++_){var f=s.dot(m,c[_]);f<p&&(p=f,l=_)}var d=l,g=d+1<h?d+1:0;t[0].v=v.mulVec2(o,u[d]),t[0].id.cf.indexA=n,t[0].id.cf.indexB=d,t[0].id.cf.typeA=V.e_face,t[0].id.cf.typeB=V.e_vertex,t[1].v=v.mulVec2(o,u[g]),t[1].id.cf.indexA=n,t[1].id.cf.indexB=g,t[1].id.cf.typeA=V.e_face,t[1].id.cf.typeB=V.e_vertex}(x,l,_,d,p,f);var b=l.m_count,A=l.m_vertices,w=d,B=d+1<b?d+1:0,M=A[w],C=A[B],S=s.sub(C,M);S.normalize();var z=s.cross(S,1),I=s.combine(.5,M,.5,C),P=y.mulVec2(_.q,S),E=s.cross(P,1);M=v.mulVec2(_,M),C=v.mulVec2(_,C);var N=s.dot(E,M),T=-s.dot(P,M)+o,F=s.dot(P,C)+o,D=[new V.ClipVertex,new V.ClipVertex],q=[new V.ClipVertex,new V.ClipVertex];if(!(V.clipSegmentToLine(D,x,s.neg(P),T,w)<2||V.clipSegmentToLine(q,D,P,F,B)<2)){t.localNormal=z,t.localPoint=I;for(var L=0,O=0;O<q.length;++O)if(s.dot(E,q[O].v)-N<=o){var k=t.points[L];if(k.localPoint.set(v.mulTVec2(f,q[O].v)),k.id=q[O].id,g){var j=k.id.cf,R=j.indexA,J=j.indexB,Y=j.typeA,U=j.typeB;j.indexA=J,j.indexB=R,j.typeA=U,j.typeB=Y}++L}t.pointCount=L}}}}function Tt(t,e,i,n,r){t.pointCount=0;for(var a=v.mulVec2(r,n.m_p),h=v.mulTVec2(i,a),u=0,c=-1/0,m=e.m_radius+n.m_radius,l=e.m_count,p=e.m_vertices,_=e.m_normals,f=0;f<l;++f){var d=s.dot(_[f],s.sub(h,p[f]));if(d>m)return;d>c&&(c=d,u=f)}var y=u,g=y+1<l?y+1:0,x=p[y],b=p[g];if(c<o.EPSILON)return t.pointCount=1,t.type=V.e_faceA,t.localNormal.set(_[u]),t.localPoint.setCombine(.5,x,.5,b),t.points[0].localPoint=n.m_p,t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=V.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=V.e_vertex);var A=s.dot(s.sub(h,x),s.sub(b,x)),w=s.dot(s.sub(h,b),s.sub(x,b));if(A<=0){if(s.distanceSquared(h,x)>m*m)return;t.pointCount=1,t.type=V.e_faceA,t.localNormal.setCombine(1,h,-1,x),t.localNormal.normalize(),t.localPoint=x,t.points[0].localPoint.set(n.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=V.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=V.e_vertex}else if(w<=0){if(s.distanceSquared(h,b)>m*m)return;t.pointCount=1,t.type=V.e_faceA,t.localNormal.setCombine(1,h,-1,b),t.localNormal.normalize(),t.localPoint.set(b),t.points[0].localPoint.set(n.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=V.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=V.e_vertex}else{var B=s.mid(x,b);if((c=s.dot(h,_[y])-s.dot(B,_[y]))>m)return;t.pointCount=1,t.type=V.e_faceA,t.localNormal.set(_[y]),t.localPoint.set(B),t.points[0].localPoint.set(n.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=V.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=V.e_vertex}}wt.toJson=Bt.toJson,wt.fromJson=Bt.fromJson,Mt._super=A,Mt.prototype=Object.create(Mt._super.prototype),Mt.TYPE="circle",A.TYPES[Mt.TYPE]=Mt,Mt.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},Mt._deserialize=function(t){return new Mt(t.p,t.radius)},Mt.prototype.getRadius=function(){return this.m_radius},Mt.prototype.getCenter=function(){return this.m_p},Mt.prototype.getVertex=function(t){return this.m_p},Mt.prototype.getVertexCount=function(t){return 1},Mt.prototype._clone=function(){var t=new Mt;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},Mt.prototype.getChildCount=function(){return 1},Mt.prototype.testPoint=function(t,e){var i=s.add(t.p,y.mulVec2(t.q,this.m_p)),n=s.sub(e,i);return s.dot(n,n)<=this.m_radius*this.m_radius},Mt.prototype.rayCast=function(t,e,i,n){var r=s.add(i.p,y.mulVec2(i.q,this.m_p)),a=s.sub(e.p1,r),h=s.dot(a,a)-this.m_radius*this.m_radius,u=s.sub(e.p2,e.p1),c=s.dot(a,u),m=s.dot(u,u),l=c*c-m*h;if(l<0||m<o.EPSILON)return!1;var p=-(c+o.sqrt(l));return 0<=p&&p<=e.maxFraction*m&&(p/=m,t.fraction=p,t.normal=s.add(a,s.mul(p,u)),t.normal.normalize(),!0)},Mt.prototype.computeAABB=function(t,e,i){var n=s.add(e.p,y.mulVec2(e.q,this.m_p));t.lowerBound.set(n.x-this.m_radius,n.y-this.m_radius),t.upperBound.set(n.x+this.m_radius,n.y+this.m_radius)},Mt.prototype.computeMass=function(t,e){t.mass=e*o.PI*this.m_radius*this.m_radius,t.center=this.m_p,t.I=t.mass*(.5*this.m_radius*this.m_radius+s.dot(this.m_p,this.m_p))},Mt.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_p),t.m_count=1,t.m_radius=this.m_radius},Ct._super=A,Ct.prototype=Object.create(Ct._super.prototype),Ct.TYPE="edge",A.TYPES[Ct.TYPE]=Ct,Ct.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},Ct._deserialize=function(t){var e=new Ct(t.vertex1,t.vertex2);return e.hasVertex0&&e.setPrev(t.vertex0),e.hasVertex3&&e.setNext(t.vertex3),e},Ct.prototype.setNext=function(t){return t?(this.m_vertex3.set(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},Ct.prototype.setPrev=function(t){return t?(this.m_vertex0.set(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},Ct.prototype._set=function(t,e){return this.m_vertex1.set(t),this.m_vertex2.set(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},Ct.prototype._clone=function(){var t=new Ct;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.set(this.m_vertex1),t.m_vertex2.set(this.m_vertex2),t.m_vertex0.set(this.m_vertex0),t.m_vertex3.set(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},Ct.prototype.getChildCount=function(){return 1},Ct.prototype.testPoint=function(t,e){return!1},Ct.prototype.rayCast=function(t,e,i,n){var r=y.mulTVec2(i.q,s.sub(e.p1,i.p)),o=y.mulTVec2(i.q,s.sub(e.p2,i.p)),a=s.sub(o,r),h=this.m_vertex1,u=this.m_vertex2,c=s.sub(u,h),m=s.neo(c.y,-c.x);m.normalize();var l=s.dot(m,s.sub(h,r)),p=s.dot(m,a);if(0==p)return!1;var _=l/p;if(_<0||e.maxFraction<_)return!1;var f=s.add(r,s.mul(_,a)),d=s.sub(u,h),v=s.dot(d,d);if(0==v)return!1;var g=s.dot(s.sub(f,h),d)/v;return!(g<0||1<g||(t.fraction=_,t.normal=l>0?y.mulVec2(i.q,m).neg():y.mulVec2(i.q,m),0))},Ct.prototype.computeAABB=function(t,e,i){var n=v.mulVec2(e,this.m_vertex1),r=v.mulVec2(e,this.m_vertex2);t.combinePoints(n,r),t.extend(this.m_radius)},Ct.prototype.computeMass=function(t,e){t.mass=0,t.center.setCombine(.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},Ct.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_vertex1),t.m_vertices.push(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius},St._super=A,St.prototype=Object.create(St._super.prototype),St.TYPE="polygon",A.TYPES[St.TYPE]=St,St.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},St._deserialize=function(t,e,i){var n=[];if(t.vertices)for(var r=0;r<t.vertices.length;r++)n.push(i(s,t.vertices[r]));return new St(n)},St.prototype.getVertex=function(t){return this.m_vertices[t]},St.prototype._clone=function(){var t=new St;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.set(this.m_centroid);for(var e=0;e<this.m_count;e++)t.m_vertices.push(this.m_vertices[e].clone());for(e=0;e<this.m_normals.length;e++)t.m_normals.push(this.m_normals[e].clone());return t},St.prototype.getChildCount=function(){return 1},St.prototype._reset=function(){this._set(this.m_vertices)},St.prototype._set=function(t){if(t.length<3)this._setAsBox(1,1);else{for(var e=o.min(t.length,a.maxPolygonVertices),i=[],n=0;n<e;++n){for(var r=t[n],h=!0,u=0;u<i.length;++u)if(s.distanceSquared(r,i[u])<.25*a.linearSlopSquared){h=!1;break}h&&i.push(r)}if((e=i.length)<3)this._setAsBox(1,1);else{var c=0,m=i[0].x;for(n=1;n<e;++n){var l=i[n].x;(l>m||l===m&&i[n].y<i[c].y)&&(c=n,m=l)}for(var p=[],_=0,f=c;;){p[_]=f;var d=0;for(u=1;u<e;++u)if(d!==f){var y=s.sub(i[d],i[p[_]]),v=(r=s.sub(i[u],i[p[_]]),s.cross(y,r));v<0&&(d=u),0===v&&r.lengthSquared()>y.lengthSquared()&&(d=u)}else d=u;if(++_,f=d,d===c)break}if(_<3)this._setAsBox(1,1);else{for(this.m_count=_,this.m_vertices=[],n=0;n<_;++n)this.m_vertices[n]=i[p[n]];for(n=0;n<_;++n){var g=n,x=n+1<_?n+1:0,b=s.sub(this.m_vertices[x],this.m_vertices[g]);this.m_normals[n]=s.cross(b,1),this.m_normals[n].normalize()}this.m_centroid=function(t,e){for(var i=s.zero(),n=0,r=s.zero(),o=1/3,a=0;a<e;++a){var h=r,u=t[a],c=a+1<e?t[a+1]:t[0],m=s.sub(u,h),l=s.sub(c,h),p=.5*s.cross(m,l);n+=p,i.addMul(p*o,h),i.addMul(p*o,u),i.addMul(p*o,c)}return i.mul(1/n),i}(this.m_vertices,_)}}}},St.prototype._setAsBox=function(t,e,i,n){if(this.m_vertices[0]=s.neo(t,-e),this.m_vertices[1]=s.neo(t,e),this.m_vertices[2]=s.neo(-t,e),this.m_vertices[3]=s.neo(-t,-e),this.m_normals[0]=s.neo(1,0),this.m_normals[1]=s.neo(0,1),this.m_normals[2]=s.neo(-1,0),this.m_normals[3]=s.neo(0,-1),this.m_count=4,s.isValid(i)){n=n||0,this.m_centroid.set(i);var r=v.identity();r.p.set(i),r.q.set(n);for(var o=0;o<this.m_count;++o)this.m_vertices[o]=v.mulVec2(r,this.m_vertices[o]),this.m_normals[o]=y.mulVec2(r.q,this.m_normals[o])}},St.prototype.testPoint=function(t,e){for(var i=y.mulTVec2(t.q,s.sub(e,t.p)),n=0;n<this.m_count;++n)if(s.dot(this.m_normals[n],s.sub(i,this.m_vertices[n]))>0)return!1;return!0},St.prototype.rayCast=function(t,e,i,n){for(var r=y.mulTVec2(i.q,s.sub(e.p1,i.p)),o=y.mulTVec2(i.q,s.sub(e.p2,i.p)),a=s.sub(o,r),h=0,u=e.maxFraction,c=-1,m=0;m<this.m_count;++m){var l=s.dot(this.m_normals[m],s.sub(this.m_vertices[m],r)),p=s.dot(this.m_normals[m],a);if(0==p){if(l<0)return!1}else p<0&&l<h*p?(h=l/p,c=m):p>0&&l<u*p&&(u=l/p);if(u<h)return!1}return c>=0&&(t.fraction=h,t.normal=y.mulVec2(i.q,this.m_normals[c]),!0)},St.prototype.computeAABB=function(t,e,i){for(var n=1/0,r=1/0,s=-1/0,a=-1/0,h=0;h<this.m_count;++h){var u=v.mulVec2(e,this.m_vertices[h]);n=o.min(n,u.x),s=o.max(s,u.x),r=o.min(r,u.y),a=o.max(a,u.y)}t.lowerBound.set(n,r),t.upperBound.set(s,a),t.extend(this.m_radius)},St.prototype.computeMass=function(t,e){for(var i=s.zero(),n=0,r=0,o=s.zero(),a=0;a<this.m_count;++a)o.add(this.m_vertices[a]);o.mul(1/this.m_count);var h=1/3;for(a=0;a<this.m_count;++a){var u=s.sub(this.m_vertices[a],o),c=a+1<this.m_count?s.sub(this.m_vertices[a+1],o):s.sub(this.m_vertices[0],o),m=s.cross(u,c),l=.5*m;n+=l,i.addCombine(l*h,u,l*h,c);var p=u.x,_=u.y,f=c.x,d=c.y;r+=.25*h*m*(p*p+f*p+f*f+(_*_+d*_+d*d))}t.mass=e*n,i.mul(1/n),t.center.setCombine(1,i,1,o),t.I=e*r,t.I+=t.mass*(s.dot(t.center,t.center)-s.dot(i,i))},St.prototype.validate=function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=t<this.m_count-1?e+1:0,n=this.m_vertices[e],r=s.sub(this.m_vertices[i],n),o=0;o<this.m_count;++o)if(o!=e&&o!=i){var a=s.sub(this.m_vertices[o],n);if(s.cross(r,a)<0)return!1}return!0},St.prototype.computeDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius},zt._super=A,zt.prototype=Object.create(zt._super.prototype),zt.TYPE="chain",A.TYPES[zt.TYPE]=zt,zt.prototype._serialize=function(){var t={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex};return this.m_prevVertex&&(t.prevVertex=this.m_prevVertex),this.m_nextVertex&&(t.nextVertex=this.m_nextVertex),t},zt._deserialize=function(t,e,i){var n=[];if(t.vertices)for(var r=0;r<t.vertices.length;r++)n.push(i(s,t.vertices[r]));var o=new zt(n,t.isLoop);return t.prevVertex&&o.setPrevVertex(t.prevVertex),t.nextVertex&&o.setNextVertex(t.nextVertex),o},zt.prototype._createLoop=function(t){for(var e=1;e<t.length;++e)t[e-1],t[e];for(this.m_vertices=[],this.m_count=t.length+1,e=0;e<t.length;++e)this.m_vertices[e]=s.clone(t[e]);return this.m_vertices[t.length]=s.clone(t[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},zt.prototype._createChain=function(t){for(var e=1;e<t.length;++e)t[e-1],t[e];for(this.m_count=t.length,e=0;e<t.length;++e)this.m_vertices[e]=s.clone(t[e]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},zt.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)},zt.prototype.setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},zt.prototype.setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},zt.prototype._clone=function(){var t=new zt;return t.createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},zt.prototype.getChildCount=function(){return this.m_count-1},zt.prototype.getChildEdge=function(t,e){t.m_type=Ct.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[e],t.m_vertex2=this.m_vertices[e+1],e>0?(t.m_vertex0=this.m_vertices[e-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3=this.m_vertices[e+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},zt.prototype.getVertex=function(t){return t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},zt.prototype.testPoint=function(t,e){return!1},zt.prototype.rayCast=function(t,e,i,n){return new Ct(this.getVertex(n),this.getVertex(n+1)).rayCast(t,e,i,0)},zt.prototype.computeAABB=function(t,e,i){var n=v.mulVec2(e,this.getVertex(i)),r=v.mulVec2(e,this.getVertex(i+1));t.combinePoints(n,r)},zt.prototype.computeMass=function(t,e){t.mass=0,t.center=s.neo(),t.I=0},zt.prototype.computeDistanceProxy=function(t,e){t.m_buffer[0]=this.getVertex(e),t.m_buffer[1]=this.getVertex(e+1),t.m_vertices=t.m_buffer,t.m_count=2,t.m_radius=this.m_radius},It._super=St,It.prototype=Object.create(It._super.prototype),It.TYPE="polygon",K.addType(Mt.TYPE,Mt.TYPE,(function(t,e,i,n,r,o,s){Pt(t,i.getShape(),e,o.getShape(),r)})),K.addType(Ct.TYPE,Mt.TYPE,(function(t,e,i,n,r,o,s){Et(t,i.getShape(),e,o.getShape(),r)})),K.addType(zt.TYPE,Mt.TYPE,(function(t,e,i,n,r,o,s){var a=i.getShape(),h=new Ct;a.getChildEdge(h,n),Et(t,h,e,o.getShape(),r)})),K.addType(St.TYPE,St.TYPE,(function(t,e,i,n,r,o,s){Vt(t,i.getShape(),e,o.getShape(),r)})),K.addType(St.TYPE,Mt.TYPE,(function(t,e,i,n,r,o,s){Tt(t,i.getShape(),e,o.getShape(),r)})),K.addType(Ct.TYPE,St.TYPE,(function(t,e,i,n,r,o,s){kt(t,i.getShape(),e,o.getShape(),r)})),K.addType(zt.TYPE,St.TYPE,(function(t,e,i,n,r,o,s){var a=i.getShape(),h=new Ct;a.getChildEdge(h,n),kt(t,h,e,o.getShape(),r)}));function Ft(){this.type,this.index,this.separation}var Dt=new Ft,qt=new Ft,Lt=new function(){this.vertices=[],this.normals=[],this.count=0},Ot=new function(){this.i1,this.i2,this.v1,this.v2,this.normal=s.zero(),this.sideNormal1=s.zero(),this.sideOffset1,this.sideNormal2=s.zero(),this.sideOffset2};function kt(t,e,i,n,r){var h=v.mulTXf(i,r),u=v.mulVec2(h,n.m_centroid),c=e.m_vertex0,m=e.m_vertex1,l=e.m_vertex2,p=e.m_vertex3,_=e.m_hasVertex0,f=e.m_hasVertex3,d=s.sub(l,m);d.normalize();var g,x=s.neo(d.y,-d.x),b=s.dot(x,s.sub(u,m)),A=0,w=0,B=!1,M=!1;if(_){var C=s.sub(m,c);C.normalize();var S=s.neo(C.y,-C.x);B=s.cross(C,d)>=0,A=s.dot(S,u)-s.dot(S,c)}if(f){var z=s.sub(p,l);z.normalize();var I=s.neo(z.y,-z.x);M=s.cross(d,z)>0,w=s.dot(I,u)-s.dot(I,l)}var P=s.zero(),E=s.zero(),N=s.zero();_&&f?B&&M?(g=A>=0||b>=0||w>=0)?(P.set(x),E.set(S),N.set(I)):(P.setMul(-1,x),E.setMul(-1,x),N.setMul(-1,x)):B?(g=A>=0||b>=0&&w>=0)?(P.set(x),E.set(S),N.set(x)):(P.setMul(-1,x),E.setMul(-1,I),N.setMul(-1,x)):M?(g=w>=0||A>=0&&b>=0)?(P.set(x),E.set(x),N.set(I)):(P.setMul(-1,x),E.setMul(-1,x),N.setMul(-1,S)):(g=A>=0&&b>=0&&w>=0)?(P.set(x),E.set(x),N.set(x)):(P.setMul(-1,x),E.setMul(-1,I),N.setMul(-1,S)):_?B?(g=A>=0||b>=0)?(P.set(x),E.set(S),N.setMul(-1,x)):(P.setMul(-1,x),E.set(x),N.setMul(-1,x)):(g=A>=0&&b>=0)?(P.set(x),E.set(x),N.setMul(-1,x)):(P.setMul(-1,x),E.set(x),N.setMul(-1,S)):f?M?(g=b>=0||w>=0)?(P.set(x),E.setMul(-1,x),N.set(I)):(P.setMul(-1,x),E.setMul(-1,x),N.set(x)):(g=b>=0&&w>=0)?(P.set(x),E.setMul(-1,x),N.set(x)):(P.setMul(-1,x),E.setMul(-1,I),N.set(x)):(g=b>=0)?(P.set(x),E.setMul(-1,x),N.setMul(-1,x)):(P.setMul(-1,x),E.set(x),N.set(x)),Lt.count=n.m_count;for(var T=0;T<n.m_count;++T)Lt.vertices[T]=v.mulVec2(h,n.m_vertices[T]),Lt.normals[T]=y.mulVec2(h.q,n.m_normals[T]);var F=2*a.polygonRadius;for(t.pointCount=0,Dt.type=1,Dt.index=g?0:1,Dt.separation=1/0,T=0;T<Lt.count;++T)(q=s.dot(P,s.sub(Lt.vertices[T],m)))<Dt.separation&&(Dt.separation=q);if(-1!=Dt.type&&!(Dt.separation>F)){qt.type=-1,qt.index=-1,qt.separation=-1/0;var D=s.neo(-P.y,P.x);for(T=0;T<Lt.count;++T){var q,L=s.neg(Lt.normals[T]),O=s.dot(L,s.sub(Lt.vertices[T],m)),k=s.dot(L,s.sub(Lt.vertices[T],l));if((q=o.min(O,k))>F){qt.type=2,qt.index=T,qt.separation=q;break}if(s.dot(L,D)>=0){if(s.dot(s.sub(L,N),P)<-a.angularSlop)continue}else if(s.dot(s.sub(L,E),P)<-a.angularSlop)continue;q>qt.separation&&(qt.type=2,qt.index=T,qt.separation=q)}if(!(-1!=qt.type&&qt.separation>F)){var j;j=-1==qt.type?Dt:qt.separation>.98*Dt.separation+.001?qt:Dt;var R=[new V.ClipVertex,new V.ClipVertex];if(1==j.type){t.type=V.e_faceA;var J=0,Y=s.dot(P,Lt.normals[0]);for(T=1;T<Lt.count;++T){var U=s.dot(P,Lt.normals[T]);U<Y&&(Y=U,J=T)}var W=J,Z=W+1<Lt.count?W+1:0;R[0].v=Lt.vertices[W],R[0].id.cf.indexA=0,R[0].id.cf.indexB=W,R[0].id.cf.typeA=V.e_face,R[0].id.cf.typeB=V.e_vertex,R[1].v=Lt.vertices[Z],R[1].id.cf.indexA=0,R[1].id.cf.indexB=Z,R[1].id.cf.typeA=V.e_face,R[1].id.cf.typeB=V.e_vertex,g?(Ot.i1=0,Ot.i2=1,Ot.v1=m,Ot.v2=l,Ot.normal.set(x)):(Ot.i1=1,Ot.i2=0,Ot.v1=l,Ot.v2=m,Ot.normal.setMul(-1,x))}else t.type=V.e_faceB,R[0].v=m,R[0].id.cf.indexA=0,R[0].id.cf.indexB=j.index,R[0].id.cf.typeA=V.e_vertex,R[0].id.cf.typeB=V.e_face,R[1].v=l,R[1].id.cf.indexA=0,R[1].id.cf.indexB=j.index,R[1].id.cf.typeA=V.e_vertex,R[1].id.cf.typeB=V.e_face,Ot.i1=j.index,Ot.i2=Ot.i1+1<Lt.count?Ot.i1+1:0,Ot.v1=Lt.vertices[Ot.i1],Ot.v2=Lt.vertices[Ot.i2],Ot.normal.set(Lt.normals[Ot.i1]);Ot.sideNormal1.set(Ot.normal.y,-Ot.normal.x),Ot.sideNormal2.setMul(-1,Ot.sideNormal1),Ot.sideOffset1=s.dot(Ot.sideNormal1,Ot.v1),Ot.sideOffset2=s.dot(Ot.sideNormal2,Ot.v2);var H=[new V.ClipVertex,new V.ClipVertex],G=[new V.ClipVertex,new V.ClipVertex];if(!(V.clipSegmentToLine(H,R,Ot.sideNormal1,Ot.sideOffset1,Ot.i1)<a.maxManifoldPoints||V.clipSegmentToLine(G,H,Ot.sideNormal2,Ot.sideOffset2,Ot.i2)<a.maxManifoldPoints)){1==j.type?(t.localNormal=s.clone(Ot.normal),t.localPoint=s.clone(Ot.v1)):(t.localNormal=s.clone(n.m_normals[Ot.i1]),t.localPoint=s.clone(n.m_vertices[Ot.i1]));var X=0;for(T=0;T<a.maxManifoldPoints;++T)if(s.dot(Ot.normal,s.sub(G[T].v,Ot.v1))<=F){var K=t.points[X];1==j.type?(K.localPoint=v.mulT(h,G[T].v),K.id=G[T].id):(K.localPoint=G[T].v,K.id.cf.typeA=G[T].id.cf.typeB,K.id.cf.typeB=G[T].id.cf.typeA,K.id.cf.indexA=G[T].id.cf.indexB,K.id.cf.indexB=G[T].id.cf.indexA),++X}t.pointCount=X}}}}Rt.TYPE="distance-joint",nt.TYPES[Rt.TYPE]=Rt,Rt._super=nt,Rt.prototype=Object.create(Rt._super.prototype);var jt={frequencyHz:0,dampingRatio:0};function Rt(t,e,n,r,a){if(!(this instanceof Rt))return new Rt(t,e,n,r,a);if(n&&r&&"m_type"in r&&"x"in n&&"y"in n){var h=n;n=r,r=h}t=i(t,jt),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=Rt.TYPE,this.m_localAnchorA=s.clone(r?e.getLocalPoint(r):t.localAnchorA||s.zero()),this.m_localAnchorB=s.clone(a?n.getLocalPoint(a):t.localAnchorB||s.zero()),this.m_length=o.isFinite(t.length)?t.length:s.distance(e.getWorldPoint(this.m_localAnchorA),n.getWorldPoint(this.m_localAnchorB)),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}Rt.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},Rt._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),new Rt(t)},Rt.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB),t.length>0?this.m_length=+t.length:t.length<0||(t.anchorA||t.anchorA||t.anchorA||t.anchorA)&&(this.m_length=s.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB)))},Rt.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},Rt.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},Rt.prototype.setLength=function(t){this.m_length=t},Rt.prototype.getLength=function(){return this.m_length},Rt.prototype.setFrequency=function(t){this.m_frequencyHz=t},Rt.prototype.getFrequency=function(){return this.m_frequencyHz},Rt.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},Rt.prototype.getDampingRatio=function(){return this.m_dampingRatio},Rt.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},Rt.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},Rt.prototype.getReactionForce=function(t){return s.mul(this.m_impulse,this.m_u).mul(t)},Rt.prototype.getReactionTorque=function(t){return 0},Rt.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,u=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,l=y.neo(i),p=y.neo(u);this.m_rA=y.mulVec2(l,s.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=y.mulVec2(p,s.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=s.sub(s.add(h,this.m_rB),s.add(e,this.m_rA));var _=this.m_u.length();_>a.linearSlop?this.m_u.mul(1/_):this.m_u.set(0,0);var f=s.cross(this.m_rA,this.m_u),d=s.cross(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*f*f+this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=0!=v?1/v:0,this.m_frequencyHz>0){var g=_-this.m_length,x=2*o.PI*this.m_frequencyHz,b=2*this.m_mass*this.m_dampingRatio*x,A=this.m_mass*x*x,w=t.dt;this.m_gamma=w*(b+w*A),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=g*w*A*this.m_gamma,v+=this.m_gamma,this.m_mass=0!=v?1/v:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var B=s.mul(this.m_impulse,this.m_u);n.subMul(this.m_invMassA,B),r-=this.m_invIA*s.cross(this.m_rA,B),c.addMul(this.m_invMassB,B),m+=this.m_invIB*s.cross(this.m_rB,B)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.set(c),this.m_bodyB.c_velocity.w=m},Rt.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,o=s.add(e,s.cross(i,this.m_rA)),a=s.add(n,s.cross(r,this.m_rB)),h=s.dot(this.m_u,a)-s.dot(this.m_u,o),u=-this.m_mass*(h+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=u;var c=s.mul(u,this.m_u);e.subMul(this.m_invMassA,c),i-=this.m_invIA*s.cross(this.m_rA,c),n.addMul(this.m_invMassB,c),r+=this.m_invIB*s.cross(this.m_rB,c),this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.set(n),this.m_bodyB.c_velocity.w=r},Rt.prototype.solvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=y.neo(i),u=y.neo(r),c=y.mulSub(h,this.m_localAnchorA,this.m_localCenterA),m=y.mulSub(u,this.m_localAnchorB,this.m_localCenterB),l=s.sub(s.add(n,m),s.add(e,c)),p=l.normalize()-this.m_length;p=o.clamp(p,-a.maxLinearCorrection,a.maxLinearCorrection);var _=-this.m_mass*p,f=s.mul(_,l);return e.subMul(this.m_invMassA,f),i-=this.m_invIA*s.cross(c,f),n.addMul(this.m_invMassB,f),r+=this.m_invIB*s.cross(m,f),this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(n),this.m_bodyB.c_position.a=r,o.abs(p)<a.linearSlop},Yt.TYPE="friction-joint",nt.TYPES[Yt.TYPE]=Yt,Yt._super=nt,Yt.prototype=Object.create(Yt._super.prototype);var Jt={maxForce:0,maxTorque:0};function Yt(t,e,n,r){if(!(this instanceof Yt))return new Yt(t,e,n,r);t=i(t,Jt),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=Yt.TYPE,this.m_localAnchorA=s.clone(r?e.getLocalPoint(r):t.localAnchorA||s.zero()),this.m_localAnchorB=s.clone(r?n.getLocalPoint(r):t.localAnchorB||s.zero()),this.m_linearImpulse=s.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}Yt.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},Yt._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),new Yt(t)},Yt.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},Yt.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},Yt.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},Yt.prototype.setMaxForce=function(t){this.m_maxForce=t},Yt.prototype.getMaxForce=function(){return this.m_maxForce},Yt.prototype.setMaxTorque=function(t){this.m_maxTorque=t},Yt.prototype.getMaxTorque=function(){return this.m_maxTorque},Yt.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},Yt.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},Yt.prototype.getReactionForce=function(t){return s.mul(t,this.m_linearImpulse)},Yt.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},Yt.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,r=this.m_bodyB.c_position.a,o=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=y.neo(e),u=y.neo(r);this.m_rA=y.mulVec2(h,s.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=y.mulVec2(u,s.sub(this.m_localAnchorB,this.m_localCenterB));var c=this.m_invMassA,m=this.m_invMassB,l=this.m_invIA,p=this.m_invIB,_=new N;if(_.ex.x=c+m+l*this.m_rA.y*this.m_rA.y+p*this.m_rB.y*this.m_rB.y,_.ex.y=-l*this.m_rA.x*this.m_rA.y-p*this.m_rB.x*this.m_rB.y,_.ey.x=_.ex.y,_.ey.y=c+m+l*this.m_rA.x*this.m_rA.x+p*this.m_rB.x*this.m_rB.x,this.m_linearMass=_.getInverse(),this.m_angularMass=l+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var f=s.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);i.subMul(c,f),n-=l*(s.cross(this.m_rA,f)+this.m_angularImpulse),o.addMul(m,f),a+=p*(s.cross(this.m_rB,f)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=a},Yt.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_invMassA,h=this.m_invMassB,u=this.m_invIA,c=this.m_invIB,m=t.dt,l=r-i,p=-this.m_angularMass*l,_=this.m_angularImpulse,f=m*this.m_maxTorque;this.m_angularImpulse=o.clamp(this.m_angularImpulse+p,-f,f),i-=u*(p=this.m_angularImpulse-_),r+=c*p,l=s.sub(s.add(n,s.cross(r,this.m_rB)),s.add(e,s.cross(i,this.m_rA))),p=s.neg(N.mulVec2(this.m_linearMass,l)),_=this.m_linearImpulse,this.m_linearImpulse.add(p),f=m*this.m_maxForce,this.m_linearImpulse.lengthSquared()>f*f&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(f)),p=s.sub(this.m_linearImpulse,_),e.subMul(a,p),i-=u*s.cross(this.m_rA,p),n.addMul(h,p),r+=c*s.cross(this.m_rB,p),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},Yt.prototype.solvePositionConstraints=function(t){return!0};Wt.TYPE="revolute-joint",nt.TYPES[Wt.TYPE]=Wt,Wt._super=nt,Wt.prototype=Object.create(Wt._super.prototype);var Ut={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1};function Wt(t,e,n,r){if(!(this instanceof Wt))return new Wt(t,e,n,r);t=i(t,Ut),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=Wt.TYPE,this.m_localAnchorA=s.clone(r?e.getLocalPoint(r):t.localAnchorA||s.zero()),this.m_localAnchorB=s.clone(r?n.getLocalPoint(r):t.localAnchorB||s.zero()),this.m_referenceAngle=o.isFinite(t.referenceAngle)?t.referenceAngle:n.getAngle()-e.getAngle(),this.m_impulse=j(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new R,this.m_motorMass,this.m_limitState=0}Wt.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},Wt._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),new Wt(t)},Wt.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},Wt.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},Wt.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},Wt.prototype.getReferenceAngle=function(){return this.m_referenceAngle},Wt.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},Wt.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},Wt.prototype.isMotorEnabled=function(){return this.m_enableMotor},Wt.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},Wt.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},Wt.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},Wt.prototype.getMotorSpeed=function(){return this.m_motorSpeed},Wt.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},Wt.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},Wt.prototype.isLimitEnabled=function(){return this.m_enableLimit},Wt.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},Wt.prototype.getLowerLimit=function(){return this.m_lowerAngle},Wt.prototype.getUpperLimit=function(){return this.m_upperAngle},Wt.prototype.setLimits=function(t,e){t==this.m_lowerAngle&&e==this.m_upperAngle||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},Wt.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},Wt.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},Wt.prototype.getReactionForce=function(t){return s.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},Wt.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},Wt.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,r=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,u=this.m_bodyB.c_velocity.w,c=y.neo(e),m=y.neo(r);this.m_rA=y.mulVec2(c,s.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=y.mulVec2(m,s.sub(this.m_localAnchorB,this.m_localCenterB));var l=this.m_invMassA,p=this.m_invMassB,_=this.m_invIA,f=this.m_invIB,d=_+f===0;if(this.m_mass.ex.x=l+p+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*f,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*f,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*f,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=l+p+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*f,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*f,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+f,this.m_motorMass=_+f,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||d)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==d){var v=r-e-this.m_referenceAngle;o.abs(this.m_upperAngle-this.m_lowerAngle)<2*a.angularSlop?this.m_limitState=3:v<=this.m_lowerAngle?(1!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):v>=this.m_upperAngle?(2!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var g=s.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(l,g),n-=_*(s.cross(this.m_rA,g)+this.m_motorImpulse+this.m_impulse.z),h.addMul(p,g),u+=f*(s.cross(this.m_rB,g)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=h,this.m_bodyB.c_velocity.w=u},Wt.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_invMassA,h=this.m_invMassB,u=this.m_invIA,c=this.m_invIB,m=u+c===0;if(this.m_enableMotor&&3!=this.m_limitState&&0==m){var l=r-i-this.m_motorSpeed,p=-this.m_motorMass*l,_=this.m_motorImpulse,f=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=o.clamp(this.m_motorImpulse+p,-f,f),i-=u*(p=this.m_motorImpulse-_),r+=c*p}if(this.m_enableLimit&&0!=this.m_limitState&&0==m){var d=s.zero();d.addCombine(1,n,1,s.cross(r,this.m_rB)),d.subCombine(1,e,1,s.cross(i,this.m_rA));var y=r-i;if(l=j(d.x,d.y,y),p=j.neg(this.m_mass.solve33(l)),3==this.m_limitState)this.m_impulse.add(p);else if(1==this.m_limitState)if(this.m_impulse.z+p.z<0){var v=s.combine(-1,d,this.m_impulse.z,s.neo(this.m_mass.ez.x,this.m_mass.ez.y)),g=this.m_mass.solve22(v);p.x=g.x,p.y=g.y,p.z=-this.m_impulse.z,this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,this.m_impulse.z=0}else this.m_impulse.add(p);else 2==this.m_limitState&&(this.m_impulse.z+p.z>0?(v=s.combine(-1,d,this.m_impulse.z,s.neo(this.m_mass.ez.x,this.m_mass.ez.y)),g=this.m_mass.solve22(v),p.x=g.x,p.y=g.y,p.z=-this.m_impulse.z,this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,this.m_impulse.z=0):this.m_impulse.add(p));var x=s.neo(p.x,p.y);e.subMul(a,x),i-=u*(s.cross(this.m_rA,x)+p.z),n.addMul(h,x),r+=c*(s.cross(this.m_rB,x)+p.z)}else(l=s.zero()).addCombine(1,n,1,s.cross(r,this.m_rB)),l.subCombine(1,e,1,s.cross(i,this.m_rA)),p=this.m_mass.solve22(s.neg(l)),this.m_impulse.x+=p.x,this.m_impulse.y+=p.y,e.subMul(a,p),i-=u*s.cross(this.m_rA,p),n.addMul(h,p),r+=c*s.cross(this.m_rB,p);this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},Wt.prototype.solvePositionConstraints=function(t){var e,i=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,r=this.m_bodyB.c_position.c,h=this.m_bodyB.c_position.a,u=y.neo(n),c=y.neo(h),m=0,l=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&0!=this.m_limitState&&0==l){var p=h-n-this.m_referenceAngle,_=0;if(3==this.m_limitState){var f=o.clamp(p-this.m_lowerAngle,-a.maxAngularCorrection,a.maxAngularCorrection);_=-this.m_motorMass*f,m=o.abs(f)}else 1==this.m_limitState?(m=-(f=p-this.m_lowerAngle),f=o.clamp(f+a.angularSlop,-a.maxAngularCorrection,0),_=-this.m_motorMass*f):2==this.m_limitState&&(m=f=p-this.m_upperAngle,f=o.clamp(f-a.angularSlop,0,a.maxAngularCorrection),_=-this.m_motorMass*f);n-=this.m_invIA*_,h+=this.m_invIB*_}u.set(n),c.set(h);var d=y.mulVec2(u,s.sub(this.m_localAnchorA,this.m_localCenterA)),v=y.mulVec2(c,s.sub(this.m_localAnchorB,this.m_localCenterB));(f=s.zero()).addCombine(1,r,1,v),f.subCombine(1,i,1,d),e=f.length();var g=this.m_invMassA,x=this.m_invMassB,b=this.m_invIA,A=this.m_invIB,w=new N;w.ex.x=g+x+b*d.y*d.y+A*v.y*v.y,w.ex.y=-b*d.x*d.y-A*v.x*v.y,w.ey.x=w.ex.y,w.ey.y=g+x+b*d.x*d.x+A*v.x*v.x;var B=s.neg(w.solve(f));return i.subMul(g,B),n-=b*s.cross(d,B),r.addMul(x,B),h+=A*s.cross(v,B),this.m_bodyA.c_position.c.set(i),this.m_bodyA.c_position.a=n,this.m_bodyB.c_position.c.set(r),this.m_bodyB.c_position.a=h,e<=a.linearSlop&&m<=a.angularSlop};Ht.TYPE="prismatic-joint",nt.TYPES[Ht.TYPE]=Ht,Ht._super=nt,Ht.prototype=Object.create(Ht._super.prototype);var Zt={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0};function Ht(t,e,n,r,a){if(!(this instanceof Ht))return new Ht(t,e,n,r,a);t=i(t,Zt),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=Ht.TYPE,this.m_localAnchorA=s.clone(r?e.getLocalPoint(r):t.localAnchorA||s.zero()),this.m_localAnchorB=s.clone(r?n.getLocalPoint(r):t.localAnchorB||s.zero()),this.m_localXAxisA=s.clone(a?e.getLocalVector(a):t.localAxisA||s.neo(1,0)),this.m_localXAxisA.normalize(),this.m_localYAxisA=s.cross(1,this.m_localXAxisA),this.m_referenceAngle=o.isFinite(t.referenceAngle)?t.referenceAngle:n.getAngle()-e.getAngle(),this.m_impulse=j(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=0,this.m_axis=s.zero(),this.m_perp=s.zero(),this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_axis,this.m_perp,this.m_s1,this.m_s2,this.m_a1,this.m_a2,this.m_K=new R,this.m_motorMass}Ht.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},Ht._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),t.localAxisA=s(t.localAxisA),new Ht(t)},Ht.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.set(t.localAxisA),this.m_localYAxisA.set(s.cross(1,t.localAxisA)))},Ht.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},Ht.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},Ht.prototype.getLocalAxisA=function(){return this.m_localXAxisA},Ht.prototype.getReferenceAngle=function(){return this.m_referenceAngle},Ht.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=s.sub(e,t),n=this.m_bodyA.getWorldVector(this.m_localXAxisA);return s.dot(i,n)},Ht.prototype.getJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=y.mulVec2(t.m_xf.q,s.sub(this.m_localAnchorA,t.m_sweep.localCenter)),n=y.mulVec2(e.m_xf.q,s.sub(this.m_localAnchorB,e.m_sweep.localCenter)),r=s.add(t.m_sweep.c,i),o=s.add(e.m_sweep.c,n),a=s.sub(o,r),h=y.mulVec2(t.m_xf.q,this.m_localXAxisA),u=t.m_linearVelocity,c=e.m_linearVelocity,m=t.m_angularVelocity,l=e.m_angularVelocity;return s.dot(a,s.cross(m,h))+s.dot(h,s.sub(s.addCross(c,l,n),s.addCross(u,m,i)))},Ht.prototype.isLimitEnabled=function(){return this.m_enableLimit},Ht.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},Ht.prototype.getLowerLimit=function(){return this.m_lowerTranslation},Ht.prototype.getUpperLimit=function(){return this.m_upperTranslation},Ht.prototype.setLimits=function(t,e){t==this.m_lowerTranslation&&e==this.m_upperTranslation||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},Ht.prototype.isMotorEnabled=function(){return this.m_enableMotor},Ht.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},Ht.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},Ht.prototype.setMaxMotorForce=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t},Ht.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},Ht.prototype.getMotorSpeed=function(){return this.m_motorSpeed},Ht.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},Ht.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},Ht.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},Ht.prototype.getReactionForce=function(t){return s.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)},Ht.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},Ht.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,u=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,l=y.neo(i),p=y.neo(u),_=y.mulVec2(l,s.sub(this.m_localAnchorA,this.m_localCenterA)),f=y.mulVec2(p,s.sub(this.m_localAnchorB,this.m_localCenterB)),d=s.zero();d.addCombine(1,h,1,f),d.subCombine(1,e,1,_);var v=this.m_invMassA,g=this.m_invMassB,x=this.m_invIA,b=this.m_invIB;this.m_axis=y.mulVec2(l,this.m_localXAxisA),this.m_a1=s.cross(s.add(d,_),this.m_axis),this.m_a2=s.cross(f,this.m_axis),this.m_motorMass=v+g+x*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=y.mulVec2(l,this.m_localYAxisA),this.m_s1=s.cross(s.add(d,_),this.m_perp),this.m_s2=s.cross(f,this.m_perp),s.cross(_,this.m_perp);var A=v+g+x*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,w=x*this.m_s1+b*this.m_s2,B=x*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,M=x+b;0==M&&(M=1);var C=x*this.m_a1+b*this.m_a2,S=v+g+x*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;if(this.m_K.ex.set(A,w,B),this.m_K.ey.set(w,M,C),this.m_K.ez.set(B,C,S),this.m_enableLimit){var z=s.dot(this.m_axis,d);o.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.linearSlop?this.m_limitState=3:z<=this.m_lowerTranslation?1!=this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):z>=this.m_upperTranslation?2!=this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var I=s.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),P=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,E=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.subMul(v,I),r-=x*P,c.addMul(g,I),m+=b*E}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.set(c),this.m_bodyB.c_velocity.w=m},Ht.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_invMassA,h=this.m_invMassB,u=this.m_invIA,c=this.m_invIB;if(this.m_enableMotor&&3!=this.m_limitState){var m=s.dot(this.m_axis,s.sub(n,e))+this.m_a2*r-this.m_a1*i,l=this.m_motorMass*(this.m_motorSpeed-m),p=this.m_motorImpulse,_=t.dt*this.m_maxMotorForce;this.m_motorImpulse=o.clamp(this.m_motorImpulse+l,-_,_),l=this.m_motorImpulse-p;var f=s.mul(l,this.m_axis),d=l*this.m_a1,y=l*this.m_a2;e.subMul(a,f),i-=u*d,n.addMul(h,f),r+=c*y}var v=s.zero();if(v.x+=s.dot(this.m_perp,n)+this.m_s2*r,v.x-=s.dot(this.m_perp,e)+this.m_s1*i,v.y=r-i,this.m_enableLimit&&0!=this.m_limitState){var g=0;g+=s.dot(this.m_axis,n)+this.m_a2*r,g-=s.dot(this.m_axis,e)+this.m_a1*i,m=j(v.x,v.y,g);var x=j(this.m_impulse),b=this.m_K.solve33(j.neg(m));this.m_impulse.add(b),1==this.m_limitState?this.m_impulse.z=o.max(this.m_impulse.z,0):2==this.m_limitState&&(this.m_impulse.z=o.min(this.m_impulse.z,0));var A=s.combine(-1,v,-(this.m_impulse.z-x.z),s.neo(this.m_K.ez.x,this.m_K.ez.y)),w=s.add(this.m_K.solve22(A),s.neo(x.x,x.y));this.m_impulse.x=w.x,this.m_impulse.y=w.y,b=j.sub(this.m_impulse,x),f=s.combine(b.x,this.m_perp,b.z,this.m_axis),d=b.x*this.m_s1+b.y+b.z*this.m_a1,y=b.x*this.m_s2+b.y+b.z*this.m_a2,e.subMul(a,f),i-=u*d,n.addMul(h,f),r+=c*y}else b=this.m_K.solve22(s.neg(v)),this.m_impulse.x+=b.x,this.m_impulse.y+=b.y,f=s.mul(b.x,this.m_perp),d=b.x*this.m_s1+b.y,y=b.x*this.m_s2+b.y,e.subMul(a,f),i-=u*d,n.addMul(h,f),r+=c*y;this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},Ht.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=y.neo(i),u=y.neo(r),c=this.m_invMassA,m=this.m_invMassB,l=this.m_invIA,p=this.m_invIB,_=y.mulVec2(h,s.sub(this.m_localAnchorA,this.m_localCenterA)),f=y.mulVec2(u,s.sub(this.m_localAnchorB,this.m_localCenterB)),d=s.sub(s.add(n,f),s.add(e,_)),v=y.mulVec2(h,this.m_localXAxisA),g=s.cross(s.add(d,_),v),x=s.cross(f,v),b=y.mulVec2(h,this.m_localYAxisA),A=s.cross(s.add(d,_),b),w=s.cross(f,b),B=j(),M=s.zero();M.x=s.dot(b,d),M.y=r-i-this.m_referenceAngle;var C=o.abs(M.x),S=o.abs(M.y),z=a.linearSlop,I=a.maxLinearCorrection,P=!1,E=0;if(this.m_enableLimit){var V=s.dot(v,d);o.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*z?(E=o.clamp(V,-I,I),C=o.max(C,o.abs(V)),P=!0):V<=this.m_lowerTranslation?(E=o.clamp(V-this.m_lowerTranslation+z,-I,0),C=o.max(C,this.m_lowerTranslation-V),P=!0):V>=this.m_upperTranslation&&(E=o.clamp(V-this.m_upperTranslation-z,0,I),C=o.max(C,V-this.m_upperTranslation),P=!0)}if(P){var T=c+m+l*A*A+p*w*w,F=l*A+p*w,D=l*A*g+p*w*x;0==(k=l+p)&&(k=1);var q=l*g+p*x,L=c+m+l*g*g+p*x*x;(J=new R).ex.set(T,F,D),J.ey.set(F,k,q),J.ez.set(D,q,L);var O=j();O.x=M.x,O.y=M.y,O.z=E,B=J.solve33(j.neg(O))}else{var k,J;T=c+m+l*A*A+p*w*w,F=l*A+p*w,0==(k=l+p)&&(k=1),(J=new N).ex.set(T,F),J.ey.set(F,k);var Y=J.solve(s.neg(M));B.x=Y.x,B.y=Y.y,B.z=0}var U=s.combine(B.x,b,B.z,v),W=B.x*A+B.y+B.z*g,Z=B.x*w+B.y+B.z*x;return e.subMul(c,U),i-=l*W,n.addMul(m,U),r+=p*Z,this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=r,C<=a.linearSlop&&S<=a.angularSlop},Xt.TYPE="gear-joint",nt.TYPES[Xt.TYPE]=Xt,Xt._super=nt,Xt.prototype=Object.create(Xt._super.prototype);var Gt={ratio:1};function Xt(t,e,n,r,a,h){if(!(this instanceof Xt))return new Xt(t,e,n,r,a,h);var u,c;t=i(t,Gt),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=Xt.TYPE,this.m_joint1=r||t.joint1,this.m_joint2=a||t.joint2,this.m_ratio=o.isFinite(h)?h:t.ratio,this.m_type1=this.m_joint1.getType(),this.m_type2=this.m_joint2.getType(),this.m_bodyC=this.m_joint1.getBodyA(),this.m_bodyA=this.m_joint1.getBodyB();var m=this.m_bodyA.m_xf,l=this.m_bodyA.m_sweep.a,p=this.m_bodyC.m_xf,_=this.m_bodyC.m_sweep.a;if(this.m_type1===Wt.TYPE){var f=this.m_joint1;this.m_localAnchorC=f.m_localAnchorA,this.m_localAnchorA=f.m_localAnchorB,this.m_referenceAngleA=f.m_referenceAngle,this.m_localAxisC=s.zero(),u=l-_-this.m_referenceAngleA}else{var d=this.m_joint1;this.m_localAnchorC=d.m_localAnchorA,this.m_localAnchorA=d.m_localAnchorB,this.m_referenceAngleA=d.m_referenceAngle,this.m_localAxisC=d.m_localXAxisA;var v=this.m_localAnchorC,g=y.mulTVec2(p.q,s.add(y.mul(m.q,this.m_localAnchorA),s.sub(m.p,p.p)));u=s.dot(g,this.m_localAxisC)-s.dot(v,this.m_localAxisC)}this.m_bodyD=this.m_joint2.getBodyA(),this.m_bodyB=this.m_joint2.getBodyB();var x=this.m_bodyB.m_xf,b=this.m_bodyB.m_sweep.a,A=this.m_bodyD.m_xf,w=this.m_bodyD.m_sweep.a;if(this.m_type2===Wt.TYPE)f=this.m_joint2,this.m_localAnchorD=f.m_localAnchorA,this.m_localAnchorB=f.m_localAnchorB,this.m_referenceAngleB=f.m_referenceAngle,this.m_localAxisD=s.zero(),c=b-w-this.m_referenceAngleB;else{d=this.m_joint2,this.m_localAnchorD=d.m_localAnchorA,this.m_localAnchorB=d.m_localAnchorB,this.m_referenceAngleB=d.m_referenceAngle,this.m_localAxisD=d.m_localXAxisA;var B=this.m_localAnchorD,M=y.mulTVec2(A.q,s.add(y.mul(x.q,this.m_localAnchorB),s.sub(x.p,A.p)));c=s.dot(M,this.m_localAxisD)-s.dot(B,this.m_localAxisD)}this.m_constant=u+this.m_ratio*c,this.m_impulse=0,this.m_lcA,this.m_lcB,this.m_lcC,this.m_lcD,this.m_mA,this.m_mB,this.m_mC,this.m_mD,this.m_iA,this.m_iB,this.m_iC,this.m_iD,this.m_JvAC,this.m_JvBD,this.m_JwA,this.m_JwB,this.m_JwC,this.m_JwD,this.m_mass}Xt.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},Xt._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),t.joint1=i(nt,t.joint1,e),t.joint2=i(nt,t.joint2,e),new Xt(t)},Xt.prototype.getJoint1=function(){return this.m_joint1},Xt.prototype.getJoint2=function(){return this.m_joint2},Xt.prototype.setRatio=function(t){this.m_ratio=t},Xt.prototype.getRatio=function(){return this.m_ratio},Xt.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},Xt.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},Xt.prototype.getReactionForce=function(t){return s.mul(this.m_impulse,this.m_JvAC).mul(t)},Xt.prototype.getReactionTorque=function(t){return t*(this.m_impulse*this.m_JwA)},Xt.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,r=this.m_bodyB.c_position.a,o=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=this.m_bodyC.c_position.a,u=this.m_bodyC.c_velocity.v,c=this.m_bodyC.c_velocity.w,m=this.m_bodyD.c_position.a,l=this.m_bodyD.c_velocity.v,p=this.m_bodyD.c_velocity.w,_=y.neo(e),f=y.neo(r),d=y.neo(h),v=y.neo(m);if(this.m_mass=0,this.m_type1==Wt.TYPE)this.m_JvAC=s.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var g=y.mulVec2(d,this.m_localAxisC),x=y.mulSub(d,this.m_localAnchorC,this.m_lcC),b=y.mulSub(_,this.m_localAnchorA,this.m_lcA);this.m_JvAC=g,this.m_JwC=s.cross(x,g),this.m_JwA=s.cross(b,g),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==Wt.TYPE)this.m_JvBD=s.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{g=y.mulVec2(v,this.m_localAxisD);var A=y.mulSub(v,this.m_localAnchorD,this.m_lcD),w=y.mulSub(f,this.m_localAnchorB,this.m_lcB);this.m_JvBD=s.mul(this.m_ratio,g),this.m_JwD=this.m_ratio*s.cross(A,g),this.m_JwB=this.m_ratio*s.cross(w,g),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.warmStarting?(i.addMul(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,o.addMul(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,u.subMul(this.m_mC*this.m_impulse,this.m_JvAC),c-=this.m_iC*this.m_impulse*this.m_JwC,l.subMul(this.m_mD*this.m_impulse,this.m_JvBD),p-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.set(i),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.set(o),this.m_bodyB.c_velocity.w=a,this.m_bodyC.c_velocity.v.set(u),this.m_bodyC.c_velocity.w=c,this.m_bodyD.c_velocity.v.set(l),this.m_bodyD.c_velocity.w=p},Xt.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,o=this.m_bodyC.c_velocity.v,a=this.m_bodyC.c_velocity.w,h=this.m_bodyD.c_velocity.v,u=this.m_bodyD.c_velocity.w,c=s.dot(this.m_JvAC,e)-s.dot(this.m_JvAC,o)+s.dot(this.m_JvBD,n)-s.dot(this.m_JvBD,h);c+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*r-this.m_JwD*u);var m=-this.m_mass*c;this.m_impulse+=m,e.addMul(this.m_mA*m,this.m_JvAC),i+=this.m_iA*m*this.m_JwA,n.addMul(this.m_mB*m,this.m_JvBD),r+=this.m_iB*m*this.m_JwB,o.subMul(this.m_mC*m,this.m_JvAC),a-=this.m_iC*m*this.m_JwC,h.subMul(this.m_mD*m,this.m_JvBD),u-=this.m_iD*m*this.m_JwD,this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.set(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.set(o),this.m_bodyC.c_velocity.w=a,this.m_bodyD.c_velocity.v.set(h),this.m_bodyD.c_velocity.w=u},Xt.prototype.solvePositionConstraints=function(t){var e,i,n,r,o,h,u,c,m=this.m_bodyA.c_position.c,l=this.m_bodyA.c_position.a,p=this.m_bodyB.c_position.c,_=this.m_bodyB.c_position.a,f=this.m_bodyC.c_position.c,d=this.m_bodyC.c_position.a,v=this.m_bodyD.c_position.c,g=this.m_bodyD.c_position.a,x=y.neo(l),b=y.neo(_),A=y.neo(d),w=y.neo(g),B=0;if(this.m_type1==Wt.TYPE)n=s.zero(),o=1,u=1,B+=this.m_iA+this.m_iC,e=l-d-this.m_referenceAngleA;else{var M=y.mulVec2(A,this.m_localAxisC),C=y.mulSub(A,this.m_localAnchorC,this.m_lcC),S=y.mulSub(x,this.m_localAnchorA,this.m_lcA);n=M,u=s.cross(C,M),o=s.cross(S,M),B+=this.m_mC+this.m_mA+this.m_iC*u*u+this.m_iA*o*o;var z=s.sub(this.m_localAnchorC,this.m_lcC),I=y.mulTVec2(A,s.add(S,s.sub(m,f)));e=s.dot(s.sub(I,z),this.m_localAxisC)}if(this.m_type2==Wt.TYPE)r=s.zero(),h=this.m_ratio,c=this.m_ratio,B+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=_-g-this.m_referenceAngleB;else{M=y.mulVec2(w,this.m_localAxisD);var P=y.mulSub(w,this.m_localAnchorD,this.m_lcD),E=y.mulSub(b,this.m_localAnchorB,this.m_lcB);r=s.mul(this.m_ratio,M),c=this.m_ratio*s.cross(P,M),h=this.m_ratio*s.cross(E,M),B+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*c*c+this.m_iB*h*h;var N=s.sub(this.m_localAnchorD,this.m_lcD),V=y.mulTVec2(w,s.add(E,s.sub(p,v)));i=s.dot(V,this.m_localAxisD)-s.dot(N,this.m_localAxisD)}var T=e+this.m_ratio*i-this.m_constant,F=0;return B>0&&(F=-T/B),m.addMul(this.m_mA*F,n),l+=this.m_iA*F*o,p.addMul(this.m_mB*F,r),_+=this.m_iB*F*h,f.subMul(this.m_mC*F,n),d-=this.m_iC*F*u,v.subMul(this.m_mD*F,r),g-=this.m_iD*F*c,this.m_bodyA.c_position.c.set(m),this.m_bodyA.c_position.a=l,this.m_bodyB.c_position.c.set(p),this.m_bodyB.c_position.a=_,this.m_bodyC.c_position.c.set(f),this.m_bodyC.c_position.a=d,this.m_bodyD.c_position.c.set(v),this.m_bodyD.c_position.a=g,0<a.linearSlop},$t.TYPE="motor-joint",nt.TYPES[$t.TYPE]=$t,$t._super=nt,$t.prototype=Object.create($t._super.prototype);var Kt={maxForce:1,maxTorque:1,correctionFactor:.3};function $t(t,e,n){if(!(this instanceof $t))return new $t(t,e,n);t=i(t,Kt),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=$t.TYPE,this.m_linearOffset=o.isFinite(t.linearOffset)?t.linearOffset:e.getLocalPoint(n.getPosition()),this.m_angularOffset=o.isFinite(t.angularOffset)?t.angularOffset:n.getAngle()-e.getAngle(),this.m_linearImpulse=s.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_linearError,this.m_angularError,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}$t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},$t._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),new $t(t)},$t.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},$t.prototype.setMaxForce=function(t){this.m_maxForce=t},$t.prototype.getMaxForce=function(){return this.m_maxForce},$t.prototype.setMaxTorque=function(t){this.m_maxTorque=t},$t.prototype.getMaxTorque=function(){return this.m_maxTorque},$t.prototype.setCorrectionFactor=function(t){this.m_correctionFactor=t},$t.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},$t.prototype.setLinearOffset=function(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=t)},$t.prototype.getLinearOffset=function(){return this.m_linearOffset},$t.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},$t.prototype.getAngularOffset=function(){return this.m_angularOffset},$t.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},$t.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},$t.prototype.getReactionForce=function(t){return s.mul(t,this.m_linearImpulse)},$t.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},$t.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.c,a=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,u=this.m_bodyB.c_velocity.w,c=y.neo(i),m=y.neo(a);this.m_rA=y.mulVec2(c,s.neg(this.m_localCenterA)),this.m_rB=y.mulVec2(m,s.neg(this.m_localCenterB));var l=this.m_invMassA,p=this.m_invMassB,_=this.m_invIA,f=this.m_invIB,d=new N;if(d.ex.x=l+p+_*this.m_rA.y*this.m_rA.y+f*this.m_rB.y*this.m_rB.y,d.ex.y=-_*this.m_rA.x*this.m_rA.y-f*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=l+p+_*this.m_rA.x*this.m_rA.x+f*this.m_rB.x*this.m_rB.x,this.m_linearMass=d.getInverse(),this.m_angularMass=_+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=s.zero(),this.m_linearError.addCombine(1,o,1,this.m_rB),this.m_linearError.subCombine(1,e,1,this.m_rA),this.m_linearError.sub(y.mulVec2(c,this.m_linearOffset)),this.m_angularError=a-i-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var v=s.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);n.subMul(l,v),r-=_*(s.cross(this.m_rA,v)+this.m_angularImpulse),h.addMul(p,v),u+=f*(s.cross(this.m_rB,v)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v=h,this.m_bodyB.c_velocity.w=u},$t.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_invMassA,h=this.m_invMassB,u=this.m_invIA,c=this.m_invIB,m=t.dt,l=t.inv_dt,p=r-i+l*this.m_correctionFactor*this.m_angularError,_=-this.m_angularMass*p,f=this.m_angularImpulse,d=m*this.m_maxTorque;this.m_angularImpulse=o.clamp(this.m_angularImpulse+_,-d,d),i-=u*(_=this.m_angularImpulse-f),r+=c*_,(p=s.zero()).addCombine(1,n,1,s.cross(r,this.m_rB)),p.subCombine(1,e,1,s.cross(i,this.m_rA)),p.addMul(l*this.m_correctionFactor,this.m_linearError),_=s.neg(N.mulVec2(this.m_linearMass,p)),f=s.clone(this.m_linearImpulse),this.m_linearImpulse.add(_),d=m*this.m_maxForce,this.m_linearImpulse.clamp(d),_=s.sub(this.m_linearImpulse,f),e.subMul(a,_),i-=u*s.cross(this.m_rA,_),n.addMul(h,_),r+=c*s.cross(this.m_rB,_),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},$t.prototype.solvePositionConstraints=function(t){return!0},te.TYPE="mouse-joint",nt.TYPES[te.TYPE]=te,te._super=nt,te.prototype=Object.create(te._super.prototype);var Qt={maxForce:0,frequencyHz:5,dampingRatio:.7};function te(t,e,n,r){if(!(this instanceof te))return new te(t,e,n,r);t=i(t,Qt),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=te.TYPE,this.m_targetA=r?s.clone(r):t.target||s.zero(),this.m_localAnchorB=v.mulTVec2(n.getTransform(),this.m_targetA),this.m_maxForce=t.maxForce,this.m_impulse=s.zero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_rB=s.zero(),this.m_localCenterB=s.zero(),this.m_invMassB=0,this.m_invIB=0,this.mass=new N,this.m_C=s.zero()}te.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},te._deserialize=function(t,e,i){(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),t.target=s(t.target);var n=new te(t);return t._localAnchorB&&(n.m_localAnchorB=t._localAnchorB),n},te.prototype.setTarget=function(t){0==this.m_bodyB.isAwake()&&this.m_bodyB.setAwake(!0),this.m_targetA=s.clone(t)},te.prototype.getTarget=function(){return this.m_targetA},te.prototype.setMaxForce=function(t){this.m_maxForce=t},te.getMaxForce=function(){return this.m_maxForce},te.prototype.setFrequency=function(t){this.m_frequencyHz=t},te.prototype.getFrequency=function(){return this.m_frequencyHz},te.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},te.prototype.getDampingRatio=function(){return this.m_dampingRatio},te.prototype.getAnchorA=function(){return s.clone(this.m_targetA)},te.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},te.prototype.getReactionForce=function(t){return s.mul(t,this.m_impulse)},te.prototype.getReactionTorque=function(t){return 0*t},te.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},te.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyB.c_position,i=this.m_bodyB.c_velocity,n=e.c,r=e.a,a=i.v,h=i.w,u=y.neo(r),c=this.m_bodyB.getMass(),m=2*o.PI*this.m_frequencyHz,l=2*c*this.m_dampingRatio*m,p=c*(m*m),_=t.dt;this.m_gamma=_*(l+_*p),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=_*p*this.m_gamma,this.m_rB=y.mulVec2(u,s.sub(this.m_localAnchorB,this.m_localCenterB));var f=new N;f.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,f.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,f.ey.x=f.ex.y,f.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=f.getInverse(),this.m_C.set(n),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),h*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),a.addMul(this.m_invMassB,this.m_impulse),h+=this.m_invIB*s.cross(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),i.v.set(a),i.w=h},te.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyB.c_velocity,i=s.clone(e.v),n=e.w,r=s.cross(n,this.m_rB);r.add(i),r.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),r.neg();var o=N.mulVec2(this.m_mass,r),a=s.clone(this.m_impulse);this.m_impulse.add(o);var h=t.dt*this.m_maxForce;this.m_impulse.clamp(h),o=s.sub(this.m_impulse,a),i.addMul(this.m_invMassB,o),n+=this.m_invIB*s.cross(this.m_rB,o),e.v.set(i),e.w=n},te.prototype.solvePositionConstraints=function(t){return!0},ie.TYPE="pulley-joint",ie.MIN_PULLEY_LENGTH=2,nt.TYPES[ie.TYPE]=ie,ie._super=nt,ie.prototype=Object.create(ie._super.prototype);var ee={collideConnected:!0};function ie(t,e,n,r,a,h,u,c){if(!(this instanceof ie))return new ie(t,e,n,r,a,h,u,c);t=i(t,ee),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=ie.TYPE,this.m_groundAnchorA=r||t.groundAnchorA||s.neo(-1,1),this.m_groundAnchorB=a||t.groundAnchorB||s.neo(1,1),this.m_localAnchorA=h?e.getLocalPoint(h):t.localAnchorA||s.neo(-1,0),this.m_localAnchorB=u?n.getLocalPoint(u):t.localAnchorB||s.neo(1,0),this.m_lengthA=o.isFinite(t.lengthA)?t.lengthA:s.distance(h,r),this.m_lengthB=o.isFinite(t.lengthB)?t.lengthB:s.distance(u,a),this.m_ratio=o.isFinite(c)?c:t.ratio,this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0,this.m_uA,this.m_uB,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}ie.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},ie._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),new ie(t)},ie.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},ie.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},ie.prototype.getLengthA=function(){return this.m_lengthA},ie.prototype.getLengthB=function(){return this.m_lengthB},ie.prototype.getRatio=function(){return this.m_ratio},ie.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return s.distance(t,e)},ie.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return s.distance(t,e)},ie.prototype.shiftOrigin=function(t){this.m_groundAnchorA.sub(t),this.m_groundAnchorB.sub(t)},ie.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},ie.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},ie.prototype.getReactionForce=function(t){return s.mul(this.m_impulse,this.m_uB).mul(t)},ie.prototype.getReactionTorque=function(t){return 0},ie.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.c,h=this.m_bodyB.c_position.a,u=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,m=y.neo(i),l=y.neo(h);this.m_rA=y.mulVec2(m,s.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=y.mulVec2(l,s.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=s.sub(s.add(e,this.m_rA),this.m_groundAnchorA),this.m_uB=s.sub(s.add(o,this.m_rB),this.m_groundAnchorB);var p=this.m_uA.length(),_=this.m_uB.length();p>10*a.linearSlop?this.m_uA.mul(1/p):this.m_uA.setZero(),_>10*a.linearSlop?this.m_uB.mul(1/_):this.m_uB.setZero();var f=s.cross(this.m_rA,this.m_uA),d=s.cross(this.m_rB,this.m_uB),v=this.m_invMassA+this.m_invIA*f*f,g=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=v+this.m_ratio*this.m_ratio*g,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var x=s.mul(-this.m_impulse,this.m_uA),b=s.mul(-this.m_ratio*this.m_impulse,this.m_uB);n.addMul(this.m_invMassA,x),r+=this.m_invIA*s.cross(this.m_rA,x),u.addMul(this.m_invMassB,b),c+=this.m_invIB*s.cross(this.m_rB,b)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v=u,this.m_bodyB.c_velocity.w=c},ie.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,o=s.add(e,s.cross(i,this.m_rA)),a=s.add(n,s.cross(r,this.m_rB)),h=-s.dot(this.m_uA,o)-this.m_ratio*s.dot(this.m_uB,a),u=-this.m_mass*h;this.m_impulse+=u;var c=s.mul(-u,this.m_uA),m=s.mul(-this.m_ratio*u,this.m_uB);e.addMul(this.m_invMassA,c),i+=this.m_invIA*s.cross(this.m_rA,c),n.addMul(this.m_invMassB,m),r+=this.m_invIB*s.cross(this.m_rB,m),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},ie.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=y.neo(i),u=y.neo(r),c=y.mulVec2(h,s.sub(this.m_localAnchorA,this.m_localCenterA)),m=y.mulVec2(u,s.sub(this.m_localAnchorB,this.m_localCenterB)),l=s.sub(s.add(e,this.m_rA),this.m_groundAnchorA),p=s.sub(s.add(n,this.m_rB),this.m_groundAnchorB),_=l.length(),f=p.length();_>10*a.linearSlop?l.mul(1/_):l.setZero(),f>10*a.linearSlop?p.mul(1/f):p.setZero();var d=s.cross(c,l),v=s.cross(m,p),g=this.m_invMassA+this.m_invIA*d*d,x=this.m_invMassB+this.m_invIB*v*v,b=g+this.m_ratio*this.m_ratio*x;b>0&&(b=1/b);var A=this.m_constant-_-this.m_ratio*f,w=o.abs(A),B=-b*A,M=s.mul(-B,l),C=s.mul(-this.m_ratio*B,p);return e.addMul(this.m_invMassA,M),i+=this.m_invIA*s.cross(c,M),n.addMul(this.m_invMassB,C),r+=this.m_invIB*s.cross(m,C),this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=r,w<a.linearSlop};re.TYPE="rope-joint",nt.TYPES[re.TYPE]=re,re._super=nt,re.prototype=Object.create(re._super.prototype);var ne={maxLength:0};function re(t,e,n,r){if(!(this instanceof re))return new re(t,e,n,r);t=i(t,ne),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=re.TYPE,this.m_localAnchorA=r?e.getLocalPoint(r):t.localAnchorA||s.neo(-1,0),this.m_localAnchorB=r?n.getLocalPoint(r):t.localAnchorB||s.neo(1,0),this.m_maxLength=t.maxLength,this.m_mass=0,this.m_impulse=0,this.m_length=0,this.m_state=0,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}re.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},re._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),new re(t)},re.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},re.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},re.prototype.setMaxLength=function(t){this.m_maxLength=t},re.prototype.getMaxLength=function(){return this.m_maxLength},re.prototype.getLimitState=function(){return this.m_state},re.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},re.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},re.prototype.getReactionForce=function(t){return s.mul(this.m_impulse,this.m_u).mul(t)},re.prototype.getReactionTorque=function(t){return 0},re.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.c,h=this.m_bodyB.c_position.a,u=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,m=y.neo(i),l=y.neo(h);this.m_rA=y.mulSub(m,this.m_localAnchorA,this.m_localCenterA),this.m_rB=y.mulSub(l,this.m_localAnchorB,this.m_localCenterB),this.m_u=s.zero(),this.m_u.addCombine(1,o,1,this.m_rB),this.m_u.subCombine(1,e,1,this.m_rA),this.m_length=this.m_u.length();var p=this.m_length-this.m_maxLength;if(this.m_state=p>0?2:0,!(this.m_length>a.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);var _=s.cross(this.m_rA,this.m_u),f=s.cross(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*_*_+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!=d?1/d:0,t.warmStarting){this.m_impulse*=t.dtRatio;var v=s.mul(this.m_impulse,this.m_u);n.subMul(this.m_invMassA,v),r-=this.m_invIA*s.cross(this.m_rA,v),u.addMul(this.m_invMassB,v),c+=this.m_invIB*s.cross(this.m_rB,v)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.set(u),this.m_bodyB.c_velocity.w=c},re.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=s.addCross(e,i,this.m_rA),h=s.addCross(n,r,this.m_rB),u=this.m_length-this.m_maxLength,c=s.dot(this.m_u,s.sub(h,a));u<0&&(c+=t.inv_dt*u);var m=-this.m_mass*c,l=this.m_impulse;this.m_impulse=o.min(0,this.m_impulse+m),m=this.m_impulse-l;var p=s.mul(m,this.m_u);e.subMul(this.m_invMassA,p),i-=this.m_invIA*s.cross(this.m_rA,p),n.addMul(this.m_invMassB,p),r+=this.m_invIB*s.cross(this.m_rB,p),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},re.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=y.neo(i),u=y.neo(r),c=y.mulSub(h,this.m_localAnchorA,this.m_localCenterA),m=y.mulSub(u,this.m_localAnchorB,this.m_localCenterB),l=s.zero();l.addCombine(1,n,1,m),l.subCombine(1,e,1,c);var p=l.normalize(),_=p-this.m_maxLength;_=o.clamp(_,0,a.maxLinearCorrection);var f=-this.m_mass*_,d=s.mul(f,l);return e.subMul(this.m_invMassA,d),i-=this.m_invIA*s.cross(c,d),n.addMul(this.m_invMassB,d),r+=this.m_invIB*s.cross(m,d),this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(n),this.m_bodyB.c_position.a=r,p-this.m_maxLength<a.linearSlop},se.TYPE="weld-joint",nt.TYPES[se.TYPE]=se,se._super=nt,se.prototype=Object.create(se._super.prototype);var oe={frequencyHz:0,dampingRatio:0};function se(t,e,n,r){if(!(this instanceof se))return new se(t,e,n,r);t=i(t,oe),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=se.TYPE,this.m_localAnchorA=s.clone(r?e.getLocalPoint(r):t.localAnchorA||s.zero()),this.m_localAnchorB=s.clone(r?n.getLocalPoint(r):t.localAnchorB||s.zero()),this.m_referenceAngle=o.isFinite(t.referenceAngle)?t.referenceAngle:n.getAngle()-e.getAngle(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=j(),this.m_bias=0,this.m_gamma=0,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new R}se.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},se._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),new se(t)},se.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},se.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},se.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},se.prototype.getReferenceAngle=function(){return this.m_referenceAngle},se.prototype.setFrequency=function(t){this.m_frequencyHz=t},se.prototype.getFrequency=function(){return this.m_frequencyHz},se.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},se.prototype.getDampingRatio=function(){return this.m_dampingRatio},se.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},se.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},se.prototype.getReactionForce=function(t){return s.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},se.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},se.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,u=y.neo(e),c=y.neo(r);this.m_rA=y.mulVec2(u,s.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=y.mulVec2(c,s.sub(this.m_localAnchorB,this.m_localCenterB));var m=this.m_invMassA,l=this.m_invMassB,p=this.m_invIA,_=this.m_invIB,f=new R;if(f.ex.x=m+l+this.m_rA.y*this.m_rA.y*p+this.m_rB.y*this.m_rB.y*_,f.ey.x=-this.m_rA.y*this.m_rA.x*p-this.m_rB.y*this.m_rB.x*_,f.ez.x=-this.m_rA.y*p-this.m_rB.y*_,f.ex.y=f.ey.x,f.ey.y=m+l+this.m_rA.x*this.m_rA.x*p+this.m_rB.x*this.m_rB.x*_,f.ez.y=this.m_rA.x*p+this.m_rB.x*_,f.ex.z=f.ez.x,f.ey.z=f.ez.y,f.ez.z=p+_,this.m_frequencyHz>0){f.getInverse22(this.m_mass);var d=p+_,v=d>0?1/d:0,g=r-e-this.m_referenceAngle,x=2*o.PI*this.m_frequencyHz,b=2*v*this.m_dampingRatio*x,A=v*x*x,w=t.dt;this.m_gamma=w*(b+w*A),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=g*w*A*this.m_gamma,d+=this.m_gamma,this.m_mass.ez.z=0!=d?1/d:0}else 0==f.ez.z?(f.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(f.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var B=s.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(m,B),n-=p*(s.cross(this.m_rA,B)+this.m_impulse.z),a.addMul(l,B),h+=_*(s.cross(this.m_rB,B)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=h},se.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,o=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,u=this.m_invIB;if(this.m_frequencyHz>0){var c=r-i,m=-this.m_mass.ez.z*(c+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=m,i-=h*m,r+=u*m,(_=s.zero()).addCombine(1,n,1,s.cross(r,this.m_rB)),_.subCombine(1,e,1,s.cross(i,this.m_rA));var l=s.neg(R.mulVec2(this.m_mass,_));this.m_impulse.x+=l.x,this.m_impulse.y+=l.y;var p=s.clone(l);e.subMul(o,p),i-=h*s.cross(this.m_rA,p),n.addMul(a,p),r+=u*s.cross(this.m_rB,p)}else{var _;(_=s.zero()).addCombine(1,n,1,s.cross(r,this.m_rB)),_.subCombine(1,e,1,s.cross(i,this.m_rA)),c=r-i;var f=j(_.x,_.y,c),d=j.neg(R.mulVec3(this.m_mass,f));this.m_impulse.add(d),p=s.neo(d.x,d.y),e.subMul(o,p),i-=h*(s.cross(this.m_rA,p)+d.z),n.addMul(a,p),r+=u*(s.cross(this.m_rB,p)+d.z)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},se.prototype.solvePositionConstraints=function(t){var e,i,n=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,h=this.m_bodyB.c_position.c,u=this.m_bodyB.c_position.a,c=y.neo(r),m=y.neo(u),l=this.m_invMassA,p=this.m_invMassB,_=this.m_invIA,f=this.m_invIB,d=y.mulVec2(c,s.sub(this.m_localAnchorA,this.m_localCenterA)),v=y.mulVec2(m,s.sub(this.m_localAnchorB,this.m_localCenterB)),g=new R;if(g.ex.x=l+p+d.y*d.y*_+v.y*v.y*f,g.ey.x=-d.y*d.x*_-v.y*v.x*f,g.ez.x=-d.y*_-v.y*f,g.ex.y=g.ey.x,g.ey.y=l+p+d.x*d.x*_+v.x*v.x*f,g.ez.y=d.x*_+v.x*f,g.ex.z=g.ez.x,g.ey.z=g.ez.y,g.ez.z=_+f,this.m_frequencyHz>0){(b=s.zero()).addCombine(1,h,1,v),b.subCombine(1,n,1,d),e=b.length(),i=0;var x=s.neg(g.solve22(b));n.subMul(l,x),r-=_*s.cross(d,x),h.addMul(p,x),u+=f*s.cross(v,x)}else{var b;(b=s.zero()).addCombine(1,h,1,v),b.subCombine(1,n,1,d);var A=u-r-this.m_referenceAngle;e=b.length(),i=o.abs(A);var w=j(b.x,b.y,A),B=j();if(g.ez.z>0)B=j.neg(g.solve33(w));else{var M=s.neg(g.solve22(b));B.set(M.x,M.y,0)}x=s.neo(B.x,B.y),n.subMul(l,x),r-=_*(s.cross(d,x)+B.z),h.addMul(p,x),u+=f*(s.cross(v,x)+B.z)}return this.m_bodyA.c_position.c=n,this.m_bodyA.c_position.a=r,this.m_bodyB.c_position.c=h,this.m_bodyB.c_position.a=u,e<=a.linearSlop&&i<=a.angularSlop},he.TYPE="wheel-joint",nt.TYPES[he.TYPE]=he,he._super=nt,he.prototype=Object.create(he._super.prototype);var ae={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7};function he(t,e,n,r,o){if(!(this instanceof he))return new he(t,e,n,r,o);t=i(t,ae),nt.call(this,t,e,n),e=this.m_bodyA,n=this.m_bodyB,this.m_type=he.TYPE,this.m_localAnchorA=s.clone(r?e.getLocalPoint(r):t.localAnchorA||s.zero()),this.m_localAnchorB=s.clone(r?n.getLocalPoint(r):t.localAnchorB||s.zero()),this.m_localXAxisA=s.clone(o?e.getLocalVector(o):t.localAxisA||t.localAxis||s.neo(1,0)),this.m_localYAxisA=s.cross(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_ax=s.zero(),this.m_ay=s.zero(),this.m_sAx,this.m_sBx,this.m_sAy,this.m_sBy}he.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},he._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(P,t.bodyA,e),t.bodyB=i(P,t.bodyB,e),new he(t)},he.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.set(t.localAxisA),this.m_localYAxisA.set(s.cross(1,t.localAxisA)))},he.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},he.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},he.prototype.getLocalAxisA=function(){return this.m_localXAxisA},he.prototype.getJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchorA),n=e.getWorldPoint(this.m_localAnchorB),r=s.sub(n,i),o=t.getWorldVector(this.m_localXAxisA);return s.dot(r,o)},he.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},he.prototype.isMotorEnabled=function(){return this.m_enableMotor},he.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},he.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},he.prototype.getMotorSpeed=function(){return this.m_motorSpeed},he.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},he.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},he.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},he.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},he.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},he.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},he.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},he.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},he.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},he.prototype.getReactionForce=function(t){return s.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)},he.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},he.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,a=this.m_bodyA.c_position.c,h=this.m_bodyA.c_position.a,u=this.m_bodyA.c_velocity.v,c=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,p=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,f=y.neo(h),d=y.neo(l),v=y.mulVec2(f,s.sub(this.m_localAnchorA,this.m_localCenterA)),g=y.mulVec2(d,s.sub(this.m_localAnchorB,this.m_localCenterB));if((w=s.zero()).addCombine(1,m,1,g),w.subCombine(1,a,1,v),this.m_ay=y.mulVec2(f,this.m_localYAxisA),this.m_sAy=s.cross(s.add(w,v),this.m_ay),this.m_sBy=s.cross(g,this.m_ay),this.m_mass=e+i+n*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=y.mulVec2(f,this.m_localXAxisA),this.m_sAx=s.cross(s.add(w,v),this.m_ax),this.m_sBx=s.cross(g,this.m_ax);var x=e+i+n*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx;if(x>0){this.m_springMass=1/x;var b=s.dot(w,this.m_ax),A=2*o.PI*this.m_frequencyHz,w=2*this.m_springMass*this.m_dampingRatio*A,B=this.m_springMass*A*A,M=t.dt;this.m_gamma=M*(w+M*B),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=b*M*B*this.m_gamma,this.m_springMass=x+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+r,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var C=s.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),S=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,z=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;u.subMul(this.m_invMassA,C),c-=this.m_invIA*S,p.addMul(this.m_invMassB,C),_+=this.m_invIB*z}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(u),this.m_bodyA.c_velocity.w=c,this.m_bodyB.c_velocity.v.set(p),this.m_bodyB.c_velocity.w=_},he.prototype.solveVelocityConstraints=function(t){var e=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,a=this.m_bodyA.c_velocity.v,h=this.m_bodyA.c_velocity.w,u=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,m=s.dot(this.m_ax,u)-s.dot(this.m_ax,a)+this.m_sBx*c-this.m_sAx*h,l=-this.m_springMass*(m+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=l;var p=s.mul(l,this.m_ax),_=l*this.m_sAx,f=l*this.m_sBx;a.subMul(e,p),h-=n*_,u.addMul(i,p),m=(c+=r*f)-h-this.m_motorSpeed,l=-this.m_motorMass*m;var d=this.m_motorImpulse,y=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=o.clamp(this.m_motorImpulse+l,-y,y),h-=n*(l=this.m_motorImpulse-d),c+=r*l,m=s.dot(this.m_ay,u)-s.dot(this.m_ay,a)+this.m_sBy*c-this.m_sAy*h,l=-this.m_mass*m,this.m_impulse+=l,p=s.mul(l,this.m_ay),_=l*this.m_sAy,f=l*this.m_sBy,a.subMul(e,p),h-=n*_,u.addMul(i,p),c+=r*f,this.m_bodyA.c_velocity.v.set(a),this.m_bodyA.c_velocity.w=h,this.m_bodyB.c_velocity.v.set(u),this.m_bodyB.c_velocity.w=c},he.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=y.neo(i),u=y.neo(r),c=y.mulVec2(h,s.sub(this.m_localAnchorA,this.m_localCenterA)),m=y.mulVec2(u,s.sub(this.m_localAnchorB,this.m_localCenterB)),l=s.zero();l.addCombine(1,n,1,m),l.subCombine(1,e,1,c);var p,_=y.mulVec2(h,this.m_localYAxisA),f=s.cross(s.add(l,c),_),d=s.cross(m,_),v=s.dot(l,_),g=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;p=0!=g?-v/g:0;var x=s.mul(p,_),b=p*f,A=p*d;return e.subMul(this.m_invMassA,x),i-=this.m_invIA*b,n.addMul(this.m_invMassB,x),r+=this.m_invIB*A,this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(n),this.m_bodyB.c_position.a=r,o.abs(v)<=a.linearSlop};var ue={CollidePolygons:Vt,Settings:a,Sweep:g,Manifold:V,Distance:W,TimeOfImpact:mt,DynamicTree:m,stats:k};t.AABB=h,t.Body=P,t.Box=It,t.Chain=zt,t.Circle=Mt,t.CollideCircles=Pt,t.CollideEdgeCircle=Et,t.CollideEdgePolygon=kt,t.CollidePolygonCircle=Tt,t.CollidePolygons=Vt,t.Contact=K,t.Distance=W,t.DistanceJoint=Rt,t.DynamicTree=m,t.Edge=Ct,t.Fixture=M,t.FrictionJoint=Yt,t.GearJoint=Xt,t.Joint=nt,t.Manifold=V,t.Mat22=N,t.Mat33=R,t.Math=o,t.MotorJoint=$t,t.MouseJoint=te,t.Polygon=St,t.PrismaticJoint=Ht,t.PulleyJoint=ie,t.RevoluteJoint=Wt,t.RopeJoint=re,t.Rot=y,t.Serializer=wt,t.Settings=a,t.Shape=A,t.Sweep=g,t.TimeOfImpact=mt,t.Transform=v,t.Vec2=s,t.Vec3=j,t.WeldJoint=se,t.WheelJoint=he,t.World=xt,t.internal=ue,Object.defineProperty(t,"__esModule",{value:!0})}(e)},377:(t,e,i)=>{var n=i(832),r=i(652),o=i(801),s=i(30),a=i(618),h=i(49),u=i(971);u.alea=n,u.xor128=r,u.xorwow=o,u.xorshift7=s,u.xor4096=a,u.tychei=h,t.exports=u},832:function(t,e,i){var n;!function(t,r,o){function s(t){var e,i=this,n=(e=4022871197,function(t){t=String(t);for(var i=0;i<t.length;i++){var n=.02519603282416938*(e+=t.charCodeAt(i));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)});i.next=function(){var t=2091639*i.s0+2.3283064365386963e-10*i.c;return i.s0=i.s1,i.s1=i.s2,i.s2=t-(i.c=0|t)},i.c=1,i.s0=n(" "),i.s1=n(" "),i.s2=n(" "),i.s0-=n(t),i.s0<0&&(i.s0+=1),i.s1-=n(t),i.s1<0&&(i.s1+=1),i.s2-=n(t),i.s2<0&&(i.s2+=1),n=null}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function h(t,e){var i=new s(t),n=e&&e.state,r=i.next;return r.int32=function(){return 4294967296*i.next()|0},r.double=function(){return r()+11102230246251565e-32*(2097152*r()|0)},r.quick=r,n&&("object"==typeof n&&a(n,i),r.state=function(){return a(i,{})}),r}r&&r.exports?r.exports=h:i.amdD&&i.amdO?void 0===(n=function(){return h}.call(e,i,e,r))||(r.exports=n):this.alea=h}(0,t=i.nmd(t),i.amdD)},49:function(t,e,i){var n;!function(t,r,o){function s(t){var e=this,i="";e.next=function(){var t=e.b,i=e.c,n=e.d,r=e.a;return t=t<<25^t>>>7^i,i=i-n|0,n=n<<24^n>>>8^r,r=r-t|0,e.b=t=t<<20^t>>>12^i,e.c=i=i-n|0,e.d=n<<16^i>>>16^r,e.a=r-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):i+=t;for(var n=0;n<i.length+20;n++)e.b^=0|i.charCodeAt(n),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function h(t,e){var i=new s(t),n=e&&e.state,r=function(){return(i.next()>>>0)/4294967296};return r.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=i.next,r.quick=r,n&&("object"==typeof n&&a(n,i),r.state=function(){return a(i,{})}),r}r&&r.exports?r.exports=h:i.amdD&&i.amdO?void 0===(n=function(){return h}.call(e,i,e,r))||(r.exports=n):this.tychei=h}(0,t=i.nmd(t),i.amdD)},652:function(t,e,i){var n;!function(t,r,o){function s(t){var e=this,i="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:i+=t;for(var n=0;n<i.length+64;n++)e.x^=0|i.charCodeAt(n),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function h(t,e){var i=new s(t),n=e&&e.state,r=function(){return(i.next()>>>0)/4294967296};return r.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=i.next,r.quick=r,n&&("object"==typeof n&&a(n,i),r.state=function(){return a(i,{})}),r}r&&r.exports?r.exports=h:i.amdD&&i.amdO?void 0===(n=function(){return h}.call(e,i,e,r))||(r.exports=n):this.xor128=h}(0,t=i.nmd(t),i.amdD)},618:function(t,e,i){var n;!function(t,r,o){function s(t){var e=this;e.next=function(){var t,i,n=e.w,r=e.X,o=e.i;return e.w=n=n+1640531527|0,i=r[o+34&127],t=r[o=o+1&127],i^=i<<13,t^=t<<17,i^=i>>>15,t^=t>>>12,i=r[o]=i^t,e.i=o,i+(n^n>>>16)|0},function(t,e){var i,n,r,o,s,a=[],h=128;for(e===(0|e)?(n=e,e=null):(e+="\0",n=0,h=Math.max(h,e.length)),r=0,o=-32;o<h;++o)e&&(n^=e.charCodeAt((o+32)%e.length)),0===o&&(s=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,o>=0&&(s=s+1640531527|0,r=0==(i=a[127&o]^=n+s)?r+1:0);for(r>=128&&(a[127&(e&&e.length||0)]=-1),r=127,o=512;o>0;--o)n=a[r+34&127],i=a[r=r+1&127],n^=n<<13,i^=i<<17,n^=n>>>15,i^=i>>>12,a[r]=n^i;t.w=s,t.X=a,t.i=r}(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function h(t,e){null==t&&(t=+new Date);var i=new s(t),n=e&&e.state,r=function(){return(i.next()>>>0)/4294967296};return r.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=i.next,r.quick=r,n&&(n.X&&a(n,i),r.state=function(){return a(i,{})}),r}r&&r.exports?r.exports=h:i.amdD&&i.amdO?void 0===(n=function(){return h}.call(e,i,e,r))||(r.exports=n):this.xor4096=h}(0,t=i.nmd(t),i.amdD)},30:function(t,e,i){var n;!function(t,r,o){function s(t){var e=this;e.next=function(){var t,i,n=e.x,r=e.i;return t=n[r],i=(t^=t>>>7)^t<<24,i^=(t=n[r+1&7])^t>>>10,i^=(t=n[r+3&7])^t>>>3,i^=(t=n[r+4&7])^t<<7,t=n[r+7&7],i^=(t^=t<<13)^t<<9,n[r]=i,e.i=r+1&7,i},function(t,e){var i,n=[];if(e===(0|e))n[0]=e;else for(e=""+e,i=0;i<e.length;++i)n[7&i]=n[7&i]<<15^e.charCodeAt(i)+n[i+1&7]<<13;for(;n.length<8;)n.push(0);for(i=0;i<8&&0===n[i];++i);for(8==i?n[7]=-1:n[i],t.x=n,t.i=0,i=256;i>0;--i)t.next()}(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function h(t,e){null==t&&(t=+new Date);var i=new s(t),n=e&&e.state,r=function(){return(i.next()>>>0)/4294967296};return r.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=i.next,r.quick=r,n&&(n.x&&a(n,i),r.state=function(){return a(i,{})}),r}r&&r.exports?r.exports=h:i.amdD&&i.amdO?void 0===(n=function(){return h}.call(e,i,e,r))||(r.exports=n):this.xorshift7=h}(0,t=i.nmd(t),i.amdD)},801:function(t,e,i){var n;!function(t,r,o){function s(t){var e=this,i="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:i+=t;for(var n=0;n<i.length+64;n++)e.x^=0|i.charCodeAt(n),n==i.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function h(t,e){var i=new s(t),n=e&&e.state,r=function(){return(i.next()>>>0)/4294967296};return r.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=i.next,r.quick=r,n&&("object"==typeof n&&a(n,i),r.state=function(){return a(i,{})}),r}r&&r.exports?r.exports=h:i.amdD&&i.amdO?void 0===(n=function(){return h}.call(e,i,e,r))||(r.exports=n):this.xorwow=h}(0,t=i.nmd(t),i.amdD)},971:function(t,e,i){var n;!function(r,o,s){var a,h=256,u=s.pow(h,6),c=s.pow(2,52),m=2*c,l=255;function p(t,e,i){var n=[],l=y(d((e=1==e?{entropy:!0}:e||{}).entropy?[t,v(o)]:null==t?function(){try{var t;return a&&(t=a.randomBytes)?t=t(h):(t=new Uint8Array(h),(r.crypto||r.msCrypto).getRandomValues(t)),v(t)}catch(t){var e=r.navigator,i=e&&e.plugins;return[+new Date,r,i,r.screen,v(o)]}}():t,3),n),p=new _(n),g=function(){for(var t=p.g(6),e=u,i=0;t<c;)t=(t+i)*h,e*=h,i=p.g(1);for(;t>=m;)t/=2,e/=2,i>>>=1;return(t+i)/e};return g.int32=function(){return 0|p.g(4)},g.quick=function(){return p.g(4)/4294967296},g.double=g,y(v(p.S),o),(e.pass||i||function(t,e,i,n){return n&&(n.S&&f(n,p),t.state=function(){return f(p,{})}),i?(s.random=t,e):t})(g,l,"global"in e?e.global:this==s,e.state)}function _(t){var e,i=t.length,n=this,r=0,o=n.i=n.j=0,s=n.S=[];for(i||(t=[i++]);r<h;)s[r]=r++;for(r=0;r<h;r++)s[r]=s[o=l&o+t[r%i]+(e=s[r])],s[o]=e;(n.g=function(t){for(var e,i=0,r=n.i,o=n.j,s=n.S;t--;)e=s[r=l&r+1],i=i*h+s[l&(s[r]=s[o=l&o+e])+(s[o]=e)];return n.i=r,n.j=o,i})(h)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function d(t,e){var i,n=[],r=typeof t;if(e&&"object"==r)for(i in t)try{n.push(d(t[i],e-1))}catch(t){}return n.length?n:"string"==r?t:t+"\0"}function y(t,e){for(var i,n=t+"",r=0;r<n.length;)e[l&r]=l&(i^=19*e[l&r])+n.charCodeAt(r++);return v(e)}function v(t){return String.fromCharCode.apply(0,t)}if(y(s.random(),o),t.exports){t.exports=p;try{a=i(42)}catch(t){}}else void 0===(n=function(){return p}.call(e,i,e,t))||(t.exports=n)}("undefined"!=typeof self?self:this,[],Math)},287:function(t,e){"use strict";var i,n;void 0===(n="function"==typeof(i=function(){function t(){return!0}function e(){return!1}function i(){}return function n(){var r=[{name:"number",test:function(t){return"number"==typeof t}},{name:"string",test:function(t){return"string"==typeof t}},{name:"boolean",test:function(t){return"boolean"==typeof t}},{name:"Function",test:function(t){return"function"==typeof t}},{name:"Array",test:Array.isArray},{name:"Date",test:function(t){return t instanceof Date}},{name:"RegExp",test:function(t){return t instanceof RegExp}},{name:"Object",test:function(t){return"object"==typeof t&&null!==t&&t.constructor===Object}},{name:"null",test:function(t){return null===t}},{name:"undefined",test:function(t){return void 0===t}}],o={name:"any",test:t},s=[],a=[],h={types:r,conversions:a,ignore:s};function u(t){var e=O(h.types,(function(e){return e.name===t}));if(e)return e;if("any"===t)return o;var i=O(h.types,(function(e){return e.name.toLowerCase()===t.toLowerCase()}));throw new TypeError('Unknown type "'+t+'"'+(i?'. Did you mean "'+i.name+'"?':""))}function c(t){return t===o?999:h.types.indexOf(t)}function m(t){var e=O(h.types,(function(e){return e.test(t)}));if(e)return e.name;throw new TypeError("Value has unknown type. Value: "+t)}function l(t){return t.map((function(t){var e=t.types.map(x);return(t.restParam?"...":"")+e.join("|")})).join(",")}function p(t,e){var i=0===t.indexOf("..."),n=(i?t.length>3?t.slice(3):"any":t).split("|").map(N).filter(V).filter(E),r=function(t,e){var i={};return t.forEach((function(t){-1!==e.indexOf(t.from)||-1===e.indexOf(t.to)||i[t.from]||(i[t.from]=t)})),Object.keys(i).map((function(t){return i[t]}))}(e,n),o=n.map((function(t){var e=u(t);return{name:t,typeIndex:c(e),test:e.test,conversion:null,conversionIndex:-1}})),s=r.map((function(t){var i=u(t.from);return{name:t.from,typeIndex:c(i),test:i.test,conversion:t,conversionIndex:e.indexOf(t)}}));return{types:o.concat(s),restParam:i}}function _(t){var e=D(t);return!!e&&e.restParam}function f(t){return t.types.some((function(t){return null!=t.conversion}))}function d(e){if(e&&0!==e.types.length){if(1===e.types.length)return u(e.types[0].name).test;if(2===e.types.length){var i=u(e.types[0].name).test,n=u(e.types[1].name).test;return function(t){return i(t)||n(t)}}var r=e.types.map((function(t){return u(t.name).test}));return function(t){for(var e=0;e<r.length;e++)if(r[e](t))return!0;return!1}}return t}function y(t){var e,i,n,r;if(_(t)){var o=(e=(r=t,r.slice(0,r.length-1)).map(d)).length,s=d(D(t));return function(t){for(var i=0;i<e.length;i++)if(!e[i](t[i]))return!1;return function(t){for(var e=o;e<t.length;e++)if(!s(t[e]))return!1;return!0}(t)&&t.length>=o+1}}return 0===t.length?function(t){return 0===t.length}:1===t.length?(i=d(t[0]),function(t){return i(t[0])&&1===t.length}):2===t.length?(i=d(t[0]),n=d(t[1]),function(t){return i(t[0])&&n(t[1])&&2===t.length}):(e=t.map(d),function(t){for(var i=0;i<e.length;i++)if(!e[i](t[i]))return!1;return t.length===e.length})}function v(t,e){return e<t.params.length?t.params[e]:_(t.params)?D(t.params):null}function g(t,e,i){var n=v(t,e);return(n?i?n.types.filter(b):n.types:[]).map(x)}function x(t){return t.name}function b(t){return null===t.conversion||void 0===t.conversion}function A(t,e){var i=function(t){for(var e={},i=0;i<t.length;i++)e[t[i]]=!0;return Object.keys(e)}(k(t,(function(t){return g(t,e,!1)})));return-1!==i.indexOf("any")?["any"]:i}function w(t,e,i){var n,r,o,s=t||"unnamed",a=i;for(o=0;o<e.length;o++){var h=a.filter((function(t){var i=d(v(t,o));return(o<t.params.length||_(t.params))&&i(e[o])}));if(0===h.length){if((r=A(a,o)).length>0){var u=m(e[o]);return(n=new TypeError("Unexpected type of argument in function "+s+" (expected: "+r.join(" or ")+", actual: "+u+", index: "+o+")")).data={category:"wrongType",fn:s,index:o,actual:u,expected:r},n}}else a=h}var c=a.map((function(t){return _(t.params)?1/0:t.params.length}));if(e.length<Math.min.apply(null,c))return r=A(a,o),(n=new TypeError("Too few arguments in function "+s+" (expected: "+r.join(" or ")+", index: "+e.length+")")).data={category:"tooFewArgs",fn:s,index:e.length,expected:r},n;var l=Math.max.apply(null,c);return e.length>l?((n=new TypeError("Too many arguments in function "+s+" (expected: "+l+", actual: "+e.length+")")).data={category:"tooManyArgs",fn:s,index:e.length,expectedLength:l},n):((n=new TypeError('Arguments of type "'+e.join(", ")+'" do not match any of the defined signatures of function '+s+".")).data={category:"mismatch",actual:e.map(m)},n)}function B(t){for(var e=999,i=0;i<t.types.length;i++)b(t.types[i])&&(e=Math.min(e,t.types[i].typeIndex));return e}function M(t){for(var e=999,i=0;i<t.types.length;i++)b(t.types[i])||(e=Math.min(e,t.types[i].conversionIndex));return e}function C(t,e){var i;return 0!=(i=t.restParam-e.restParam)||0!=(i=f(t)-f(e))||0!=(i=B(t)-B(e))?i:M(t)-M(e)}function S(t,e){var i,n,r=Math.min(t.params.length,e.params.length);if(0!=(n=t.params.some(f)-e.params.some(f)))return n;for(i=0;i<r;i++)if(0!=(n=f(t.params[i])-f(e.params[i])))return n;for(i=0;i<r;i++)if(0!==(n=C(t.params[i],e.params[i])))return n;return t.params.length-e.params.length}function z(t){var e,i,n,r,o=[],s=[];switch(t.types.forEach((function(t){t.conversion&&(o.push(u(t.conversion.from).test),s.push(t.conversion.convert))})),s.length){case 0:return function(t){return t};case 1:return e=o[0],n=s[0],function(t){return e(t)?n(t):t};case 2:return e=o[0],i=o[1],n=s[0],r=s[1],function(t){return e(t)?n(t):i(t)?r(t):t};default:return function(t){for(var e=0;e<s.length;e++)if(o[e](t))return s[e](t);return t}}}function I(t,e){return function t(i,n,r){if(n<i.length){var o,s=i[n],a=e?s.types.filter(b):s.types;if(s.restParam){var h=a.filter(b);o=h.length<a.length?[h,a]:[a]}else o=a.map((function(t){return[t]}));return k(o,(function(e){return t(i,n+1,r.concat([e]))}))}return[r.map((function(t,e){return{types:t,restParam:e===i.length-1&&_(i)}}))]}(t,0,[])}function P(t,n){if(0===Object.keys(n).length)throw new SyntaxError("No signatures provided");var r=[];Object.keys(n).map((function(t){return function(t,e,i){var n=[];return""!==t.trim()&&(n=t.split(",").map(N).map((function(t,e,n){var r=p(t,i);if(r.restParam&&e!==n.length-1)throw new SyntaxError('Unexpected rest parameter "'+t+'": only allowed for the last parameter');return r}))),n.some(F)?null:{params:n,fn:e}}(t,n[t],h.conversions)})).filter(T).forEach((function(t){var e=O(r,(function(e){return function(t,e){for(var i=Math.max(t.params.length,e.params.length),n=0;n<i;n++)if(!L(g(t,n,!0),g(e,n,!0)))return!1;var r=t.params.length,o=e.params.length,s=_(t.params),a=_(e.params);return s?a?r===o:o>=r:a?r>=o:r===o}(e,t)}));if(e)throw new TypeError('Conflicting signatures "'+l(e.params)+'" and "'+l(t.params)+'".');r.push(t)}));var o=k(r,(function(t){return(t?I(t.params,!1):[]).map((function(e){return{params:e,fn:t.fn}}))})).filter(T);o.sort(S);var s=o[0]&&o[0].params.length<=2&&!_(o[0].params),a=o[1]&&o[1].params.length<=2&&!_(o[1].params),u=o[2]&&o[2].params.length<=2&&!_(o[2].params),c=o[3]&&o[3].params.length<=2&&!_(o[3].params),m=o[4]&&o[4].params.length<=2&&!_(o[4].params),v=o[5]&&o[5].params.length<=2&&!_(o[5].params),x=s&&a&&u&&c&&m&&v,b=o.map((function(t){return y(t.params)})),A=s?d(o[0].params[0]):e,B=a?d(o[1].params[0]):e,M=u?d(o[2].params[0]):e,C=c?d(o[3].params[0]):e,P=m?d(o[4].params[0]):e,E=v?d(o[5].params[0]):e,V=s?d(o[0].params[1]):e,D=a?d(o[1].params[1]):e,j=u?d(o[2].params[1]):e,R=c?d(o[3].params[1]):e,J=m?d(o[4].params[1]):e,Y=v?d(o[5].params[1]):e,U=o.map((function(t){return function(t,e){var i=e;if(t.some(f)){var n=_(t),r=t.map(z);i=function(){for(var t=[],i=n?arguments.length-1:arguments.length,o=0;o<i;o++)t[o]=r[o](arguments[o]);return n&&(t[i]=arguments[i].map(r[i])),e.apply(this,t)}}var o=i;if(_(t)){var s=t.length-1;o=function(){return i.apply(this,q(arguments,0,s).concat([q(arguments,s)]))}}return o}(t.params,t.fn)})),W=s?U[0]:i,Z=a?U[1]:i,H=u?U[2]:i,G=c?U[3]:i,X=m?U[4]:i,K=v?U[5]:i,$=s?o[0].params.length:-1,Q=a?o[1].params.length:-1,tt=u?o[2].params.length:-1,et=c?o[3].params.length:-1,it=m?o[4].params.length:-1,nt=v?o[5].params.length:-1,rt=x?6:0,ot=o.length,st=function(){for(var e=rt;e<ot;e++)if(b[e](arguments))return U[e].apply(this,arguments);throw w(t,arguments,o)},at=function t(e,i){return arguments.length===$&&A(e)&&V(i)?W.apply(t,arguments):arguments.length===Q&&B(e)&&D(i)?Z.apply(t,arguments):arguments.length===tt&&M(e)&&j(i)?H.apply(t,arguments):arguments.length===et&&C(e)&&R(i)?G.apply(t,arguments):arguments.length===it&&P(e)&&J(i)?X.apply(t,arguments):arguments.length===nt&&E(e)&&Y(i)?K.apply(t,arguments):st.apply(t,arguments)};try{Object.defineProperty(at,"name",{value:t})}catch(t){}return at.signatures=function(t){var e={};return t.forEach((function(t){t.params.some(f)||I(t.params,!0).forEach((function(i){e[l(i)]=t.fn}))})),e}(o),at}function E(t){return-1===h.ignore.indexOf(t)}function N(t){return t.trim()}function V(t){return!!t}function T(t){return null!==t}function F(t){return 0===t.types.length}function D(t){return t[t.length-1]}function q(t,e,i){return Array.prototype.slice.call(t,e,i)}function L(t,e){for(var i=0;i<t.length;i++)if(n=e,r=t[i],-1!==n.indexOf(r))return!0;var n,r;return!1}function O(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return t[i]}function k(t,e){return Array.prototype.concat.apply([],t.map(e))}function j(t){for(var e="",i=0;i<t.length;i++){var n=t[i];if(("object"==typeof n.signatures||"string"==typeof n.signature)&&""!==n.name)if(""===e)e=n.name;else if(e!==n.name){var r=new Error("Function names do not match (expected: "+e+", actual: "+n.name+")");throw r.data={actual:n.name,expected:e},r}}return e}function R(t){var e,i={};function n(t,n){if(i.hasOwnProperty(t)&&n!==i[t])throw(e=new Error('Signature "'+t+'" is defined twice')).data={signature:t},e}for(var r=0;r<t.length;r++){var o=t[r];if("object"==typeof o.signatures)for(var s in o.signatures)o.signatures.hasOwnProperty(s)&&(n(s,o.signatures[s]),i[s]=o.signatures[s]);else{if("string"!=typeof o.signature)throw(e=new TypeError("Function is no typed-function (index: "+r+")")).data={index:r},e;n(o.signature,o),i[o.signature]=o}}return i}return(h=P("typed",{"string, Object":P,Object:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return P(j(e),t)},"...Function":function(t){return P(j(t),R(t))},"string, ...Function":function(t,e){return P(t,R(e))}})).create=n,h.types=r,h.conversions=a,h.ignore=s,h.convert=function(t,e){var i=m(t);if(e===i)return t;for(var n=0;n<h.conversions.length;n++){var r=h.conversions[n];if(r.from===i&&r.to===e)return r.convert(t)}throw new Error("Cannot convert from "+i+" to "+e)},h.find=function(t,e){if(!t.signatures)throw new TypeError("Function is no typed-function");var i;if("string"==typeof e){i=e.split(",");for(var n=0;n<i.length;n++)i[n]=i[n].trim()}else{if(!Array.isArray(e))throw new TypeError("String array or a comma separated string expected");i=e}var r=i.join(","),o=t.signatures[r];if(o)return o;throw new TypeError("Signature not found (signature: "+(t.name||"unnamed")+"("+i.join(", ")+"))")},h.addType=function(t,e){if(!t||"string"!=typeof t.name||"function"!=typeof t.test)throw new TypeError("Object with properties {name: string, test: function} expected");if(!1!==e)for(var i=0;i<h.types.length;i++)if("Object"===h.types[i].name)return void h.types.splice(i,0,t);h.types.push(t)},h.addConversion=function(t){if(!t||"string"!=typeof t.from||"string"!=typeof t.to||"function"!=typeof t.convert)throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");h.conversions.push(t)},h}()})?i.apply(e,[]):i)||(t.exports=n)},42:()=>{}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.amdD=function(){throw new Error("define cannot be used indirect")},i.amdO={},i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";var t={epsilon:1e-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null};function e(){return(e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}var n=function(e){if(e)throw new Error("The global config is readonly. \nPlease create a mathjs instance if you want to change the default configuration. \nExample:\n\n  import { create, all } from 'mathjs';\n  const mathjs = create(all);\n  mathjs.config({ number: 'BigNumber' });\n");return Object.freeze(t)};function r(t){return"number"==typeof t}function o(t){return t&&!0===t.constructor.prototype.isBigNumber||!1}function s(t){return t&&"object"==typeof t&&!0===Object.getPrototypeOf(t).isComplex||!1}function a(t){return t&&"object"==typeof t&&!0===Object.getPrototypeOf(t).isFraction||!1}function h(t){return t&&!0===t.constructor.prototype.isUnit||!1}function u(t){return"string"==typeof t}e(n,t,{MATRIX_OPTIONS:["Matrix","Array"],NUMBER_OPTIONS:["number","BigNumber","Fraction"]});var c=Array.isArray;function m(t){return t&&!0===t.constructor.prototype.isMatrix||!1}function l(t){return Array.isArray(t)||m(t)}function p(t){return t&&t.isDenseMatrix&&!0===t.constructor.prototype.isMatrix||!1}function _(t){return t&&t.isSparseMatrix&&!0===t.constructor.prototype.isMatrix||!1}function f(t){return t&&!0===t.constructor.prototype.isRange||!1}function d(t){return t&&!0===t.constructor.prototype.isIndex||!1}function y(t){return"boolean"==typeof t}function v(t){return t&&!0===t.constructor.prototype.isResultSet||!1}function g(t){return t&&!0===t.constructor.prototype.isHelp||!1}function x(t){return"function"==typeof t}function b(t){return t instanceof Date}function A(t){return t instanceof RegExp}function w(t){return!(!t||"object"!=typeof t||t.constructor!==Object||s(t)||a(t))}function B(t){return null===t}function M(t){return void 0===t}function C(t){return t&&!0===t.isAccessorNode&&!0===t.constructor.prototype.isNode||!1}function S(t){return t&&!0===t.isArrayNode&&!0===t.constructor.prototype.isNode||!1}function z(t){return t&&!0===t.isAssignmentNode&&!0===t.constructor.prototype.isNode||!1}function I(t){return t&&!0===t.isBlockNode&&!0===t.constructor.prototype.isNode||!1}function P(t){return t&&!0===t.isConditionalNode&&!0===t.constructor.prototype.isNode||!1}function E(t){return t&&!0===t.isConstantNode&&!0===t.constructor.prototype.isNode||!1}function N(t){return t&&!0===t.isFunctionAssignmentNode&&!0===t.constructor.prototype.isNode||!1}function V(t){return t&&!0===t.isFunctionNode&&!0===t.constructor.prototype.isNode||!1}function T(t){return t&&!0===t.isIndexNode&&!0===t.constructor.prototype.isNode||!1}function F(t){return t&&!0===t.isNode&&!0===t.constructor.prototype.isNode||!1}function D(t){return t&&!0===t.isObjectNode&&!0===t.constructor.prototype.isNode||!1}function q(t){return t&&!0===t.isOperatorNode&&!0===t.constructor.prototype.isNode||!1}function L(t){return t&&!0===t.isParenthesisNode&&!0===t.constructor.prototype.isNode||!1}function O(t){return t&&!0===t.isRangeNode&&!0===t.constructor.prototype.isNode||!1}function k(t){return t&&!0===t.isSymbolNode&&!0===t.constructor.prototype.isNode||!1}function j(t){return t&&!0===t.constructor.prototype.isChain||!1}function R(t){var e=typeof t;return"object"===e?null===t?"null":Array.isArray(t)?"Array":t instanceof Date?"Date":t instanceof RegExp?"RegExp":o(t)?"BigNumber":s(t)?"Complex":a(t)?"Fraction":m(t)?"Matrix":h(t)?"Unit":d(t)?"Index":f(t)?"Range":v(t)?"ResultSet":F(t)?t.type:j(t)?"Chain":g(t)?"Help":"Object":"function"===e?"Function":e}function J(t){var e=typeof t;if("number"===e||"string"===e||"boolean"===e||null==t)return t;if("function"==typeof t.clone)return t.clone();if(Array.isArray(t))return t.map((function(t){return J(t)}));if(t instanceof Date)return new Date(t.valueOf());if(o(t))return t;if(t instanceof RegExp)throw new TypeError("Cannot clone "+t);return function(t,e){var i={};for(var n in t)W(t,n)&&(i[n]=e(t[n]));return i}(t,J)}function Y(t,e){for(var i in e)W(e,i)&&(t[i]=e[i]);return t}function U(t,e){var i,n,r;if(Array.isArray(t)){if(!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(n=0,r=t.length;n<r;n++)if(!U(t[n],e[n]))return!1;return!0}if("function"==typeof t)return t===e;if(t instanceof Object){if(Array.isArray(e)||!(e instanceof Object))return!1;for(i in t)if(!(i in e)||!U(t[i],e[i]))return!1;for(i in e)if(!(i in t)||!U(t[i],e[i]))return!1;return!0}return t===e}function W(t,e){return t&&Object.hasOwnProperty.call(t,e)}function Z(t,e,i,n){function r(n){var r=function(t,e){for(var i={},n=0;n<e.length;n++){var r=e[n],o=t[r];void 0!==o&&(i[r]=o)}return i}(n,e.map(H));return function(t,e,i){if(!e.filter((t=>!function(t){return t&&"?"===t[0]}(t))).every((t=>void 0!==i[t]))){var n=e.filter((t=>void 0===i[t]));throw new Error('Cannot create function "'.concat(t,'", ')+"some dependencies are missing: ".concat(n.map((t=>'"'.concat(t,'"'))).join(", "),"."))}}(t,e,n),i(r)}return r.isFactory=!0,r.fn=t,r.dependencies=e.slice().sort(),n&&(r.meta=n),r}function H(t){return t&&"?"===t[0]?t.slice(1):t}var G=i(977);function X(t){return"boolean"==typeof t||!!isFinite(t)&&t===Math.round(t)}Math.sign,Math.log2,Math.log10,Math.log1p,Math.cbrt,Math.expm1;function K(t,e,i){var n={2:"0b",8:"0o",16:"0x"}[e],r="";if(i){if(i<1)throw new Error("size must be in greater than 0");if(!X(i))throw new Error("size must be an integer");if(t>2**(i-1)-1||t<-(2**(i-1)))throw new Error("Value must be in range [-2^".concat(i-1,", 2^").concat(i-1,"-1]"));if(!X(t))throw new Error("Value must be an integer");t<0&&(t+=2**i),r="i".concat(i)}var o="";return t<0&&(t=-t,o="-"),"".concat(o).concat(n).concat(t.toString(e)).concat(r)}function $(t,e){if("function"==typeof e)return e(t);if(t===1/0)return"Infinity";if(t===-1/0)return"-Infinity";if(isNaN(t))return"NaN";var i,n,o="auto";if(e&&(e.notation&&(o=e.notation),r(e)?i=e:r(e.precision)&&(i=e.precision),e.wordSize&&"number"!=typeof(n=e.wordSize)))throw new Error('Option "wordSize" must be a number');switch(o){case"fixed":return tt(t,i);case"exponential":return et(t,i);case"engineering":return function(t,e){if(isNaN(t)||!isFinite(t))return String(t);var i=it(Q(t),e),n=i.exponent,o=i.coefficients,s=n%3==0?n:n<0?n-3-n%3:n-n%3;if(r(e))for(;e>o.length||n-s+1>o.length;)o.push(0);else for(var a=Math.abs(n-s)-(o.length-1),h=0;h<a;h++)o.push(0);for(var u=Math.abs(n-s),c=1;u>0;)c++,u--;var m=o.slice(c).join(""),l=r(e)&&m.length||m.match(/[1-9]/)?"."+m:"",p=o.slice(0,c).join("")+l+"e"+(n>=0?"+":"")+s.toString();return i.sign+p}(t,i);case"bin":return K(t,2,n);case"oct":return K(t,8,n);case"hex":return K(t,16,n);case"auto":return function(t,e,i){if(isNaN(t)||!isFinite(t))return String(t);var n=i&&void 0!==i.lowerExp?i.lowerExp:-3,r=i&&void 0!==i.upperExp?i.upperExp:5,o=Q(t),s=e?it(o,e):o;if(s.exponent<n||s.exponent>=r)return et(t,e);var a=s.coefficients,h=s.exponent;a.length<e&&(a=a.concat(nt(e-a.length))),a=a.concat(nt(h-a.length+1+(a.length<e?e-a.length:0)));var u=h>0?h:0;return u<(a=nt(-h).concat(a)).length-1&&a.splice(u+1,0,"."),s.sign+a.join("")}(t,i,e&&e).replace(/((\.\d*?)(0+))($|e)/,(function(){var t=arguments[2],e=arguments[4];return"."!==t?t+e:e}));default:throw new Error('Unknown notation "'+o+'". Choose "auto", "exponential", "fixed", "bin", "oct", or "hex.')}}function Q(t){var e=String(t).toLowerCase().match(/^0*?(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!e)throw new SyntaxError("Invalid number "+t);var i=e[1],n=e[2],r=parseFloat(e[4]||"0"),o=n.indexOf(".");r+=-1!==o?o-1:n.length-1;var s=n.replace(".","").replace(/^0*/,(function(t){return r-=t.length,""})).replace(/0*$/,"").split("").map((function(t){return parseInt(t)}));return 0===s.length&&(s.push(0),r++),{sign:i,coefficients:s,exponent:r}}function tt(t,e){if(isNaN(t)||!isFinite(t))return String(t);var i=Q(t),n="number"==typeof e?it(i,i.exponent+1+e):i,r=n.coefficients,o=n.exponent+1,s=o+(e||0);return r.length<s&&(r=r.concat(nt(s-r.length))),o<0&&(r=nt(1-o).concat(r),o=1),o<r.length&&r.splice(o,0,0===o?"0.":"."),n.sign+r.join("")}function et(t,e){if(isNaN(t)||!isFinite(t))return String(t);var i=Q(t),n=e?it(i,e):i,r=n.coefficients,o=n.exponent;r.length<e&&(r=r.concat(nt(e-r.length)));var s=r.shift();return n.sign+s+(r.length>0?"."+r.join(""):"")+"e"+(o>=0?"+":"")+o}function it(t,e){for(var i={sign:t.sign,coefficients:t.coefficients,exponent:t.exponent},n=i.coefficients;e<=0;)n.unshift(0),i.exponent++,e++;if(n.length>e&&n.splice(e,n.length-e)[0]>=5){var r=e-1;for(n[r]++;10===n[r];)n.pop(),0===r&&(n.unshift(0),i.exponent++,r++),n[--r]++}return i}function nt(t){for(var e=[],i=0;i<t;i++)e.push(0);return e}var rt=Number.EPSILON||2220446049250313e-31;function ot(t,e,i){if(null==i)return t===e;if(t===e)return!0;if(isNaN(t)||isNaN(e))return!1;if(isFinite(t)&&isFinite(e)){var n=Math.abs(t-e);return n<rt||n<=Math.max(Math.abs(t),Math.abs(e))*i}return!1}Math.acosh,Math.asinh,Math.atanh,Math.cosh,Math.sinh;var st=(Math.tanh,Z("Complex",[],(()=>(G.prototype.type="Complex",G.prototype.isComplex=!0,G.prototype.toJSON=function(){return{mathjs:"Complex",re:this.re,im:this.im}},G.prototype.toPolar=function(){return{r:this.abs(),phi:this.arg()}},G.prototype.format=function(t){var e=this.im,i=this.re,n=$(this.re,t),o=$(this.im,t),s=r(t)?t:t?t.precision:null;if(null!==s){var a=Math.pow(10,-s);Math.abs(i/e)<a&&(i=0),Math.abs(e/i)<a&&(e=0)}return 0===e?n:0===i?1===e?"i":-1===e?"-i":o+"i":e<0?-1===e?n+" - i":n+" - "+o.substring(1)+"i":1===e?n+" + i":n+" + "+o+"i"},G.fromPolar=function(t){switch(arguments.length){case 1:var e=arguments[0];if("object"==typeof e)return G(e);throw new TypeError("Input has to be an object with r and phi keys.");case 2:var i=arguments[0],n=arguments[1];if(r(i)){if(h(n)&&n.hasBase("ANGLE")&&(n=n.toNumber("rad")),r(n))return new G({r:i,phi:n});throw new TypeError("Phi is not a number nor an angle unit.")}throw new TypeError("Radius r is not a number.");default:throw new SyntaxError("Wrong number of arguments in function fromPolar")}},G.prototype.valueOf=G.prototype.toString,G.fromJSON=function(t){return new G(t)},G.compare=function(t,e){return t.re>e.re?1:t.re<e.re?-1:t.im>e.im?1:t.im<e.im?-1:0},G)),{isClass:!0}));function at(t){var e=0,i=1,n=Object.create(null),r=Object.create(null),o=0,s=function(t){var s=r[t];if(s&&(delete n[s],delete r[t],--e,i===s)){if(!e)return o=0,void(i=1);for(;!hasOwnProperty.call(n,++i););}};return t=Math.abs(t),{hit:function(a){var h=r[a],u=++o;if(n[u]=a,r[a]=u,!h){if(++e<=t)return;return a=n[i],s(a),a}if(delete n[h],i===h)for(;!hasOwnProperty.call(n,++i););},delete:s,clear:function(){e=o=0,i=1,n=Object.create(null),r=Object.create(null)}}}function ht(t){var{hasher:e,limit:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i=null==i?Number.POSITIVE_INFINITY:i,e=null==e?JSON.stringify:e,function n(){"object"!=typeof n.cache&&(n.cache={values:new Map,lru:at(i||Number.POSITIVE_INFINITY)});for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var s=e(r);if(n.cache.values.has(s))return n.cache.lru.hit(s),n.cache.values.get(s);var a=t.apply(t,r);return n.cache.values.set(s,a),n.cache.values.delete(n.cache.lru.hit(s)),a}}ht((function(t){return new t(1).exp()}),{hasher:ct}),ht((function(t){return new t(1).plus(new t(5).sqrt()).div(2)}),{hasher:ct});var ut=ht((function(t){return t.acos(-1)}),{hasher:ct});function ct(t){return t[0].precision}ht((function(t){return ut(t).times(2)}),{hasher:ct}),Math.PI,Math.PI,Math.E;var mt=i(776),lt=Z("BigNumber",["?on","config"],(t=>{var{on:e,config:i}=t,n=mt.clone({precision:i.precision,modulo:9});return n.prototype.type="BigNumber",n.prototype.isBigNumber=!0,n.prototype.toJSON=function(){return{mathjs:"BigNumber",value:this.toString()}},n.fromJSON=function(t){return new n(t.value)},e&&e("config",(function(t,e){t.precision!==e.precision&&n.config({precision:t.precision})})),n}),{isClass:!0}),pt=Z("Matrix",[],(()=>{function t(){if(!(this instanceof t))throw new SyntaxError("Constructor must be called with the new operator")}return t.prototype.type="Matrix",t.prototype.isMatrix=!0,t.prototype.storage=function(){throw new Error("Cannot invoke storage on a Matrix interface")},t.prototype.datatype=function(){throw new Error("Cannot invoke datatype on a Matrix interface")},t.prototype.create=function(t,e){throw new Error("Cannot invoke create on a Matrix interface")},t.prototype.subset=function(t,e,i){throw new Error("Cannot invoke subset on a Matrix interface")},t.prototype.get=function(t){throw new Error("Cannot invoke get on a Matrix interface")},t.prototype.set=function(t,e,i){throw new Error("Cannot invoke set on a Matrix interface")},t.prototype.resize=function(t,e){throw new Error("Cannot invoke resize on a Matrix interface")},t.prototype.reshape=function(t,e){throw new Error("Cannot invoke reshape on a Matrix interface")},t.prototype.clone=function(){throw new Error("Cannot invoke clone on a Matrix interface")},t.prototype.size=function(){throw new Error("Cannot invoke size on a Matrix interface")},t.prototype.map=function(t,e){throw new Error("Cannot invoke map on a Matrix interface")},t.prototype.forEach=function(t){throw new Error("Cannot invoke forEach on a Matrix interface")},t.prototype.toArray=function(){throw new Error("Cannot invoke toArray on a Matrix interface")},t.prototype.valueOf=function(){throw new Error("Cannot invoke valueOf on a Matrix interface")},t.prototype.format=function(t){throw new Error("Cannot invoke format on a Matrix interface")},t.prototype.toString=function(){throw new Error("Cannot invoke toString on a Matrix interface")},t}),{isClass:!0});function _t(t,e){return Z(t,["config","BigNumber"],(t=>{var{config:i,BigNumber:n}=t;return"BigNumber"===i.number?new n(e):e}))}_t("fineStructure",.0072973525693),_t("weakMixingAngle",.2229),_t("efimovFactor",22.7),_t("sackurTetrode",-1.16487052358);var ft=i(628),dt=Z("Fraction",[],(()=>(ft.prototype.type="Fraction",ft.prototype.isFraction=!0,ft.prototype.toJSON=function(){return{mathjs:"Fraction",n:this.s*this.n,d:this.d}},ft.fromJSON=function(t){return new ft(t)},ft)),{isClass:!0});function yt(t,e,i){var n=new(0,t.constructor)(2),r="";if(i){if(i<1)throw new Error("size must be in greater than 0");if(!X(i))throw new Error("size must be an integer");if(t.greaterThan(n.pow(i-1).sub(1))||t.lessThan(n.pow(i-1).mul(-1)))throw new Error("Value must be in range [-2^".concat(i-1,", 2^").concat(i-1,"-1]"));if(!t.isInteger())throw new Error("Value must be an integer");t.lessThan(0)&&(t=t.add(n.pow(i))),r="i".concat(i)}switch(e){case 2:return"".concat(t.toBinary()).concat(r);case 8:return"".concat(t.toOctal()).concat(r);case 16:return"".concat(t.toHexadecimal()).concat(r);default:throw new Error("Base ".concat(e," not supported "))}}function vt(t,e){return void 0!==e?t.toExponential(e-1):t.toExponential()}function gt(t,e){return"number"==typeof t?$(t,e):o(t)?function(t,e){if("function"==typeof e)return e(t);if(!t.isFinite())return t.isNaN()?"NaN":t.gt(0)?"Infinity":"-Infinity";var i,n,r="auto";if(void 0!==e&&(e.notation&&(r=e.notation),"number"==typeof e?i=e:e.precision&&(i=e.precision),e.wordSize&&"number"!=typeof(n=e.wordSize)))throw new Error('Option "wordSize" must be a number');switch(r){case"fixed":return function(t,e){return t.toFixed(e)}(t,i);case"exponential":return vt(t,i);case"engineering":return function(t,e){var i=t.e,n=i%3==0?i:i<0?i-3-i%3:i-i%3,r=t.mul(Math.pow(10,-n)),o=r.toPrecision(e);return-1!==o.indexOf("e")&&(o=r.toString()),o+"e"+(i>=0?"+":"")+n.toString()}(t,i);case"bin":return yt(t,2,n);case"oct":return yt(t,8,n);case"hex":return yt(t,16,n);case"auto":var o=e&&void 0!==e.lowerExp?e.lowerExp:-3,s=e&&void 0!==e.upperExp?e.upperExp:5;if(t.isZero())return"0";var a=t.toSignificantDigits(i),h=a.e;return(h>=o&&h<s?a.toFixed():vt(t,i)).replace(/((\.\d*?)(0+))($|e)/,(function(){var t=arguments[2],e=arguments[4];return"."!==t?t+e:e}));default:throw new Error('Unknown notation "'+r+'". Choose "auto", "exponential", "fixed", "bin", "oct", or "hex.')}}(t,e):function(t){return t&&"object"==typeof t&&"number"==typeof t.s&&"number"==typeof t.n&&"number"==typeof t.d||!1}(t)?e&&"decimal"===e.fraction?t.toString():t.s*t.n+"/"+t.d:Array.isArray(t)?xt(t,e):u(t)?'"'+t+'"':"function"==typeof t?t.syntax?String(t.syntax):"function":t&&"object"==typeof t?"function"==typeof t.format?t.format(e):t&&t.toString(e)!=={}.toString()?t.toString(e):"{"+Object.keys(t).map((i=>'"'+i+'": '+gt(t[i],e))).join(", ")+"}":String(t)}function xt(t,e){if(Array.isArray(t)){for(var i="[",n=t.length,r=0;r<n;r++)0!==r&&(i+=", "),i+=xt(t[r],e);return i+"]"}return gt(t,e)}function bt(t,e,i){if(!(this instanceof bt))throw new SyntaxError("Constructor must be called with the new operator");this.actual=t,this.expected=e,this.relation=i,this.message="Dimension mismatch ("+(Array.isArray(t)?"["+t.join(", ")+"]":t)+" "+(this.relation||"!=")+" "+(Array.isArray(e)?"["+e.join(", ")+"]":e)+")",this.stack=(new Error).stack}function At(t,e,i){if(!(this instanceof At))throw new SyntaxError("Constructor must be called with the new operator");this.index=t,arguments.length<3?(this.min=0,this.max=e):(this.min=e,this.max=i),void 0!==this.min&&this.index<this.min?this.message="Index out of range ("+this.index+" < "+this.min+")":void 0!==this.max&&this.index>=this.max?this.message="Index out of range ("+this.index+" > "+(this.max-1)+")":this.message="Index out of range ("+this.index+")",this.stack=(new Error).stack}function wt(t){for(var e=[];Array.isArray(t);)e.push(t.length),t=t[0];return e}function Bt(t,e,i){var n,r=t.length;if(r!==e[i])throw new bt(r,e[i]);if(i<e.length-1){var o=i+1;for(n=0;n<r;n++){var s=t[n];if(!Array.isArray(s))throw new bt(e.length-1,e.length,"<");Bt(t[n],e,o)}}else for(n=0;n<r;n++)if(Array.isArray(t[n]))throw new bt(e.length+1,e.length,">")}function Mt(t,e){if(0===e.length){if(Array.isArray(t))throw new bt(t.length,0)}else Bt(t,e,0)}function Ct(t,e){if(!r(t)||!X(t))throw new TypeError("Index must be an integer (value: "+t+")");if(t<0||"number"==typeof e&&t>=e)throw new At(t,e)}function St(t,e,i){if(!Array.isArray(t)||!Array.isArray(e))throw new TypeError("Array expected");if(0===e.length)throw new Error("Resizing to scalar is not supported");return e.forEach((function(t){if(!r(t)||!X(t)||t<0)throw new TypeError("Invalid size, must contain positive integers (size: "+gt(e)+")")})),zt(t,e,0,void 0!==i?i:0),t}function zt(t,e,i,n){var r,o,s=t.length,a=e[i],h=Math.min(s,a);if(t.length=a,i<e.length-1){var u=i+1;for(r=0;r<h;r++)o=t[r],Array.isArray(o)||(o=[o],t[r]=o),zt(o,e,u,n);for(r=h;r<a;r++)o=[],t[r]=o,zt(o,e,u,n)}else{for(r=0;r<h;r++)for(;Array.isArray(t[r]);)t[r]=t[r][0];for(r=h;r<a;r++)t[r]=n}}function It(t,e){var i=function(t){if(!Array.isArray(t))return t;var e=[];return t.forEach((function t(i){Array.isArray(i)?i.forEach(t):e.push(i)})),e}(t),n=i.length;if(!Array.isArray(t)||!Array.isArray(e))throw new TypeError("Array expected");if(0===e.length)throw new bt(0,n,"!=");var r=Et(e=Pt(e,n));if(n!==r)throw new bt(r,n,"!=");try{return function(t,e){for(var i,n=t,r=e.length-1;r>0;r--){var o=e[r];i=[];for(var s=n.length/o,a=0;a<s;a++)i.push(n.slice(a*o,(a+1)*o));n=i}return n}(i,e)}catch(t){if(t instanceof bt)throw new bt(r,n,"!=");throw t}}function Pt(t,e){var i=Et(t),n=t.slice(),r=t.indexOf(-1);if(t.indexOf(-1,r+1)>=0)throw new Error("More than one wildcard in sizes");if(r>=0){if(e%i!=0)throw new Error("Could not replace wildcard, since "+e+" is no multiple of "+-i);n[r]=-e/i}return n}function Et(t){return t.reduce(((t,e)=>t*e),1)}function Nt(t,e){for(var i=e||wt(t);Array.isArray(t)&&1===t.length;)t=t[0],i.shift();for(var n=i.length;1===i[n-1];)n--;return n<i.length&&(t=Vt(t,n,0),i.length=n),t}function Vt(t,e,i){var n,r;if(i<e){var o=i+1;for(n=0,r=t.length;n<r;n++)t[n]=Vt(t[n],e,o)}else for(;Array.isArray(t);)t=t[0];return t}function Tt(t,e,i,n){var r=n||wt(t);if(i)for(var o=0;o<i;o++)t=[t],r.unshift(1);for(t=Ft(t,e,0);r.length<e;)r.push(1);return t}function Ft(t,e,i){var n,r;if(Array.isArray(t)){var o=i+1;for(n=0,r=t.length;n<r;n++)t[n]=Ft(t[n],e,o)}else for(var s=i;s<e;s++)t=[t];return t}function Dt(t,e){for(var i,n=0,r=0;r<t.length;r++){var o=t[r],s=Array.isArray(o);if(0===r&&s&&(n=o.length),s&&o.length!==n)return;var a=s?Dt(o,e):e(o);if(void 0===i)i=a;else if(i!==a)return"mixed"}return i}bt.prototype=new RangeError,bt.prototype.constructor=RangeError,bt.prototype.name="DimensionError",bt.prototype.isDimensionError=!0,At.prototype=new RangeError,At.prototype.constructor=RangeError,At.prototype.name="IndexError",At.prototype.isIndexError=!0;var qt=Z("DenseMatrix",["Matrix"],(t=>{var{Matrix:e}=t;function i(t,e){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(e&&!u(e))throw new Error("Invalid datatype: "+e);if(m(t))"DenseMatrix"===t.type?(this._data=J(t._data),this._size=J(t._size),this._datatype=e||t._datatype):(this._data=t.toArray(),this._size=t.size(),this._datatype=e||t._datatype);else if(t&&c(t.data)&&c(t.size))this._data=t.data,this._size=t.size,Mt(this._data,this._size),this._datatype=e||t.datatype;else if(c(t))this._data=f(t),this._size=wt(this._data),Mt(this._data,this._size),this._datatype=e;else{if(t)throw new TypeError("Unsupported type of data ("+R(t)+")");this._data=[],this._size=[0],this._datatype=e}}function n(t,e){if(!d(e))throw new TypeError("Invalid index");if(e.isScalar())return t.get(e.min());var n=e.size();if(n.length!==t._size.length)throw new bt(n.length,t._size.length);for(var r=e.min(),o=e.max(),a=0,h=t._size.length;a<h;a++)Ct(r[a],t._size[a]),Ct(o[a],t._size[a]);return new i(s(t._data,e,n.length,0),t._datatype)}function s(t,e,i,n){var r=n===i-1,o=e.dimension(n);return r?o.map((function(e){return Ct(e,t.length),t[e]})).valueOf():o.map((function(r){return Ct(r,t.length),s(t[r],e,i,n+1)})).valueOf()}function a(t,e,i,n){if(!e||!0!==e.isIndex)throw new TypeError("Invalid index");var r,o=e.size(),s=e.isScalar();if(m(i)?(r=i.size(),i=i.valueOf()):r=wt(i),s){if(0!==r.length)throw new TypeError("Scalar expected");t.set(e.min(),i,n)}else{if(o.length<t._size.length)throw new bt(o.length,t._size.length,"<");if(r.length<o.length){for(var a=0,u=0;1===o[a]&&1===r[a];)a++;for(;1===o[a];)u++,a++;i=Tt(i,o.length,u,r)}if(!U(o,r))throw new bt(o,r,">");_(t,e.max().map((function(t){return t+1})),n);var c=o.length;h(t._data,e,i,c,0)}return t}function h(t,e,i,n,r){var o=r===n-1,s=e.dimension(r);o?s.forEach((function(e,n){Ct(e),t[e]=i[n[0]]})):s.forEach((function(o,s){Ct(o),h(t[o],e,i[s[0]],n,r+1)}))}function p(t,e,i){if(0===e.length){for(var n=t._data;c(n);)n=n[0];return n}return t._size=e.slice(0),t._data=St(t._data,t._size,i),t}function _(t,e,i){for(var n=t._size.slice(0),r=!1;n.length<e.length;)n.push(0),r=!0;for(var o=0,s=e.length;o<s;o++)e[o]>n[o]&&(n[o]=e[o],r=!0);r&&p(t,n,i)}function f(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];c(n)?t[e]=f(n):n&&!0===n.isMatrix&&(t[e]=f(n.valueOf()))}return t}return i.prototype=new e,i.prototype.createDenseMatrix=function(t,e){return new i(t,e)},i.prototype.type="DenseMatrix",i.prototype.isDenseMatrix=!0,i.prototype.getDataType=function(){return Dt(this._data,R)},i.prototype.storage=function(){return"dense"},i.prototype.datatype=function(){return this._datatype},i.prototype.create=function(t,e){return new i(t,e)},i.prototype.subset=function(t,e,i){switch(arguments.length){case 1:return n(this,t);case 2:case 3:return a(this,t,e,i);default:throw new SyntaxError("Wrong number of arguments")}},i.prototype.get=function(t){if(!c(t))throw new TypeError("Array expected");if(t.length!==this._size.length)throw new bt(t.length,this._size.length);for(var e=0;e<t.length;e++)Ct(t[e],this._size[e]);for(var i=this._data,n=0,r=t.length;n<r;n++){var o=t[n];Ct(o,i.length),i=i[o]}return i},i.prototype.set=function(t,e,i){if(!c(t))throw new TypeError("Array expected");if(t.length<this._size.length)throw new bt(t.length,this._size.length,"<");var n,r,o;_(this,t.map((function(t){return t+1})),i);var s=this._data;for(n=0,r=t.length-1;n<r;n++)Ct(o=t[n],s.length),s=s[o];return Ct(o=t[t.length-1],s.length),s[o]=e,this},i.prototype.resize=function(t,e,i){if(!l(t))throw new TypeError("Array or Matrix expected");var n=t.valueOf().map((t=>Array.isArray(t)&&1===t.length?t[0]:t));return p(i?this.clone():this,n,e)},i.prototype.reshape=function(t,e){var i=e?this.clone():this;i._data=It(i._data,t);var n=i._size.reduce(((t,e)=>t*e));return i._size=Pt(t,n),i},i.prototype.clone=function(){return new i({data:J(this._data),size:J(this._size),datatype:this._datatype})},i.prototype.size=function(){return this._size.slice(0)},i.prototype.map=function(t){var e=this,n=function i(n,r){return c(n)?n.map((function(t,e){return i(t,r.concat(e))})):t(n,r,e)}(this._data,[]);return new i(n,void 0!==this._datatype?Dt(n,R):void 0)},i.prototype.forEach=function(t){var e=this;!function i(n,r){c(n)?n.forEach((function(t,e){i(t,r.concat(e))})):t(n,r,e)}(this._data,[])},i.prototype.toArray=function(){return J(this._data)},i.prototype.valueOf=function(){return this._data},i.prototype.format=function(t){return gt(this._data,t)},i.prototype.toString=function(){return gt(this._data)},i.prototype.toJSON=function(){return{mathjs:"DenseMatrix",data:this._data,size:this._size,datatype:this._datatype}},i.prototype.diagonal=function(t){if(t){if(o(t)&&(t=t.toNumber()),!r(t)||!X(t))throw new TypeError("The parameter k must be an integer number")}else t=0;for(var e=t>0?t:0,n=t<0?-t:0,s=this._size[0],a=this._size[1],h=Math.min(s-n,a-e),u=[],c=0;c<h;c++)u[c]=this._data[c+n][c+e];return new i({data:u,size:[h],datatype:this._datatype})},i.diagonal=function(t,e,n,s){if(!c(t))throw new TypeError("Array expected, size parameter");if(2!==t.length)throw new Error("Only two dimensions matrix are supported");if(t=t.map((function(t){if(o(t)&&(t=t.toNumber()),!r(t)||!X(t)||t<1)throw new Error("Size values must be positive integers");return t})),n){if(o(n)&&(n=n.toNumber()),!r(n)||!X(n))throw new TypeError("The parameter k must be an integer number")}else n=0;var a,h=n>0?n:0,u=n<0?-n:0,l=t[0],p=t[1],_=Math.min(l-u,p-h);if(c(e)){if(e.length!==_)throw new Error("Invalid value array length");a=function(t){return e[t]}}else if(m(e)){var f=e.size();if(1!==f.length||f[0]!==_)throw new Error("Invalid matrix length");a=function(t){return e.get([t])}}else a=function(){return e};s||(s=o(a(0))?a(0).mul(0):0);var d=[];if(t.length>0){d=St(d,t,s);for(var y=0;y<_;y++)d[y+u][y+h]=a(y)}return new i({data:d,size:[l,p]})},i.fromJSON=function(t){return new i(t)},i.prototype.swapRows=function(t,e){if(!(r(t)&&X(t)&&r(e)&&X(e)))throw new Error("Row index must be positive integers");if(2!==this._size.length)throw new Error("Only two dimensional matrix is supported");return Ct(t,this._size[0]),Ct(e,this._size[0]),i._swapRows(t,e,this._data),this},i._swapRows=function(t,e,i){var n=i[t];i[t]=i[e],i[e]=n},i}),{isClass:!0}),Lt=i(287),Ot=function(){return Ot=Lt.create,Lt},kt=Z("typed",["?BigNumber","?Complex","?DenseMatrix","?Fraction"],(function(t){var{BigNumber:e,Complex:i,DenseMatrix:n,Fraction:l}=t,R=Ot();return R.types=[{name:"number",test:r},{name:"Complex",test:s},{name:"BigNumber",test:o},{name:"Fraction",test:a},{name:"Unit",test:h},{name:"string",test:u},{name:"Chain",test:j},{name:"Array",test:c},{name:"Matrix",test:m},{name:"DenseMatrix",test:p},{name:"SparseMatrix",test:_},{name:"Range",test:f},{name:"Index",test:d},{name:"boolean",test:y},{name:"ResultSet",test:v},{name:"Help",test:g},{name:"function",test:x},{name:"Date",test:b},{name:"RegExp",test:A},{name:"null",test:B},{name:"undefined",test:M},{name:"AccessorNode",test:C},{name:"ArrayNode",test:S},{name:"AssignmentNode",test:z},{name:"BlockNode",test:I},{name:"ConditionalNode",test:P},{name:"ConstantNode",test:E},{name:"FunctionNode",test:V},{name:"FunctionAssignmentNode",test:N},{name:"IndexNode",test:T},{name:"Node",test:F},{name:"ObjectNode",test:D},{name:"OperatorNode",test:q},{name:"ParenthesisNode",test:L},{name:"RangeNode",test:O},{name:"SymbolNode",test:k},{name:"Object",test:w}],R.conversions=[{from:"number",to:"BigNumber",convert:function(t){if(e||jt(t),t.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length>15)throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+t+"). Use function bignumber(x) to convert to BigNumber.");return new e(t)}},{from:"number",to:"Complex",convert:function(t){return i||Rt(t),new i(t,0)}},{from:"number",to:"string",convert:function(t){return t+""}},{from:"BigNumber",to:"Complex",convert:function(t){return i||Rt(t),new i(t.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(t){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.")}},{from:"Fraction",to:"Complex",convert:function(t){return i||Rt(t),new i(t.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(t){l||Jt(t);var e=new l(t);if(e.valueOf()!==t)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+t+"). Use function fraction(x) to convert to Fraction.");return e}},{from:"string",to:"number",convert:function(t){var e=Number(t);if(isNaN(e))throw new Error('Cannot convert "'+t+'" to a number');return e}},{from:"string",to:"BigNumber",convert:function(t){e||jt(t);try{return new e(t)}catch(e){throw new Error('Cannot convert "'+t+'" to BigNumber')}}},{from:"string",to:"Fraction",convert:function(t){l||Jt(t);try{return new l(t)}catch(e){throw new Error('Cannot convert "'+t+'" to Fraction')}}},{from:"string",to:"Complex",convert:function(t){i||Rt(t);try{return new i(t)}catch(e){throw new Error('Cannot convert "'+t+'" to Complex')}}},{from:"boolean",to:"number",convert:function(t){return+t}},{from:"boolean",to:"BigNumber",convert:function(t){return e||jt(t),new e(+t)}},{from:"boolean",to:"Fraction",convert:function(t){return l||Jt(t),new l(+t)}},{from:"boolean",to:"string",convert:function(t){return String(t)}},{from:"Array",to:"Matrix",convert:function(t){return n||function(){throw new Error("Cannot convert array into a Matrix: no class 'DenseMatrix' provided")}(),new n(t)}},{from:"Matrix",to:"Array",convert:function(t){return t.valueOf()}}],R}));function jt(t){throw new Error("Cannot convert value ".concat(t," into a BigNumber: no class 'BigNumber' provided"))}function Rt(t){throw new Error("Cannot convert value ".concat(t," into a Complex number: no class 'Complex' provided"))}function Jt(t){throw new Error("Cannot convert value ".concat(t," into a Fraction, no class 'Fraction' provided."))}function Yt(t,e,i){return t&&"function"==typeof t.map?t.map((function(t){return Yt(t,e,i)})):e(t)}function Ut(t,e,i){if(null==i)return t.eq(e);if(t.eq(e))return!0;if(t.isNaN()||e.isNaN())return!1;if(t.isFinite()&&e.isFinite()){var n=t.minus(e).abs();if(n.isZero())return!0;var r=t.constructor.max(t.abs(),e.abs());return n.lte(r.times(i))}return!1}var Wt="equalScalar",Zt=Z(Wt,["typed","config"],(t=>{var{typed:e,config:i}=t;return e(Wt,{"boolean, boolean":function(t,e){return t===e},"number, number":function(t,e){return ot(t,e,i.epsilon)},"BigNumber, BigNumber":function(t,e){return t.eq(e)||Ut(t,e,i.epsilon)},"Fraction, Fraction":function(t,e){return t.equals(e)},"Complex, Complex":function(t,e){return function(t,e,i){return ot(t.re,e.re,i)&&ot(t.im,e.im,i)}(t,e,i.epsilon)},"Unit, Unit":function(t,e){if(!t.equalBase(e))throw new Error("Cannot compare units with different base");return this(t.value,e.value)}})}));Z(Wt,["typed","config"],(t=>{var{typed:e,config:i}=t;return e(Wt,{"number, number":function(t,e){return ot(t,e,i.epsilon)}})}));var Ht="number",Gt="number, number";function Xt(t,e){return t+e}function Kt(t,e){return t*e}function $t(t){return-t}function Qt(t,e){if(e>0)return t-e*Math.floor(t/e);if(0===e)return t;throw new Error("Cannot calculate mod for a negative divisor")}Xt.signature=Gt,Kt.signature=Gt,$t.signature=Ht,Qt.signature=Gt;var te=Z("multiplyScalar",["typed"],(t=>{var{typed:e}=t;return e("multiplyScalar",{"number, number":Kt,"Complex, Complex":function(t,e){return t.mul(e)},"BigNumber, BigNumber":function(t,e){return t.times(e)},"Fraction, Fraction":function(t,e){return t.mul(e)},"number | Fraction | BigNumber | Complex, Unit":function(t,e){var i=e.clone();return i.value=null===i.value?i._normalize(t):this(i.value,t),i},"Unit, number | Fraction | BigNumber | Complex":function(t,e){var i=t.clone();return i.value=null===i.value?i._normalize(e):this(i.value,e),i},"Unit, Unit":function(t,e){return t.multiply(e)}})}));Math.pow(2,53),Z("oct",["typed","format"],(t=>{var{typed:e,format:i}=t;return e("oct",{"number | BigNumber":function(t){return i(t,{notation:"oct"})},"number | BigNumber, number":function(t,e){return i(t,{notation:"oct",wordSize:e})}})}));i(377);Date.now();var ee="unaryMinus",ie=Z(ee,["typed"],(t=>{var{typed:e}=t;return e(ee,{number:$t,Complex:function(t){return t.neg()},BigNumber:function(t){return t.neg()},Fraction:function(t){return t.neg()},Unit:function(t){var e=t.clone();return e.value=this(t.value),e},"Array | Matrix":function(t){return Yt(t,this,!0)}})})),ne="addScalar",re=Z(ne,["typed"],(t=>{var{typed:e}=t;return e(ne,{"number, number":Xt,"Complex, Complex":function(t,e){return t.add(e)},"BigNumber, BigNumber":function(t,e){return t.plus(e)},"Fraction, Fraction":function(t,e){return t.add(e)},"Unit, Unit":function(t,e){if(null===t.value||void 0===t.value)throw new Error("Parameter x contains a unit with undefined value");if(null===e.value||void 0===e.value)throw new Error("Parameter y contains a unit with undefined value");if(!t.equalBase(e))throw new Error("Units do not match");var i=t.clone();return i.value=this(i.value,e.value),i.fixPrefix=!1,i}})})),oe="conj",se=Z(oe,["typed"],(t=>{var{typed:e}=t;return e(oe,{number:function(t){return t},BigNumber:function(t){return t},Complex:function(t){return t.conjugate()},"Array | Matrix":function(t){return Yt(t,this)}})})),ae=(Z("bin",["typed","format"],(t=>{var{typed:e,format:i}=t;return e("bin",{"number | BigNumber":function(t){return i(t,{notation:"bin"})},"number | BigNumber, number":function(t,e){return i(t,{notation:"bin",wordSize:e})}})})),Z("cos",["typed"],(t=>{var{typed:e}=t;return e("cos",{number:Math.cos,Complex:function(t){return t.cos()},BigNumber:function(t){return t.cos()},Unit:function(t){if(!t.hasBase(t.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cos is no angle");return this(t.value)},"Array | Matrix":function(t){return Yt(t,this)}})}))),he=Z("sin",["typed"],(t=>{var{typed:e}=t;return e("sin",{number:Math.sin,Complex:function(t){return t.sin()},BigNumber:function(t){return t.sin()},Unit:function(t){if(!t.hasBase(t.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sin is no angle");return this(t.value)},"Array | Matrix":function(t){return Yt(t,this,!0)}})})),ue=Z("SparseMatrix",["typed","equalScalar","Matrix"],(t=>{var{typed:e,equalScalar:i,Matrix:n}=t;function s(t,e){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if(e&&!u(e))throw new Error("Invalid datatype: "+e);if(m(t))!function(t,e,i){"SparseMatrix"===e.type?(t._values=e._values?J(e._values):void 0,t._index=J(e._index),t._ptr=J(e._ptr),t._size=J(e._size),t._datatype=i||e._datatype):a(t,e.valueOf(),i||e._datatype)}(this,t,e);else if(t&&c(t.index)&&c(t.ptr)&&c(t.size))this._values=t.values,this._index=t.index,this._ptr=t.ptr,this._size=t.size,this._datatype=e||t.datatype;else if(c(t))a(this,t,e);else{if(t)throw new TypeError("Unsupported type of data ("+R(t)+")");this._values=[],this._index=[],this._ptr=[0],this._size=[0,0],this._datatype=e}}function a(t,n,r){t._values=[],t._index=[],t._ptr=[],t._datatype=r;var o=n.length,s=0,a=i,h=0;if(u(r)&&(a=e.find(i,[r,r])||i,h=e.convert(0,r)),o>0){var m=0;do{t._ptr.push(t._index.length);for(var l=0;l<o;l++){var p=n[l];if(c(p)){if(0===m&&s<p.length&&(s=p.length),m<p.length){var _=p[m];a(_,h)||(t._values.push(_),t._index.push(l))}}else 0===m&&s<1&&(s=1),a(p,h)||(t._values.push(p),t._index.push(l))}m++}while(m<s)}t._ptr.push(t._index.length),t._size=[o,s]}function h(t,e){if(!d(e))throw new TypeError("Invalid index");if(e.isScalar())return t.get(e.min());var i,n,r,o,a=e.size();if(a.length!==t._size.length)throw new bt(a.length,t._size.length);var h=e.min(),u=e.max();for(i=0,n=t._size.length;i<n;i++)Ct(h[i],t._size[i]),Ct(u[i],t._size[i]);var c=t._values,m=t._index,l=t._ptr,p=e.dimension(0),_=e.dimension(1),f=[],y=[];p.forEach((function(t,e){y[t]=e[0],f[t]=!0}));var v=c?[]:void 0,g=[],x=[];return _.forEach((function(t){for(x.push(g.length),r=l[t],o=l[t+1];r<o;r++)i=m[r],!0===f[i]&&(g.push(y[i]),v&&v.push(c[r]))})),x.push(g.length),new s({values:v,index:g,ptr:x,size:a,datatype:t._datatype})}function p(t,e,i,n){if(!e||!0!==e.isIndex)throw new TypeError("Invalid index");var r,o=e.size(),s=e.isScalar();if(m(i)?(r=i.size(),i=i.toArray()):r=wt(i),s){if(0!==r.length)throw new TypeError("Scalar expected");t.set(e.min(),i,n)}else{if(1!==o.length&&2!==o.length)throw new bt(o.length,t._size.length,"<");if(r.length<o.length){for(var a=0,h=0;1===o[a]&&1===r[a];)a++;for(;1===o[a];)h++,a++;i=Tt(i,o.length,h,r)}if(!U(o,r))throw new bt(o,r,">");for(var u=e.min()[0],c=e.min()[1],l=r[0],p=r[1],_=0;_<l;_++)for(var f=0;f<p;f++){var d=i[_][f];t.set([_+u,f+c],d,n)}}return t}function _(t,e,i,n){if(i-e==0)return i;for(var r=e;r<i;r++)if(n[r]===t)return r;return e}function f(t,e,i,n,r,o,s){r.splice(t,0,n),o.splice(t,0,e);for(var a=i+1;a<s.length;a++)s[a]++}function y(t,n,r,o){var s=o||0,a=i,h=0;u(t._datatype)&&(a=e.find(i,[t._datatype,t._datatype])||i,h=e.convert(0,t._datatype),s=e.convert(s,t._datatype));var c,m,l,p=!a(s,h),_=t._size[0],f=t._size[1];if(r>f){for(m=f;m<r;m++)if(t._ptr[m]=t._values.length,p)for(c=0;c<_;c++)t._values.push(s),t._index.push(c);t._ptr[r]=t._values.length}else r<f&&(t._ptr.splice(r+1,f-r),t._values.splice(t._ptr[r],t._values.length),t._index.splice(t._ptr[r],t._index.length));if(f=r,n>_){if(p){var d=0;for(m=0;m<f;m++){t._ptr[m]=t._ptr[m]+d,l=t._ptr[m+1]+d;var y=0;for(c=_;c<n;c++,y++)t._values.splice(l+y,0,s),t._index.splice(l+y,0,c),d++}t._ptr[f]=t._values.length}}else if(n<_){var v=0;for(m=0;m<f;m++){t._ptr[m]=t._ptr[m]-v;var g=t._ptr[m],x=t._ptr[m+1]-v;for(l=g;l<x;l++)(c=t._index[l])>n-1&&(t._values.splice(l,1),t._index.splice(l,1),v++)}t._ptr[m]=t._values.length}return t._size[0]=n,t._size[1]=r,t}function v(t,e,i,n,r){var o,s,a=n[0],h=n[1],u=[];for(o=0;o<a;o++)for(u[o]=[],s=0;s<h;s++)u[o][s]=0;for(s=0;s<h;s++)for(var c=i[s],m=i[s+1],l=c;l<m;l++)u[o=e[l]][s]=t?r?J(t[l]):t[l]:1;return u}return s.prototype=new n,s.prototype.createSparseMatrix=function(t,e){return new s(t,e)},s.prototype.type="SparseMatrix",s.prototype.isSparseMatrix=!0,s.prototype.getDataType=function(){return Dt(this._values,R)},s.prototype.storage=function(){return"sparse"},s.prototype.datatype=function(){return this._datatype},s.prototype.create=function(t,e){return new s(t,e)},s.prototype.density=function(){var t=this._size[0],e=this._size[1];return 0!==t&&0!==e?this._index.length/(t*e):0},s.prototype.subset=function(t,e,i){if(!this._values)throw new Error("Cannot invoke subset on a Pattern only matrix");switch(arguments.length){case 1:return h(this,t);case 2:case 3:return p(this,t,e,i);default:throw new SyntaxError("Wrong number of arguments")}},s.prototype.get=function(t){if(!c(t))throw new TypeError("Array expected");if(t.length!==this._size.length)throw new bt(t.length,this._size.length);if(!this._values)throw new Error("Cannot invoke get on a Pattern only matrix");var e=t[0],i=t[1];Ct(e,this._size[0]),Ct(i,this._size[1]);var n=_(e,this._ptr[i],this._ptr[i+1],this._index);return n<this._ptr[i+1]&&this._index[n]===e?this._values[n]:0},s.prototype.set=function(t,n,r){if(!c(t))throw new TypeError("Array expected");if(t.length!==this._size.length)throw new bt(t.length,this._size.length);if(!this._values)throw new Error("Cannot invoke set on a Pattern only matrix");var o=t[0],s=t[1],a=this._size[0],h=this._size[1],m=i,l=0;u(this._datatype)&&(m=e.find(i,[this._datatype,this._datatype])||i,l=e.convert(0,this._datatype)),(o>a-1||s>h-1)&&(y(this,Math.max(o+1,a),Math.max(s+1,h),r),a=this._size[0],h=this._size[1]),Ct(o,a),Ct(s,h);var p=_(o,this._ptr[s],this._ptr[s+1],this._index);return p<this._ptr[s+1]&&this._index[p]===o?m(n,l)?function(t,e,i,n,r){i.splice(t,1),n.splice(t,1);for(var o=e+1;o<r.length;o++)r[o]--}(p,s,this._values,this._index,this._ptr):this._values[p]=n:f(p,o,s,n,this._values,this._index,this._ptr),this},s.prototype.resize=function(t,e,i){if(!l(t))throw new TypeError("Array or Matrix expected");var n=t.valueOf().map((t=>Array.isArray(t)&&1===t.length?t[0]:t));if(2!==n.length)throw new Error("Only two dimensions matrix are supported");return n.forEach((function(t){if(!r(t)||!X(t)||t<0)throw new TypeError("Invalid size, must contain positive integers (size: "+gt(n)+")")})),y(i?this.clone():this,n[0],n[1],e)},s.prototype.reshape=function(t,e){if(!c(t))throw new TypeError("Array expected");if(2!==t.length)throw new Error("Sparse matrices can only be reshaped in two dimensions");t.forEach((function(e){if(!r(e)||!X(e)||e<=-2||0===e)throw new TypeError("Invalid size, must contain positive integers or -1 (size: "+gt(t)+")")}));var i=this._size[0]*this._size[1];if(i!==(t=Pt(t,i))[0]*t[1])throw new Error("Reshaping sparse matrix will result in the wrong number of elements");var n=e?this.clone():this;if(this._size[0]===t[0]&&this._size[1]===t[1])return n;for(var o=[],s=0;s<n._ptr.length;s++)for(var a=0;a<n._ptr[s+1]-n._ptr[s];a++)o.push(s);for(var h=n._values.slice(),u=n._index.slice(),m=0;m<n._index.length;m++){var l=u[m],p=o[m],d=l*n._size[1]+p;o[m]=d%t[1],u[m]=Math.floor(d/t[1])}n._values.length=0,n._index.length=0,n._ptr.length=t[1]+1,n._size=t.slice();for(var y=0;y<n._ptr.length;y++)n._ptr[y]=0;for(var v=0;v<h.length;v++){var g=u[v],x=o[v],b=h[v];f(_(g,n._ptr[x],n._ptr[x+1],n._index),g,x,b,n._values,n._index,n._ptr)}return n},s.prototype.clone=function(){return new s({values:this._values?J(this._values):void 0,index:J(this._index),ptr:J(this._ptr),size:J(this._size),datatype:this._datatype})},s.prototype.size=function(){return this._size.slice(0)},s.prototype.map=function(t,n){if(!this._values)throw new Error("Cannot invoke map on a Pattern only matrix");var r=this;return function(t,n,r,o,a,h,c){var m=[],l=[],p=[],_=i,f=0;u(t._datatype)&&(_=e.find(i,[t._datatype,t._datatype])||i,f=e.convert(0,t._datatype));for(var d=function(t,e,i){t=h(t,e,i),_(t,f)||(m.push(t),l.push(e))},y=0;y<=a;y++){p.push(m.length);var v=t._ptr[y],g=t._ptr[y+1];if(c)for(var x=v;x<g;x++){var b=t._index[x];b>=0&&b<=r&&d(t._values[x],b-0,y-0)}else{for(var A={},w=v;w<g;w++)A[t._index[w]]=t._values[w];for(var B=0;B<=r;B++)d(B in A?A[B]:0,B-0,y-0)}}return p.push(m.length),new s({values:m,index:l,ptr:p,size:[r-0+1,a-0+1]})}(this,0,this._size[0]-1,0,this._size[1]-1,(function(e,i,n){return t(e,[i,n],r)}),n)},s.prototype.forEach=function(t,e){if(!this._values)throw new Error("Cannot invoke forEach on a Pattern only matrix");for(var i=this._size[0],n=this._size[1],r=0;r<n;r++){var o=this._ptr[r],s=this._ptr[r+1];if(e)for(var a=o;a<s;a++){var h=this._index[a];t(this._values[a],[h,r],this)}else{for(var u={},c=o;c<s;c++)u[this._index[c]]=this._values[c];for(var m=0;m<i;m++)t(m in u?u[m]:0,[m,r],this)}}},s.prototype.toArray=function(){return v(this._values,this._index,this._ptr,this._size,!0)},s.prototype.valueOf=function(){return v(this._values,this._index,this._ptr,this._size,!1)},s.prototype.format=function(t){for(var e=this._size[0],i=this._size[1],n=this.density(),r="Sparse Matrix ["+gt(e,t)+" x "+gt(i,t)+"] density: "+gt(n,t)+"\n",o=0;o<i;o++)for(var s=this._ptr[o],a=this._ptr[o+1],h=s;h<a;h++)r+="\n    ("+gt(this._index[h],t)+", "+gt(o,t)+") ==> "+(this._values?gt(this._values[h],t):"X");return r},s.prototype.toString=function(){return gt(this.toArray())},s.prototype.toJSON=function(){return{mathjs:"SparseMatrix",values:this._values,index:this._index,ptr:this._ptr,size:this._size,datatype:this._datatype}},s.prototype.diagonal=function(t){if(t){if(o(t)&&(t=t.toNumber()),!r(t)||!X(t))throw new TypeError("The parameter k must be an integer number")}else t=0;var e=t>0?t:0,i=t<0?-t:0,n=this._size[0],a=this._size[1],h=Math.min(n-i,a-e),u=[],c=[],m=[];m[0]=0;for(var l=e;l<a&&u.length<h;l++)for(var p=this._ptr[l],_=this._ptr[l+1],f=p;f<_;f++){var d=this._index[f];if(d===l-e+i){u.push(this._values[f]),c[u.length-1]=d-i;break}}return m.push(u.length),new s({values:u,index:c,ptr:m,size:[h,1]})},s.fromJSON=function(t){return new s(t)},s.diagonal=function(t,n,a,h,l){if(!c(t))throw new TypeError("Array expected, size parameter");if(2!==t.length)throw new Error("Only two dimensions matrix are supported");if(t=t.map((function(t){if(o(t)&&(t=t.toNumber()),!r(t)||!X(t)||t<1)throw new Error("Size values must be positive integers");return t})),a){if(o(a)&&(a=a.toNumber()),!r(a)||!X(a))throw new TypeError("The parameter k must be an integer number")}else a=0;var p=i,_=0;u(l)&&(p=e.find(i,[l,l])||i,_=e.convert(0,l));var f,d=a>0?a:0,y=a<0?-a:0,v=t[0],g=t[1],x=Math.min(v-y,g-d);if(c(n)){if(n.length!==x)throw new Error("Invalid value array length");f=function(t){return n[t]}}else if(m(n)){var b=n.size();if(1!==b.length||b[0]!==x)throw new Error("Invalid matrix length");f=function(t){return n.get([t])}}else f=function(){return n};for(var A=[],w=[],B=[],M=0;M<g;M++){B.push(A.length);var C=M-d;if(C>=0&&C<x){var S=f(C);p(S,_)||(w.push(C+y),A.push(S))}}return B.push(A.length),new s({values:A,index:w,ptr:B,size:[v,g]})},s.prototype.swapRows=function(t,e){if(!(r(t)&&X(t)&&r(e)&&X(e)))throw new Error("Row index must be positive integers");if(2!==this._size.length)throw new Error("Only two dimensional matrix is supported");return Ct(t,this._size[0]),Ct(e,this._size[0]),s._swapRows(t,e,this._size[1],this._values,this._index,this._ptr),this},s._forEachRow=function(t,e,i,n,r){for(var o=n[t],s=n[t+1],a=o;a<s;a++)r(i[a],e[a])},s._swapRows=function(t,e,i,n,r,o){for(var s=0;s<i;s++){var a=o[s],h=o[s+1],u=_(t,a,h,r),c=_(e,a,h,r);if(u<h&&c<h&&r[u]===t&&r[c]===e){if(n){var m=n[u];n[u]=n[c],n[c]=m}}else if(u<h&&r[u]===t&&(c>=h||r[c]!==e)){var l=n?n[u]:void 0;r.splice(c,0,e),n&&n.splice(c,0,l),r.splice(c<=u?u+1:u,1),n&&n.splice(c<=u?u+1:u,1)}else if(c<h&&r[c]===e&&(u>=h||r[u]!==t)){var p=n?n[c]:void 0;r.splice(u,0,t),n&&n.splice(u,0,p),r.splice(u<=c?c+1:c,1),n&&n.splice(u<=c?c+1:c,1)}}},s}),{isClass:!0}),ce="matrix",me=Z(ce,["typed","Matrix","DenseMatrix","SparseMatrix"],(t=>{var{typed:e,Matrix:i,DenseMatrix:n,SparseMatrix:r}=t;return e(ce,{"":function(){return o([])},string:function(t){return o([],t)},"string, string":function(t,e){return o([],t,e)},Array:function(t){return o(t)},Matrix:function(t){return o(t,t.storage())},"Array | Matrix, string":o,"Array | Matrix, string, string":o});function o(t,e,i){if("dense"===e||"default"===e||void 0===e)return new n(t,i);if("sparse"===e)return new r(t,i);throw new TypeError("Unknown matrix type "+JSON.stringify(e)+".")}})),le=Z("algorithm01",["typed"],(t=>{var{typed:e}=t;return function(t,i,n,r){var o=t._data,s=t._size,a=t._datatype,h=i._values,u=i._index,c=i._ptr,m=i._size,l=i._datatype;if(s.length!==m.length)throw new bt(s.length,m.length);if(s[0]!==m[0]||s[1]!==m[1])throw new RangeError("Dimension mismatch. Matrix A ("+s+") must match Matrix B ("+m+")");if(!h)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var p,_,f=s[0],d=s[1],y="string"==typeof a&&a===l?a:void 0,v=y?e.find(n,[y,y]):n,g=[];for(p=0;p<f;p++)g[p]=[];var x=[],b=[];for(_=0;_<d;_++){for(var A=_+1,w=c[_],B=c[_+1],M=w;M<B;M++)x[p=u[M]]=r?v(h[M],o[p][_]):v(o[p][_],h[M]),b[p]=A;for(p=0;p<f;p++)b[p]===A?g[p][_]=x[p]:g[p][_]=o[p][_]}return t.createDenseMatrix({data:g,size:[f,d],datatype:y})}})),pe=Z("algorithm04",["typed","equalScalar"],(t=>{var{typed:e,equalScalar:i}=t;return function(t,n,r){var o=t._values,s=t._index,a=t._ptr,h=t._size,u=t._datatype,c=n._values,m=n._index,l=n._ptr,p=n._size,_=n._datatype;if(h.length!==p.length)throw new bt(h.length,p.length);if(h[0]!==p[0]||h[1]!==p[1])throw new RangeError("Dimension mismatch. Matrix A ("+h+") must match Matrix B ("+p+")");var f,d=h[0],y=h[1],v=i,g=0,x=r;"string"==typeof u&&u===_&&(f=u,v=e.find(i,[f,f]),g=e.convert(0,f),x=e.find(r,[f,f]));var b,A,w,B,M,C=o&&c?[]:void 0,S=[],z=[],I=o&&c?[]:void 0,P=o&&c?[]:void 0,E=[],N=[];for(A=0;A<y;A++){z[A]=S.length;var V=A+1;for(B=a[A],M=a[A+1],w=B;w<M;w++)b=s[w],S.push(b),E[b]=V,I&&(I[b]=o[w]);for(B=l[A],M=l[A+1],w=B;w<M;w++)if(E[b=m[w]]===V){if(I){var T=x(I[b],c[w]);v(T,g)?E[b]=null:I[b]=T}}else S.push(b),N[b]=V,P&&(P[b]=c[w]);if(I&&P)for(w=z[A];w<S.length;)E[b=S[w]]===V?(C[w]=I[b],w++):N[b]===V?(C[w]=P[b],w++):S.splice(w,1)}return z[y]=S.length,t.createSparseMatrix({values:C,index:S,ptr:z,size:[d,y],datatype:f})}})),_e=Z("algorithm10",["typed","DenseMatrix"],(t=>{var{typed:e,DenseMatrix:i}=t;return function(t,n,r,o){var s=t._values,a=t._index,h=t._ptr,u=t._size,c=t._datatype;if(!s)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var m,l=u[0],p=u[1],_=r;"string"==typeof c&&(m=c,n=e.convert(n,m),_=e.find(r,[m,m]));for(var f=[],d=[],y=[],v=0;v<p;v++){for(var g=v+1,x=h[v],b=h[v+1],A=x;A<b;A++){var w=a[A];d[w]=s[A],y[w]=g}for(var B=0;B<l;B++)0===v&&(f[B]=[]),y[B]===g?f[B][v]=o?_(n,d[B]):_(d[B],n):f[B][v]=n}return new i({data:f,size:[l,p],datatype:m})}})),fe=Z("algorithm13",["typed"],(t=>{var{typed:e}=t;return function(t,n,r){var o,s=t._data,a=t._size,h=t._datatype,u=n._data,c=n._size,m=n._datatype,l=[];if(a.length!==c.length)throw new bt(a.length,c.length);for(var p=0;p<a.length;p++){if(a[p]!==c[p])throw new RangeError("Dimension mismatch. Matrix A ("+a+") must match Matrix B ("+c+")");l[p]=a[p]}var _=r;"string"==typeof h&&h===m&&(o=h,_=e.find(r,[o,o]));var f=l.length>0?i(_,0,l,l[0],s,u):[];return t.createDenseMatrix({data:f,size:l,datatype:o})};function i(t,e,n,r,o,s){var a=[];if(e===n.length-1)for(var h=0;h<r;h++)a[h]=t(o[h],s[h]);else for(var u=0;u<r;u++)a[u]=i(t,e+1,n,n[e+1],o[u],s[u]);return a}})),de=Z("algorithm14",["typed"],(t=>{var{typed:e}=t;return function(t,n,r,o){var s,a=t._data,h=t._size,u=t._datatype,c=r;"string"==typeof u&&(s=u,n=e.convert(n,s),c=e.find(r,[s,s]));var m=h.length>0?i(c,0,h,h[0],a,n,o):[];return t.createDenseMatrix({data:m,size:J(h),datatype:s})};function i(t,e,n,r,o,s,a){var h=[];if(e===n.length-1)for(var u=0;u<r;u++)h[u]=a?t(s,o[u]):t(o[u],s);else for(var c=0;c<r;c++)h[c]=i(t,e+1,n,n[e+1],o[c],s,a);return h}})),ye=Z("algorithm02",["typed","equalScalar"],(t=>{var{typed:e,equalScalar:i}=t;return function(t,n,r,o){var s=t._data,a=t._size,h=t._datatype,u=n._values,c=n._index,m=n._ptr,l=n._size,p=n._datatype;if(a.length!==l.length)throw new bt(a.length,l.length);if(a[0]!==l[0]||a[1]!==l[1])throw new RangeError("Dimension mismatch. Matrix A ("+a+") must match Matrix B ("+l+")");if(!u)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var _,f=a[0],d=a[1],y=i,v=0,g=r;"string"==typeof h&&h===p&&(_=h,y=e.find(i,[_,_]),v=e.convert(0,_),g=e.find(r,[_,_]));for(var x=[],b=[],A=[],w=0;w<d;w++){A[w]=b.length;for(var B=m[w],M=m[w+1],C=B;C<M;C++){var S=c[C],z=o?g(u[C],s[S][w]):g(s[S][w],u[C]);y(z,v)||(b.push(S),x.push(z))}}return A[d]=b.length,n.createSparseMatrix({values:x,index:b,ptr:A,size:[f,d],datatype:_})}})),ve=Z("algorithm03",["typed"],(t=>{var{typed:e}=t;return function(t,i,n,r){var o=t._data,s=t._size,a=t._datatype,h=i._values,u=i._index,c=i._ptr,m=i._size,l=i._datatype;if(s.length!==m.length)throw new bt(s.length,m.length);if(s[0]!==m[0]||s[1]!==m[1])throw new RangeError("Dimension mismatch. Matrix A ("+s+") must match Matrix B ("+m+")");if(!h)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var p,_=s[0],f=s[1],d=0,y=n;"string"==typeof a&&a===l&&(p=a,d=e.convert(0,p),y=e.find(n,[p,p]));for(var v=[],g=0;g<_;g++)v[g]=[];for(var x=[],b=[],A=0;A<f;A++){for(var w=A+1,B=c[A],M=c[A+1],C=B;C<M;C++){var S=u[C];x[S]=r?y(h[C],o[S][A]):y(o[S][A],h[C]),b[S]=w}for(var z=0;z<_;z++)b[z]===w?v[z][A]=x[z]:v[z][A]=r?y(d,o[z][A]):y(o[z][A],d)}return t.createDenseMatrix({data:v,size:[_,f],datatype:p})}})),ge=Z("algorithm05",["typed","equalScalar"],(t=>{var{typed:e,equalScalar:i}=t;return function(t,n,r){var o=t._values,s=t._index,a=t._ptr,h=t._size,u=t._datatype,c=n._values,m=n._index,l=n._ptr,p=n._size,_=n._datatype;if(h.length!==p.length)throw new bt(h.length,p.length);if(h[0]!==p[0]||h[1]!==p[1])throw new RangeError("Dimension mismatch. Matrix A ("+h+") must match Matrix B ("+p+")");var f,d=h[0],y=h[1],v=i,g=0,x=r;"string"==typeof u&&u===_&&(f=u,v=e.find(i,[f,f]),g=e.convert(0,f),x=e.find(r,[f,f]));var b,A,w,B,M=o&&c?[]:void 0,C=[],S=[],z=M?[]:void 0,I=M?[]:void 0,P=[],E=[];for(A=0;A<y;A++){S[A]=C.length;var N=A+1;for(w=a[A],B=a[A+1];w<B;w++)b=s[w],C.push(b),P[b]=N,z&&(z[b]=o[w]);for(w=l[A],B=l[A+1];w<B;w++)P[b=m[w]]!==N&&C.push(b),E[b]=N,I&&(I[b]=c[w]);if(M)for(w=S[A];w<C.length;){var V=P[b=C[w]],T=E[b];if(V===N||T===N){var F=x(V===N?z[b]:g,T===N?I[b]:g);v(F,g)?C.splice(w,1):(M.push(F),w++)}}}return S[y]=C.length,t.createSparseMatrix({values:M,index:C,ptr:S,size:[d,y],datatype:f})}})),xe=Z("algorithm11",["typed","equalScalar"],(t=>{var{typed:e,equalScalar:i}=t;return function(t,n,r,o){var s=t._values,a=t._index,h=t._ptr,u=t._size,c=t._datatype;if(!s)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var m,l=u[0],p=u[1],_=i,f=0,d=r;"string"==typeof c&&(m=c,_=e.find(i,[m,m]),f=e.convert(0,m),n=e.convert(n,m),d=e.find(r,[m,m]));for(var y=[],v=[],g=[],x=0;x<p;x++){g[x]=v.length;for(var b=h[x],A=h[x+1],w=b;w<A;w++){var B=a[w],M=o?d(n,s[w]):d(s[w],n);_(M,f)||(v.push(B),y.push(M))}}return g[p]=v.length,t.createSparseMatrix({values:y,index:v,ptr:g,size:[l,p],datatype:m})}})),be=Z("algorithm12",["typed","DenseMatrix"],(t=>{var{typed:e,DenseMatrix:i}=t;return function(t,n,r,o){var s=t._values,a=t._index,h=t._ptr,u=t._size,c=t._datatype;if(!s)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var m,l=u[0],p=u[1],_=r;"string"==typeof c&&(m=c,n=e.convert(n,m),_=e.find(r,[m,m]));for(var f=[],d=[],y=[],v=0;v<p;v++){for(var g=v+1,x=h[v],b=h[v+1],A=x;A<b;A++){var w=a[A];d[w]=s[A],y[w]=g}for(var B=0;B<l;B++)0===v&&(f[B]=[]),y[B]===g?f[B][v]=o?_(n,d[B]):_(d[B],n):f[B][v]=o?_(n,0):_(0,n)}return new i({data:f,size:[l,p],datatype:m})}})),Ae=Z("mod",["typed","matrix","equalScalar","DenseMatrix"],(t=>{var{typed:e,matrix:i,equalScalar:n,DenseMatrix:r}=t,o=ye({typed:e,equalScalar:n}),s=ve({typed:e}),a=ge({typed:e,equalScalar:n}),h=xe({typed:e,equalScalar:n}),u=be({typed:e,DenseMatrix:r}),c=fe({typed:e}),m=de({typed:e});return e("mod",{"number, number":Qt,"BigNumber, BigNumber":function(t,e){if(e.isNeg())throw new Error("Cannot calculate mod for a negative divisor");return e.isZero()?t:t.mod(e)},"Fraction, Fraction":function(t,e){if(e.compare(0)<0)throw new Error("Cannot calculate mod for a negative divisor");return t.compare(0)>=0?t.mod(e):t.mod(e).add(e).mod(e)},"SparseMatrix, SparseMatrix":function(t,e){return a(t,e,this,!1)},"SparseMatrix, DenseMatrix":function(t,e){return o(e,t,this,!0)},"DenseMatrix, SparseMatrix":function(t,e){return s(t,e,this,!1)},"DenseMatrix, DenseMatrix":function(t,e){return c(t,e,this)},"Array, Array":function(t,e){return this(i(t),i(e)).valueOf()},"Array, Matrix":function(t,e){return this(i(t),e)},"Matrix, Array":function(t,e){return this(t,i(e))},"SparseMatrix, any":function(t,e){return h(t,e,this,!1)},"DenseMatrix, any":function(t,e){return m(t,e,this,!1)},"any, SparseMatrix":function(t,e){return u(e,t,this,!0)},"any, DenseMatrix":function(t,e){return m(e,t,this,!0)},"Array, any":function(t,e){return m(i(t),e,this,!1).valueOf()},"any, Array":function(t,e){return m(i(e),t,this,!0).valueOf()}})})),we=Z("algorithm07",["typed","DenseMatrix"],(t=>{var{typed:e,DenseMatrix:i}=t;return function(t,r,o){var s=t._size,a=t._datatype,h=r._size,u=r._datatype;if(s.length!==h.length)throw new bt(s.length,h.length);if(s[0]!==h[0]||s[1]!==h[1])throw new RangeError("Dimension mismatch. Matrix A ("+s+") must match Matrix B ("+h+")");var c,m,l,p=s[0],_=s[1],f=0,d=o;"string"==typeof a&&a===u&&(c=a,f=e.convert(0,c),d=e.find(o,[c,c]));var y=[];for(m=0;m<p;m++)y[m]=[];var v=[],g=[],x=[],b=[];for(l=0;l<_;l++){var A=l+1;for(n(t,l,x,v,A),n(r,l,b,g,A),m=0;m<p;m++){var w=x[m]===A?v[m]:f,B=b[m]===A?g[m]:f;y[m][l]=d(w,B)}}return new i({data:y,size:[p,_],datatype:c})};function n(t,e,i,n,r){for(var o=t._values,s=t._index,a=t._ptr,h=a[e],u=a[e+1];h<u;h++){var c=s[h];i[c]=r,n[c]=o[h]}}}));function Be(){throw new Error('No "matrix" implementation available')}var Me="size",Ce=Z(Me,["typed","config","?matrix"],(t=>{var{typed:e,config:i,matrix:n}=t;return e(Me,{Matrix:function(t){return t.create(t.size())},Array:wt,string:function(t){return"Array"===i.matrix?[t.length]:n([t.length])},"number | Complex | BigNumber | Unit | boolean | null":function(t){return"Array"===i.matrix?[]:n?n([]):Be()}})}));function Se(t,e){return!(!t||"object"!=typeof t||!W(Ie,e)&&(e in Object.prototype||e in Function.prototype))}function ze(t){return"object"==typeof t&&t&&t.constructor===Object}var Ie={length:!0,name:!0},Pe={toString:!0,valueOf:!0,toLocaleString:!0},Ee="subset",Ne=Z(Ee,["typed","matrix"],(t=>{var{typed:e,matrix:i}=t;return e(Ee,{"Array, Index":function(t,e){var n=i(t).subset(e);return e.isScalar()?n:n.valueOf()},"Matrix, Index":function(t,e){return t.subset(e)},"Object, Index":Fe,"string, Index":Ve,"Array, Index, any":function(t,e,n){return i(J(t)).subset(e,n,void 0).valueOf()},"Array, Index, any, any":function(t,e,n,r){return i(J(t)).subset(e,n,r).valueOf()},"Matrix, Index, any":function(t,e,i){return t.clone().subset(e,i)},"Matrix, Index, any, any":function(t,e,i,n){return t.clone().subset(e,i,n)},"string, Index, string":Te,"string, Index, string, string":Te,"Object, Index, any":De})}));function Ve(t,e){if(!d(e))throw new TypeError("Index expected");if(1!==e.size().length)throw new bt(e.size().length,1);var i=t.length;Ct(e.min()[0],i),Ct(e.max()[0],i);var n=e.dimension(0),r="";return n.forEach((function(e){r+=t.charAt(e)})),r}function Te(t,e,i,n){if(!e||!0!==e.isIndex)throw new TypeError("Index expected");if(1!==e.size().length)throw new bt(e.size().length,1);if(void 0!==n){if("string"!=typeof n||1!==n.length)throw new TypeError("Single character expected as defaultValue")}else n=" ";var r=e.dimension(0);if(r.size()[0]!==i.length)throw new bt(r.size()[0],i.length);var o=t.length;Ct(e.min()[0]),Ct(e.max()[0]);for(var s=[],a=0;a<o;a++)s[a]=t.charAt(a);if(r.forEach((function(t,e){s[t]=i.charAt(e[0])})),s.length>o)for(var h=o-1,u=s.length;h<u;h++)s[h]||(s[h]=n);return s.join("")}function Fe(t,e){if(1!==e.size().length)throw new bt(e.size(),1);var i=e.dimension(0);if("string"!=typeof i)throw new TypeError("String expected as index to retrieve an object property");return function(t,e){if(ze(t)&&Se(t,e))return t[e];if("function"==typeof t[e]&&function(t,e){return!(null==t||"function"!=typeof t[e]||W(t,e)&&Object.getPrototypeOf&&e in Object.getPrototypeOf(t)||!W(Pe,e)&&(e in Object.prototype||e in Function.prototype))}(t,e))throw new Error('Cannot access method "'+e+'" as a property');throw new Error('No access to property "'+e+'"')}(t,i)}function De(t,e,i){if(1!==e.size().length)throw new bt(e.size(),1);var n=e.dimension(0);if("string"!=typeof n)throw new TypeError("String expected as index to retrieve an object property");var r=J(t);return function(t,e,i){if(ze(t)&&Se(t,e))return t[e]=i,i;throw new Error('No access to property "'+e+'"')}(r,n,i),r}Z("hex",["typed","format"],(t=>{var{typed:e,format:i}=t;return e("hex",{"number | BigNumber":function(t){return i(t,{notation:"hex"})},"number | BigNumber, number":function(t,e){return i(t,{notation:"hex",wordSize:e})}})}));var qe="smaller",Le=Z(qe,["typed","config","matrix","DenseMatrix"],(t=>{var{typed:e,config:i,matrix:n,DenseMatrix:r}=t,o=ve({typed:e}),s=we({typed:e,DenseMatrix:r}),a=be({typed:e,DenseMatrix:r}),h=fe({typed:e}),u=de({typed:e});return e(qe,{"boolean, boolean":function(t,e){return t<e},"number, number":function(t,e){return t<e&&!ot(t,e,i.epsilon)},"BigNumber, BigNumber":function(t,e){return t.lt(e)&&!Ut(t,e,i.epsilon)},"Fraction, Fraction":function(t,e){return-1===t.compare(e)},"Complex, Complex":function(t,e){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(t,e){if(!t.equalBase(e))throw new Error("Cannot compare units with different base");return this(t.value,e.value)},"SparseMatrix, SparseMatrix":function(t,e){return s(t,e,this)},"SparseMatrix, DenseMatrix":function(t,e){return o(e,t,this,!0)},"DenseMatrix, SparseMatrix":function(t,e){return o(t,e,this,!1)},"DenseMatrix, DenseMatrix":function(t,e){return h(t,e,this)},"Array, Array":function(t,e){return this(n(t),n(e)).valueOf()},"Array, Matrix":function(t,e){return this(n(t),e)},"Matrix, Array":function(t,e){return this(t,n(e))},"SparseMatrix, any":function(t,e){return a(t,e,this,!1)},"DenseMatrix, any":function(t,e){return u(t,e,this,!1)},"any, SparseMatrix":function(t,e){return a(e,t,this,!0)},"any, DenseMatrix":function(t,e){return u(e,t,this,!0)},"Array, any":function(t,e){return u(n(t),e,this,!1).valueOf()},"any, Array":function(t,e){return u(n(e),t,this,!0).valueOf()}})})),Oe="larger",ke=Z(Oe,["typed","config","matrix","DenseMatrix"],(t=>{var{typed:e,config:i,matrix:n,DenseMatrix:r}=t,o=ve({typed:e}),s=we({typed:e,DenseMatrix:r}),a=be({typed:e,DenseMatrix:r}),h=fe({typed:e}),u=de({typed:e});return e(Oe,{"boolean, boolean":function(t,e){return t>e},"number, number":function(t,e){return t>e&&!ot(t,e,i.epsilon)},"BigNumber, BigNumber":function(t,e){return t.gt(e)&&!Ut(t,e,i.epsilon)},"Fraction, Fraction":function(t,e){return 1===t.compare(e)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(t,e){if(!t.equalBase(e))throw new Error("Cannot compare units with different base");return this(t.value,e.value)},"SparseMatrix, SparseMatrix":function(t,e){return s(t,e,this)},"SparseMatrix, DenseMatrix":function(t,e){return o(e,t,this,!0)},"DenseMatrix, SparseMatrix":function(t,e){return o(t,e,this,!1)},"DenseMatrix, DenseMatrix":function(t,e){return h(t,e,this)},"Array, Array":function(t,e){return this(n(t),n(e)).valueOf()},"Array, Matrix":function(t,e){return this(n(t),e)},"Matrix, Array":function(t,e){return this(t,n(e))},"SparseMatrix, any":function(t,e){return a(t,e,this,!1)},"DenseMatrix, any":function(t,e){return u(t,e,this,!1)},"any, SparseMatrix":function(t,e){return a(e,t,this,!0)},"any, DenseMatrix":function(t,e){return u(e,t,this,!0)},"Array, any":function(t,e){return u(n(t),e,this,!1).valueOf()},"any, Array":function(t,e){return u(n(e),t,this,!0).valueOf()}})})),je="unequal",Re=(Z(je,["typed","equalScalar"],(t=>{var{typed:e,equalScalar:i}=t;return e(je,{"any, any":function(t,e){return null===t?null!==e:null===e?null!==t:void 0===t?void 0!==e:void 0===e?void 0!==t:!i(t,e)}})})),Z("ImmutableDenseMatrix",["smaller","DenseMatrix"],(t=>{var{smaller:e,DenseMatrix:i}=t;function n(t,e){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if(e&&!u(e))throw new Error("Invalid datatype: "+e);if(m(t)||c(t)){var r=new i(t,e);this._data=r._data,this._size=r._size,this._datatype=r._datatype,this._min=null,this._max=null}else if(t&&c(t.data)&&c(t.size))this._data=t.data,this._size=t.size,this._datatype=t.datatype,this._min=void 0!==t.min?t.min:null,this._max=void 0!==t.max?t.max:null;else{if(t)throw new TypeError("Unsupported type of data ("+R(t)+")");this._data=[],this._size=[0],this._datatype=e,this._min=null,this._max=null}}return n.prototype=new i,n.prototype.type="ImmutableDenseMatrix",n.prototype.isImmutableDenseMatrix=!0,n.prototype.subset=function(t){switch(arguments.length){case 1:var e=i.prototype.subset.call(this,t);return m(e)?new n({data:e._data,size:e._size,datatype:e._datatype}):e;case 2:case 3:throw new Error("Cannot invoke set subset on an Immutable Matrix instance");default:throw new SyntaxError("Wrong number of arguments")}},n.prototype.set=function(){throw new Error("Cannot invoke set on an Immutable Matrix instance")},n.prototype.resize=function(){throw new Error("Cannot invoke resize on an Immutable Matrix instance")},n.prototype.reshape=function(){throw new Error("Cannot invoke reshape on an Immutable Matrix instance")},n.prototype.clone=function(){return new n({data:J(this._data),size:J(this._size),datatype:this._datatype})},n.prototype.toJSON=function(){return{mathjs:"ImmutableDenseMatrix",data:this._data,size:this._size,datatype:this._datatype}},n.fromJSON=function(t){return new n(t)},n.prototype.swapRows=function(){throw new Error("Cannot invoke swapRows on an Immutable Matrix instance")},n.prototype.min=function(){if(null===this._min){var t=null;this.forEach((function(i){(null===t||e(i,t))&&(t=i)})),this._min=null!==t?t:void 0}return this._min},n.prototype.max=function(){if(null===this._max){var t=null;this.forEach((function(i){(null===t||e(t,i))&&(t=i)})),this._max=null!==t?t:void 0}return this._max},n}),{isClass:!0})),Je=Z("add",["typed","matrix","addScalar","equalScalar","DenseMatrix","SparseMatrix"],(t=>{var{typed:e,matrix:i,addScalar:n,equalScalar:r,DenseMatrix:o,SparseMatrix:s}=t,a=le({typed:e}),h=pe({typed:e,equalScalar:r}),u=_e({typed:e,DenseMatrix:o}),c=fe({typed:e}),m=de({typed:e});return e("add",Y({"DenseMatrix, DenseMatrix":function(t,e){return c(t,e,n)},"DenseMatrix, SparseMatrix":function(t,e){return a(t,e,n,!1)},"SparseMatrix, DenseMatrix":function(t,e){return a(e,t,n,!0)},"SparseMatrix, SparseMatrix":function(t,e){return h(t,e,n)},"Array, Array":function(t,e){return this(i(t),i(e)).valueOf()},"Array, Matrix":function(t,e){return this(i(t),e)},"Matrix, Array":function(t,e){return this(t,i(e))},"DenseMatrix, any":function(t,e){return m(t,e,n,!1)},"SparseMatrix, any":function(t,e){return u(t,e,n,!1)},"any, DenseMatrix":function(t,e){return m(e,t,n,!0)},"any, SparseMatrix":function(t,e){return u(e,t,n,!0)},"Array, any":function(t,e){return m(i(t),e,n,!1).valueOf()},"any, Array":function(t,e){return m(i(e),t,n,!0).valueOf()},"any, any":n,"any, any, ...any":function(t,e,i){for(var n=this(t,e),r=0;r<i.length;r++)n=this(n,i[r]);return n}},n.signatures))})),Ye=Z("dot",["typed","addScalar","multiplyScalar","conj","size"],(t=>{var{typed:e,addScalar:i,multiplyScalar:n,conj:r,size:o}=t;return e("dot",{"Array | DenseMatrix, Array | DenseMatrix":function(t,o){var h=s(t,o),u=m(t)?t._data:t,c=m(t)?t._datatype:void 0,l=m(o)?o._data:o,p=m(o)?o._datatype:void 0,_=2===a(t).length,f=2===a(o).length,d=i,y=n;if(c&&p&&c===p&&"string"==typeof c){var v=c;d=e.find(i,[v,v]),y=e.find(n,[v,v])}if(!_&&!f){for(var g=y(r(u[0]),l[0]),x=1;x<h;x++)g=d(g,y(r(u[x]),l[x]));return g}if(!_&&f){for(var b=y(r(u[0]),l[0][0]),A=1;A<h;A++)b=d(b,y(r(u[A]),l[A][0]));return b}if(_&&!f){for(var w=y(r(u[0][0]),l[0]),B=1;B<h;B++)w=d(w,y(r(u[B][0]),l[B]));return w}if(_&&f){for(var M=y(r(u[0][0]),l[0][0]),C=1;C<h;C++)M=d(M,y(r(u[C][0]),l[C][0]));return M}},"SparseMatrix, SparseMatrix":function(t,e){s(t,e);for(var r=t._index,o=t._values,a=e._index,h=e._values,u=0,c=i,m=n,l=0,p=0;l<r.length&&p<a.length;){var _=r[l],f=a[p];_<f?l++:_>f?p++:_===f&&(u=c(u,m(o[l],h[p])),l++,p++)}return u}});function s(t,e){var i,n,r=a(t),o=a(e);if(1===r.length)i=r[0];else{if(2!==r.length||1!==r[1])throw new RangeError("Expected a column vector, instead got a matrix of size ("+r.join(", ")+")");i=r[0]}if(1===o.length)n=o[0];else{if(2!==o.length||1!==o[1])throw new RangeError("Expected a column vector, instead got a matrix of size ("+o.join(", ")+")");n=o[0]}if(i!==n)throw new RangeError("Vectors must have equal length ("+i+" != "+n+")");if(0===i)throw new RangeError("Cannot calculate the dot product of empty vectors");return i}function a(t){return m(t)?t.size():o(t)}})),Ue="multiply",We=Z(Ue,["typed","matrix","addScalar","multiplyScalar","equalScalar","dot"],(t=>{var{typed:e,matrix:i,addScalar:n,multiplyScalar:r,equalScalar:o,dot:s}=t,a=xe({typed:e,equalScalar:o}),h=de({typed:e});function u(t,e){switch(t.length){case 1:switch(e.length){case 1:if(t[0]!==e[0])throw new RangeError("Dimension mismatch in multiplication. Vectors must have the same length");break;case 2:if(t[0]!==e[0])throw new RangeError("Dimension mismatch in multiplication. Vector length ("+t[0]+") must match Matrix rows ("+e[0]+")");break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+e.length+" dimensions)")}break;case 2:switch(e.length){case 1:if(t[1]!==e[0])throw new RangeError("Dimension mismatch in multiplication. Matrix columns ("+t[1]+") must match Vector length ("+e[0]+")");break;case 2:if(t[1]!==e[0])throw new RangeError("Dimension mismatch in multiplication. Matrix A columns ("+t[1]+") must match Matrix B rows ("+e[0]+")");break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+e.length+" dimensions)")}break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix A has "+t.length+" dimensions)")}}var c=e("_multiplyMatrixVector",{"DenseMatrix, any":function(t,i){var o,s=t._data,a=t._size,h=t._datatype,u=i._data,c=i._datatype,m=a[0],l=a[1],p=n,_=r;h&&c&&h===c&&"string"==typeof h&&(o=h,p=e.find(n,[o,o]),_=e.find(r,[o,o]));for(var f=[],d=0;d<m;d++){for(var y=s[d],v=_(y[0],u[0]),g=1;g<l;g++)v=p(v,_(y[g],u[g]));f[d]=v}return t.createDenseMatrix({data:f,size:[m],datatype:o})},"SparseMatrix, any":function(t,i){var s=t._values,a=t._index,h=t._ptr,u=t._datatype;if(!s)throw new Error("Cannot multiply Pattern only Matrix times Dense Matrix");var c,m=i._data,l=i._datatype,p=t._size[0],_=i._size[0],f=[],d=[],y=[],v=n,g=r,x=o,b=0;u&&l&&u===l&&"string"==typeof u&&(c=u,v=e.find(n,[c,c]),g=e.find(r,[c,c]),x=e.find(o,[c,c]),b=e.convert(0,c));var A=[],w=[];y[0]=0;for(var B=0;B<_;B++){var M=m[B];if(!x(M,b))for(var C=h[B],S=h[B+1],z=C;z<S;z++){var I=a[z];w[I]?A[I]=v(A[I],g(M,s[z])):(w[I]=!0,d.push(I),A[I]=g(M,s[z]))}}for(var P=d.length,E=0;E<P;E++){var N=d[E];f[E]=A[N]}return y[1]=d.length,t.createSparseMatrix({values:f,index:d,ptr:y,size:[p,1],datatype:c})}}),l=e("_multiplyMatrixMatrix",{"DenseMatrix, DenseMatrix":function(t,i){var o,s=t._data,a=t._size,h=t._datatype,u=i._data,c=i._size,m=i._datatype,l=a[0],p=a[1],_=c[1],f=n,d=r;h&&m&&h===m&&"string"==typeof h&&(o=h,f=e.find(n,[o,o]),d=e.find(r,[o,o]));for(var y=[],v=0;v<l;v++){var g=s[v];y[v]=[];for(var x=0;x<_;x++){for(var b=d(g[0],u[0][x]),A=1;A<p;A++)b=f(b,d(g[A],u[A][x]));y[v][x]=b}}return t.createDenseMatrix({data:y,size:[l,_],datatype:o})},"DenseMatrix, SparseMatrix":function(t,i){var s=t._data,a=t._size,h=t._datatype,u=i._values,c=i._index,m=i._ptr,l=i._size,p=i._datatype;if(!u)throw new Error("Cannot multiply Dense Matrix times Pattern only Matrix");var _,f=a[0],d=l[1],y=n,v=r,g=o,x=0;h&&p&&h===p&&"string"==typeof h&&(_=h,y=e.find(n,[_,_]),v=e.find(r,[_,_]),g=e.find(o,[_,_]),x=e.convert(0,_));for(var b=[],A=[],w=[],B=i.createSparseMatrix({values:b,index:A,ptr:w,size:[f,d],datatype:_}),M=0;M<d;M++){w[M]=A.length;var C=m[M],S=m[M+1];if(S>C)for(var z=0,I=0;I<f;I++){for(var P=I+1,E=void 0,N=C;N<S;N++){var V=c[N];z!==P?(E=v(s[I][V],u[N]),z=P):E=y(E,v(s[I][V],u[N]))}z!==P||g(E,x)||(A.push(I),b.push(E))}}return w[d]=A.length,B},"SparseMatrix, DenseMatrix":function(t,i){var s=t._values,a=t._index,h=t._ptr,u=t._datatype;if(!s)throw new Error("Cannot multiply Pattern only Matrix times Dense Matrix");var c,m=i._data,l=i._datatype,p=t._size[0],_=i._size[0],f=i._size[1],d=n,y=r,v=o,g=0;u&&l&&u===l&&"string"==typeof u&&(c=u,d=e.find(n,[c,c]),y=e.find(r,[c,c]),v=e.find(o,[c,c]),g=e.convert(0,c));for(var x=[],b=[],A=[],w=t.createSparseMatrix({values:x,index:b,ptr:A,size:[p,f],datatype:c}),B=[],M=[],C=0;C<f;C++){A[C]=b.length;for(var S=C+1,z=0;z<_;z++){var I=m[z][C];if(!v(I,g))for(var P=h[z],E=h[z+1],N=P;N<E;N++){var V=a[N];M[V]!==S?(M[V]=S,b.push(V),B[V]=y(I,s[N])):B[V]=d(B[V],y(I,s[N]))}}for(var T=A[C],F=b.length,D=T;D<F;D++){var q=b[D];x[D]=B[q]}}return A[f]=b.length,w},"SparseMatrix, SparseMatrix":function(t,i){var o,s=t._values,a=t._index,h=t._ptr,u=t._datatype,c=i._values,m=i._index,l=i._ptr,p=i._datatype,_=t._size[0],f=i._size[1],d=s&&c,y=n,v=r;u&&p&&u===p&&"string"==typeof u&&(o=u,y=e.find(n,[o,o]),v=e.find(r,[o,o]));for(var g,x,b,A,w,B,M,C,S=d?[]:void 0,z=[],I=[],P=t.createSparseMatrix({values:S,index:z,ptr:I,size:[_,f],datatype:o}),E=d?[]:void 0,N=[],V=0;V<f;V++){I[V]=z.length;var T=V+1;for(w=l[V],B=l[V+1],A=w;A<B;A++)if(C=m[A],d)for(x=h[C],b=h[C+1],g=x;g<b;g++)N[M=a[g]]!==T?(N[M]=T,z.push(M),E[M]=v(c[A],s[g])):E[M]=y(E[M],v(c[A],s[g]));else for(x=h[C],b=h[C+1],g=x;g<b;g++)N[M=a[g]]!==T&&(N[M]=T,z.push(M));if(d)for(var F=I[V],D=z.length,q=F;q<D;q++){var L=z[q];S[q]=E[L]}}return I[f]=z.length,P}});return e(Ue,Y({"Array, Array":function(t,e){u(wt(t),wt(e));var n=this(i(t),i(e));return m(n)?n.valueOf():n},"Matrix, Matrix":function(t,i){var o=t.size(),a=i.size();return u(o,a),1===o.length?1===a.length?function(t,e,i){if(0===i)throw new Error("Cannot multiply two empty vectors");return s(t,e)}(t,i,o[0]):function(t,i){if("dense"!==i.storage())throw new Error("Support for SparseMatrix not implemented");return function(t,i){var o,s=t._data,a=t._size,h=t._datatype,u=i._data,c=i._size,m=i._datatype,l=a[0],p=c[1],_=n,f=r;h&&m&&h===m&&"string"==typeof h&&(o=h,_=e.find(n,[o,o]),f=e.find(r,[o,o]));for(var d=[],y=0;y<p;y++){for(var v=f(s[0],u[0][y]),g=1;g<l;g++)v=_(v,f(s[g],u[g][y]));d[y]=v}return t.createDenseMatrix({data:d,size:[p],datatype:o})}(t,i)}(t,i):1===a.length?c(t,i):l(t,i)},"Matrix, Array":function(t,e){return this(t,i(e))},"Array, Matrix":function(t,e){return this(i(t,e.storage()),e)},"SparseMatrix, any":function(t,e){return a(t,e,r,!1)},"DenseMatrix, any":function(t,e){return h(t,e,r,!1)},"any, SparseMatrix":function(t,e){return a(e,t,r,!0)},"any, DenseMatrix":function(t,e){return h(e,t,r,!0)},"Array, any":function(t,e){return h(i(t),e,r,!1).valueOf()},"any, Array":function(t,e){return h(i(e),t,r,!0).valueOf()},"any, any":r,"any, any, ...any":function(t,e,i){for(var n=this(t,e),r=0;r<i.length;r++)n=this(n,i[r]);return n}},r.signatures))}));function Ze(t,e,i,n){if(!(this instanceof Ze))throw new SyntaxError("Constructor must be called with the new operator");this.fn=t,this.count=e,this.min=i,this.max=n,this.message="Wrong number of arguments in function "+t+" ("+e+" provided, "+i+(null!=n?"-"+n:"")+" expected)",this.stack=(new Error).stack}Ze.prototype=new Error,Ze.prototype.constructor=Error,Ze.prototype.name="ArgumentsError",Ze.prototype.isArgumentsError=!0;var He="squeeze",Ge=Z(He,["typed","matrix"],(t=>{var{typed:e,matrix:i}=t;return e(He,{Array:function(t){return Nt(J(t))},Matrix:function(t){var e=Nt(t.toArray());return Array.isArray(e)?i(e):e},any:function(t){return J(t)}})}));i(228);var Xe="largerEq",Ke=Z(Xe,["typed","config","matrix","DenseMatrix"],(t=>{var{typed:e,config:i,matrix:n,DenseMatrix:r}=t,o=ve({typed:e}),s=we({typed:e,DenseMatrix:r}),a=be({typed:e,DenseMatrix:r}),h=fe({typed:e}),u=de({typed:e});return e(Xe,{"boolean, boolean":function(t,e){return t>=e},"number, number":function(t,e){return t>=e||ot(t,e,i.epsilon)},"BigNumber, BigNumber":function(t,e){return t.gte(e)||Ut(t,e,i.epsilon)},"Fraction, Fraction":function(t,e){return-1!==t.compare(e)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(t,e){if(!t.equalBase(e))throw new Error("Cannot compare units with different base");return this(t.value,e.value)},"SparseMatrix, SparseMatrix":function(t,e){return s(t,e,this)},"SparseMatrix, DenseMatrix":function(t,e){return o(e,t,this,!0)},"DenseMatrix, SparseMatrix":function(t,e){return o(t,e,this,!1)},"DenseMatrix, DenseMatrix":function(t,e){return h(t,e,this)},"Array, Array":function(t,e){return this(n(t),n(e)).valueOf()},"Array, Matrix":function(t,e){return this(n(t),e)},"Matrix, Array":function(t,e){return this(t,n(e))},"SparseMatrix, any":function(t,e){return a(t,e,this,!1)},"DenseMatrix, any":function(t,e){return u(t,e,this,!1)},"any, SparseMatrix":function(t,e){return a(e,t,this,!0)},"any, DenseMatrix":function(t,e){return u(e,t,this,!0)},"Array, any":function(t,e){return u(n(t),e,this,!1).valueOf()},"any, Array":function(t,e){return u(n(e),t,this,!0).valueOf()}})})),$e=Z("Index",["ImmutableDenseMatrix"],(t=>{var{ImmutableDenseMatrix:e}=t;function i(t){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");this._dimensions=[],this._isScalar=!0;for(var e=0,r=arguments.length;e<r;e++){var o=arguments[e];if(f(o))this._dimensions.push(o),this._isScalar=!1;else if(Array.isArray(o)||m(o)){var s=n(o.valueOf());this._dimensions.push(s);var a=s.size();1===a.length&&1===a[0]||(this._isScalar=!1)}else if("number"==typeof o)this._dimensions.push(n([o]));else{if("string"!=typeof o)throw new TypeError("Dimension must be an Array, Matrix, number, string, or Range");this._dimensions.push(o)}}}function n(t){for(var i=0,n=t.length;i<n;i++)if("number"!=typeof t[i]||!X(t[i]))throw new TypeError("Index parameters must be positive integer numbers");return new e(t)}return i.prototype.type="Index",i.prototype.isIndex=!0,i.prototype.clone=function(){var t=new i;return t._dimensions=J(this._dimensions),t._isScalar=this._isScalar,t},i.create=function(t){var e=new i;return i.apply(e,t),e},i.prototype.size=function(){for(var t=[],e=0,i=this._dimensions.length;e<i;e++){var n=this._dimensions[e];t[e]="string"==typeof n?1:n.size()[0]}return t},i.prototype.max=function(){for(var t=[],e=0,i=this._dimensions.length;e<i;e++){var n=this._dimensions[e];t[e]="string"==typeof n?n:n.max()}return t},i.prototype.min=function(){for(var t=[],e=0,i=this._dimensions.length;e<i;e++){var n=this._dimensions[e];t[e]="string"==typeof n?n:n.min()}return t},i.prototype.forEach=function(t){for(var e=0,i=this._dimensions.length;e<i;e++)t(this._dimensions[e],e,this)},i.prototype.dimension=function(t){return this._dimensions[t]||null},i.prototype.isObjectProperty=function(){return 1===this._dimensions.length&&"string"==typeof this._dimensions[0]},i.prototype.getObjectProperty=function(){return this.isObjectProperty()?this._dimensions[0]:null},i.prototype.isScalar=function(){return this._isScalar},i.prototype.toArray=function(){for(var t=[],e=0,i=this._dimensions.length;e<i;e++){var n=this._dimensions[e];t.push("string"==typeof n?n:n.toArray())}return t},i.prototype.valueOf=i.prototype.toArray,i.prototype.toString=function(){for(var t=[],e=0,i=this._dimensions.length;e<i;e++){var n=this._dimensions[e];"string"==typeof n?t.push(JSON.stringify(n)):t.push(n.toString())}return"["+t.join(", ")+"]"},i.prototype.toJSON=function(){return{mathjs:"Index",dimensions:this._dimensions}},i.fromJSON=function(t){return i.create(t.dimensions)},i}),{isClass:!0});var Qe=Z("bignumber",["typed","BigNumber"],(t=>{var{typed:e,BigNumber:i}=t;return e("bignumber",{"":function(){return new i(0)},number:function(t){return new i(t+"")},string:function(t){var e=t.match(/(0[box][0-9a-fA-F]*)i([0-9]*)/);if(e){var n=e[2],r=i(e[1]),o=new i(2).pow(Number(n));if(r.gt(o.sub(1)))throw new SyntaxError('String "'.concat(t,'" is out of range'));var s=new i(2).pow(Number(n)-1);return r.gte(s)?r.sub(o):r}return new i(t)},BigNumber:function(t){return t},Fraction:function(t){return new i(t.n).div(t.d).times(t.s)},null:function(t){return new i(0)},"Array | Matrix":function(t){return Yt(t,this)}})})),ti=Z("transpose",["typed","matrix"],(t=>{var{typed:e,matrix:i}=t;return e("transpose",{Array:function(t){return this(i(t)).valueOf()},Matrix:function(t){var e,i=t.size();switch(i.length){case 1:e=t.clone();break;case 2:var n=i[0],r=i[1];if(0===r)throw new RangeError("Cannot transpose a 2D matrix with no columns (size: "+gt(i)+")");switch(t.storage()){case"dense":e=function(t,e,i){for(var n,r=t._data,o=[],s=0;s<i;s++){n=o[s]=[];for(var a=0;a<e;a++)n[a]=J(r[a][s])}return t.createDenseMatrix({data:o,size:[i,e],datatype:t._datatype})}(t,n,r);break;case"sparse":e=function(t,e,i){for(var n,r,o,s=t._values,a=t._index,h=t._ptr,u=s?[]:void 0,c=[],m=[],l=[],p=0;p<e;p++)l[p]=0;for(n=0,r=a.length;n<r;n++)l[a[n]]++;for(var _=0,f=0;f<e;f++)m.push(_),_+=l[f],l[f]=m[f];for(m.push(_),o=0;o<i;o++)for(var d=h[o],y=h[o+1],v=d;v<y;v++){var g=l[a[v]]++;c[g]=o,s&&(u[g]=J(s[v]))}return t.createSparseMatrix({values:u,index:c,ptr:m,size:[i,e],datatype:t._datatype})}(t,n,r)}break;default:throw new RangeError("Matrix must be a vector or two dimensional (size: "+gt(this._size)+")")}return e},any:function(t){return J(t)}})})),ei="smallerEq",ii=Z(ei,["typed","config","matrix","DenseMatrix"],(t=>{var{typed:e,config:i,matrix:n,DenseMatrix:r}=t,o=ve({typed:e}),s=we({typed:e,DenseMatrix:r}),a=be({typed:e,DenseMatrix:r}),h=fe({typed:e}),u=de({typed:e});return e(ei,{"boolean, boolean":function(t,e){return t<=e},"number, number":function(t,e){return t<=e||ot(t,e,i.epsilon)},"BigNumber, BigNumber":function(t,e){return t.lte(e)||Ut(t,e,i.epsilon)},"Fraction, Fraction":function(t,e){return 1!==t.compare(e)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(t,e){if(!t.equalBase(e))throw new Error("Cannot compare units with different base");return this(t.value,e.value)},"SparseMatrix, SparseMatrix":function(t,e){return s(t,e,this)},"SparseMatrix, DenseMatrix":function(t,e){return o(e,t,this,!0)},"DenseMatrix, SparseMatrix":function(t,e){return o(t,e,this,!1)},"DenseMatrix, DenseMatrix":function(t,e){return h(t,e,this)},"Array, Array":function(t,e){return this(n(t),n(e)).valueOf()},"Array, Matrix":function(t,e){return this(n(t),e)},"Matrix, Array":function(t,e){return this(t,n(e))},"SparseMatrix, any":function(t,e){return a(t,e,this,!1)},"DenseMatrix, any":function(t,e){return u(t,e,this,!1)},"any, SparseMatrix":function(t,e){return a(e,t,this,!0)},"any, DenseMatrix":function(t,e){return u(e,t,this,!0)},"Array, any":function(t,e){return u(n(t),e,this,!1).valueOf()},"any, Array":function(t,e){return u(n(e),t,this,!0).valueOf()}})})),ni="index",ri=Z(ni,["typed","Index"],(t=>{var{typed:e,Index:i}=t;return e(ni,{"...number | string | BigNumber | Range | Array | Matrix":function(t){var e=t.map((function(t){return o(t)?t.toNumber():Array.isArray(t)||m(t)?t.map((function(t){return o(t)?t.toNumber():t})):t})),n=new i;return i.apply(n,e),n}})})),oi="subtract",si=Z(oi,["typed","matrix","equalScalar","addScalar","unaryMinus","DenseMatrix"],(t=>{var{typed:e,matrix:i,equalScalar:n,addScalar:r,unaryMinus:o,DenseMatrix:s}=t,a=le({typed:e}),h=ve({typed:e}),u=ge({typed:e,equalScalar:n}),c=_e({typed:e,DenseMatrix:s}),m=fe({typed:e}),l=de({typed:e});return e(oi,{"number, number":function(t,e){return t-e},"Complex, Complex":function(t,e){return t.sub(e)},"BigNumber, BigNumber":function(t,e){return t.minus(e)},"Fraction, Fraction":function(t,e){return t.sub(e)},"Unit, Unit":function(t,e){if(null===t.value)throw new Error("Parameter x contains a unit with undefined value");if(null===e.value)throw new Error("Parameter y contains a unit with undefined value");if(!t.equalBase(e))throw new Error("Units do not match");var i=t.clone();return i.value=this(i.value,e.value),i.fixPrefix=!1,i},"SparseMatrix, SparseMatrix":function(t,e){return ai(t,e),u(t,e,this)},"SparseMatrix, DenseMatrix":function(t,e){return ai(t,e),h(e,t,this,!0)},"DenseMatrix, SparseMatrix":function(t,e){return ai(t,e),a(t,e,this,!1)},"DenseMatrix, DenseMatrix":function(t,e){return ai(t,e),m(t,e,this)},"Array, Array":function(t,e){return this(i(t),i(e)).valueOf()},"Array, Matrix":function(t,e){return this(i(t),e)},"Matrix, Array":function(t,e){return this(t,i(e))},"SparseMatrix, any":function(t,e){return c(t,o(e),r)},"DenseMatrix, any":function(t,e){return l(t,e,this)},"any, SparseMatrix":function(t,e){return c(e,t,this,!0)},"any, DenseMatrix":function(t,e){return l(e,t,this,!0)},"Array, any":function(t,e){return l(i(t),e,this,!1).valueOf()},"any, Array":function(t,e){return l(i(e),t,this,!0).valueOf()}})}));function ai(t,e){var i=t.size(),n=e.size();if(i.length!==n.length)throw new bt(i.length,n.length)}var hi="range",ui=Z(hi,["typed","config","?matrix","?bignumber","smaller","smallerEq","larger","largerEq"],(t=>{var{typed:e,config:i,matrix:n,bignumber:r,smaller:o,smallerEq:s,larger:a,largerEq:h}=t;return e(hi,{string:c,"string, boolean":c,"number, number":function(t,e){return u(m(t,e,1))},"number, number, number":function(t,e,i){return u(m(t,e,i))},"number, number, boolean":function(t,e,i){return u(i?l(t,e,1):m(t,e,1))},"number, number, number, boolean":function(t,e,i,n){return u(n?l(t,e,i):m(t,e,i))},"BigNumber, BigNumber":function(t,e){return u(p(t,e,new(0,t.constructor)(1)))},"BigNumber, BigNumber, BigNumber":function(t,e,i){return u(p(t,e,i))},"BigNumber, BigNumber, boolean":function(t,e,i){var n=t.constructor;return u(i?_(t,e,new n(1)):p(t,e,new n(1)))},"BigNumber, BigNumber, BigNumber, boolean":function(t,e,i,n){return u(n?_(t,e,i):p(t,e,i))}});function u(t){return"Matrix"===i.matrix?n?n(t):Be():t}function c(t,e){var n=function(t){var e=t.split(":").map((function(t){return Number(t)}));if(e.some((function(t){return isNaN(t)})))return null;switch(e.length){case 2:return{start:e[0],end:e[1],step:1};case 3:return{start:e[0],end:e[2],step:e[1]};default:return null}}(t);if(!n)throw new SyntaxError('String "'+t+'" is no valid range');return"BigNumber"===i.number?(void 0===r&&function(){throw new Error('No "bignumber" implementation available')}(),u((e?_:p)(r(n.start),r(n.end),r(n.step)))):u((e?l:m)(n.start,n.end,n.step))}function m(t,e,i){var n=[],r=t;if(i>0)for(;o(r,e);)n.push(r),r+=i;else if(i<0)for(;a(r,e);)n.push(r),r+=i;return n}function l(t,e,i){var n=[],r=t;if(i>0)for(;s(r,e);)n.push(r),r+=i;else if(i<0)for(;h(r,e);)n.push(r),r+=i;return n}function p(t,e,i){var n=r(0),s=[],h=t;if(i.gt(n))for(;o(h,e);)s.push(h),h=h.plus(i);else if(i.lt(n))for(;a(h,e);)s.push(h),h=h.plus(i);return s}function _(t,e,i){var n=r(0),o=[],a=t;if(i.gt(n))for(;s(a,e);)o.push(a),a=a.plus(i);else if(i.lt(n))for(;h(a,e);)o.push(a),a=a.plus(i);return o}})),ci="equal",mi=Z(ci,["typed","matrix","equalScalar","DenseMatrix"],(t=>{var{typed:e,matrix:i,equalScalar:n,DenseMatrix:r}=t,o=ve({typed:e}),s=we({typed:e,DenseMatrix:r}),a=be({typed:e,DenseMatrix:r}),h=fe({typed:e}),u=de({typed:e});return e(ci,{"any, any":function(t,e){return null===t?null===e:null===e?null===t:void 0===t?void 0===e:void 0===e?void 0===t:n(t,e)},"SparseMatrix, SparseMatrix":function(t,e){return s(t,e,n)},"SparseMatrix, DenseMatrix":function(t,e){return o(e,t,n,!0)},"DenseMatrix, SparseMatrix":function(t,e){return o(t,e,n,!1)},"DenseMatrix, DenseMatrix":function(t,e){return h(t,e,n)},"Array, Array":function(t,e){return this(i(t),i(e)).valueOf()},"Array, Matrix":function(t,e){return this(i(t),e)},"Matrix, Array":function(t,e){return this(t,i(e))},"SparseMatrix, any":function(t,e){return a(t,e,n,!1)},"DenseMatrix, any":function(t,e){return u(t,e,n,!1)},"any, SparseMatrix":function(t,e){return a(e,t,n,!0)},"any, DenseMatrix":function(t,e){return u(e,t,n,!0)},"Array, any":function(t,e){return u(i(t),e,n,!1).valueOf()},"any, Array":function(t,e){return u(i(e),t,n,!0).valueOf()}})}));Z(ci,["typed","equalScalar"],(t=>{var{typed:e,equalScalar:i}=t;return e(ci,{"any, any":function(t,e){return null===t?null===e:null===e?null===t:void 0===t?void 0===e:void 0===e?void 0===t:i(t,e)}})}));var li=st({}),pi=lt({config:n}),_i=pt({}),fi=dt({}),di=qt({Matrix:_i}),yi=kt({BigNumber:pi,Complex:li,DenseMatrix:di,Fraction:fi}),vi=Zt({config:n,typed:yi}),gi=te({typed:yi}),xi=ie({typed:yi}),bi=re({typed:yi}),Ai=se({typed:yi}),wi=ae({typed:yi}),Bi=he({typed:yi}),Mi=ue({Matrix:_i,equalScalar:vi,typed:yi}),Ci=me({DenseMatrix:di,Matrix:_i,SparseMatrix:Mi,typed:yi}),Si=Ae({DenseMatrix:di,equalScalar:vi,matrix:Ci,typed:yi}),zi=Ce({matrix:Ci,config:n,typed:yi}),Ii=Ne({matrix:Ci,typed:yi}),Pi=Le({DenseMatrix:di,config:n,matrix:Ci,typed:yi}),Ei=ke({DenseMatrix:di,config:n,matrix:Ci,typed:yi}),Ni=Re({DenseMatrix:di,smaller:Pi}),Vi=Je({DenseMatrix:di,SparseMatrix:Mi,addScalar:bi,equalScalar:vi,matrix:Ci,typed:yi}),Ti=We({addScalar:bi,dot:Ye({addScalar:bi,conj:Ai,multiplyScalar:gi,size:zi,typed:yi}),equalScalar:vi,matrix:Ci,multiplyScalar:gi,typed:yi}),Fi=Ge({matrix:Ci,typed:yi}),Di=Ke({DenseMatrix:di,config:n,matrix:Ci,typed:yi}),qi=$e({ImmutableDenseMatrix:Ni}),Li=Qe({BigNumber:pi,typed:yi}),Oi=ti({matrix:Ci,typed:yi}),ki=ii({DenseMatrix:di,config:n,matrix:Ci,typed:yi}),ji=ri({Index:qi,typed:yi}),Ri=si({DenseMatrix:di,addScalar:bi,equalScalar:vi,matrix:Ci,typed:yi,unaryMinus:xi}),Ji=ui({bignumber:Li,matrix:Ci,config:n,larger:Ei,largerEq:Di,smaller:Pi,smallerEq:ki,typed:yi}),Yi=mi({DenseMatrix:di,equalScalar:vi,matrix:Ci,typed:yi});function Ui(t){return(Ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wi(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Zi(t,e)}function Zi(t,e){return(Zi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Hi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=Xi(t);if(e){var r=Xi(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Gi(this,i)}}function Gi(t,e){return!e||"object"!==Ui(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Xi(t){return(Xi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ki(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qi(t,e,i){return e&&$i(t.prototype,e),i&&$i(t,i),t}function tn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}}(t,e)||rn(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function en(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=rn(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw o}}}}function nn(t){return function(t){if(Array.isArray(t))return on(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||rn(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rn(t,e){if(t){if("string"==typeof t)return on(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?on(t,e):void 0}}function on(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var sn=i(495);function an(t){var e=Bi(t),i=wi(t);return[[i,-e],[e,i]]}function hn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return nn(Array(t).keys()).map((function(t){return t+e}))}function un(t,e){return t.map((function(t,i){return[t,e[i]]}))}function cn(t){return Si(t,2*Math.PI)}function mn(t,e){var i=t[0][0],n=t[t.length-1][1];return function(r){for(;r>n||Yi(r,n);)r-=e;for(;r<i&&!Yi(r,i);)r+=e;var o,s=en(t);try{for(s.s();!(o=s.n()).done;){var a=tn(o.value,4),h=a[0],u=a[1],c=a[2],m=a[3];if(Yi(h,r)||h<r&&r<u)return c*Math.abs(Math.cos(r-m))}}catch(t){s.e(t)}finally{s.f()}}}function ln(t,e){var i=t[0][0],n=t[t.length-1][1];return function(r){for(;r>n||Yi(r,n);)r-=e;for(;r<i&&!Yi(r,i);)r+=e;var o,s=en(t);try{for(s.s();!(o=s.n()).done;){var a=tn(o.value,3),h=a[0],u=a[1],c=a[2];if(h<r&&r<u||Yi(r,h))return c}}catch(t){s.e(t)}finally{s.f()}}}sn.Settings.maxPolygonVertices=50;var pn=function(){function t(e,i,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:200,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:200,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:40;Ki(this,t),this.angle=r,s/=2,o/=2;var h=an(r),u=Ti(h,Ci([[0,0],[-o,o]])),c=Vi(u,[[i,i],[n,n]]),m=Ri(c.subset(ji([0,1],1)),c.subset(ji([0,1],0)));(m=new sn.Vec2(Ii(m,ji(0,0)),Ii(m,ji(1,0)))).normalize(),m.mul(a),this.botVel=m,this.botPos=new sn.Vec2(Ii(c,ji(0,0)),Ii(c,ji(1,0)));var l=this.makeGripper(e,this.botPos,s,r),p=tn(l,2);this.bot=p[0],this.botEdge=p[1],this.topVel=sn.Vec2.neg(this.botVel),this.topPos=new sn.Vec2(Ii(c,ji(0,1)),Ii(c,ji(1,1)));var _=this.makeGripper(e,this.topPos,s,r),f=tn(_,2);this.top=f[0],this.topEdge=f[1]}return Qi(t,[{key:"makeGripper",value:function(t,e,i,n){var r=t.createBody({type:"kinematic",position:e,angle:n,fixedRotation:!0}),o=sn.Edge(sn.Vec2(-i,0),sn.Vec2(i,0));return r.createFixture({shape:o,friction:0,restitution:0,density:1,filterGroupIndex:-1,filterCategoryBits:1,filterMaskBits:2}),[r,o]}},{key:"squeeze",value:function(){this.bot.setLinearVelocity(this.botVel),this.top.setLinearVelocity(this.topVel)}},{key:"unsqueeze",value:function(){this.top.setLinearVelocity(sn.Vec2.neg(this.topVel)),this.bot.setLinearVelocity(sn.Vec2.neg(this.botVel))}},{key:"push",value:function(){this.bot.setLinearVelocity(this.botVel)}},{key:"grasp",value:function(){this.top.setLinearVelocity(this.topVel)}},{key:"stop",value:function(){this.top.setLinearVelocity(new sn.Vec2(0,0)),this.bot.setLinearVelocity(new sn.Vec2(0,0))}},{key:"limitUnsqueeze",value:function(){sn.Vec2.lengthOf(sn.Vec2.sub(this.top.getPosition(),this.topPos))<10&&this.top.setLinearVelocity(new sn.Vec2(0,0)),sn.Vec2.lengthOf(sn.Vec2.sub(this.bot.getPosition(),this.botPos))<10&&this.bot.setLinearVelocity(new sn.Vec2(0,0))}},{key:"distance",value:function(){return sn.Vec2.lengthOf(sn.Vec2.sub(this.top.getPosition(),this.bot.getPosition()))}}]),t}(),_n=function(){function t(e,i,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Ki(this,t),null==o&&(o=Math.random()*Math.PI),this.body=e.createBody({type:"dynamic",position:sn.Vec2(i,n),angle:o}),this.poly=sn.Polygon(r),this.body.createFixture({shape:this.poly,density:1,friction:0,restitution:0})}return Qi(t,[{key:"setMoveFilter",value:function(){for(var t=this.body.getFixtureList();t;t=t.getNext())t.isSensor()||t.setFilterData({groupIndex:-2,categoryBits:2,maskBits:0})}},{key:"setSqueezeFilter",value:function(){for(var t=this.body.getFixtureList();t;t=t.getNext())t.isSensor()||t.setFilterData({groupIndex:-2,categoryBits:2,maskBits:3})}},{key:"move",value:function(){this.body.setLinearVelocity(sn.Vec2(100,0)),this.setMoveFilter()}},{key:"squeeze",value:function(){this.setSqueezeFilter()}}]),t}(),fn=function(){function t(e,i,n){var r=this;Ki(this,t),this.rows=[-150,150],this.points=e,this.angles=i,this.polygonAngles=n,this.spacing=300,this.gripperPos=hn(i.length,1).map((function(t){return t*r.spacing})),this.startPos=0,this.displayPos=(i.length+1)*this.spacing,this.delPos=(i.length+2)*this.spacing,this.xlim=[this.startPos,this.delPos],this.ylim=[-300,400],this.world=sn.World({gravity:new sn.Vec2(0,0)}),this.grippers=hn(this.rows.length).map((function(t){return Array(i.length)})),this.initGrippers(),this.polygons=hn(this.rows.length).map((function(t){return Array(0)})),this.initDrawPoints(),this.setPolygons(),this.TOTAL_TIME=null}return Qi(t,[{key:"initGrippers",value:function(){var t,e=en(this.rows.entries());try{for(e.s();!(t=e.n()).done;){var i,n=tn(t.value,2),r=n[0],o=n[1],s=en(un(this.angles,this.gripperPos).entries());try{for(s.s();!(i=s.n()).done;){var a=tn(i.value,2),h=a[0],u=tn(a[1],2),c=u[0],m=u[1];this.grippers[r][h]=new pn(this.world,m,o,c)}}catch(t){s.e(t)}finally{s.f()}}}catch(t){e.e(t)}finally{e.f()}}},{key:"initDrawPoints",value:function(){var t={x:this.points.map((function(t){return t.x})),y:this.points.map((function(t){return t.y}))};t.x.push(t.x[0]),t.y.push(t.y[0]);var e={x:t.x.slice(2),y:t.y.slice(2)};this.thickLine=0;for(var i=function(t){return sn.Vec2.lengthOf(sn.Vec2.sub(sn.Vec2(t.x[0],t.y[0]),sn.Vec2(t.x[1],t.y[1])))},n=0;n<t.length-1;n++){var r={x:t.x.slice(n,n+2),y:t.y.slice(n,n+2)};i(r)>i(e)&&(e=r,this.thickLine=n)}this.drawPoints=[t.x,t.y]}},{key:"setPolygons",value:function(){if(this.rows.length===this.polygonAngles.length)for(var t=0;t<this.rows.length;t++){this.polygons[t]=[];var e,i=en(this.polygonAngles[t].entries());try{for(i.s();!(e=i.n()).done;){var n=tn(e.value,2),r=n[0],o=n[1];this.polygons[t].push(new _n(this.world,(r+1)*this.spacing,this.rows[t],this.points,parseFloat(o)))}}catch(t){i.e(t)}finally{i.f()}}}},{key:"addPolygon",value:function(){var t,e=en(this.rows.entries());try{for(e.s();!(t=e.n()).done;){var i=tn(t.value,2),n=i[0],r=i[1];this.polygons[n].unshift(new _n(this.world,0,r,this.points))}}catch(t){e.e(t)}finally{e.f()}}},{key:"stepEngine",value:function(){this.world.step(1/60,10,8)}},{key:"step",value:function(t){throw"Redefine in subclass!"}},{key:"draw",value:function(){return{data:this.getTraces(),layout:{xaxis:{range:this.xlim,showticklabels:!1,showgrid:!1,zeroline:!1},yaxis:{scaleanchor:"x",range:this.ylim,showticklabels:!1,showgrid:!1,zeroline:!1},showlegend:!1,annotations:un(this.gripperPos,this.angles).map((function(t){var e=tn(t,2),i=e[0],n=e[1];return{x:i,y:350,text:Math.round(180*n/Math.PI),showarrow:!1,font:{family:"sans serif",size:18,color:"black"}}}))}}}},{key:"getTraces",value:function(){for(var t=[],e=0;e<this.rows.length;e++){for(var i=0;i<this.polygons[e].length;i++){var n=this.polygons[e][i].body,r=Ti(an(n.getAngle()),this.drawPoints),o={type:"scatter",x:(r=Vi(r,[Array(this.drawPoints[0].length).fill(n.getPosition().x),Array(this.drawPoints[1].length).fill(n.getPosition().y)]))[0],y:r[1],mode:"lines",fill:"toself",fillcolor:"#2D4262",line:{color:"black"}},s={type:"scatter",x:Fi(Ii(r,ji(0,Ji(this.thickLine,this.thickLine+2)))),y:Fi(Ii(r,ji(1,Ji(this.thickLine,this.thickLine+2)))),mode:"lines",line:{color:"#DB9501",width:4}};t.push(o,s)}for(var a=0;a<this.grippers[e].length;a++){var h=this.grippers[e][a],u=Oi([h.topEdge.m_vertex1,h.topEdge.m_vertex2].map((function(t){return[t.x,t.y]})));u=Vi(Ti(an(h.top.getAngle()),u),[Array(u[0].length).fill(h.top.getPosition().x),Array(u[1].length).fill(h.top.getPosition().y)]);var c=Oi([h.botEdge.m_vertex1,h.botEdge.m_vertex2].map((function(t){return[t.x,t.y]})));c=Vi(Ti(an(h.bot.getAngle()),c),[Array(c[0].length).fill(h.bot.getPosition().x),Array(c[1].length).fill(h.bot.getPosition().y)]);var m={type:"scatter",x:u[0],y:u[1],mode:"lines",line:{color:"black",width:4}},l={type:"scatter",x:c[0],y:c[1],mode:"lines",line:{color:"black",width:4}};t.push(m,l)}}return t}},{key:"stepDraw",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=[],i=0;i<t;i++)for(var n=0;n<this.TOTAL_TIME;n++)this.step(n),n%16==0&&e.push(this.draw());return e}},{key:"serialize",value:function(){return this.polygons.map((function(t){return t.map((function(t){return t.body.getAngle()}))}))}}]),t}(),dn=function(t){Wi(i,t);var e=Hi(i);function i(t,n,r,o,s){var a;return Ki(this,i),(a=e.call(this,t,n,r)).gripperMinDist=hn(a.rows.length).map((function(t){return Array(0)})),a.polygonRotateDist=hn(a.rows.length).map((function(t){return Array(0)})),a.stopRotateAngle=hn(a.rows.length).map((function(t){return Array(0)})),a.diameterCallable=mn(o,Math.PI),a.squeezeCallable=ln(s,Math.PI),a.TOTAL_TIME=450,a}return Qi(i,[{key:"step",value:function(t){var e=this;if(0==(t%=this.TOTAL_TIME)){this.addPolygon();var i,n=en(this.polygons);try{for(n.s();!(i=n.n()).done;){var r,o=en(i.value);try{for(o.s();!(r=o.n()).done;){var s=r.value;s.body.setLinearDamping(0),s.move()}}catch(t){o.e(t)}finally{o.f()}}}catch(t){n.e(t)}finally{n.f()}var a,h=en(this.grippers);try{for(h.s();!(a=h.n()).done;){var u,c=en(a.value);try{for(c.s();!(u=c.n()).done;)u.value.stop()}catch(t){c.e(t)}finally{c.f()}}}catch(t){h.e(t)}finally{h.f()}}else if(50<t&&t<200){var m,l=en(this.polygons);try{for(l.s();!(m=l.n()).done;){var p=m.value;p.length&&function(){var t=p[p.length-1].body;t.getPosition().x>=e.delPos&&(e.world.destroyBody(t),p.pop());var i,n=en(p);try{var r=function(){var t=i.value;(e.gripperPos.some((function(e){return Math.abs(t.body.getPosition().x-e)<3}))||Math.abs(t.body.getPosition().x-e.displayPos)<3)&&t.body.setLinearVelocity(sn.Vec2(0,0))};for(n.s();!(i=n.n()).done;)r()}catch(t){n.e(t)}finally{n.f()}}()}}catch(t){l.e(t)}finally{l.f()}}else if(200===t){this.gripperMinDist=this.rows.map((function(t){return e.gripperPos.map((function(t){return 50}))})),this.polygonRotateDist=this.rows.map((function(t){return e.gripperPos.map((function(t){return 0}))})),this.stopRotateAngle=this.rows.map((function(t){return e.gripperPos.map((function(t){return 0}))}));var _,f=en(this.polygons.entries());try{for(f.s();!(_=f.n()).done;){var d,y=tn(_.value,2),v=y[0],g=en(y[1].slice(0,this.angles.length).entries());try{for(g.s();!(d=g.n()).done;){var x=tn(d.value,2),b=x[0],A=x[1];A.squeeze(),A.body.setFixedRotation(!0);var w=this.grippers[v][b].angle,B=cn(cn(w)-cn(A.body.getAngle()));this.polygonRotateDist[v][b]=this.diameterCallable(B);var M=this.squeezeCallable(B),C=cn(cn(w)-cn(M));this.stopRotateAngle[v][b]=C,this.gripperMinDist[v][b]=this.diameterCallable(M)}}catch(t){g.e(t)}finally{g.f()}}}catch(t){f.e(t)}finally{f.f()}var S,z=en(this.grippers);try{for(z.s();!(S=z.n()).done;){var I,P=en(S.value);try{for(P.s();!(I=P.n()).done;)I.value.squeeze()}catch(t){P.e(t)}finally{P.f()}}}catch(t){z.e(t)}finally{z.f()}}else if(200<t&&t<350){var E,N=en(this.grippers.entries());try{for(N.s();!(E=N.n()).done;){var V,T=tn(E.value,2),F=T[0],D=en(T[1].entries());try{for(D.s();!(V=D.n()).done;){var q=tn(V.value,2),L=q[0],O=q[1],k=O.distance();if(L<this.polygons[F].length&&function(){var t=e.polygons[F][L];if(Math.abs(k-e.polygonRotateDist[F][L])<10&&(t.body.setFixedRotation(!1),t.body.setAngularDamping(0)),Math.abs(cn(t.body.getAngle())-cn(e.stopRotateAngle[F][L]))<.08){t.body.setFixedRotation(!0),t.body.setLinearDamping(1/0),t.setMoveFilter();var i=!1;e.world.rayCast(O.top.getWorldPoint(O.topEdge.m_vertex1),O.top.getWorldPoint(O.topEdge.m_vertex2),(function(e,n,r,o){return e===t.body.getFixtureList()?(i=!0,0):-1}));var n=!1;e.world.rayCast(O.bot.getWorldPoint(O.botEdge.m_vertex1),O.bot.getWorldPoint(O.botEdge.m_vertex2),(function(e,i,r,o){return e===t.body.getFixtureList()?(n=!0,0):-1})),i&&O.top.setLinearVelocity(sn.Vec2(0,0)),n&&O.bot.setLinearVelocity(sn.Vec2(0,0)),i&&n&&t.body.setAngle(e.stopRotateAngle[F][L])}}(),(Math.abs(k-this.gripperMinDist[F][L])<5||k<3)&&(O.stop(),L<this.polygons[F].length)){var j=this.polygons[F][L];j.body.setAngle(this.stopRotateAngle[F][L]),j.body.setFixedRotation(!0),j.body.setLinearDamping(1/0)}}}catch(t){D.e(t)}finally{D.f()}}}catch(t){N.e(t)}finally{N.f()}}else if(350===t){var R,J=en(this.polygons);try{for(J.s();!(R=J.n()).done;){var Y,U=en(R.value);try{for(U.s();!(Y=U.n()).done;){var W=Y.value;W.body.setFixedRotation(!0),W.body.setLinearDamping(1/0)}}catch(t){U.e(t)}finally{U.f()}}}catch(t){J.e(t)}finally{J.f()}var Z,H=en(this.grippers);try{for(H.s();!(Z=H.n()).done;){var G,X=en(Z.value);try{for(X.s();!(G=X.n()).done;)G.value.unsqueeze()}catch(t){X.e(t)}finally{X.f()}}}catch(t){H.e(t)}finally{H.f()}}else if(t>350){var K,$=en(this.grippers);try{for($.s();!(K=$.n()).done;){var Q,tt=en(K.value);try{for(tt.s();!(Q=tt.n()).done;)Q.value.limitUnsqueeze()}catch(t){tt.e(t)}finally{tt.f()}}}catch(t){$.e(t)}finally{$.f()}}this.stepEngine()}}]),i}(fn),yn=function(t){Wi(i,t);var e=Hi(i);function i(t,n,r,o,s,a,h){var u;return Ki(this,i),(u=e.call(this,t,n,r)).gripperPushDist=u.rows.map((function(t){return Array(0)})),u.gripperSqueezeDist=u.rows.map((function(t){return Array(0)})),u.stopPushAngle=u.rows.map((function(t){return Array(0)})),u.stopSqueezeAngle=u.rows.map((function(t){return Array(0)})),u.polygonPins=u.rows.map((function(t){return Array(0)})),u.radiusCallable=mn(o),u.diameterCallable=mn(s),u.pushCallable=ln(a),u.pushGraspCallable=ln(h),u.staticBody=u.world.createBody({type:"static"}),u.TOTAL_TIME=650,u}return Qi(i,[{key:"step",value:function(t){var e=this;if(0==(t%=this.TOTAL_TIME)){this.addPolygon();var i,n=en(this.polygons);try{for(n.s();!(i=n.n()).done;){var r,o=en(i.value);try{for(o.s();!(r=o.n()).done;){var s=r.value;s.body.setLinearDamping(0),s.move()}}catch(t){o.e(t)}finally{o.f()}}}catch(t){n.e(t)}finally{n.f()}var a,h=en(this.grippers);try{for(h.s();!(a=h.n()).done;){var u,c=en(a.value);try{for(c.s();!(u=c.n()).done;)u.value.stop()}catch(t){c.e(t)}finally{c.f()}}}catch(t){h.e(t)}finally{h.f()}}else if(50<t&&t<200){var m,l=en(this.polygons);try{for(l.s();!(m=l.n()).done;){var p=m.value;p.length&&function(){var t=p[p.length-1].body;t.getPosition().x>=e.delPos&&(e.world.destroyBody(t),p.pop());var i,n=en(p);try{var r=function(){var t=i.value;(e.gripperPos.some((function(e){return Math.abs(t.body.getPosition().x-e)<3}))||Math.abs(t.body.getPosition().x-e.displayPos)<3)&&t.body.setLinearVelocity(sn.Vec2(0,0))};for(n.s();!(i=n.n()).done;)r()}catch(t){n.e(t)}finally{n.f()}}()}}catch(t){l.e(t)}finally{l.f()}}else if(200===t){this.gripperPushDist=this.rows.map((function(t){return Array(e.gripperPos.length).fill(50)})),this.gripperSqueezeDist=this.rows.map((function(t){return Array(e.gripperPos.length).fill(50)})),this.stopPushAngle=this.rows.map((function(t){return Array(e.polygons[0].length).fill(0)})),this.stopSqueezeAngle=this.rows.map((function(t){return Array(e.polygons[0].length).fill(0)})),this.polygonPins=this.rows.map((function(t){return Array(Math.min(e.polygons[0].length,e.gripperPos.length))}));var _,f=en(this.polygons.entries());try{for(f.s();!(_=f.n()).done;){var d,y=tn(_.value,2),v=y[0],g=en(y[1].slice(0,this.gripperPos.length).entries());try{for(g.s();!(d=g.n()).done;){var x=tn(d.value,2),b=x[0],A=x[1];A.squeeze(),A.body.setFixedRotation(!1);var w=this.grippers[v][b],B=cn(cn(w.angle)-cn(A.body.getAngle())),M=this.pushCallable(B),C=cn(cn(w.angle)-cn(M)),S=this.pushGraspCallable(B),z=cn(cn(w.angle)-cn(S));this.gripperPushDist[v][b]=this.radiusCallable(M),this.gripperSqueezeDist[v][b]=this.diameterCallable(S),this.stopPushAngle[v][b]=C,this.stopSqueezeAngle[v][b]=z;var I=this.world.createJoint(sn.RevoluteJoint({},this.staticBody,A.body,A.body.getWorldCenter()));this.polygonPins[v][b]=I}}catch(t){g.e(t)}finally{g.f()}}}catch(t){f.e(t)}finally{f.f()}var P,E=en(this.grippers);try{for(E.s();!(P=E.n()).done;){var N,V=en(P.value);try{for(V.s();!(N=V.n()).done;)N.value.push()}catch(t){V.e(t)}finally{V.f()}}}catch(t){E.e(t)}finally{E.f()}}else if(200<t&&t<350){var T,F=en(this.grippers.entries());try{for(F.s();!(T=F.n()).done;){var D,q=tn(T.value,2),L=q[0],O=en(q[1].entries());try{for(O.s();!(D=O.n()).done;){var k=tn(D.value,2),j=k[0],R=k[1];j<this.polygons[L].length?function(){var t=e.polygons[L][j],i=sn.Vec2.lengthOf(sn.Vec2.sub(R.bot.getPosition(),t.body.getWorldCenter()));if(Math.abs(cn(t.body.getAngle())-cn(e.stopPushAngle[L][j]))<.08||Math.abs(i-e.gripperPushDist[L][j])<5){t.body.setFixedRotation(!0),t.body.setLinearDamping(1/0),t.setMoveFilter();var n=!1;e.world.rayCast(R.bot.getWorldPoint(R.botEdge.m_vertex1),R.bot.getWorldPoint(R.botEdge.m_vertex2),(function(e,i,r,o){return e===t.body.getFixtureList()?(n=!0,0):-1})),n&&(R.bot.setLinearVelocity(sn.Vec2(0,0)),t.body.setAngle(e.stopPushAngle[L][j]))}}():Math.abs(sn.Vec2.lengthOf(sn.Vec2.sub(R.bot.getPosition(),R.botPos))-this.gripperPushDist[L][j])<5&&R.stop()}}catch(t){O.e(t)}finally{O.f()}}}catch(t){F.e(t)}finally{F.f()}}else if(350===t){var J,Y=en(this.polygons);try{for(Y.s();!(J=Y.n()).done;){var U,W=en(J.value);try{for(W.s();!(U=W.n()).done;){var Z=U.value;Z.squeeze(),Z.body.setFixedRotation(!1)}}catch(t){W.e(t)}finally{W.f()}}}catch(t){Y.e(t)}finally{Y.f()}var H,G=en(this.polygonPins);try{for(G.s();!(H=G.n()).done;){var X,K=en(H.value);try{for(K.s();!(X=K.n()).done;){var $=X.value;this.world.destroyJoint($)}}catch(t){K.e(t)}finally{K.f()}}}catch(t){G.e(t)}finally{G.f()}var Q,tt=en(this.grippers);try{for(tt.s();!(Q=tt.n()).done;){var et,it=en(Q.value);try{for(it.s();!(et=it.n()).done;)et.value.grasp()}catch(t){it.e(t)}finally{it.f()}}}catch(t){tt.e(t)}finally{tt.f()}}else if(350<t&&t<500){var nt,rt=en(this.grippers.entries());try{for(rt.s();!(nt=rt.n()).done;){var ot,st=tn(nt.value,2),at=st[0],ht=en(st[1].entries());try{for(ht.s();!(ot=ht.n()).done;){var ut=tn(ot.value,2),ct=ut[0],mt=ut[1],lt=mt.distance();if(ct<this.polygons[at].length&&function(){var t=e.polygons[at][ct];if(Math.abs(cn(t.body.getAngle())-cn(e.stopSqueezeAngle[at][ct]))<.08){t.body.setFixedRotation(!0),t.body.setLinearDamping(1/0),t.setMoveFilter();var i=!1;e.world.rayCast(mt.top.getWorldPoint(mt.topEdge.m_vertex1),mt.top.getWorldPoint(mt.topEdge.m_vertex2),(function(e,n,r,o){return e===t.body.getFixtureList()?(i=!0,0):-1})),i&&(mt.top.setLinearVelocity(sn.Vec2(0,0)),t.body.setAngle(e.stopSqueezeAngle[at][ct]))}}(),(Math.abs(lt-this.gripperSqueezeDist[at][ct])<5||lt<3)&&(mt.stop(),ct<this.polygons[at].length)){var pt=this.polygons[at][ct];pt.body.setAngle(this.stopSqueezeAngle[at][ct]),pt.body.setFixedRotation(!0),pt.body.setLinearDamping(1/0)}}}catch(t){ht.e(t)}finally{ht.f()}}}catch(t){rt.e(t)}finally{rt.f()}}else if(500===t){var _t,ft=en(this.polygons);try{for(ft.s();!(_t=ft.n()).done;){var dt,yt=en(_t.value);try{for(yt.s();!(dt=yt.n()).done;){var vt=dt.value;vt.body.setFixedRotation(!0),vt.body.setLinearDamping(1/0)}}catch(t){yt.e(t)}finally{yt.f()}}}catch(t){ft.e(t)}finally{ft.f()}var gt,xt=en(this.grippers);try{for(xt.s();!(gt=xt.n()).done;){var bt,At=en(gt.value);try{for(At.s();!(bt=At.n()).done;)bt.value.unsqueeze()}catch(t){At.e(t)}finally{At.f()}}}catch(t){xt.e(t)}finally{xt.f()}}else if(t>500){var wt,Bt=en(this.grippers);try{for(Bt.s();!(wt=Bt.n()).done;){var Mt,Ct=en(wt.value);try{for(Ct.s();!(Mt=Ct.n()).done;)Mt.value.limitUnsqueeze()}catch(t){Ct.e(t)}finally{Ct.f()}}}catch(t){Bt.e(t)}finally{Bt.f()}}this.stepEngine()}}]),i}(fn);window.dash_clientside=Object.assign({},window.dash_clientside,{clientside:{updateAnim:function(t,e,i,n,r){if(!("squeezeFunc"in i&&"diameterFunc"in i&&"radiusFunc"in i&&"pushFunc"in i&&"pushGraspFunc"in i&&"points"in i&&"sqPlan"in i&&"pgPlan"in i&&"convexhull"in i))return[];if("stop"===e)return[[],n,!0,!0,r];if("sq_anim"===e){var o=new dn(i.points,i.sqPlan,n.sqPolygonAngles||[],i.diameterFunc,i.squeezeFunc),s=o.stepDraw(5);return n.sqPolygonAngles=o.serialize(),[s,n,!1,!1,e]}if("pg_anim"===e){var a=new yn(i.points,i.pgPlan,n.pgPolygonAngles||[],i.radiusFunc,i.diameterFunc,i.pushFunc,i.pushGraspFunc),h=a.stepDraw(5);return n.pgPolygonAngles=a.serialize(),[h,n,!1,!1,e]}}}})})()})();